<%
	curMode = (Request.Query.HasProperty("m") ? String(Request.Query.m) : "0");
	step = (Request.Query.HasProperty( 'step' ) ? String( Request.Query.step ) : '1');
	userCode = (Request.Query.HasProperty('user') ? String( Request.Query.user ) : '');
	orgCode = (Request.Query.HasProperty('org') ? String( Request.Query.org ) : '0');
	lastName = (Request.Query.HasProperty('name') ? UrlDecode(Request.Query.name) : '');
	error = (Request.Query.HasProperty('err') ? UrlDecode(Request.Query.err) : '0');
	qCode = (Request.Query.HasProperty("q") ? UrlDecode(Request.Query.q) : "");
	badEmail = (Request.Query.HasProperty("email") ? UrlDecode(Request.Query.email) : "");
	partMail = (Request.Query.HasProperty("s") ? UrlDecode(Request.Query.s) : "");
%>
<HTML XMLNS="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Регистрация в СДО NLMK-WebTutor</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251" />
<%Server.Execute( "include/head.html" )%>
<style type="text/css">
	input.inputEdit {
		padding: 0 4px;
	}
	td.paddingPic {
		position: relative;
	}
	td.paddingPic:before {
		content: url('pics/attention.png');
		position: absolute;
		left: 1px;
		top: -0px;
    }
</style>
</HEAD>

<BODY class="defaultBody">

<TABLE ID="loginBodyTable" CLASS="loginBodyTable" CELLPADDING="0" CELLSPACING="0" BORDER="0" ALIGN="center">
<TR>
	<TD ID="docBodyTableTop" CLASS="bgTopUnder">
	
	<TABLE WIDTH="100%" CELLPADDING="0" CELLSPACING="0" BORDER="0">
		<TR>
			<TD><DIV ID="bg_left_top" CLASS="loginLeftTop"><IMG SRC="pics/1blank.gif" BORDER="0" CLASS="bgLeftTopTangle"/></DIV></TD>
			<TD><DIV ID="header_main" CLASS="loginHeader"><IMG SRC="pics/1blank.gif"/></DIV></TD>
		</TR>
	</TABLE>
	
	</TD>
</TR>
<TR>
	<TD>
	
	<TABLE WIDTH="100%"  border="0" CELLSPACING="0" CELLPADDING="0">
		<TR>
			<TD CLASS="mainMenuTop"><IMG SRC="pics/1blank.gif" WIDTH="1" HEIGHT="0" /></TD>
		</TR>
		<TR>
			<TD CLASS="mainMenuCenter"><IMG SRC="pics/1blank.gif" WIDTH="1" HEIGHT="15" /></TD>
		</TR>
		<TR>
			<TD CLASS="mainMenuBottom"><IMG SRC="pics/1blank.gif" WIDTH="1" HEIGHT="0" /></TD>
		</TR>
	</TABLE>
		
	<TABLE WIDTH="100%"  border="0" CELLSPACING="0" CELLPADDING="0" ALIGN="center"  class="registerTable">
	<FORM NAME="form_register_user" METHOD="post" ACTION="register_user_server.html">
		<TR>
			<TD VALIGN="top" CLASS="registerTD">
				
			<TABLE WIDTH="100%" BORDER="0" CELLSPACING="2" CELLPADDING="0">
			
<%
if(curMode!="0") {
%>
	<tr>
		<td CLASS="registerRightTD" colspan="2">
	<%switch (curMode) {
		case "email_send":
	%>
		<p style="text-align:justify;margin-bottom: 20px;"><b>В ближайшее время данные авторизации поступят на адрес электронной почты <%=partMail%>***@nlmk.com.<b/>
		<tr><td style="text-align:center;">
		<INPUT TYPE="submit" NAME="go" VALUE="На главную" STYLE="width:150px;margin-bottom:20px;" CLASS="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" id="btSend" 
		onClick="document.location.href = 'default.html'; return false;">
		</td></tr>
	<%	break;
		case "not_answer":
	%>
		<p style="text-align:justify;margin-bottom: 20px;"><b>Для восстановления пароля к СДО Вам необходимо отправить письмо администратору дистанционного обучения. В ответ Вы получите письмо с логином и временным паролем, который необходимо будет сменить.<b/></p>
		<tr><td style="text-align:center;">
		<INPUT TYPE="submit" NAME="go" VALUE="Отправить письмо" STYLE="width:150px;margin-bottom:20px;" CLASS="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" id="btSend" 
		onClick="document.location.href = 'mailto:nl-a-do@nlmk.com ?subject=27307/<%=userCode%> &Body=Напомнить пароль'; return false;">
		</td></tr>
<%		break;
	}
} else {%>
<%if(error!="0") {%>
	<tr>
		<td CLASS="registerRightTD paddingPic" colspan="2" style="padding-left:40px;">
<%switch (error) {
	case "not_compare":
%>
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27301/<%=userCode%></br>Введенный табельный номер не соответствует введенной фамилии сотрудника.<b/></p>
<%	break;
	case "many_users":
%>
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27302/<%=userCode%></br>В базе данных найдено несколько сотрудников с указанным табельным номером. Сообщите код ошибки администртору дистанционного обучения по <a href="mailto:nl-a-do@nlmk.com ?subject=27302/<%=userCode%> &Body=Множественное совпадение">электронной почте</a>.<b/></p>
<%	break;
	case "not_user":
%>			
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27303/<%=userCode%></br>В базе данных не найден сотрудник с указанными данными. Если Вы ранее не были зарегистрированы в СДО NLMK-WebTutor, то необходимо пройти <a href="https://apps.nlmk.ru/sites/e-learning/SitePages/onlineEntry.aspx" target="_blank">регистрацию</a>.<b/></p>
<%	break;
	case "not_data":
%>
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27304</br>Введены неверные первоначальные данные.<b/></p>
<%	break;
	case "bad_question":
%>
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27305/<%=userCode%></br>Выбран вопрос, отличающийся от вопроса, хранящегося в базе данных.<b/></p>
<%	break;
	case "bad_answer":
%>
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27306/<%=userCode%></br>Введен неверный ответ на контрольный вопрос.<b/></p>
<%	break;
	case "email_bad":
%>
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27308/<%=userCode%></br>Введен недопустимый адрес электронной почты <%=badEmail%>.</b></p>
<%
	break;
	case "not_email":
%>
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27309/<%=userCode%></br>Не введен адрес электронной почты. Введите данные повторно.<b/></p>
<%
	break;
	case "user_dismiss":
%>
		<p style="text-align:justify;margin-bottom: 2px;"><b>Код ошибки 27310/<%=userCode%></br>Введены первоначальные данные уволенного сотрудника. Введите данные повторно.</br>Если Вы уверены в том, что ввели правильные данные, <a href="mailto:nl-a-do@nlmk.com ?subject=27310/<%=userCode%> &Body=Сотрудник определен как уволенный. Код организации <%=orgCode%>.">отправьте ошибку</a> администраторам дистанционного обучения.<b/></p>
<%
}%>
		</td>
	</tr>
<%}%>
				<TR>
					<td class="registerRightTD" colspan="2">
						<p style="text-align:justify;margin-bottom:2px;"><b>Для регистрации Вам необходимо заполнить поля ниже</b></p>
					</td>
				</TR>

				<TR>
					<TD CLASS="registerLeftTD"><b>Предприятие:</b></TD>
					<td CLASS="registerRightTD">
						<select name="organisation" id="organisation">
							<option value="" disabled selected>Выберите организацию</option>
<%
var orgs = XQuery("for $elem in orgs order by $elem/name descending return $elem");
for (org in orgs) { %>
							<option value='<%=org.code%>' id='<%=org.code%>'><%=org.name%></option>
<%}%>
						</select>
					</td>
				</TR>
				<TR>
					<TD CLASS="registerLeftTD"><b>Подразделение:</b></TD>
					<TD CLASS="registerRightTD"><INPUT TYPE="text" NAME="depname" STYLE="width:297px;" CLASS="inputEdit" required placeholder="Например: ДЦ-1, Копровый цех и т.п." value="КУ"/></TD>
				</TR>
				<TR>
					<TD CLASS="registerLeftTD"><b>Должность сокращенно:</b></TD>
					<TD CLASS="registerRightTD"><INPUT TYPE="text" NAME="posname" STYLE="width:297px;" CLASS="inputEdit" required placeholder="Например: специалист, энергетик и т.п." value="спец"/></TD>
				</TR>
				<TR>
					<TD CLASS="registerLeftTD"><b>Табельный номер:</b></TD>
					<TD CLASS="registerRightTD"><INPUT TYPE="text" NAME="usercode" STYLE="width:297px;" CLASS="inputEdit" required placeholder="Только цифры" value="151592"/></TD>
				</TR>
				<TR>
					<TD CLASS="registerLeftTD"><b>ФИО полностью:</b></TD>
					<TD CLASS="registerRightTD"><INPUT TYPE="text" NAME="fio" STYLE="width:297px;" CLASS="inputEdit" required placeholder="Например: Иванов Вадим Юсупович" value="Пололин С А"/></TD>
				</TR>
				<TR>
					<TD CLASS="registerLeftTD"><b>Электронная почта*:</b></TD>
					<TD CLASS="registerRightTD"><INPUT TYPE="text" NAME="email" STYLE="width:297px;" CLASS="inputEdit" required placeholder="Например: ivanov_vy@nlmk.com" value="pololin_sa@nlmk.com"/></TD>
				</TR>
				<TR>
					<td class="registerRightTD" colspan="2">
						<p style="text-align:justify;margin-bottom:2px;">*если у Вас нет личного адреса корпоративной электронной почты, необходимо указать адрес электронной почты непосредственного руководителя</p>
					</td>
				</TR>
								
				<td></td>
				<TD><INPUT TYPE="submit" NAME="go" VALUE="Отправить" STYLE="width:150px; margin-top: 10px;" CLASS="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" id="btSend">
				</TD>
			</TABLE>
				
			</TD>
		</TR>
	</FORM>
	</TABLE>
<%}%>
	</TD>
</TR>
<TR>
	<TD>
		<%Server.Execute( "include/user_footer.html" )%>
    </TD>
</TR>
</TABLE>

<script>
$(document).ready(function() {
	if ('<%=orgCode%>' != '0') {
		document.getElementById("<%=orgCode%>").setAttribute('selected', 'selected');
	};
	if ('<%=qCode%>' != '') {
		document.getElementById("<%=qCode%>").setAttribute('selected', 'selected');
	};
	
	$("form").submit(function(event) {
		if ($("#organisation").is(':disabled')==true) {
			$("#organisation").attr('disabled', false);
		}
	});
});
</script>
</HTML>