<%
	Server.Execute( "include/user_init.html" );

	try
	{
		try
		{
			curSid = Request.QueryString.sid;
		}
		catch ( asd )
		{
			curSid = Request.Form.sid;
		}

		if ( ! tools.check_sum_sid( Request.QueryString.eid, curSid ) )
			throw '_crack_fuck_';
	}
	catch ( ehuu )
	{
		Server.Execute( "view_access_panel.html" );
		Cancel();
	}
	
	_url = ( StrBegins( global_settings.settings.recruitment.estaff_server_url, 'http://' ) || StrBegins( global_settings.settings.recruitment.estaff_server_url, 'https://' ) ? '' : tools_web.get_url_protocol( Request.Url ) ) + global_settings.settings.recruitment.estaff_server_url;
	resp = HttpRequest( UrlAppendPath( _url, '/candidate.xml?eid=' + Request.QueryString.eid ) , 'get' );
	respDoc = OpenDocFromStr( resp.Body, "form=x-local://wtv/estaff/candidate.xmd" ).TopElem;
	
	_index = Int( Request.QueryString.index );
	_attachment = respDoc.attachments[ _index ];
	
	Response.ContentType = alert(_attachment.content_type);
	switch ( _attachment.content_type )
	{
		case 'text/plain':
			Response.Write( _attachment.plain_text );
			break;
			
		case 'text/html':
			Response.Write( _attachment.text );
			break;
			
		default:
			if ( _attachment.file_name.HasValue )
				Response.AddHeader( "Content-Disposition", "attachment; filename=" + _attachment.file_name );
				
			Response.WriteBinary( _attachment.data );
			break;
	}
	
//	Response.Redirect( 'download_file_redirect?file_url=' + docFile.TopElem.file_url );
	Cancel();
%>