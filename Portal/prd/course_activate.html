<%
try
{
	curDocID = Request.Query.doc_id;
	Server.Execute( "include/access_init.html" );
}
catch ( e )
{
	curDocID = '';
	curAccess = true;
	Server.Execute( "include/user_init.html" );
}

curCourseID = Int( Request.Query.course_id );
curCourse = OpenDoc( UrlFromDocID( curCourseID ) ).TopElem;

try
{
	curSid = Request.Query.sid;

	if ( ! curAccess ||  ! tools.check_sum_sid( curCourseID, curSid ) )
		throw '_crack_fuck_';
		
	if ( ! tools_web.check_access( curCourse, curUserID, curUser, Session ) )
		throw '_access_fuck_';
}
catch ( ehuu )
{
	Server.Execute( "view_access_panel.html" );
	Cancel();
}

curLerningID = tools.activate_course_to_person( curUserID, curCourseID, null, curUser );
try
{
	curLerningID.TopElem.is_self_enrolled = true;
	curLerningID.Save();
	curLerningID = curLerningID.DocID;
}
catch ( err )
{
}

Response.Redirect( "view_doc.html?mode=learning_proc&doc_id=" + curDocID + "&course_id=" + curCourseID + "&object_id=" + curLerningID );
%>