<%
Server.Execute("include/sid_access_init.html");

curActiveLearningPart = curObject.parts.GetOptChildByKey( Request.Query.part_code );

if ( curActiveLearningPart == undefined )
{
	alert( 'Finish course attempt. Unknown active learning part code &quot;' + Request.Query.part_code + '&quot;.' );
}
else if ( curActiveLearningPart.cur_attempt_num < curActiveLearningPart.attempts_num )
{
	curActiveLearningPart.state_id = 1;
	curActiveLearningPart.cur_attempt_num = curActiveLearningPart.cur_attempt_num + 1;
	curActiveLearningPart.last_usage_date = CurDate;
	if ( ! curActiveLearningPart.start_usage_date.HasValue )
		curActiveLearningPart.start_usage_date = CurDate;

	curActiveLearningPart.lesson_location.Clear();
	curActiveLearningPart.score.Clear();
	curActiveLearningPart.score_str.Clear();
	curActiveLearningPart.core_lesson.Clear();
	curActiveLearningPart.lesson_report.Clear();
	
	curObjectDoc.Save();
}

Response.Redirect( "view_doc.html?mode=learning_proc&doc_id=" + curDocID + "&object_id=" + curObjectID + "&course_id=" + curObject.course_id );
%>