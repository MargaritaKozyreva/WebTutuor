<%
	Server.Execute( "include/access_init.html" );

	outerUrl = Request.Url;

	targetUrl = global_settings.settings.recruitment.estaff_server_url;
	if ( ! StrBegins( targetUrl, 'http://' ) )
		targetUrl = 'http://' + targetUrl;

	if ( ! StrEnds( targetUrl, '/' ) )
		targetUrl += '/';

	if ( Request.QueryString.HasProperty( 'inner_url_path' ) )
		targetUrl += Request.QueryString.inner_url_path;

	targetUrl += '?';

	for ( propName in Request.QueryString )
	{
		if ( ! StrBegins( propName, 'inner_' ) )
			continue;

		if ( ! StrEnds( targetUrl, '?' ) )
			targetUrl += '&';
			
		targetUrl += StrReplaceOne( propName, 'inner_', '' ) + '=' + UrlEncode( Request.QueryString.GetProperty( propName ) );
	}
	
	if ( ! StrEnds( targetUrl, '?' ) )
		targetUrl += '&';

	targetUrl += '&outer_url=' + UrlEncode( outerUrl );
	targetUrl += '&outer_person_id=0x' + StrHexInt( curUserID, 16 );

	resp = HttpRequest( targetUrl, Request.Method, Request.Body );

	if ( Request.Method == 'POST' && Request.Form.HasProperty( 'redirect_url' ) && StrLen( resp.Body ) == 0 )
	{
		Response.Redirect( Request.Form.redirect_url );
		Cancel();
	}

	Response.Write( resp.Body );
%>	

