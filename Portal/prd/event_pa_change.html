<%
        curObjectID = Int( Request.Form.object_id );
        curObject = OpenDoc( UrlFromDocID( curObjectID ) ).TopElem;
		try
		{
        	curDocID = Int( Request.Form.doc_id );
		}
		catch(ex)
		{
			curDocID=null
		}
        
 curPAID = Int( Request.Form.pa_id );
    curPADoc = OpenDoc( UrlFromDocID( curPAID ) );
    curPA = curPADoc.TopElem;	
   for ( _comp in curPA.competences )
    {
        _comp.mark = ( Request.Form.HasProperty( "comp" + _comp.PrimaryKey ) ?   Request.Form.GetProperty( "comp" + _comp.PrimaryKey )  : "");
        for ( _ind in _comp.indicators )
        {
        	_ind.mark = ( Request.Form.HasProperty( "ind" + _ind.PrimaryKey ) ?   Request.Form.GetProperty( "ind" + _ind.PrimaryKey )  : "");
        }
    }
    
    	try
			{
				tools_web.web_custom_elems_filling( 'event_assessment_plan', curPAID, curPA, Request.Form );               
			}
			catch ( e )
			{
				alert( e );
			}
            
   curPADoc.Save();

   
   if ( Request.Form.HasProperty( "action2" ) && Request.Form.GetProperty( "action2" ) == "finish")
   {
   		curPA.is_done = true;
        curPADoc.Save();
   }

	Response.Redirect( "view_doc.html?mode=event_pa&object_id="+curObjectID+"&doc_id="+curDocID+"&action=save" );
%>