<%
Server.Execute( "include/sid_access_init.html" );

curEvent = OpenDoc( UrlFromDocID( curObject.event_id ) ).TopElem;
	
if ( curUser.access.access_role == 'admin' || curEvent.tutors.ChildByKeyExists( curUserID ) )
{		
	curObject.tutor_comment = Request.Form.tutor_comment;
	curObject.score = Request.Form.score == '' ? null : Int( Request.Form.score );
	
	curObject.is_assist = Request.Form.HasProperty( 'is_assist' );
	curObject.is_confirm = Request.Form.HasProperty( 'is_confirm' );
	curObject.is_open = Request.Form.HasProperty( 'is_open' );
	
	try
	{
		tools_web.web_custom_elems_filling( 'event_result', curObjectID, curObject, Request.Form );
	}
	catch ( e )
	{
		alert( e );
	}
}

if ( curUserID == curObject.person_id )
{
	curObject.collaborator_comment = Request.Form.collaborator_comment;
	if ( curEvent.type_id == "case" )
		for ( _tutor in curEvent.tutors )
			tools.create_notification("57", _tutor.PrimaryKey, 'view_doc.html?mode=event_result&object_id=' + curObjectID + '&doc_id=' + Request.Form.doc_id , curObject.event_id);
}

curObjectDoc.Save();
	
Response.Redirect( 'view_doc.html?mode=event&object_id=' + curObject.event_id + '&doc_id=' + Request.Form.doc_id );
%>