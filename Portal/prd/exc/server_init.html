<%
Response.WriteMode = 'single';
try
{
	if ( Request.AuthLogin == '' )
		throw 'invalid login';

	query = XQuery( "for $server in exchange_servers where $server/code = '" + Request.AuthLogin + "' and $server/is_active = true() return $server" );
	firstElem = ArrayOptFirstElem( query );
	
	if ( firstElem == undefined )
	{
		throw 'server not found';
	}
	else
	{
		curExchangeServerID = firstElem.id;
		curExchangeServerDoc = OpenDoc( UrlFromDocID( curExchangeServerID ) );
		curExchangeServer = curExchangeServerDoc.TopElem;
		
		if ( curExchangeServer.server_password != Request.AuthPassword )
			throw 'invalid password';
	}
}
catch( ehu )
{
	Response.SetWrongAuth();
	Cancel();
}
%>