<%
Server.Execute( "include/access_init.html" );

_redirect_str = "view_doc.html?mode=library_material&doc_id=" + curDocID + "&object_id=" + curObjectID;
switch ( Request.Query.action )
{
	case "add_favourite":
		if ( curObject != null )
		{
			catUserViewing = ArrayOptFirstElem(XQuery( "for $elem in library_material_viewings where $elem/person_id = " + curUserID + " and $elem/material_id=" + curObjectID + " return $elem" ));
			if(catUserViewing == undefined)
			{
				var docViewing = OpenNewDoc( 'x-local://wtv/wtv_library_material_viewing.xmd' );
				docViewing.BindToDb( DefaultDb );			
				docViewing.TopElem.state_id = "plan";	
				docViewing.TopElem.material_id = curObjectID;
				docViewing.TopElem.person_id = curUserID;
				tools.common_filling( 'collaborator', docViewing.TopElem, curUserID, curUser );
				docViewing.Save();
			}
			Response.Redirect( _redirect_str );
			Cancel();
		}
		break;
}

Response.Redirect( _redirect_str );
%>