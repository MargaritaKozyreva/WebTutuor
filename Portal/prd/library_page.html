<%
iBookId = Int(Request.Query.book_id);
iLicenseId = Int(Request.Query.lid);
teLicense = OpenDoc( UrlFromDocID( Int( iLicenseId ) ) ).TopElem;
SharedDecryptionXMLKey = teLicense.decryption_key;
sEnryptedFilePath=FilePath( AppDirectoryPath(), 'wt\\web\\encrypted\\' + iBookId + '.wft');
sImagePath=StrReplace(Request.Query.image_url, "/", "\\");

ok=tools.encrypt_lib_obj.Encrypt_Init();

ok=tools.encrypt_lib_obj.Encrypt_WriteContentItem(sEnryptedFilePath,SharedDecryptionXMLKey,sImagePath,Session,Response);
if (ok==0)
{
	alert('library license error: ' + tools.encrypt_lib_obj.Encrypt_GetLastErrorMessage());
	Response.Write('<br/>'+tools.encrypt_lib_obj.Encrypt_GetLastErrorMessage());
}
%>