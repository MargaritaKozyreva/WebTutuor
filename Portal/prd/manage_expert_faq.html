<%Server.Execute( "include/user_init.html" )%>

<%
	try
	{
		_operation = Request.Form.operation;
		_doc_id = Int(Request.Form.doc_id);
		docExpert = OpenDoc(UrlFromDocID(Int(Request.Form.expert_id)));
	}
	catch(_oblomalos_)
	{
		Response.Redirect( "error.html" );
		Cancel();
	}
	
	_href = 'view_doc.html';
	
	switch (_operation)
	{
		case "add":
			try
			{
				eqDoc = OpenDoc(UrlFromDocID(Int(Request.Form.object_id))).TopElem;
			}
			catch(_zhopa_)
			{
				eqDoc = undefined;
			}
			
			if (eqDoc != undefined)
			{
				_new_faq = docExpert.TopElem.faqs.AddChild();
				_new_faq.faq_question = eqDoc.question;
				_new_faq.faq_answer = eqDoc.answer;
				docExpert.Save();
				_href = 'view_doc.html?mode=expert&doc_id=' + _doc_id + '&object_id=' + Request.Form.expert_id;
			}
			
			break;
		case "delete":
			try
			{
				_index = Int(Request.Form.GetProperty("index"));
				docExpert.TopElem.faqs.Child(_index).Delete();
			}
			catch(_gavno_kakoeto_)
			{
				break;
			}
			_href = 'view_doc.html?mode=expert&doc_id=' + _doc_id + '&object_id=' + Request.Form.expert_id;
			docExpert.Save();
			
			break;
		
		case "save":
			try
			{
				_index = Int(Request.Form.GetProperty("index"));
				_cur_child = docExpert.TopElem.faqs.Child(_index);
				_question = Request.Form.GetProperty("question");
				_answer = Request.Form.GetProperty("answer");
			}
			catch(_gavno_kakoeto_)
			{
				break;
			}
			
			_cur_child.faq_question = _question;
			_cur_child.faq_answer = _answer;
			
			_href = 'view_doc.html?mode=expert&doc_id=' + _doc_id + '&object_id=' + Request.Form.expert_id;
			docExpert.Save();
			
			break;
		
	}

		
	Response.Redirect( _href );
%>