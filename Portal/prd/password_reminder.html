<%
if ( Request.Query.login == '' )
{
	Request.Redirect( "user_password_reminder.html" );
}
else
{
	userArray = XQuery( "for $elem in collaborators where $elem/login = " + XQueryLiteral( String( Request.Query.login ) ) + " return $elem" );

	switch ( ArrayCount( userArray ) )
	{
		case 0:
			Request.Redirect( "user_password_reminder.html?m=1" );
			break;
			
		case 1:
			curUserID = ArrayFirstElem( userArray ).PrimaryKey;
			curUser = OpenDoc( UrlFromDocID( curUserID ) ).TopElem;
			
			if ( curUser.email.HasValue )
			{
				mailArray = XQuery( "for $elem in collaborators where $elem/email = '" + curUser.email + "' return $elem" );
				if ( ArrayCount( mailArray ) > 1 )
				{
					Request.Redirect( "user_password_reminder.html?m=4" );
					break;
				}
				
				tools.create_notification( '9', curUserID );
%>
<script language="javascript">
alert(<%=CodeLiteral( tools.get_web_str('upr_send_text') )%>);
document.location.href = "default.html";
</script>
<%
			}
			else
			{
				Request.Redirect( "user_password_reminder.html?m=2" );
			}
			break;
			
		default:
			Request.Redirect( "user_password_reminder.html?m=3" );
			break;
	}
}
Cancel();
%>