<%
	Server.Execute( "include/user_init.html" );
	
	Request.QueryString.HasProperty( "encoding" ) ? _encoding = Request.QueryString.encoding : _encoding = "windows-1251";
		
	_MEGA_STR = '<?xml version="1.0" encoding="'+_encoding+'"?>';

	_MEGA_STR = _MEGA_STR + "<data>\n";

	if ( Request.QueryString.HasProperty( "id" ) && Request.QueryString.id != "" )
	{
		_person_doc = OpenDoc( UrlFromDocID( Int( Request.QueryString.id ) ) ).TopElem;
		_MEGA_STR = _MEGA_STR + _person_doc.Xml;
		
		_position = _person_doc.position_id.OptForeignElem;
		
		if ( _position != undefined )
		{
				
			_leftStr = '<position id="' + _position.id + '" name="' + _position.name + '"/>';
			_rightStr = '\n';
			
			_parent_object = _position;
			_p_temp = _parent_object.parent_object_id.OptForeignElem;
			
			if ( _p_temp != undefined )
				_MEGA_STR = _MEGA_STR + '<my_position id="' + _p_temp.id + '" name="' + _p_temp.name + '"/>';
			
			while ( _p_temp != undefined )
			{
				_parent_object = _p_temp;
				_p_temp = _parent_object.parent_object_id.OptForeignElem;

				_leftStr = '<' + _parent_object.Name + ' id="' + _parent_object.id + '" name="' + _parent_object.name + '">\n' + _leftStr;
				_rightStr = _rightStr + '</' + _parent_object.Name + '>\n';
			}
			
			_org = _parent_object.org_id.OptForeignElem;

			if ( _org != undefined )
			{
				_leftStr = '<org id="' +_org.id + '" name="' + StrReplace(_org.name,'"',"'" ) + '">\n' + _leftStr;
				_rightStr = _rightStr + '</org>\n';
			}
			_MEGA_STR = _MEGA_STR + _leftStr + _rightStr;
		}
		
		_c_query = 'for $career_reserve in career_reserves where $career_reserve/person_id = ' + Request.QueryString.id + ' return $career_reserve';
		_c_r = XQuery( _c_query );
		
		_MEGA_STR = _MEGA_STR + "<career_reserve>\n";
		if ( ArrayCount( _c_r ) > 0 )
		{
			_careerDoc = OpenDoc( UrlFromDocID( _c_r[0].id ) ).TopElem;
			_MEGA_STR = _MEGA_STR + "<aimed_position>" + _c_r[0].position_name + "</aimed_position>\n";
			_MEGA_STR = _MEGA_STR + _careerDoc.tutors.Xml;
			
		}
		_MEGA_STR = _MEGA_STR + "</career_reserve>\n";
		
	
	}
	
	_MEGA_STR = _MEGA_STR + "</data>";
	
	Response.Write( EncodeCharset( ( _MEGA_STR ), _encoding ) );
		
%>