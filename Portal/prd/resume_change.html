<%Server.Execute( "include/user_init.html" )
/*alert('<====>');
for (a in Request.Query)
{
	alert(a+"="+Request.Query.GetProperty(a));

}
alert('<====>');*/

ChangeCommand =0
try
{
	ChangeCommand = Int(Request.Form.change_command)
}
catch(ex)
{	
}

if (ChangeCommand ==1)
{
	partion_name=Request.Query.GetProperty('type')
	line_num=Request.Query.GetProperty('string_counter')
	string_id=tools.random_string( 6 )

	RespValue=''
	RespValue=RespValue+'<td width="17%" valign="top">
						<table width="100%">
							<tr >
								<td align="left">    
									<img src="/pics/Delete_3.gif" alt="'+tools_web.get_web_str('c_delete')+'" name="'+partion_name+'" id="'+line_num+'" onclick="delete_item(this.name, this.id);" border="0"/>
								</td>
								<td width="25px"><img src="/pics/up.gif" alt="'+tools_web.get_web_str('c_move_up')+'" name="'+partion_name+'" id="'+line_num+'" onclick="move_up(this.name, this.id);" border="0"/></td>
								<td  width="25px"><img src="/pics/down.gif" alt="'+tools_web.get_web_str('c_move_down')+'" name="'+partion_name+'" id="'+line_num+'" onclick="move_down(this.name, this.id);" border="0"/></td>
								</tr>
						</table>
					</td>'
	if (partion_name=='work_experiences')
	{
		RespValue=RespValue+'<td>
						<table width="100%">
							<tr>
								<td><input type="hidden" name="'+partion_name+'_'+string_id+'" id="'+partion_name+'_'+string_id+'" value="'+string_id+'"/>'+tools_web.get_web_str('vrb_start')+':</td>
								<td><input type="text" value="" name="start_date_'+string_id+'" id="start_date_'+string_id+'" onchange="check_dateMMYYYY(this);"/></td>
								<td>'+tools_web.get_web_str('vrb_finish')+':<input type="text" value="" name="finish_date_'+string_id+'" id="finish_date_'+string_id+'" onchange="check_dateMMYYYY(this);"/></td>
							</tr>
							<tr>
								<td>'+tools.get_web_str('c_org')+': </td>
								<td colspan="2"><input type="text" value="" name="org_name_'+string_id+'" id="org_name_'+string_id+'" size="100%"/></td>
							</tr>
							<tr>
								<td>'+tools.get_web_str('c_position')+': </td>
								<td colspan="2"><input type="text" value="" name="position_name_'+string_id+'" id="position_name_'+string_id+'" size="100%"/></td>
							</tr>
							<tr>
								<td colspan="3">'+tools_web.get_web_str('vrb_functions')+':</td>
							</tr>
							<tr>
								<td colspan="3"> <textarea rows="4" cols="100" name="desc_'+string_id+'" id="desc_'+string_id+'"></textarea> </td>
							</tr>		

							<tr>
								<td colspan="3"> 
									<table width="100%">
										<tr>
											<td>Рабочий телефон организации:</td>
											<td>Факс организации:</td>
											<td>E-mail организации:</td>
										</tr>		
										<tr>
											<td><input type="text" value="" name="org_phone_'+string_id+'" id="org_phone_'+string_id+'"/></td>
											<td><input type="text" value="" name="org_fax_'+string_id+'" id="org_fax_'+string_id+'" /></td>
											<td><input type="text" value="" name="org_email_'+string_id+'" id="org_email_'+string_id+'" /></td>
										</tr>	
										
										<tr>
											<td>Почтовый адрес организации:</td>
											<td colspan="2">Сайт организации:</td>
										</tr>		
										<tr>
											<td><input type="text" value="" name="org_address_'+string_id+'" id="org_address_'+string_id+'"/></td>
											<td colspan="2"><input type="text" value="" name="org_site_'+string_id+'" id="org_site_'+string_id+'" /></td>
										</tr>	
									</table>
								</td>
							</tr>										
						</table>
				</td>'
	}
	else if (partion_name=='educations')
	{
		RespValue=RespValue+'<td><input type="hidden" name="'+partion_name+'_'+string_id+'" id="'+partion_name+'_'+string_id+'" value="'+string_id+'"/>
					<table width="100%" border="0">
						<tr>
							<td>'+tools.get_web_str('c_name')+':</td>
							<td>'+tools.get_web_str('c_type')+':</td>
							<td>'+tools_web.get_web_str('vrb_faculty')+':</td>
							<td>'+tools_web.get_web_str('vrb_result')+':</td>
							<td>'+tools_web.get_web_str('vrb_finish_year')+':</td>
							<td>Сайт ВУЗа:</td>
						</tr>
						<tr>
							<td><input type="text" value="" name="educ_name_'+string_id+'" id="educ_name_'+string_id+'" size="30"/></td>
							<td width="10px">
								<select name="educ_type_'+string_id+'" id="educ_type_'+string_id+'">
									<option value=""></option>'
				
									for (_educ_type in common.expended_educ_types)
									{										
										RespValue=RespValue+'<option value="'+_educ_type.id+'">'+_educ_type.name+'</option>';										
									}
							
								RespValue=RespValue+'</select>
							</td>
							<td><input type="text" value="" name="specialisation_'+string_id+'" id="specialisation_'+string_id+'" size="20"/></td>
							<td><input type="text" value="" name="result_'+string_id+'" id="result_'+string_id+'" size="23"/></td>
							<td width="11px"><input type="text" value="" name="educ_year_'+string_id+'" id="educ_year_'+string_id+'" size="11" onchange="check_dateYYYY(this);"/></td>
							<td width="11px"><input type="text" value="" name="site_'+string_id+'" id="site_'+string_id+'" size="11"/></td>
						</tr>
					</table>
				</td>'
	}
	else if (partion_name=='projects')
	{
		RespValue=RespValue+'<td><input type="hidden" name="'+partion_name+'_'+string_id+'" id="'+partion_name+'_'+string_id+'" value="'+string_id+'"/>
					<table width="100%" border="0">
						<tr>
							<td>Предметная область проекта:</td>
							<td>Тип проекта:</td>
							<td>Год проведения экспертизы:</td>
							<td>Год проведения:</td>
						</tr>							
						<tr>
							<td><input type="text" value="" name="sphere_'+string_id+'" id="sphere_'+string_id+'" size="30"/></td>
							<td><input type="text" value="" name="type_'+string_id+'" id="type_'+string_id+'" size="30"/></td>
							<td><input type="text" value="" name="examination_year_'+string_id+'" id="examination_year_'+string_id+'" size="30" onchange="check_dateYYYY(this);"/></td>
							<td><input type="text" value="" name="year_'+string_id+'" id="year_'+string_id+'" size="11" onchange="check_dateYYYY(this);"/></td>
						</tr>						
						<tr>
							<td colspan="4">Описание проекта:</td>
						</tr>						
						<tr>
							<td colspan="4">
							<textarea name="desc_'+string_id+'" id="desc_'+string_id+'" width="100%" style="width: 100%" rows="3" class="commonTextarea"></textarea>
							</td>						
						</tr>
					</table>
				</td>'
	}
	else if (partion_name=='publications')
	{
		RespValue=RespValue+'<td><input type="hidden" name="'+partion_name+'_'+string_id+'" id="'+partion_name+'_'+string_id+'" value="'+string_id+'"/>
					<table width="100%" border="0">
						<tr>
							<td>'+ tools.get_web_str('c_name') + ':</td>
							<td>Издание:</td>
							<td>Дата публикации:</td>
							<td>Ссылка:</td>
						</tr>
						<tr>
							<td><input type="text" value="" name="name_'+string_id+'" id="name_'+string_id+'" size="35"/></td>
							<td><input type="text" value="" name="publisher_'+string_id+'" id="publisher_'+string_id+'" size="35"/></td>
							<td>' +
							tools_web.draw_calendar('date_' + string_id,StrDate( '', false,false ),'dd.mm.yyyy') + 
							'</td>
							<td><input type="text" value="" name="link_'+string_id+'" id="link_'+string_id+'" size="35"/></td>
						</tr>
						</tr>
					</table>
				</td>'
	}
	else if (partion_name=='lngs')
	{
				RespValue=RespValue+'<td><input type="hidden" name="lngs_'+string_id+'" id="lngs_'+string_id+'" value="'+string_id+'"/>
			<table width="100%" border="0">
				<tr>
					<td>'+tools_web.get_web_str('vrb_lng_foreign')+':</td>
					<td>'+tools_web.get_web_str('vrb_lng_level')+':</td>
				</tr>
				<tr>
					<td width="100px">
						<select name="lng_id_'+string_id+'" id="lng_id_'+string_id+'">
							<option value=""></option>'
		
							for (_lng in common.languages)
							{
								RespValue=RespValue+'<option value="'+_lng.id+'">'+_lng.name+'</option>';
		
							}
							
						RespValue=RespValue+'</select>
					</td>
					<td>								
						<select name="level_'+string_id+'" id="level_'+string_id+'">
							<option value=""></option>'
							for (_level in common.language_levels)
							{
								
								RespValue=RespValue+'<option value="'+_level.id+'">'+_level.name+'</option>';
		
							}
							RespValue=RespValue+'
						</select>
					</td>
				</tr>
			</table>
		</td>'
	}


	Response.Write(EncodeCharset(RespValue, 'utf-8' ));
}
else
{
	try
	{
		curResumeID = Int(Request.Form.resume_id);
	}
	catch(ex)
	{
		curResumeID=null;
	}

	if (curResumeID==null)
	{
		resumeDoc = OpenNewDoc( 'x-local://wtv/wtv_resume.xmd' );
	
		try
		{
			resumeDoc.TopElem.person_id=Int(Request.Form.person_id);
		}
		catch(ex)
		{
			alert(ex)
		}
		resumeDoc.TopElem.creator_person_id = curUserID;
		resumeDoc.BindToDb( DefaultDb );
		resumeDoc.Save();
		curResumeID=resumeDoc.DocID
	}
	else
	{
		resumeDoc = OpenDoc( UrlFromDocID( Int( curResumeID ) ) );
	}
//СОХРАНЕНИЕ ++
	resumeDoc.TopElem.name = Request.Form.name;	
	resumeDoc.TopElem.sex = Request.Form.sex;
	resumeDoc.TopElem.family_status = Request.Form.family_status;
	
	try
	{
		resumeDoc.TopElem.birth_date = Date (Request.Form.birth_date);
	}
	catch (err)
	{}
	resumeDoc.TopElem.educ_type_id = Request.Form.educ_type_id;
	resumeDoc.TopElem.profession_area_id = Request.Form.profession_area_id;
	resumeDoc.TopElem.exp_years = Request.Form.exp_years;
	resumeDoc.TopElem.academic_degree = Request.Form.academic_degree;
	resumeDoc.TopElem.academic_title = Request.Form.academic_title;
	resumeDoc.TopElem.phone = Request.Form.phone;
	resumeDoc.TopElem.mobile_phone = Request.Form.mobile_phone;
	resumeDoc.TopElem.work_phone = Request.Form.work_phone;
	resumeDoc.TopElem.email = Request.Form.email;
	
	resumeDoc.TopElem.location_id = Request.Form.location_id;
	resumeDoc.TopElem.address = Request.Form.address;
	resumeDoc.TopElem.main_lng = Request.Form.main_lng;
	resumeDoc.TopElem.dominant_skills = Request.Form.dominant_skills;
	
	resumeDoc.TopElem.work_experiences.Clear();
	resumeDoc.TopElem.educations.Clear();
	resumeDoc.TopElem.projects.Clear();	
	resumeDoc.TopElem.publications.Clear();
	resumeDoc.TopElem.lngs.Clear();
	
	for (iQueryElem in Request.Query)
	{
		if (StrBegins(iQueryElem, "work_experiences"))
		{
			elem_id=Request.Query.GetProperty(iQueryElem)
			_elem=resumeDoc.TopElem.work_experiences.AddChild();
			
			if ( Request.Form.HasProperty("start_date_"+elem_id) && Request.Form.GetProperty( "start_date_" + elem_id ) != "" )
			_elem.start_date = Date ("01." + Request.Form.GetProperty("start_date_" + elem_id));
			
			if ( Request.Form.HasProperty("finish_date_"+elem_id) && Request.Form.GetProperty( "finish_date_" + elem_id ) != "" )
				_elem.finish_date = Date ("01." + Request.Form.GetProperty( "finish_date_" + elem_id ));	
				
			if ( Request.Form.HasProperty("org_name_"+elem_id) )
				_elem.org_name = Request.Form.GetProperty("org_name_" + elem_id);	
				
			if ( Request.Form.HasProperty("position_name_"+elem_id) )
				_elem.position_name = Request.Form.GetProperty("position_name_" + elem_id);	
				
			if ( Request.Form.HasProperty("desc_"+elem_id) )
				_elem.desc = Request.Form.GetProperty("desc_" + elem_id);		
				
			if ( Request.Form.HasProperty("org_phone_"+elem_id) )
				_elem.org_phone = Request.Form.GetProperty("org_phone_" + elem_id);	
			if ( Request.Form.HasProperty("org_fax_"+elem_id) )
				_elem.org_fax = Request.Form.GetProperty("org_fax_" + elem_id);	
			if ( Request.Form.HasProperty("org_email_"+elem_id) )
				_elem.org_email = Request.Form.GetProperty("org_email_" + elem_id);	
			if ( Request.Form.HasProperty("org_address_"+elem_id) )
				_elem.org_address = Request.Form.GetProperty("org_address_" + elem_id);	
			if ( Request.Form.HasProperty("org_site_"+elem_id) )
				_elem.org_site = Request.Form.GetProperty("org_site_" + elem_id);	
		}
		if (StrBegins(iQueryElem, "educations"))
		{
			elem_id=Request.Query.GetProperty(iQueryElem)
			_elem=resumeDoc.TopElem.educations.AddChild();
			
			if ( Request.Form.HasProperty("educ_name_"+elem_id) )
				_elem.name = Request.Form.GetProperty("educ_name_" + elem_id) ;
				
			if ( Request.Form.HasProperty("educ_type_"+elem_id) )
				_elem.type = Request.Form.GetProperty("educ_type_" + elem_id);	
				
			if ( Request.Form.HasProperty("specialisation_"+elem_id) )
				_elem.specialisation = Request.Form.GetProperty("specialisation_" + elem_id);	
				
			if ( Request.Form.HasProperty("result_"+elem_id) )
				_elem.result = Request.Form.GetProperty("result_" + elem_id);		
				
			if ( Request.Form.HasProperty("educ_year_"+elem_id) && Request.Form.GetProperty( "educ_year_" + elem_id ) != "" )
				_elem.date = Int(Request.Form.GetProperty("educ_year_" + elem_id));
				
			if ( Request.Form.HasProperty("site_"+elem_id) )
				_elem.site = Request.Form.GetProperty("site_" + elem_id);	
		}
		
		
		if (StrBegins(iQueryElem, "projects"))
		{
			elem_id=Request.Query.GetProperty(iQueryElem)
			_elem=resumeDoc.TopElem.projects.AddChild();
			
			if ( Request.Form.HasProperty("sphere_"+elem_id) )
				_elem.sphere = Request.Form.GetProperty("sphere_" + elem_id) ;
				
			if ( Request.Form.HasProperty("type_"+elem_id) )
				_elem.type = Request.Form.GetProperty("type_" + elem_id);	
				
			if ( Request.Form.HasProperty("examination_year_"+elem_id) )
				_elem.examination_year = Request.Form.GetProperty("examination_year_" + elem_id);	
				
			if ( Request.Form.HasProperty("year_"+elem_id) )
				_elem.year = Request.Form.GetProperty("year_" + elem_id);		
				
			if ( Request.Form.HasProperty("desc_"+elem_id) )
				_elem.desc = Request.Form.GetProperty("desc_" + elem_id);	
		}
		
		
		if (StrBegins(iQueryElem, "publications"))
		{
			elem_id=Request.Query.GetProperty(iQueryElem)
			_elem=resumeDoc.TopElem.publications.AddChild();
			
			if ( Request.Form.HasProperty("name_"+elem_id) )
				_elem.name = Request.Form.GetProperty("name_" + elem_id) ;
				
			if ( Request.Form.HasProperty("publisher_"+elem_id) )
				_elem.publisher = Request.Form.GetProperty("publisher_" + elem_id);	
				
			if ( Request.Form.HasProperty("date_"+elem_id) )
				_elem.date = Request.Form.GetProperty("date_" + elem_id);	
				
			if ( Request.Form.HasProperty("link_"+elem_id) )
				_elem.link = Request.Form.GetProperty("link_" + elem_id);		
				
		}
		
		if (StrBegins(iQueryElem, "lngs"))
		{
			elem_id=Request.Query.GetProperty(iQueryElem)
			_elem=resumeDoc.TopElem.lngs.AddChild();
			
			if ( Request.Form.HasProperty("lng_id_"+elem_id) )
				_elem.lng_id = Request.Form.GetProperty("lng_id_" + elem_id);
			if ( Request.Form.HasProperty("level_"+elem_id) )
				_elem.level = Request.Form.GetProperty("level_" + elem_id);	
			
		}
	}
			
	
	try
	{
		tools_web.web_custom_elems_filling( 'resume', null, resumeDoc.TopElem, Request.Form );
	}
	catch ( e )
	{
		alert( e );
	}
	
	resumeDoc.Save();
	
	Redirect='';
	object_id='';
	
	try
	{
		Redirect = Trim(Request.Query.redirect);
	}
	catch(ex)
	{
	}
	
	try
	{
		object_id = Int(Request.Query.object_id);
	}
	catch(ex)
	{
	}
	
	if (Redirect!='')
	{
		Response.Redirect( "view_doc.html?mode=resume&doc_id=" + Request.Form.doc_id + "&resume_id=" + curResumeID+ "&object_id=" + object_id+"&redirect="+Redirect);
	}
	else
	{
		Response.Redirect( "view_doc.html?mode=resume&doc_id=" + Request.Form.doc_id + "&resume_id=" + curResumeID);
	}
}
%>