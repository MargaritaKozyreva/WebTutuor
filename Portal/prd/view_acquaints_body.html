<BR>

<%
	if (Request.QueryString.HasProperty("error") && Request.QueryString.GetProperty("error") != "")
    {        
        Response.Write("<center><font color='red' size='+1'><b>" + tools.get_web_str("vab_acquaint_error_" + Request.QueryString.GetProperty("error")) + "</b></font></center><br/>");
	}
	

	if (curObjectID == null)
	{
%>


		<table width="100%"  border="0" cellspacing="0" cellpadding="3">
					<tr>
						<td class="tableHeaderWithText"><%=tools.get_web_str("vab_acquaints")%></td>
					</tr>
					<tr>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>				
					</tr>
			
			<%
				counter = 0;
				
				_my_acquiants = XQuery('for $a in acquaints where contains($a/collaborators, \'' + curUserID + '\') return $a ');
				
				for (_a in _my_acquiants)
				{
					
					_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
			%>
					
				<TR VALIGN="MIDDLE">					
					<TD class="<%=_class%>"><a HREF="view_doc.html?mode=acquaint&doc_id=<%=curDocID%>&object_id=<%=_a.id%>"><%=_a.name%></a></TD>
				</TR>
			<%	
				}
			%>
					<tr>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
					</tr>
		</table>
				<BR/>
<%
	}
	else
	{
    
    		_name_fld = common.exchange_object_types.GetOptChildByKey(curObject.object_type);
			if (_name_fld != undefined && _name_fld.web_template.HasValue)
				_name_fld = _name_fld.web_template + '&object_id=' + curObject.object_id + '&doc_id=' + curDocID;
			else
            	_name_fld = "view_doc.html?doc_id=" + curObject.object_id;
            
                
%>
			<table width="100%" cellspacing="0" cellpadding="0" class="tableBorder">
			<tr>
				<td width="140" align="RIGHT"><b><%=tools.get_web_str("c_name")%>:</b>&nbsp;</td>
				<td style="font-weight:normal"><a HREF="<%=_name_fld%>"><%=(curObject.object_name)%></a></td>
			</tr>					
			</table>
	
			
			<form action='acquaint_save.html' name='f_switch' id='f_switch' method=POST>
			<input type="hidden" name="doc_id" value="<%=curDocID%>">
			<input type="hidden" name="object_id" value="<%=curObjectID%>">
			<input type="hidden" name="collaborator_id" value="<%=curUserID%>">
			
			<table width="100%"  border="0" cellspacing="0" cellpadding="3">
			
				<tr id="line_head">
					<td class="tableHeaderWithText"><%=tools.get_web_str("c_coll")%></td>
					<td class="tableHeaderWithText" width="100px"><%=tools.get_web_str("c_date")%></td>
					<td class="tableHeaderWithText" width="50px">&nbsp;</td>
				</tr>
				<tr>
					<td class="tableHeaderNoText" colspan="3"><img src="pics/1blank.gif" width="1" height="1"/></td>
				</tr>					
				<tbody id="recycler">
			<%
				counter = 0;
                _allow_press = false;
				for (_c in curObject.collaborators)
				{
					if (_c.PrimaryKey == curUserID)
                    {
                    	_travel_to_italy = true;
                        if (_c.acquaint == false)
                        	_allow_press = true;
                    }
                    else
                    {
                    	_travel_to_italy = false;
                    }
					_class = counter++ % 2 ? 'tableRowOdd' : 'tableRowEven';
			%>
					<tr valign="middle" <%=(_travel_to_italy ? 'style="font-style:italic"' : "")%>>
						<td class="<%=_class%>">
							<%=_c.collaborator_fullname%>
						</td>
						<td class="<%=_class%>" align="center">
							<%=_c.date%>
						</td>
						<td class="<%=_class%>" align="center">
							<img src="pics/<%=(_c.acquaint? "ok" : "c_br")%>.gif" border="0"/>
						</td>
					</tr>
			<%
				}
			%>
							
				</tbody>
				<tr>
					<td colspan="3" class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
			</table>
			<%
				if (_allow_press)
				{
			%>
						<p><center><input type="submit" onClick='return true' value="<%=tools.get_web_str("vab_acquaint_this")%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"></center></p>
			<%
				}
                else if (Request.QueryString.HasProperty("is_post") && Request.QueryString.GetProperty("is_post") == "1")
                	Response.Write('<center><b>' + tools.get_web_str("c_form_save") + '</b></center>');
                
			%>
			
			</form>			
<%
	}
%>