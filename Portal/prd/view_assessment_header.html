<%
if (curAssessmentAppraise.header_web_template_id.HasValue)
{
	try
	{
		Response.Write(tools_web.insert_custom_code(curAssessmentAppraise.header_web_template_id, null,true,false));
	}
	catch(_oi_)
	{}
}
else
{
	if (curAssessmentAppraise.manual_document_id.HasValue)
	{
		try
		{
			_manualElem = OpenDoc(UrlFromDocID(curAssessmentAppraise.manual_document_id)).TopElem;
		}
		catch(_oblom_)
		{
			_manualElem = undefined;
		}
		
		if (_manualElem != undefined)
		{
%>
<div style="width: 100%; text-align: right" >
<a href="#" style="text-decoration:none; font-size: 12" onclick="var _dt = document.getElementById('manual_table'); var _img = document.getElementById('manual_plusminus_img'); if (_dt.style.display == 'inline') {_dt.style.display = 'none'; _img.src = 'pics/plus.jpg';}; else {_dt.style.display = 'inline'; _img.src = 'pics/minus.jpg';} return false;"><img id="manual_plusminus_img" src="pics/plus.jpg" border="0">&nbsp;<%=_manualElem.name%></a>
</div>
<table id="manual_table" style="display: none; border: 1px gray solid" width="100%" border="0" cellpadding="5" cellspacing="0">
<tr><td>
	<%=tools_web.get_web_desc( _manualElem.text_area, UrlFromDocID( curAssessmentAppraise.manual_document_id ), "document.text_area" )%>
<%
try {
 _files=OpenDoc(UrlFromDocID( curAssessmentAppraise.manual_document_id )).TopElem.files;
if ( _files.ChildNum != 0 ) for ( _file in _files ) try {_cur_file = _file.file_id.ForeignElem;
%>
	<IMG src="pics/ex.gif" width="13" height="11">&nbsp;
                  <A href="#" onClick="document.location.href='download_file.html?file_id=<%=_file.file_id%>&sid=<%=tools.get_sum_sid( _file.file_id )%>'"><%=_cur_file.name%></A>
<%
} catch (zzs) {}} catch (zzx) {}
%>
</td></tr>
</table>

<%
		}
	}
header_style = "display: inline;";
headerExpand = tools_ass.get_workflow_state_parameter(_curState, "header_expand");
if (headerExpand == undefined) headerExpand = "";

if (headerExpand == "1")
	{
header_style = "display: none;";
%>
<div style="width: 100%; text-align: left" >
<a href="#" style="text-decoration:none; font-size: 12" onclick="var _dt = document.getElementById('header_table'); var _img = document.getElementById('header_plusminus_img'); if (_dt.style.display == 'inline') {_dt.style.display = 'none'; _img.src = 'pics/plus.jpg';}; else {_dt.style.display = 'inline'; _img.src = 'pics/minus.jpg';} return false;"><img id="header_plusminus_img" src="pics/plus.jpg" border="0">&nbsp;<b><%=tools.get_web_str("ass_estimated_person")%>:</b>&nbsp;<%=COLLABORATOR_USER_ID.ForeignElem.fullname%></a>
</div>
<%
}
if (headerExpand == "2")
	{
header_style = "display: inline;";
%>
<div style="width: 100%; text-align: left" >
<a href="#" style="text-decoration:none; font-size: 12" onclick="var _dt = document.getElementById('header_table'); var _img = document.getElementById('header_plusminus_img'); if (_dt.style.display == 'inline') {_dt.style.display = 'none'; _img.src = 'pics/plus.jpg';}; else {_dt.style.display = 'inline'; _img.src = 'pics/minus.jpg';} return false;"><img id="header_plusminus_img" src="pics/minus.jpg" border="0">&nbsp;<b><%=tools.get_web_str("ass_estimated_person")%>:</b>&nbsp;<%=COLLABORATOR_USER_ID.ForeignElem.fullname%></a>
</div>
<%
}

	if (tools_ass.get_workflow_state_parameter(_curState, "header_hide_completely") != "1")
	{
%>
<table id="header_table" border="0" style="<%=header_style%>">
<%
_header_hide_expert = tools_ass.get_workflow_state_parameter(_curState, "header_hide_expert");
_header_hide_custom_experts = tools_ass.get_workflow_state_parameter(_curState, "header_hide_custom_experts");
_pos_name = "";
if (IS_HUMAN)
{
	_parent_obj = COLLABORATOR_USER_ID.ForeignElem.position_id.OptForeignElem;
	if (_parent_obj != undefined)
	{
		_pos_name = _parent_obj.name;
		if (_parent_obj.parent_object_id.HasValue)
		{
			_parent_obj = _parent_obj.parent_object_id.OptForeignElem;
		}
		else
		{
			_parent_obj = _parent_obj.org_id.OptForeignElem;
		}
	}
	else
	{
		_parent_obj = undefined;
	}

if (headerExpand == "") {
%>
<tr><td><b><%=tools.get_web_str("ass_estimated_person")%>:</b>&nbsp;<a href="view_doc.html?mode=collaborator&doc_id=<%=curDocID%>&object_id=<%=COLLABORATOR_USER_ID%>"><%=COLLABORATOR_USER_ID.ForeignElem.fullname%></a></td></tr>
<%
}
%>
<tr><td><b><%=tools.get_web_str("c_position")%>:</b>&nbsp;<%=_pos_name%></td></tr>
<tr><td><b><%=tools.get_web_str("c_subd")%>:</b>&nbsp;<a href="view_doc.html?mode=<%=(_parent_obj != undefined ?_parent_obj.Name: "#")%>&doc_id=<%=curDocID%>&object_id=<%=(_parent_obj != undefined ? _parent_obj.id : 0)%>"><%=(_parent_obj != undefined ? _parent_obj.name: "")%></a></td></tr><%
}
else
{
%>
<tr><td><b><%=tools.get_web_str("ass_estimated_structure")%>:</b>&nbsp;<a href="view_doc.html?mode=subdivision&doc_id=<%=curDocID%>&object_id=<%=COLLABORATOR_USER_ID%>"><%= OpenDoc( UrlFromDocID(COLLABORATOR_USER_ID)).TopElem.name%></a></td></tr>
<%
}

if (_header_hide_expert != "1")
{
	if (COLLABORATOR_EXPERT_ID != undefined)
		_custom_exp_name = COLLABORATOR_EXPERT_ID.OptForeignElem;
	else
		_custom_exp_name = undefined;
%>
<tr><td><b><%=tools.get_web_str("ass_estimating_person")%>:</b>&nbsp;<a href="view_doc.html?mode=collaborator&doc_id=<%=curDocID%>&object_id=<%=COLLABORATOR_EXPERT_ID%>"><%=(_custom_exp_name != undefined ? _custom_exp_name.fullname : "<font color='red'>*ERROR* corrupted expert</font>")%></a></td></tr>
<%
}
	if (curPA != undefined && ArrayOptFirstElem(curPA.custom_experts) != undefined && _header_hide_custom_experts != "1")
	{
		_custom_exp_name = ArrayOptFind(curAssessmentAppraise.participants, "customize.is_custom_experts == true");
		if (_custom_exp_name != undefined && _custom_exp_name.customize.custom_title.HasValue)
			_custom_exp_name = _custom_exp_name.customize.custom_title;
		else
			_custom_exp_name = tools.get_web_str("ass_custom_experts");
			
%>
	<tr><td><b><%=_custom_exp_name%>:</b>
<%
		for(_ce in curPA.custom_experts)
		{
			Response.Write("<br/>&nbsp;");
            if (_ce.ChildExists("is_done"))
	            Response.Write(_ce.is_done ? "&nbsp;<img src='pics/ok.gif' border='0' title='" + tools.get_web_str("vcb_is_coordinated") + "'/>": "&bull;");
			_ce_name = _ce.PrimaryKey.OptForeignElem;
			if (_ce_name != undefined) Response.Write("&nbsp;" + _ce_name.fullname);
			else Response.Write("&nbsp;<b>Error - unable to find person</b>");
		}
%>


	</td></tr>
<%
	}
    
    
    for (_custom_tit in curAssessmentAppraise.custom_headers)
    {
    	if (Trim(_custom_tit.display_eval) != '')
        {
        	try
            {
            	if (eval(_custom_tit.display_eval))
                	_custom_tit_display_eval = true;
                else
                	_custom_tit_display_eval = false;
            }
            catch(_oblazalis_)
            {
            	_custom_tit_display_eval = false;
            }
        }
        else
        	_custom_tit_display_eval = true;

		if (_custom_tit_display_eval)
    	{
            try
            {
                _custom_tit_eval = String(eval(_custom_tit.value_eval));
            }
            catch(_obosralos_)
            {
                _custom_tit_eval = "<img src='pics/no.gif' border='0' title='Evaluation formula error'/>";
            }
%>
		<tr><td><b><%=_custom_tit.title%>:</b>&nbsp;<%=_custom_tit_eval%></td></tr>
<%
		}
	}
%>

</table>
<%
	}
}
%>