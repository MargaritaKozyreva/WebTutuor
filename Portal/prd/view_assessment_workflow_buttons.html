<%
wf_buttons_pos = tools_ass.get_workflow_state_parameter(_curState, "wf_buttons_pos");
if (wf_buttons_pos == '' || wf_buttons_pos == undefined) wf_buttons_pos = tools_ass.get_workflow_state_parameter(_curState, curPA.assessment_appraise_type+"_wf_buttons_pos");
if (wf_buttons_pos == '' || wf_buttons_pos == undefined) wf_buttons_pos = 'top';

if ((wf_buttons_pos==WF_FORM_TOP && is_post != '1') ||  (is_post=='1' && WF_FORM_TOP=='top')) 
{
%>

<script language="JavaScript">
function doSubmit( _sAction )
{
	document.workflow_process.action_id.value = _sAction;
	var vrem1=$("form#f_switch").get(0);
	if (document.workflow_process.cur_comment && vrem1 && vrem1.comment)
	{
<%
	_comment_actions = tools_ass.get_workflow_state_parameter(_curState, "action_comment_req");
	if (curAssessmentAppraise.is_comment_required || (_comment_actions !="" && _comment_actions != undefined))
	{
%>
		var a_flag = <%=curAssessmentAppraise.is_comment_required%>;
		var a_str = "<%=_comment_actions%>";
		if (a_str!="" && !a_flag)
		{
			var a_arr = a_str.split(","); 
			for (var i=0;i < a_arr.length;i++)
			{
				if (a_arr[i]==_sAction)
				{
					a_flag=true;
					break;
				}
			}
		}

		if (vrem1.comment.value == "" && a_flag)
		{
			window.alert("<%=HtmlEncode(tools.get_web_str("ass_message_please_fill_in_comment"))%>");
			return false;
		}
<%
	}
%>
		document.workflow_process.cur_comment.value = vrem1.comment.value;
	}
	document.workflow_process.submit();
}
</script>

<FORM ACTION="workflow_assessment_process.html" NAME="workflow_process" METHOD="POST">

	<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
	<input type="hidden" name="object_id" value="<%=curAssessmentPlanID%>"/>
	<input type="hidden" name="pa_id" value="<%=curPAID%>"/>
	<input type="hidden" name="is_post" value="<%=is_post%>"/>
<%
	if (!curAssessmentAppraise.is_basic_comment)
	{
%>
		<input type="hidden" name="cur_comment" value=""/>
<%
	}
%>
	<input type="hidden" name="action_id" value=""/>
	<input type="hidden" name="mode" value="<%=curMode%>"/>
	<input type=hidden name="assessment_appraise_id" value="<%=curAssessmentAppraiseID%>"/>
	<center>
<%
	sIsLineOriented = tools_ass.get_workflow_state_parameter(_curState, "wf_buttons_orientation");
	
		for ( _action in curWorkflow.actions )
		{	
		
			/*
				alert('curPersonID='+curPersonID);
				alert('STATUS='+STATUS);
				alert('COLLABORATOR_USER_ID='+COLLABORATOR_USER_ID);
				alert('COLLABORATOR_EXPERT_ID='+COLLABORATOR_EXPERT_ID);
				alert('IS_DONE='+IS_DONE);
				alert('PA_IS_DONE='+PA_IS_DONE);
			
				alert(_action.condition_eval_str );
				alert('---');
			*/
			try
			{
			if ( _in_time && (_action.condition_eval_str == '' || eval( _action.condition_eval_str)) )
			{
				i = _action.name.Value.indexOf("|");
				if (i >= 0)
					__sButtonTitle = _action.name.Value.slice(0, i);
				else
					__sButtonTitle = _action.name.Value;
				
%>				
					<input type="button" value="<%=HtmlEncode(tools_web.get_cur_lng_name(__sButtonTitle, curLng.short_id))%>" class="inputButton" onClick="doSubmit( '<%=_action.code%>' );" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" <%=(i >= 0 ? 'title="' +HtmlEncode(tools_web.get_cur_lng_name(_action.name.Value.slice(i+1), curLng.short_id))+ '"':"")%>/>
<%
				Response.Write(sIsLineOriented == "horizontal" ? "<nobr/>":"<br/>");
			}
			}
			catch(_hren_)
			{
				Response.Write(alert("ERROR ACTION " + _action.name + " CONDITION: " + _action.condition_eval_str + "<br/>\n" + _hren_));
			}
		}
%>	
	</center>
</FORM>
<%
}
%>