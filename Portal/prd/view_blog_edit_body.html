<%	try	{		curBlogID = Int( Request.QueryString.object_id );		curBlog = OpenDoc( UrlFromDocID( curBlogID ) ).TopElem;	}	catch(_fuck_)	{		curBlog = null;		curBlogID = null;	}	try	{		Session.RETURN_MSG;	}	catch(_x_)	{		Session.RETURN_MSG = "";	}	if (Session.RETURN_MSG != "")	{		Response.Write("<br/><center><font size='+1' align='center'><i><b>" + HtmlEncode(Session.RETURN_MSG) + "</b></i></font></center>");		Session.RETURN_MSG = "";	}%><script language="javascript"><!--//------------------------------------------------------------------------------------------function buttonMouseOver(){	window.event.srcElement.className='inputButtonOver';}function buttonMouseOut(){	window.event.srcElement.className='inputButton';}function checkkey(srcobj, keycode, flag_flat){				if ((keycode<48 || keycode>57)& keycode!=46) return false;	if (keycode==46) 	{		if( (!flag_flat) || srcobj.value.indexOf('.') >= 0) return false;	}	return true;}//------------------------------------------------------------------------------------------function what2submit(){	var tobj=document.all.recycler;	var item_count = parseInt(document.getElementById("authors_count").value);		var o = document.forms["blog_submitter"].elements["name"].value;	if (o == "")	{		window.alert(<%=CodeLiteral( tools_web.get_web_str('vaeb_mess_empty_title') )%>);		return false;	}	o = document.forms["blog_submitter"].elements["num_message_in_list"].value;	if (o != "" && isNaN(parseInt(o)) )	{		window.alert(<%=CodeLiteral( tools_web.get_web_str('vbeb_mess_wrong_num') )%>);		return false;	}		var auth_list = "";	var _x = 0;	while (_x < item_count)	{		if (document.getElementById("author_id_" + _x) != undefined)			auth_list += (auth_list != "" ? ";" : "") + document.getElementById("author_id_" + _x).value;		_x++;	}		var tinput=document.createElement('INPUT');	tinput.type='hidden'; 	tinput.name='author_ids';	tinput.value = auth_list;	$(tobj).append(tinput);			return true;}//------------------------------------------------------------------------------------------function addAuthor(cur_id, cur_name, _x, tobj, _is_admin){	var trow=document.createElement("TR");	trow.setAttribute("id","author_" + cur_id);	trow.setAttribute("value",cur_id);	trow.valign="middle";	$(tobj).append(trow);	_class = trow.rowIndex % 2 ? 'tableRowEven' : 'tableRowOdd';		var tcol1=document.createElement("TD");	tcol1.className = _class;	$(trow).append(tcol1);<%	_href = "view_doc.html?mode=collaborator&doc_id="+curDocID+"&object_id=";%>	tcol1.innerHTML = "<a href='<%=_href%>" +cur_id+ "'>" + cur_name + "</a>";		var tinput_qt=document.createElement('INPUT');	tinput_qt.type='hidden'; 	tinput_qt.id='author_id_' + _x;	tinput_qt.name='author_id_' + _x;	tinput_qt.value = cur_id;	$(tcol1).append(tinput_qt);		var tcol3=document.createElement("TD");	tcol3.width="100px";	tcol3.className = _class;	tcol3.align = 'center';	$(trow).append(tcol3);		var tinput_ica=document.createElement('INPUT');	tinput_ica.type='checkbox';	tinput_ica.id='is_full_moderator_' + cur_id;	tinput_ica.name='is_full_moderator_' + cur_id;	tinput_ica.value="1";	$(tcol3).append(tinput_ica);	if (_is_admin != null)		tinput_ica.checked = (_is_admin == true);}//-----------------------------------function change_authors(){	var tobj = document.getElementById("recycler");	var item_count = parseInt(document.getElementById("authors_count").value);		var pars=new Object();	var _x = 0;	pars.selected_object_ids = "";	while (_x < item_count)	{		if (document.getElementById("author_id_" + _x) != undefined)			pars.selected_object_ids += (pars.selected_object_ids != "" ? ";" : "") + document.getElementById("author_id_" + _x).value;		_x++;	}				var strAttr="status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1";	xShowModalDialog("dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&typein=1&check_access=1&multi_select=1&rand="+Math.random(), pars, strAttr);		if (!pars.handle) return false;		$(tobj).empty()	item_count = 0;		for (_x = item_count; _x < pars.elemArray.length; _x++)	{		var cur_id = pars.elemArray[_x];		var cur_name = pars.elemNamesArray[_x];				addAuthor(cur_id, cur_name, _x, tobj, false)		item_count++;	}	document.getElementById("authors_count").value = item_count;}--></script><table width="100%"  border="0" cellspacing="0" cellpadding="3" name="top_report_table"><tr><td><form name="blog_submitter" id="blog_submitter" action="content_panel_process.html" method="post"><input type="hidden" name="blog_id" value="<%=(curBlogID != null ? curBlogID : 0)%>"/><input type="hidden" name="mode" value="blog"/><input type="hidden" name="doc_id" value="<%=curDocID%>"/><input type="hidden" name="href" value="<%=Request.Url%>"/><table width="100%" cellspacing="0" cellpadding="4" class="tableBorder" border="0">	<tr>		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools.get_web_str('c_name')%>:</td>		<td style="font-weight:bolder; font-size:larger"><input type="text" id="name" name="name" value="<%=(curBlog != null ? XmlAttrEncode(curBlog.name) : "")%>" class="inputEdit" style="width:100%"/></td>	</tr></table><br/><table><tr>		<td><%=tools_web.get_web_str('vbeb_mess_num')%>:</td>		<td><input type="text" id="num_message_in_list" name="num_message_in_list" value="<%=(curBlog != null ? curBlog.num_message_in_list : "")%>" class="inputEdit" style="width:50px" onkeypress="return checkkey(this,window.event.keyCode, false);" onblur="return checkkey(this,window.event.keyCode, false);"/></td></tr></table><table>	<tr>		<td><input type="checkbox" name="permit_subscription" id="permit_subscription" <%=(curBlog != null && curBlog.permit_subscription ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vdb_can_submition')%></td>		<td><input type="checkbox" name="allow_anonymous_comment" id="allow_anonymous_comment" <%=(curBlog != null && curBlog.allow_anonymous_comment ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vbeb_can_anonum_comm')%></td>	</tr></table><br/><div id="blog_authors_div" style="display: inline">		<table width="100%"  border="0" cellspacing="0" cellpadding="3">		<tr>			<td class="tableHeaderWithText"><%=tools_web.get_web_str('vbeb_authors')%></td>			<td class="tableHeaderWithText"><%=tools_web.get_web_str('c_admin')%></td>		</tr>		<tr>			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>		</tr>		<tbody id="recycler"></tbody>		<tr>			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>		</tr>	</table>	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">		<TR><TD ALIGN="CENTER" class="activator">			<input type="button" value="<%=tools.get_web_str("veb_b7")%>" onClick="change_authors();" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/>		</TD></TR>	</table></div><%	if (curBlog != null && ArrayOptFirstElem(curBlog.authors) != undefined)	{%>		<script language='javascript'>			var tobj1 = document.getElementById("recycler");<%		_x = 0;		for (_author in curBlog.authors)		{			Response.Write('addAuthor("' + _author.PrimaryKey + '", "' +HtmlEncode(_author.person_fullname)+ '", '+_x+', tobj1, '+(_author.is_full_moderator == true)+');\n');			_x++;		}%>		</script><%	}%><br/><input type="hidden" name="authors_count" id="authors_count" value="<%=(curBlog != null ? ArrayCount(curBlog.authors): 0)%>"/><table style="font-weight:bolder; font-size:larger;" width="100%">	<tr>		<td><%=tools.get_web_str('c_comment')%></td>	</tr><tr>		<td><textarea id="comment" name="comment" style="width:100%"><%=(curBlog != null ? HtmlEncode(curBlog.comment) : "")%></textarea></td>	</tr></table>	<br/>		<center><input type="submit" value="<%=tools.get_web_str('c_save')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="return what2submit();"/></center></form><%	_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=content_panel&doc_id="+curDocID+"&tab=blog";%><center>	<input type="button" value="<%=tools_web.get_web_str('vaaeb_list_back')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="window.location.href='<%=_href%>'"/><%	if (curBlog != null)	{		_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=blog&doc_id="+curDocID+"&object_id=" + curBlogID;%>	<input type="button" value="<%=tools_web.get_web_str('vbeb_go_blog')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="window.location.href='<%=_href%>'"/><%	}%></center><br/></td></tr><tr>	<td colspan="3" class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td></tr></table>