<%
bIsPerson=(curUserID==curObject.person_id)
bIsTutor = curObject.tutors.ChildByKeyExists( curUserID );
bIsMainTutor = bIsTutor ? curObject.tutors.GetChildByKey( curUserID ).is_responsible : false;
bIsCommissionPerson = ArrayCount( XQuery("for $elem in career_reserve_tutors where $elem/career_reserve_id=" + curObjectID + " and $elem/tutor_id=" + curUserID + " and $elem/tutor_type='commission_person' return $elem" ) ) != 0;

if ( ! bIsPerson && ! bIsTutor && !bIsMainTutor && !bIsCommissionPerson )
{
	Server.Execute( "view_access_panel.html" );
	Cancel();
}

tableID='task_table'
sortIndex =	Request.QueryString.HasProperty( 'sort' + tableID ) ? Int( Request.QueryString.GetProperty( 'sort' + tableID) ) : 2;
sortDirect = Request.QueryString.HasProperty( 'direct' + tableID) ? ( Request.QueryString.GetProperty( 'direct' + tableID) == '0' ? '-' : '+' ):'-';
curQueryString =tools_web.get_query_string( true, 'sort' + tableID + ';direct' + tableID+';tab') 



strTutorsIds=ArrayMerge(curObject.tutors, 'person_id', ',')
if (strTutorsIds!='')
{
	strXqueryQuals="MatchSome( $elem/id, ("+strTutorsIds+" ) )"
}
else
{
	strXqueryQuals="$elem/id=0"
}


Server.Execute( "view_desc.html" )

switch ( curObject.position_type )
{
	case 'position':
		_type_name = tools.get_web_str('vcrb_target_position');
		_position_name = curObject.position_id.sd.name;
		break;
		
	case 'position_common':
		_type_name = tools.get_web_str('vcrb_target_position_common');
		_position_name = curObject.position_common_id.sd.name;
		break;
		
	case 'name':
		_type_name = tools.get_web_str('c_position');
		_position_name = curObject.position_name;
		break;
	case 'adaptation':
		_type_name = tools.get_web_str('vcrb_adaptation');
		_position_name = ' ';
		break;
}

bIsBoss=false
fldBoss=tools.get_uni_user_boss(curObject.person_id)
if (fldBoss!=undefined)
{
	bIsBoss=(fldBoss.id==curUserID);
}


_cur_status = curLngCommon.career_reserve_status_types.GetOptChildByKey( curObject.status );

_tutor_text = '';
for ( _tutor in curObject.tutors )
{
	_tutor_text = _tutor_text + ( _tutor.ChildIndex == 0 ? '' : ', ' ) + (_tutor.person_id.OptForeignElem != undefined ? '<a href="view_doc.html?mode=collaborator&doc_id='+curDocID+'&object_id='+_tutor.person_id+'">'+_tutor.person_id.ForeignElem.fullname+'</a>' : _tutor.person_fullname);
}
%>


<script language="javascript">
<!--
function do_sort_<%=tableID%>( _href )
{
	var _sQueryString = "<%=curQueryString%>" + _href+"&tab=2";
	document.location.href = _sQueryString ;
	return false;
}

function do_add_event()
{

	if (document.all["new_name"].value == '')
		window.alert(<%=CodeLiteral( tools.get_web_str('vcrb_mess_empty_name') )%>);
	else
	{	
		var bOk=true;
		var TaskType=document.getElementById("new_type")
		var strTaskType=''
		
		if (TaskType)
		{
			strTaskType=TaskType.options[TaskType.selectedIndex].value
		}

		switch (strTaskType)
		{
			case "learning":
				if (document.all["new_course_id"].value == '')
				{
					bOk=false
					window.alert('Не указан курс для новой задачи!');
				}
				break;
				
			case "test_learning":
				if (document.all["new_test_id"].value == '')
				{
					bOk=false
					window.alert('Не указан тест для новой задачи!');
				}
				break;
			case "education_method":
				if (document.all["new_edu_method_id"].value == '')
				{
					bOk=false
					window.alert('Не указана учебная программа для новой задачи!');
				}
				break;
			case "":
				bOk=false
				break;		
		}

		if (bOk)
		{
			document.forms['new_task_form'].command.value = 'add_event';
			document.forms['new_task_form'].submit();
		}
	}
}
function do_delete_event(task_id)
{
	if (window.confirm(<%=CodeLiteral( tools.get_web_str('vcrb_mess_del_rec') )%>))
	{
		document.forms['task_form_'+task_id].task_id.value = task_id;
		document.forms['task_form_'+task_id].command.value = 'delete_event';
		dataStr=$("#task_form_"+task_id).serialize()
		fnServerSendData(dataStr,task_id,2);
	}
}

function do_save_event(task_id)
{
	document.forms['task_form_'+task_id].task_id.value = task_id;
	document.forms['task_form_'+task_id].command.value = 'save_task';
	dataStr=$("#task_form_"+task_id).serialize()
	fnServerSendData(dataStr,task_id,1);
}

function fnChangeStatus(task_id,initial_value)
{
	var elemSelect=document.getElementById("status"+task_id)
	if (elemSelect)
	{
		if (elemSelect.value!=initial_value)
		{
			document.forms['task_form_'+task_id].task_id.value = task_id;
			document.forms['task_form_'+task_id].command.value = 'change_status';
			dataStr=$("#task_form_"+task_id).serialize()
			fnServerSendData(dataStr,task_id,1);
		}
	}
}

function fnAddPerson(task_id,obj_id,type)
{
	if (window.confirm(<%=CodeLiteral( tools.get_web_str('vcrb_mess_del_rec') )%>))
	{
		try
		{			
			var strElemName='target_id'
			var hidin = document.getElementById(strElemName);
			if(hidin==null)
			{
				hidin=document.createElement('INPUT'); 
				hidin.type='hidden'; 
				hidin.name=strElemName; 
				hidin.id=strElemName;
				var hidinins = document.forms['task_form_'+task_id].appendChild(hidin);
			}
			hidin.value=obj_id;
		}
		catch(ex)
		{
		}
	
		document.forms['task_form_'+task_id].task_id.value = task_id;
		document.forms['task_form_'+task_id].command.value = type;
		dataStr=$("#task_form_"+task_id).serialize()
		fnServerSendData(dataStr,task_id,1);		
	}
}

function fnChangeTutorPerson( selected_object_ids_str, task_id )
{
	var pars=new Object();
	var strAttr="status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1";


	pars.xquery_qual ="<%=strXqueryQuals%>"
	
	xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&typein=0&show_all=1&multi_select=0&check_access=1&rand='+Math.random(), pars, strAttr);
	if ( ! pars.handle ) 
		return null;
			
	document.forms['task_form_'+task_id].selected_object_ids.value = pars.selected_object_ids;
	document.forms['task_form_'+task_id].command.value = "change_tutor_person";
	document.forms['task_form_'+task_id].task_id.value = task_id;
	dataStr=$("#task_form_"+task_id).serialize()
	fnServerSendData(dataStr,task_id);		
}

function change_commission_persons( selected_object_ids_str, task_id )
{
	var pars=new Object();
	var strAttr="status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1";
	pars.selected_object_ids = selected_object_ids_str;

	xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&typein=0&show_all=1&multi_select=1&check_access=1&rand='+Math.random(), pars, strAttr);
	if ( ! pars.handle ) 
		return null;
			
	document.forms['task_form_'+task_id].selected_object_ids.value = pars.selected_object_ids;
	document.forms['task_form_'+task_id].command.value = "change_commission_persons";
	document.forms['task_form_'+task_id].task_id.value = task_id;
	dataStr=$("#task_form_"+task_id).serialize()
	fnServerSendData(dataStr,task_id);		
}


	function toggle_tab(_id)
	{
		/*var _href = "<%=tools_web.get_query_string( true,'tab;')%>&tab=" + _id;
		window.location.href = _href;*/
		for (i=0;i<4;i++)
		{
			_div_id='divTab'+i
			_tab_id='td_'+i
			
			try
			{
				_div = document.getElementById(_div_id);
				if ( i == _id )
				{
					_div.style.display = 'inline';
				}
				else
				{
					_div.style.display = 'none';
				}
			}
			catch(ex)
			{
				//alert('div'+i+' '+ex)
			}
			
			try
			{
				_tab=document.getElementById(_tab_id);
				if ( i == _id )
				{
					_tab.className = 'tab_td_sel';
				}
				else
				{
					_tab.className = 'tab_td';
				}
			}
			catch(ex)
			{
				//alert('tab'+i+' '+ex)
			}
		}
		
		document.getElementById("tab").value = _id;
		return true;
	}

	function SetSelectValue()
	{
	
		var status=document.getElementById('status').value;
		
		if (status=='passed')
		{
			try
			{
				document.getElementById('readiness_percent').value=100
			}
			catch(ex)
			{
			}
		}
	}
	

	function fnDispHideElem( iImgId, iTaskId )
	{
		iElemId='tableinfoid_'+iTaskId
		if ( ! document.getElementById( iElemId ) )
			return false;

		_img = document.getElementById( iImgId );
		_trElem = document.getElementById( iElemId );
		_tdElem = document.getElementById( iElemId +'Td');
		
	
		if ( _trElem.style.display == 'none' )
		{
			_trElem.style.display = '';
			if( _img )
				_img.src = 'pics/minus.jpg';
				
			subForm=document.forms['task_form_'+iTaskId+"_ie"]
			
			subForm.command.value = "show_task_desc";
			subForm.task_id.value = iTaskId;
			dataStr=$("#task_form_"+iTaskId+"_ie").serialize()
			fnServerSendData(dataStr,iTaskId);		
		}
		else
		{
			_trElem.style.display = 'none';
			if (_tdElem)
				$(_tdElem).empty().html('&nbsp;')
			if( _img )
				_img.src = 'pics/plus.jpg';
		}
		return true;
		
		
	}

	function fnDispHideAddElem( iImgId, iElemId )
	{
		_elem=document.getElementById( iElemId )
		if ( ! _elem )
			return false;

		_img = document.getElementById( iImgId );
	
	
		if ( _elem.style.display == 'none' )
		{
			_elem.style.display = '';
			if( _img )
				_img.src = 'pics/minus.jpg';
					
		}
		else
		{
			_elem.style.display = 'none';
			if( _img )
				_img.src = 'pics/plus.jpg';
		}
		return true;
		
		
	}


	function fnServerSendData(dataStr,TaskId,UpdateRow)
	{
		try
		{	
			bUpdateRow=parseInt(UpdateRow)
		}
		catch(ex)
		{
			bUpdateRow=0
		}
		
		dataStr=dataStr+'&send_type=1'
		//alert(dataStr)

		containerId='tableinfoid_'+TaskId +'Td'
		
		
		$('#'+containerId).empty().html('<table width="100%" height="50%" border="0"><tr><td height="50%" style="text-align: center"><img src="pics/ajax-loader.gif" alt="<%=tools.get_web_str('c_loading')%>..."/></td></tr><tr><td height="50%"><div align="center">Downloading</div></td></tr></table>');
		$.post("career_reserve_change.html",dataStr,function(data)
			{
				if (data.indexOf("err:") ==0)
				{
					alert("Не обработать команду!\nОшибка: "+data);
					$('#'+containerId).empty().html('&nbsp;')
					return false;
				}
				else
				{
					$("#"+containerId).html(data);
					if (bUpdateRow==1)
					{
						$("#divEventLink_"+TaskId).html($("#hideLinkDiv_"+TaskId).html())
						$("#tdEventStatus_"+TaskId).html($("#hideStatusDiv_"+TaskId).html())
						$("#tdEventPlan_"+TaskId).html($("#hideDateDiv_"+TaskId).html())
						
						var strColor=($("#hideColorDiv_"+TaskId).html())
						
						strColor=(strColor!=''?'#':'')+strColor
						$("#tdEventName_"+TaskId).css("backgroundColor",strColor);
						$("#tdEventType_"+TaskId).css("backgroundColor",strColor);
						$("#tdEventPlan_"+TaskId).css("backgroundColor",strColor);
						$("#tdEventStatus_"+TaskId).css("backgroundColor",strColor);
					}
					else if (bUpdateRow==2)
					{
						try 
						{
							
							CurTable=document.getElementById('<%=tableID%>')
							
							RowIndex=document.getElementById('tableinfoid_'+TaskId).rowIndex
							CurTable.deleteRow(RowIndex);
							RowIndex=document.getElementById('tableinfoid_'+TaskId+'Tr').rowIndex
							CurTable.deleteRow(RowIndex);
						} 
						catch(e) 
						{
							alert(e.description)
						}
					}
					
					return true
				}
			}
		)	 
	}
	
	function fnSelectTask(ObjType)
	{
		switch ( ObjType )
		{
			case 'test':
					catName='assessment'
				break;
			case 'course':
					catName='course'
				break;
			case 'edu_method':
					catName='education_method'
				break;
			default:	
				return null;
		}

	
		var pars=new Object();
		var strAttr="status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1";
	
		xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name='+catName+'&typein=0&show_all=1&multi_select=0&check_access=1&rand='+Math.random(), pars, strAttr);
		if ( ! pars.handle ) 
			return null;
			
		var nameElem=document.getElementById(ObjType+'NewObjNameTd')
		if (nameElem)
		{
			nameElem.innerHTML=pars.element_name;
		}
		
		var idElem=document.getElementById('new_'+ObjType+'_id')
		if (idElem)
		{
			idElem.value=pars.selected_object_ids
		}
		
		var name_input = document.getElementById("new_name");
		
		if (name_input)
		{
			name_input.value=pars.element_name
		}
	}
-->
</script>
	
<style>
	.tab_td {
		border-right: #aaaaaa 1px solid; border-top: #aaaaaa 1px solid; border-left: #aaaaaa 1px solid; border-bottom: #aaaaaa 1px solid; text-align: center; background-color: #EEEEEE;
	}
	.tab_td_sel {
		border-right: #aaaaaa 1px solid; border-top: #aaaaaa 1px solid; border-left: #aaaaaa 1px solid; border-bottom: #aaaaaa 0px solid; text-align: center; font-weight:bold; height:24px;
	}
	.tab_td_empty {
		border-bottom: #aaaaaa 1px solid;
	}
</style>
<%
if (Request.Query.HasProperty("tab"))
	_selectedTab = Int(Request.Query.GetProperty("tab"));
else
	_selectedTab = 0;
%>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td class="tab_td_empty"><img src="pics/1blank.gif" width="10" height="0"/></td>
		
		<td class="<%=(_selectedTab == 0 ? "tab_td_sel" : "tab_td")%>" id="td_0" onclick=""><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="toggle_tab(0)"><%=tools.get_web_str('c_common')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>
		
		<td class="<%=(_selectedTab == 1 ? "tab_td_sel" : "tab_td")%>" id="td_1" onclick=""><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="toggle_tab(1)"><%=tools.get_web_str('c_development_plan')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>
		
		<td class="<%=(_selectedTab == 2 ? "tab_td_sel" : "tab_td")%>" id="td_2" onclick=""><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="toggle_tab(2)"><%=tools.get_web_str('c_activity_plan')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>
		
		<td class="<%=(_selectedTab == 3 ? "tab_td_sel" : "tab_td")%>" id="td_3" onclick=""><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="toggle_tab(3)"><%=tools.get_web_str('c_resume')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>
		
		<td class="tab_td_empty" width="100%">&nbsp;</td>
	</tr>
</table>
<br/>
<script src="scripts/calendar/calendar.js"></script>

<form name="career_reserve_form" id="career_reserve_form" action="career_reserve_change.html" method="post">
	<input type="hidden" name="doc_id" id="doc_id" value="<%=curDocID%>"/>
	<input type="hidden" name="career_reserve_id" id="career_reserve_id" value="<%=curObjectID%>"/>
	<input type="hidden" name="sid" id="sid" value="<%=tools.get_sum_sid( curDocID )%>"/>
	<input type="hidden" name="command" id="command" value=""/>
	<input type="hidden" name="is_tutor" id="is_tutor" value="<%=bIsTutor%>"/>
	<input type="hidden" name="is_main_tutor" id="is_main_tutor" value="<%=bIsMainTutor%>"/>
	<input type="hidden" name="is_commission_person" id="is_commission_person" value="<%=bIsCommissionPerson%>"/>
	<input type="hidden" name="selected_object_id" id="selected_object_id" value=""/>
	<input type="hidden" name="selected_object_ids" id="selected_object_ids" value=""/>
	<input type="hidden" name="task_id" id="task_id" value=""/>
	<input type="hidden" name="tab" id="tab" value="<%=_selectedTab%>"/>

<br/>	
<div id="divTab0" <%=(_selectedTab != 0 ? 'style="display: none"' : 'style="display: inline"')%>>
	<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">			
		<tr>
			<td width="200" align="RIGHT"><%=_type_name%>:</td>
			<td style="font-weight:normal"><%=_position_name%></td>
		</tr>
		<tr>
			<td width="200" align="RIGHT"><%=tools.get_web_str('c_open_date')%>:</td>
			<td style="font-weight:normal">
			<%
				if ( bIsTutor )
				{
			%>
					<input type="text" name="start_date" id="start_date" style="width: 60px" class="inputEdit" value="<%=StrDate( curObject.start_date, false )%>" />
					<a href="#" onclick="var h=0; var offP = this.offsetParent; while(offP.id != 'main_block' && offP.tagName.toUpperCase()!='BODY') {h+=offP.offsetTop; offP = offP.offsetParent;} ; showCalendar(this, document.getElementById('start_date'), 'dd.mm.yyyy','ru',1,null, h+40);"><img src="/scripts/calendar/calendar.gif" width="24" height="22" border="0"/></a>
			<%
				}
				else
					Response.Write( StrDate( curObject.start_date, false ) );
			%>		
			</td>
		</tr>
		<tr>
			<td width="200" align="RIGHT"><%=tools.get_web_str('c_plan_readiness_date')%>:</td>
			<td style="font-weight:normal">
			<%
				if ( bIsTutor )
				{
			%>
					<input type="text" name="plan_readiness_date" id="plan_readiness_date" style="width: 60px" class="inputEdit" value="<%=StrDate( curObject.plan_readiness_date, false )%>" />
					<a href="#" onclick="var h=0; var offP = this.offsetParent; while(offP.id != 'main_block' && offP.tagName.toUpperCase()!='BODY') {h+=offP.offsetTop; offP = offP.offsetParent;} ; showCalendar(this, document.getElementById('plan_readiness_date'), 'dd.mm.yyyy','ru',1,null, h+40);"><img src="/scripts/calendar/calendar.gif" width="24" height="22" border="0"/></a>
			<%
				}
				else
					Response.Write( StrDate( curObject.plan_readiness_date, false ) );
			%>			
			</td>
		</tr>
		<tr>
			<td width="200" align="RIGHT"><%=tools.get_web_str('c_close_date')%>:</td>
			<td style="font-weight:normal">
			<%
				if ( bIsTutor )
				{
			%>
					<input type="text" name="finish_date" id="finish_date" style="width: 60px" class="inputEdit" value="<%=StrDate( curObject.finish_date, false )%>" />
					<a href="#" onclick="var h=0; var offP = this.offsetParent; while(offP.id != 'main_block' && offP.tagName.toUpperCase()!='BODY') {h+=offP.offsetTop; offP = offP.offsetParent;} ; showCalendar(this, document.getElementById('finish_date'), 'dd.mm.yyyy','ru',1,null, h+40);"><img src="/scripts/calendar/calendar.gif" width="24" height="22" border="0"/></a>
			<%
				}
				else
					Response.Write( StrDate( curObject.finish_date, false ) );
			%>			
			</td>
		</tr>
		<tr>
			<td width="200" align="RIGHT"><%=tools.get_web_str('c_status')%>:</td>
	<%
		if ( bIsTutor )
		{
	%>
			<td style="font-weight:normal">
				<select name="status" id="status" onchange="SetSelectValue()">
	<%
			for ( _status in curLngCommon.career_reserve_status_types )
			{
				if (_status.PrimaryKey == curObject.status ) 
					selected_flag = ' selected';
				else 
					selected_flag = '';
	%>
					<option <%=selected_flag%> value="<%=_status.PrimaryKey%>"><%=_status.name%></option>
	<%
			}
	%>
				</select>
			</td>
	<%
		}
		else
		{
	%>
			<td style="font-weight:normal"><%=( _cur_status == undefined ? curObject.status : _cur_status.name )%></td>
	<%
		}
	%>
		</tr>
		<tr>
		<td width="200" align="RIGHT"><%=tools.get_web_str('c_readiness_percent')%>:</td>
			<td style="font-weight:normal">
			<%
				if ( bIsTutor )
				{
			%>
					<input type="text" name="readiness_percent" id="readiness_percent" style="width: 60px" class="inputEdit" value="<%=curObject.readiness_percent%>"onchange="check_real_value(this.value, this.id)" />
			<%
				}
				else
					Response.Write( curObject.readiness_percent );
			%>			
			</td>
		</tr>
		<tr>
			<td width="200" align="RIGHT"><%=tools.get_web_str('c_mentor')%>:</td>
			<td style="font-weight:normal"><%=_tutor_text%></td>
		</tr>
		<tr>
			<td width="200" align="RIGHT"><%=tools.get_web_str('vcrb_mentor_comment')%>:</td>
			<td style="font-weight:normal">
			<%
			if ( !bIsTutor )
			{
				Response.Write(curObject.comment);
			}
			else
				Response.Write('<textarea rows="4" cols="100" name="tutor_general_comment">'+curObject.comment+'</textarea>');
			%>
			</td>
		</tr>
	</table>
	<br>
	
<%
if ( bIsTutor )
{	
%>
	<table width="100%" cellspacing="0" cellpadding="5" class="activator">
		<tr valign="MIDDLE">	
			<td align="CENTER"><input type="button" value="<%=tools.get_web_str('c_save')%>" onclick="document.forms['career_reserve_form'].command.value = 'save'; document.career_reserve_form.submit();return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/></td>
		</tr>
	</table>
<%
}
%>

</form>
</div>

<div id="divTab1" <%=(_selectedTab != 1 ? 'style="display: none"' : 'style="display: inline"')%>">
	<%
	if ( curObject.development_plan_id.HasValue || curObject.current_competence_profile_id.HasValue || curObject.target_competence_profile_id.HasValue )
	{
	%>
	<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
	<%
		if ( curObject.current_competence_profile_id.HasValue )
		{
	%>
		<tr>
			<td width="200" align="RIGHT"><%=tools.get_web_str('vcrb_begin_competence_profile')%>:</td>
			<td style="font-weight:normal">
				<a href="" onClick="var id=window.open('view_window_competence_profile.html?doc_id=<%=curDocID%>&object_id=<%=curObject.current_competence_profile_id%>', 'About','scrollbars,resizable,width=760,height=500');id.focus();return false;">
	<%
				try
				{
					current_competence_name = curObject.current_competence_profile_id.ForeignElem.name;
				}
				catch(err)
				{
					current_competence_name = tools.get_web_str("c_deleted");
				}
	%>
				<%=current_competence_name%>&nbsp;
				</a>
			</td>
		</tr>
	<%
		}
		
		if ( curObject.target_competence_profile_id.HasValue )
		{
	%>
		<tr>
			<td width="200" align="RIGHT"><%=tools.get_web_str('vcrb_target_competence_profile')%>:</td>
			<td style="font-weight:normal"><a href="" onClick="var id=window.open('view_window_competence_profile.html?doc_id=<%=curDocID%>&object_id=<%=curObject.target_competence_profile_id%>', 'About','scrollbars,resizable,width=760,height=500');id.focus();return false;">
	<%
			try
			{
				target_competence_name = curObject.target_competence_profile_id.ForeignElem.name;
			}
			catch(err)
			{
				target_competence_name = tools.get_web_str("c_deleted");
			}
	%>
			<%=target_competence_name%>&nbsp;</a></td>
		</tr>
	<%
		}
	%>
	</table>
	<br/>
	<%
		if (curObject.development_plan_id.HasValue)
		{
			try
			{
				tePlan=OpenDoc( UrlFromDocID (curObject.development_plan_id)).TopElem;
				arrComp=tePlan.competences
			}
			catch(ex)
			{
				
			}
	%>
	<table width="100%" class="tableBasic" border="0" cellspacing="0" cellpadding="0">
		<tr>
			<td class="tableHeaderTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderText" colspan="5" width="100%"><p class="tableHeaderTextInner"><%=tools.get_web_str('c_development_plan')%></p></td>
			<td class="tableHeaderTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
		<tr>
			<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderWithText"><%=tools.get_web_str('ass_competence')%></td>
			<td class="tableHeaderWithText"><%=tools.get_web_str('vdb_development_method')%></td>
			<td class="tableHeaderWithText"><%=tools.get_web_str('vepb_edu_methods')%></td>
			<td class="tableHeaderWithText">Текущий уровень</td>
			<td class="tableHeaderWithText">Требуемый уровень</td>
			<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
		<tr>
			<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderNoText" colspan="5"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
	<%
		counter = 0;
		for ( iCompElem in arrComp )
		{
			_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
			_classl = counter++ % 2 ? 'tableRowEvenLeft' : 'tableRowOddLeft';		
			_classr = counter++ % 2 ? 'tableRowEvenRight' : 'tableRowOddRight';
			
			try
			{
				target_competence_name = iCompElem.competence_id.ForeignElem.name
			}
			catch(err)
			{
				target_competence_name = tools.get_web_str("c_deleted");
			}
	%>
		<tr>
			
			<td class="<%=_classl%>">&nbsp;</td>
			<td class="<%=_class%>">
				<%=target_competence_name%>&nbsp;
			</td>
			<td class="<%=_class%>">
				<%
					resulr_str='';
					for (_development_method in iCompElem.development_methods)
					{
						resulr_str=='' ? resulr_str=resulr_str+_development_method.development_method_id.ForeignElem.name : resulr_str=resulr_str+', '+_development_method.development_method_id.ForeignElem.name
					}
					Response.Write(resulr_str);
				%>&nbsp;
			</td>
			<td class="<%=_class%>">
				<%
					resulr_str='';
					for (_education_method in iCompElem.education_methods)
					{
						resulr_str=='' ? resulr_str=resulr_str+_education_method.education_method_id.ForeignElem.name : resulr_str=resulr_str+', '+_education_method.education_method_id.ForeignElem.name
					}
					Response.Write(resulr_str);
				%>&nbsp;
			</td>
			<td class="<%=_class%>" align="center">
				<%
					if (curObject.current_competence_profile_id.HasValue)
					{
						currentCompetenceProfileDoc = OpenDoc( UrlFromDocID( curObject.current_competence_profile_id ) ).TopElem;
						if ( currentCompetenceProfileDoc.competences.ChildByKeyExists( iCompElem.competence_id ) )
						{
							_competence = currentCompetenceProfileDoc.competences.GetChildByKey( iCompElem.competence_id );
							if ( _competence.plan.HasValue )
							{
								competenceDoc = OpenDoc( UrlFromDocID (iCompElem.competence_id)).TopElem;
								_scale_name=''
								try
								{
									_scale_name = competenceDoc.scales.GetChildByKey(_competence.plan).name;
								}
								catch(ex)
								{
								}
								 Response.Write(_scale_name)
							}
						}		
					}
				%>&nbsp;
			</td>
			<td class="<%=_class%>" align="center">
				<%
					if (curObject.target_competence_profile_id.HasValue)
					{
						targetCompetenceProfileDoc = OpenDoc( UrlFromDocID( curObject.target_competence_profile_id ) ).TopElem;
						if ( targetCompetenceProfileDoc.competences.ChildByKeyExists( iCompElem.competence_id ) )
						{
							_competence = targetCompetenceProfileDoc.competences.GetChildByKey( iCompElem.competence_id );
							if ( _competence.plan.HasValue )
							{
								competenceDoc = OpenDoc( UrlFromDocID (iCompElem.competence_id)).TopElem;
								_scale_name=''
								try
								{
									_scale_name = competenceDoc.scales.GetChildByKey(_competence.plan).name;
								}
								catch(ex)
								{
								}
								Response.Write(_scale_name)
							}
						}		
					}
				%>&nbsp;
			</td>
			<td class="<%=_classr%>">&nbsp;</td>
			
		</tr>
		<%
		}
		%>	
		<tr>
			<td class="tableFooterLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableFooter" colspan="5"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableFooterRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
	</table>	
	<%
		}
	
	}
	%>			
	
</div>
<div id="divTab2" <%=(_selectedTab != 2 ? 'style="display: none"' : 'style="display: inline"')%>">
<!-- START NEW VARIANT 24.05.2011 GSM -->
		<table width="100%" class="tableBasic" border="0" cellspacing="0" cellpadding="0">
		<tbody id="<%=tableID%>" name="<%=tableID%>">
			<tr>
				<td class="tableHeaderTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
				<td class="tableHeaderText" colspan="4" width="100%"><p class="tableHeaderTextInner"><%=tools.get_web_str('vkb_tasks')%></p></td>
				<td class="tableHeaderTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
			</tr>
			<tr>
				<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
				
<%
				for (i=0;i<4;i++)
				{
					switch (i) 			
					{
						case 0:
							ColName='c_name'
							break;
						case 1:
							ColName='c_type'
							break;
						case 2:
							ColName='c_plan_date'
							break;
						case 3:
							ColName='c_status'
							break	
					}
				
%>
				<td class="tableHeaderWithText">
<%
				_add = 'sort'+tableID+'=' + i + '&direct'+tableID + ( i == sortIndex && sortDirect == '+' ? '=0' : '=1' );
%>
			<a href="#" onclick="do_sort_<%=tableID%>('<%=_add%>')"><%=tools.get_web_str(ColName)%></a>
<%
			if ( i == sortIndex )
				Response.Write( sortDirect == '+' ? '&nbsp;&#9650;' : '&nbsp;&#9660;' );
				%></td>
<%
				}
%>
				<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
			</tr>
			<tr>
				<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
				<td class="tableHeaderNoText" colspan="4"><img src="pics/1blank.gif" width="0" height="0" /></td>
				<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
			</tr>
		<%
			counter = 0;
			
			switch (sortIndex) 			
			{
				case 0:
					ColName='name'
					break;
				case 1:
					ColName='type'
					break;
				case 2:
					ColName='plan_date'
					break;
				case 3:
					ColName='status'
					break	
				default:
					ColName='plan_date'
					break;
			}
			
			arrTasks=ArraySort(curObject.tasks,ColName,sortDirect)
			for ( _event in arrTasks)
			{
			
				if (!bIsMainTutor&&!bIsPerson)
				{
					if ((_event.tutor_id != curUserID)&&(ArrayOptFind(_event.commission_persons,'person_id=='+curUserID)==undefined))
					{
						continue;
					}
				}
				_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
				_classl = counter++ % 2 ? 'tableRowEvenLeft' : 'tableRowOddLeft';		
				_classr = counter++ % 2 ? 'tableRowEvenRight' : 'tableRowOddRight';
				strTaskBodyRowName='tableinfoid_'+_event.id
				
				bCanActivateTest=false;
				bCanActivateCourse=false;
				bCanAddToEvent=false;
				
				strColor=''
				if( _event.plan_date.HasValue)
				{
					if ( _event.plan_date<Date())
					{
						strColor='style="background-color:#' + StrHexColor( '255,210,210' ) + '"' 
					}
				}
		%>
			<tr id="<%=strTaskBodyRowName%>Tr">
			<form name="task_form_<%=_event.id%>_ie" id="task_form_<%=_event.id%>_ie" action="career_reserve_change.html" method="post">
				<input type="hidden" name="doc_id" id="doc_id" value="<%=curDocID%>"/>
				<input type="hidden" name="career_reserve_id" id="career_reserve_id" value="<%=curObjectID%>"/>
				<input type="hidden" name="sid" id="sid" value="<%=tools.get_sum_sid( curDocID )%>"/>
				<input type="hidden" name="command" id="command" value=""/>
				<input type="hidden" name="task_id" id="task_id" value=""/>
				<td class="<%=_classl%>">&nbsp;</td>
				<td class="<%=_class%>" name="tdEventName_<%=_event.id%>" id="tdEventName_<%=_event.id%>" <%=strColor%>>
					<a href="#" onclick="fnDispHideElem('task_body_img_<%=_event.id%>','<%=_event.id%>'); return false" id="best"><img src="pics/plus.jpg" id="task_body_img_<%=_event.id%>" border="0"/></a>
				<div id="divEventLink_<%=_event.id%>" name="divEventLink_<%=_event.id%>" style="display:inline">
				<%
					strResponce=''
					switch ( _event.type )
					{
						case 'learning':
						
							if ( _event.object_id.HasValue || _event.active_learning_id.HasValue )
							{
								fldActiveLearn=_event.active_learning_id.OptForeignElem
								fldCourse=_event.object_id.OptForeignElem
								if(fldActiveLearn!=undefined&&fldCourse!=undefined)
								{
									strResponce='<a href="view_doc.html?object_id='+fldActiveLearn.id+'&course_id='+fldCourse.id+'&mode=learning_proc&doc_id='+curDocID+'&sid='+tools.get_sum_sid(fldActiveLearn.id)+'">' + _event.name + '</a>';
								}
								else if (fldActiveLearn!=undefined&&fldCourse==undefined)
								{
									strResponce='<a href="view_doc.html?object_id='+fldActiveLearn.id+'&mode=learning_proc&doc_id='+curDocID+'&sid='+tools.get_sum_sid(fldActiveLearn.id)+'">' + _event.name + '</a>';
								}
								else if (fldActiveLearn==undefined&&fldCourse!=undefined)
								{
									strResponce='<a href="view_doc.html?object_id='+fldCourse.id+'&mode=course_info&doc_id='+curDocID+'">' + _event.name + '</a>';
									bCanActivateCourse=true;
								}
								else
								{
									strResponce='<a href="view_doc.html?mode=active_learning&doc_code=active_learnings&doc_id='+curDocID+'">' + _event.name + '</a>';
								}
								
							}
							else
								strResponce=_event.name; 
							break;
						case 'test_learning':
							if ( _event.object_id.HasValue || _event.active_test_learning_id.HasValue )
							{
	
								fldActiveLearn=_event.active_test_learning_id.OptForeignElem
								fldTest=_event.object_id.OptForeignElem
								if(fldActiveLearn!=undefined&&fldTest!=undefined)
								{
									strResponce='<a href="view_doc.html?object_id='+fldActiveLearn.id+'&assessment_id='+fldTest.id+'&mode=test_learning_proc&doc_id='+curDocID+'&sid='+tools.get_sum_sid(fldActiveLearn.id)+'">' + _event.name + '</a>';
								}
								else if (fldActiveLearn!=undefined&&fldTest==undefined)
								{
									strResponce='<a href="view_doc.html?object_id='+fldActiveLearn.id+'&mode=test_learning_proc&doc_id='+curDocID+'&sid='+tools.get_sum_sid(fldActiveLearn.id)+'">' + _event.name + '</a>';
								}
								else if (fldActiveLearn==undefined&&fldTest!=undefined)
								{
									strResponce='<a href="view_doc.html?object_id='+fldTest.id+'&mode=assessment&doc_id='+curDocID+'">' + _event.name + '</a>';
									bCanActivateTest=true;
								}
								else
								{
									strResponce='<a href="view_doc.html?mode=active_test_learning&doc_code=active_test_learnings&doc_id='+curDocID+'">' + _event.name + '</a>';
								}
							}
							else
								strResponce=_event.name; 
							break;
						case 'document_learning':
							if ( _event.type_document == 'absolute_doc' )
								strResponce='<a href="' + _event.link_document + '">' + _event.name + '</a>';
							else
								if ( _event.object_id.HasValue )
									strResponce='<a href="view_doc.html?doc_id='+ _event.object_id +'">' + _event.name + '</a>';
								else	
									strResponce='_event.name'; 
							break;
						case 'education_method':
							fldEduMethod=_event.object_id.OptForeignElem
							if ( fldEduMethod!= undefined )
							{
								
								fldEvent=_event.event_id.OptForeignElem
								fldEventResult=_event.event_result_id.OptForeignElem
								
								if(fldEvent!=undefined&&fldEventResult!=undefined)
								{
									strResponce='<a href="view_doc.html?mode=event_result&event_id='+fldEvent.id+'&person_id='+curObject.person_id+'&doc_id='+curDocID+'">' + _event.name + '</a>';
								}
								else if(fldEvent!=undefined&&fldEventResult==undefined)
								{
									strResponce='<a href="view_doc.html?object_id='+fldEvent.id+'&mode=event&doc_id='+curDocID+'">' + _event.name + '</a>';
									bCanAddToEvent=true;;
								}
								else
								{
									strResponce='<a href="view_doc.html?mode=education_method&doc_id='+curDocID+'&object_id='+fldEduMethod.id+'">' + _event.name + '</a>';
								}
							}
							else
								strResponce=_event.name; 
							break;	
							
							
						default:	
							strResponce=_event.name; 
					}
	
				if (bIsPerson)
				{
					Response.Write(strResponce);
				}
				else if (bIsBoss||bIsTutor||bIsMainTutor)
				{
					Response.Write(StrReplace(StrReplace(strResponce,'test_learning_proc','test_learning_stat'),'learning_proc','learning_stat'));
				}
				else
				{
					Response.Write(_event.name);
				}
	
				
	
				%>
				</div>
				</td>
				<td class="<%=_class%>" name="tdEventType_<%=_event.id%>" id="tdEventType_<%=_event.id%>" <%=strColor%>><%=_event.type.ForeignElem.name%></td>
				<td class="<%=_class%>" name="tdEventPlan_<%=_event.id%>" id="tdEventPlan_<%=_event.id%>" <%=strColor%>><%=StrDate( _event.plan_date, false )%></td>
				<td class="<%=_class%>" name="tdEventStatus_<%=_event.id%>" id="tdEventStatus_<%=_event.id%>" <%=strColor%>><%=_event.status.ForeignElem.name%></td>
				<td class="<%=_classr%>">&nbsp;</td>
			</tr>
			</form>
			<tr id="<%=strTaskBodyRowName%>" style="display:none">
				<td class="<%=_classl%>">&nbsp;</td>
				<td class="<%=_class%>" colspan="4" id="<%=strTaskBodyRowName%>Td">
				</td>
				<td class="<%=_classr%>">&nbsp;</td>
			</tr>
		<%
			}
		%>	
			<tr>
				<td class="tableFooterLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
				<td class="tableFooter" colspan="4"><img src="pics/1blank.gif" width="0" height="0" /></td>
				<td class="tableFooterRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
			</tr>
		</tbody>
	</table>
	<br/>
<!-- END NEW VARIANT 24.05.2011 GSM -->	
	<%
		if ( bIsTutor )
		{
	%>
	<a href="" onclick="fnDispHideAddElem('new_task_img','new_task_div'); return false;" id="new_task"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/plus.jpg" id="new_task_img" border="0"/>&nbsp;<%=tools.get_web_str('vcrb_add_task')%></p></a>
	<div id="new_task_div" style="display: none">
		<form name="new_task_form" id="new_task_form" action="career_reserve_change.html" method="post">
			<input type="hidden" name="doc_id" id="doc_id" value="<%=curDocID%>"/>
			<input type="hidden" name="career_reserve_id" id="career_reserve_id" value="<%=curObjectID%>"/>
			<input type="hidden" name="sid" id="sid" value="<%=tools.get_sum_sid( curDocID )%>"/>
			<input type="hidden" name="command" id="command" value=""/>
			<input type="hidden" name="tab" id="tab" value="2"/>
		<table width="100%" cellspacing="0" cellpadding="4"  border="0" class="tableBorder">			
			<tr>
				<td width="200" align="RIGHT"><%=tools.get_web_str('c_name')%>:</td>
				<td style="font-weight:normal"><input size="100" type="text" name="new_name" id="new_name" class="inputEdit"/></td>
			</tr>
			<tr>
				<td width="200" align="RIGHT"><%=tools.get_web_str('c_type')%></td>
				<td style="font-weight:normal">
					<select name="new_type" id="new_type" onchange="on_type_change(this.value);">
		<%
					for ( _type in curLngCommon.career_reserve_tasks_types )
					{
		%>
							<option value="<%=_type.PrimaryKey%>"><%=_type.name%></option>
		<%
					}
		%>
					</select>
				</td>
			</tr>
			<tr>
				<td width="200" align="RIGHT"><%=tools.get_web_str('c_status')%>:</td>
				<td style="font-weight:normal">
					<select name="new_status">
		<%
				for ( _status in curLngCommon.career_reserve_status_types )
				{
		%>
						<option value="<%=_status.PrimaryKey%>"><%=_status.name%></option>
		<%
				}
		%>
					</select>
				</td>
			</tr>
			<tr>
				<td width="200" align="RIGHT"><%=tools.get_web_str('c_desc')%>:</td>
				<td style="font-weight:normal"><textarea rows="3" cols="40" name="new_desc"></textarea></td>
			</tr>
			
			<tr id="course_block" style="display: none">
				<td width="200" align="RIGHT">
					<b><%=tools.get_web_str('c_course')%>:</b>   
				</td>
				<td>
					<table width="100%" cellspacing="0" cellpadding="0"  border="0">
						<tr>
							<td width="40%" id="courseNewObjNameTd" align="left" valign="middle">
								<%=tools.get_web_str('c_select')%>
							</td>
							<td>
								<input type="hidden" id="new_course_id" name="new_course_id">
								<input type="button" value="<%=tools.get_web_str('c_choose')%>"  onclick="fnSelectTask('course')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">   
							</td>
						</tr>
					</table>
				</td>
			</tr>
		    <tr id="test_block" style="display: none">
				<td width="200" align="RIGHT">
					<b><%=tools.get_web_str('c_test')%>:</b>   
				</td>
				<td>
					<table width="100%" cellspacing="0" cellpadding="0"  border="0">
						<tr>
							<td width="40%" id="testNewObjNameTd" align="left" valign="middle">
								<%=tools.get_web_str('c_select')%>
							</td>
							<td>
								<input type="hidden" id="new_test_id" name="new_test_id">
								<input type="button" value="<%=tools.get_web_str('c_choose')%>"  onclick="fnSelectTask('test')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">   
							</td>
						</tr>
					</table>
				</td>
			</tr>
		
			<tr id="edu_block" style="display: none">
				<td width="200" align="RIGHT">
					<b><%=tools.get_web_str('c_edu_method')%>:</b>   
				</td>
				<td>
					<table width="100%" cellspacing="0" cellpadding="0"  border="0">
						<tr>
							<td width="40%" id="edu_methodNewObjNameTd" align="left" valign="middle">
								<%=tools.get_web_str('c_select')%>
							</td>
							<td>
								<input type="hidden" id="new_edu_method_id" name="new_edu_method_id">
								<input type="button" value="<%=tools.get_web_str('c_choose')%>"  onclick="fnSelectTask('edu_method')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">   
							</td>
						</tr>
					</table>
				</td>
			</tr>
		
			<tr id="document_block" style="display: none">
				<td width="200" align="RIGHT"><%=tools.get_web_str('c_doc')%>:</td>
				<td style="font-weight:normal">
					<input type="radio" name="new_doc_type" value="portal_doc" checked onclick="document.all['new_doc_id'].style.display = 'inline'; document.all['new_doc_url'].style.display = 'none';"/> <%=tools.get_web_str('c_document')%>
					<input type="radio" name="new_doc_type" value="absolute_doc" onclick="document.all['new_doc_id'].style.display = 'none'; document.all['new_doc_url'].style.display = 'inline';"/> <%=tools.get_web_str('vcrb_doc_link')%><br><br>
					<input type="text" name="new_doc_url" value="http://" style="display: none" size="100"/>
					<select name="new_doc_id">
						<%
						ElemArray = XQuery ('for $elem in documents order by  $elem/name return  $elem');
						for (_elem in ElemArray)
						{
							%>
							<option value="<%=_elem.PrimaryKey%>"><%=_elem.name%></option>
							<%
						}
						%>
					</select>
				</td>
			</tr>
			<%
		
			%>
			<tr>
				<td width="200" align="RIGHT"></td>
				<td style="font-weight:normal"><input type="button" value="<%=tools.get_web_str('vcrb_add_task')%>" onclick="do_add_event();return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/></td>
			</tr>
		</table>
		</form>
	</div>
	<br/>
<%
		}
%>
</div>
<div id="divTab3" <%=(_selectedTab != 3 ? 'style="display: none"' : 'style="display: inline"')%>">
<%
	isTutor=true
	PersonID=curObject.person_id
	CanAddDelResumes=bIsTutor;
	FormToSubmit='delete_resume_form';
	_url='view_doc.html?mode=resume&object_id='+curObjectID+'&doc_id='+curDocID+'&person_id='+PersonID+'&tab=3&redirect=career_reserve'
	strBackUrl='view_doc.html?mode=career_reserve&doc_id='+curDocID+'&object_id='+curObjectID+'&tab=3'
	Server.Execute('view_resumes_body.html');
%>
</div>


<SCRIPT LANGUAGE="JavaScript">
<!--//
	function on_type_change(_value)
	{
		var course_block = document.getElementById("course_block");
		var test_block = document.getElementById("test_block");
		var doc_block = document.getElementById("document_block");
		var edu_block = document.getElementById("edu_block");

		course_block.style.display = 'none';
		test_block.style.display = 'none';		
		doc_block.style.display = 'none';
		edu_block.style.display = 'none';	

		document.getElementById("new_name").value = "";
		switch (_value)
		{
			case "learning":
				course_block.style.display = '';
				break;
				
			case "test_learning":
				test_block.style.display = '';
				break;
			case "document_learning":
				doc_block.style.display = '';
				break;
			case "education_method":
				edu_block.style.display = '';
				break;		
		}
		
	}
	
	function check_real_value( _value, _id )
	{
		if ( isNaN( parseFloat( _value ) ) || parseFloat( _value ) != _value )
		{
			alert( <%=CodeLiteral( tools.get_web_str('vcrb_mess_num') )%> );
			document.getElementById(_id).value = ( isNaN( parseFloat( _value ) ) ? "" : parseFloat( _value ) );
		}
		else
		{
			document.getElementById(_id).value = parseFloat( _value );
		}
	}
	
	function comission_score_change( _value, _id, _event_id, _ids_str )
	{
		check_real_value( _value, _id );
		var _ids_str = new String(_ids_str);
		_id_array = _ids_str.split(";");
		_sum = 0;
		for ( i = 0; i < _id_array.length; i++ )
		{
			_cur_value = document.getElementById("score_" + _event_id + "_" + _id_array[i]).value;
			if ( !isNaN( parseFloat( _cur_value ) ) )
				_sum = _sum + parseFloat(_cur_value);
		}
		if ( _id_array.length != 0 )
		{
			var markValue=0
			markValue=parseFloat((_sum/_id_array.length).toFixed(2));
			document.getElementById("score" + _event_id ).value = markValue
			
			if (document.getElementById("div_score" + _event_id ))
			{
				document.getElementById("div_score" + _event_id ).innerHTML = markValue
			}
			
		} 
	}
	
	
//-->
</SCRIPT>

<%Server.Execute( "view_files.html" )%>
<br>