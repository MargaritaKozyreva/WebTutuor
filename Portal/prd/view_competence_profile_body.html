<%
if (Request.QueryString.HasProperty("competence_profile_id"))
{
	curProfileID = Int(Request.QueryString.competence_profile_id);
	_flag_info = true;
	try
	{
		curProfile = OpenDoc(UrlFromDocID( curProfileID)).TopElem;
	}
	catch(_yopt_)
	{
		curProfile = null;
	}
}
else if (curObjectID != null)
{
	curProfileID = curObjectID;
	curProfile = curObject;
	_flag_info = true;
}
else
{
	curProfileID=curUser.position_id.OptForeignElem;
	if (curProfileID != undefined)
		curProfileID = curProfileID.competence_profile_id;
	_flag_info = false;
	try
	{
		curProfile = OpenDoc(UrlFromDocID( curProfileID)).TopElem;
	}
	catch(_yopt_)
	{
		curProfile = null;
	}
}

%>
<script language="JavaScript" src="scripts/tooltip/wz_tooltip_late.js"></script>
<table width="100%"  border="0" cellspacing="0" cellpadding="3">
<%

	if (curProfile != null)
	{
%>
	<TR VALIGN="MIDDLE">
		<TD class="tableHeaderWithText" style="font-size:smaller" colspan="5">
			<%=curProfile.name%>
		</TD>
	</TR>
<%
		function print_profile_data()
		{
%>
		<TR VALIGN="MIDDLE">					
			<TD class="<%=_class%>">
				<%=((curCompetenceElement.Name == "indicator" ? "<li/><i>" + curCompetenceElement.name + "</i>" : "<B>" + curCompetenceElement.name + "</B>"))%>
			</TD>
			<TD class="<%=_class%>">
<%
				_fldScaleElem = curCompetenceElement.scales.GetOptChildByKey(_element.plan);
				if (_fldScaleElem != undefined)
				{
					if (_fldScaleElem.desc.HasValue)
					{
%>
					<div style="cursor: default" onmouseover="this.style.fontWeight = 'bold';Tip('<%=XmlAttrEncode(_fldScaleElem.desc.Value)%>', SHADOW, true, BGCOLOR, 'white', WIDTH, 500, DELAY, 100);" onmouseout="this.style.fontWeight = 'normal';"><%=_fldScaleElem.name%></div>
<%
					}
					else
						Response.Write(_fldScaleElem.name);
				}
				else
					Response.Write(_element.plan);
%>
			</TD>
			<TD class="<%=_class%>">
					<%=(StrReal(_element.weight, 1) + "%")%>
			</TD>
			<TD class="<%=_class%>">
<%
				for(_level in curCompetenceElement.levels)
				{
				
					for(_assessment in _level.assessments)
					{
						if (_assessment.PrimaryKey.OptForeignElem != undefined)
						{
								if (_flag_info)
								{
%>
				&raquo;&nbsp; <%=_assessment.PrimaryKey.ForeignElem.title%>
<%
								}
								else
								{
%>
							<a href="view_doc.html?mode=assessment&object_id=<%=_assessment.PrimaryKey%>&doc_id=<%=curDocID%>">&raquo;&nbsp; <%=_assessment.PrimaryKey.ForeignElem.title%></a> 
<%
								}
							Response.Write('(');
									
							if (curCompetenceElement.scales.ChildByKeyExists(_level.scale_id))
								Response.Write(curCompetenceElement.scales.GetChildByKey(_level.scale_id).name);
							else
								Response.Write(_level.scale_id);
				
							Response.Write(')<br/>');
						}
					}
				}
%>
			</TD>
			<TD class="<%=_class%>">
<%
				for(_level in curCompetenceElement.levels)
				{
						for(_education_method in _level.education_methods)
						{
							if (_education_method.PrimaryKey.OptForeignElem != undefined)
							{
								if (_flag_info)
								{
%>
						&raquo;&nbsp; <%=_education_method.PrimaryKey.ForeignElem.name%>
<%
								}
								else
								{
%>
						<a href="view_doc.html?mode=education_method&object_id=<%=_education_method.PrimaryKey%>&doc_id=<%=curDocID%>">&raquo;&nbsp; <%=_education_method.PrimaryKey.ForeignElem.name%></a> <br/>
<%
								}
							}
						}
				}
%>
			</TD>			
		</TR>
<%
		}


		if (ArrayOptFirstElem(curProfile.education_methods) != undefined || ArrayOptFirstElem(curProfile.assessments) != undefined)
		{
%>
			<TR VALIGN="MIDDLE">
				<TD class="tableHeaderNoText" colspan="5">
					<table width="100%" border="0">
					<tr>
						<th width="50%"><%=tools.get_web_str("c_tests")%></th>
						<th width="50%"><%=tools.get_web_str("c_courses")%></th>
					</tr>
					<tr align="center">
						<TD>
							<table cellpadding="0" cellspacing="0" border="0"><tr><td align="left">
							<%
								for(_assessment in curProfile.assessments)
								{
									if (_assessment.PrimaryKey.OptForeignElem != undefined)
									{
							%>
									<li/><a href="view_doc.html?mode=assessment&object_id=<%=_assessment.PrimaryKey%>&doc_id=<%=curDocID%>"><%=_assessment.PrimaryKey.ForeignElem.title%></a> <br/>
							<%
									}
								}
							%>
							</td></tr></table>
						</TD>
						<TD>
							<table cellpadding="0" cellspacing="0" border="0"><tr><td align="left">
						<%
							for(_education_method in curProfile.education_methods)
							{
								if (_education_method.PrimaryKey.OptForeignElem != undefined)
								{
						%>
								<li/><a href="view_doc.html?mode=education_method&object_id=<%=_education_method.PrimaryKey%>&doc_id=<%=curDocID%>"><%=_education_method.PrimaryKey.ForeignElem.name%></a> <br/>

						<%
								}
							}
						%>
							</td></tr></table>
						</TD>
					</tr>

					</table>
				</TD>
			</TR>
<%
		}

%>
	<tr>
		<td class="tableHeaderNoText" colspan="5"><img src="pics/1blank.gif" width="1" height="1"/></td>
	</tr>
	<TR VALIGN="MIDDLE" bgcolor="lightgrey">
		<TH><%=tools.get_web_str("vcpb_competence_indicator")%></TH>
		<TH width="20px"><%=tools.get_web_str("vcpb_plan")%></TH>
		<TH width="20px"><%=tools.get_web_str("vcpb_weight")%></TH>
		<TH width="25%"><%=tools.get_web_str("c_tests")%></TH>
		<TH width="25%"><%=tools.get_web_str("c_courses")%></TH>
	</TR>
<%
		counter = 0;
		for ( _competence in  curProfile.competences)
		{
			_class = counter++ % 2 ? "tableRowEven" : "tableRowOdd";
			_element = _competence;
			curCompetenceElement = OpenDoc(UrlFromDocID(_competence.PrimaryKey)).TopElem;

			print_profile_data();

			for ( _indicator in  _competence.indicators)
			{
				_class = counter++ % 2 ? "tableRowEven" : "tableRowOdd";
				_element = _indicator;
				curCompetenceElement = OpenDoc(UrlFromDocID(_indicator.PrimaryKey)).TopElem;
				
				print_profile_data();
			}
		}
	}
	else
	{
		Response.Write('<center><font color="maroon"><b>' + tools.get_web_str("vcpb_message_no_profile") + '</b></font></center>');
	}
%>
	<tr>
		<td class="tableFooter" colspan="5"><img src="pics/1blank.gif" width="1" height="1" /></td>
	</tr>
</table>
<br/>