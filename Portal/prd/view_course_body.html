<%Server.Execute( "view_desc.html" )%>	

<%
   intExpCount = ArrayCount(curObject.persons);
   if (intExpCount > 0)
   {
%>
   <br />
   <table width="100%" cellspacing="0" cellpadding="3">
	 <tr>
	    <td>
	       <div class="headerText" style="position:relative; margin-top:10px;margin-bottom:5px;margin-left:5px;"><%=tools.get_web_str('vcorb_experts')%></div>
		   <table width="100%"  border="0" cellspacing="0" cellpadding="3"> 
			<!--<tr> 
			   <td width="50%" class="tableHeaderNoText" colspan="6"><img src="pics/1blank.gif" width="1" height="1" /></td> 
			</tr>--> 
			  <tr>
			     <td class="tableHeaderWithText"><%=tools.get_web_str('c_fio')%></td>
			     <td class="tableHeaderWithText"><%=tools.get_web_str('c_position')%></td>
			     <td class="tableHeaderWithText"><%=tools.get_web_str('c_subd')%></td>
			     <td class="tableHeaderWithText"><%=tools.get_web_str('c_org')%></td>
			     <td class="tableHeaderWithText"><%=tools.get_web_str('uf_phone')%></td>
			     <td class="tableHeaderWithText"><%=tools.get_web_str('uf_email')%></td>
				 <td class="tableHeaderWithText"><%=tools.get_web_str('vcorb_exp_type')%></td>
			  </tr>
			  <tr> 
			     <td class="tableHeaderNoText" colspan="7"><img src="pics/1blank.gif" width="1" height="1" /></td> 
			  </tr> 
<%  
         counter=0;
         for (catPerson in curObject.persons)
         {
	       strClass = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
		   tePerson = OpenDoc(UrlFromDocID(catPerson.person_id)).TopElem;
%>			
			  <tr>
			     <td class="<%=strClass%>" align="left"><%=catPerson.person_fullname%></td>
			     <td class="<%=strClass%>" align="left"><%=catPerson.person_position_name%></td>
			     <td class="<%=strClass%>" align="left"><%=catPerson.person_subdivision_name%></td>
			     <td class="<%=strClass%>" align="left"><%=catPerson.person_org_name%></td>
			     <td class="<%=strClass%>" align="center"><%=tePerson.phone%></td>
			     <td class="<%=strClass%>" align="center"><%=tePerson.email%></td>
				 <td class="<%=strClass%>" align="center"><%=curLngCommon.course_expert_types.GetChildByKey(catPerson.type).name%></td>
			  </tr>
<%
         }     
%>		  	  
              <tr> 
			     <td width="50%" class="tableHeaderNoText" colspan="7"><img src="pics/1blank.gif" width="1" height="1" /></td> 
			  </tr>
		   </table>
	  </td>
	</tr>
   </table>
   <br />	
<%
    }
%>	
   
<table width="100%" cellspacing="0" cellpadding="3">
	<tr>
		<td>

 
		<div class="headerText" style="position:relative; margin-top:10px;margin-bottom:5px;margin-left:5px;"><%=tools.get_web_str('vcorb_title')%></div> 
		<table width="100%"  border="0" cellspacing="0" cellpadding="3"> 
			<tr> 
				<td width="50%" class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td> 
			</tr> 


<%
	counter = 0;
	_indent = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
	
	function put_doc_xml( _code, _indent_str )
	{
		var _child_part_array = ArraySelect( curObject.parts, 'parent_part_code == _code' );
		var _len = ArrayCount( _child_part_array );
		var b = 0;
		
		for ( b = 0; b < _len; b++ )
		{
			_part_course = _child_part_array[b];			
			_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
			
%>
			<tr valign="top">
				<td class="<%=_class%>">
 
				<table width="100%"  border="0" cellspacing="0" cellpadding="0">
					<tr valign="top">
						<td nowrap="nowrap"><%=_indent_str%></td>
						<td nowrap="nowrap">        
<%			
			switch ( _part_course.type )
			{
				case 'lesson':
%>
							<img src="pics/lesson.gif" width="12" height="10" border="0"/>             
<%
				break;
				case 'test':
%>
							<img src="pics/test.gif" width="13" height="11" border="0"/>
<%	
				break;
				case 'inline':
%>
							<img src="pics/text.gif" width="13" height="11" border="0"/>
<%	
				break;
				default:
%>
							 <img src="pics/folder.gif" width="13" height="11" border="0"/>
<%
			}
%>
						</td>
						<td width="100%"><%=tools_web.get_cur_lng_name( _part_course.name )%></td>
 					</tr>
				</table>
				
				</td>
			</tr>	

<%		
			put_doc_xml( _part_course.code, _indent_str + _indent );
			
		}
	}
	
	
	put_doc_xml( '', '' );
%>

			<tr> 
				<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td> 
			</tr> 
		</table> 
					
		</td>
	</tr>
	<tr>
		<td>

		<table width="100%" border="0" cellspacing="0" cellpadding="3" class="activator">
				
<%
	_learning_array = XQuery( 'for $active_learning in active_learnings where $active_learning/person_id = ' + curUserID + ' and $active_learning/course_id = ' + curObjectID + ' return $active_learning' );
	firstElem = ArrayOptFirstElem( _learning_array );
	if ( firstElem != undefined )
	{	
%>
			<tr>	
				<td bgcolor="#FFFFFF" align=center>
					<b><i><%=tools.get_web_str('vcorb_message1')%></i></b><br><br>
					<input type="button" value="<%=tools.get_web_str('vcorb_b_refr')%>" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" onclick="document.location.href='view_doc.html?mode=learning_proc&doc_id=<%=curDocID%>&object_id=<%=firstElem.id%>&course_id=<%=firstElem.course_id%>&start=1';return false;">
				</td>
			</tr>
<%
	}
	else if ( ! curObject.yourself_start && ArrayOptFirstElem( XQuery( "for $request in requests where $request/status_id = 'active' and $request/person_id = " + curUserID + " and $request/object_id = " + curObjectID + " return $request" ) ) != undefined )
	{
%>
			<tr>	
				<td bgcolor="#FFFFFF" align=center>
					<b><i><%=tools.get_web_str('vcorb_message2')%></i></b>
				</td>
			</tr>
<%
	}
	else
	{
%>
	<form name="course_activate_form" action="course_activate.html" method=POST>
	<input type="hidden" name="sid" value="<%=tools.get_sum_sid( curObjectID )%>" id="sid">
<%
		if ( ! curObject.yourself_start )
		{
%>
			<tr>	
				<td align="center" colspan="2"><i><%=tools.get_web_str('vcorb_message3')%></i><br></td>
			</tr>
<%
		}
%>
			<tr>	
				<td align="right" width="50%"><%=tools.get_web_str('vcorb_message4')%></td>
				<td width="50%">
					<input type=hidden name=doc_id value="<%=curDocID%>">			
					<input type=hidden name=course_id value="<%=curObjectID%>">
<%
		if ( curObject.yourself_start )
		{
%>				
					<input type="submit" value="<%=tools.get_web_str('vcorb_b_start')%>" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">		
<%
		}
		else
		{
					_request_type_array = XQuery( "for $elem in request_types where $elem/object_type = 'course' return $elem" )
					for ( _request_type in _request_type_array )
					{
%>	
					<input type="button" value="<%=tools_web.get_cur_lng_name( _request_type.name )%>" onclick="document.location.href='view_doc.html?mode=request_create&doc_id=<%=curDocID%>&type=course&request_object_id=<%=curObjectID%>&request_type_id=<%=_request_type.PrimaryKey%>';return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">	
<%
					}
		}
%>		
				</td>
			</tr>

	</form>
<%
	}
%>
		</table> 

		</td>
	</tr>



<%
	try
	{
		_forum_id = ArrayFirstElem( XQuery( 'for $forum in forums where $forum/course_id = ' + curObjectID + ' return $forum' ) ).id;
%>
	<tr>
		<td>

		<table width="100%" border="0" cellspacing="0" cellpadding="5">
			<tr>
				<td class="tableHeaderWithText" align="center"><a href="view_doc.html?mode=forums&object_id=<%=_forum_id%>&doc_id=<%=curDocID%>"><%=tools.get_web_str('vcorb_go_forum')%></a></td>
			</tr>
		</table>

		</td>
	</tr>
<br/>
<%
	}
	catch( e )
	{
	}
%>

	<%Server.Execute( "view_files.html" )%>
	<br/>
	
	
	<%Server.Execute( "view_catalogs.html" )%>
	<br/>



<%
	if ( ArrayOptFindByKey( curObject.persons, curUserID, 'person_id' ) != undefined )
	{
%>

	<form action="view_doc.html?mode=course_info&doc_id=<%=curDocID%>&object_id=<%=curObjectID%>" name="set_person_form" method="POST">

	<tr>
		<td>	

<br/>


		<div class="headerText" style="position:relative; margin-top:10px;margin-bottom:5px;margin-left:5px;"><%=tools.get_web_str('vlpb_title')%></div> 
		<table width="100%" cellspacing="0" cellpadding="3" class="tableBorder">	
			<tr>		
				<td width="170" align="RIGHT"><%=tools.get_web_str('c_filter')%>:</td>
				<td align="LEFT"><select name="filter_id" id="filter_id" onchange="document.set_person_form.submit();">
<%
	for ( _ff in curLngCommon.web_filter_types )
	{
%>		
						<option value="<%=_ff.id%>"><%=_ff.name%></option>
<%
	}
%>		
        			 </select>
<%
	try
	{
		_filter = Request.Form.filter_id;
%>
<script language="JavaScript">
selcur=document.getElementById('filter_id');
selcur.selectedIndex==-1;
for (i=0;i<selcur.options.length;i++)
    if (selcur.options[i].value=="<%=Request.Form.filter_id%>")
    {
        selcur.selectedIndex=i;
        break;
    }
</script>
<%
	}
	catch ( e )
	{ 
		_filter = 'active';
	}
%>
		 		</td>
		 	</tr>
			<tr>
				<td width="170" align="RIGHT"><%=tools.get_web_str('c_sort')%>:</td>
				<td align="LEFT">
					<select name="sort_type" name="sort_type_id" onchange="document.set_person_form.submit();">
						<option SELECTED value=start_date><%=tools.get_web_str('c_act_date')%></option>
						<option value=last_date><%=tools.get_web_str('c_finish_date')%></option>
						<option value=course_name><%=tools.get_web_str('c_course')%></option>
						<option value=state_id><%=tools.get_web_str('c_state')%></option>
						<option value=score><%=tools.get_web_str('c_score')%></option>					
					</select>
<%
	try
	{
		_sort_type = Request.Form.sort_type;
%>
<script language="JavaScript">
selcur=document.getElementById('sort_type_id');
selcur.selectedIndex==-1;
for (i=0;i<selcur.options.length;i++)
    if (selcur.options[i].value=="<%=Request.Form.sort_type%>")
    {
        selcur.selectedIndex=i;
        break;
    }
</script>
<%
	}
	catch ( e )
	{
		_sort_type = 'start_date';
	}
%>

				</td>
			</tr>
		</table>
			
		</td>
	</tr>
	<tr>
		<td> 
<%
		_order_str = '';
		_active_flag = _filter != 'finish';
		
		switch ( _sort_type )
		{
			case 'start_date':
				_order_str = ' order by $learning/start_usage_date descending';
				break;
			case 'last_date':
				_order_str = ' order by $learning/last_usage_date descending';
				break;
			case 'course_name':
				_order_str = ' order by foreign-elem( $learning/course_id )/name';
				break;
			case 'course_code':
				_order_str = ' order by foreign-elem( $learning/course_id )/code';
				break;
			case 'state_id':
				_order_str = ' order by $learning/state_id';
				break;
			case 'score':
				_order_str = ' order by $learning/score';
				break;
		}
		
		switch ( _filter )
		{
			case 'all':
				learningArray = XQuery( "for $learning in ( active_learnings, learnings ) where $learning/course_id = " + curObjectID + _order_str + " return $learning" );
				break
			case 'finish':
				learningArray = XQuery( "for $learning in learnings where $learning/course_id = " + curObjectID + _order_str + " return $learning" );
				break;
			default:
				learningArray = XQuery( "for $learning in active_learnings where $learning/course_id = " + curObjectID + _order_str + " return $learning" );
		}

		disp_person = true;
		Server.Execute( "view_learning_list_body.html" );
%>
		</td>
	</tr>
	<tr>
		<td align="CENTER">
		
		<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
			<tr>
				<td align="CENTER" class="activator">
					<input type="SUBMIT" value="<%=tools.get_web_str('c_refresh')%>" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
				</td>
			</tr>
		</table>

		</td>
	</tr>	

</form>
<%
	}
%>	

</table>


<%
	curKnowlegedDoc = curObject;
	Server.Execute( "view_knowledge_parts_body.html" );
%>