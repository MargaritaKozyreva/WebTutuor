<%
curCourseID = Int( Request.Query.course_id );
curCourse = OpenDoc( UrlFromDocID( curCourseID ) ).TopElem;

curPartCode = Request.Query.HasProperty( 'part_code' ) ? Request.Query.part_code : curObject.last_usage_part_code;
if ( curPartCode == '' )
	curPartCode = ArrayFirstElem( ArraySelect( curCourse.parts, "url!=''&&completed_parent_parts.ChildNum==0" ) ).PrimaryKey.Value;

if ( ! curObject.parts.ChildByKeyExists( curPartCode ) )
	curPartCode =  ArrayFirstElem( curObject.parts ).PrimaryKey.Value;

var viewPartArray = Array();
var viewPartArrayType = Array();
var viewPartArrayCounter = 0;
%>
<script language="JAVASCRIPT">
var arrParts = new Array();
var curPart = new Object();

function getCurPart( part_code )
{
	for ( var i=0; i<arrParts.length; i++ )
		if ( arrParts[ i ].code == part_code )
		{
			curPart =  arrParts[ i ];
			break;
		}
}

function course_launch( _width, _height, _index )
{
	if( screen.availWidth < _width || screen.availHeight < _height )
		alert("<%=tools.get_web_str('vcplb_message1')%>");

	if ( curPart.code != _index )
	{
		getCurPart( _index );
		paint_img();
	}

	_frame = document.getElementById("courseWindow");
	_frame.src = 'course_launch.html?course_id=<%=curCourseID%>&object_id=<%=curObjectID%>&sid=<%=tools.get_sum_sid( curCourseID )%>' + ( _index != "" ? "&part_code=" + escape( _index ) : "" ) + "&rnd=" + Math.random();
	return false;
}

function course_launch_move( _delta )
{
	course_launch( 0, 0, arrParts[ curPart.i + _delta ].code );
}

function paint_img()
{
	var partLen = arrParts.length;
	var _cur_part_index = curPart.i;

	$(".part_pimpa").hide();
	$("#pimpa"+curPart.code).show();

	if ( _cur_part_index < ( arrParts.length - 1 ) )
		$("#arrow_right").show();
	else
		$("#arrow_right").hide();

	if ( _cur_part_index > 0 )
		$("#arrow_left").show();
	else
		$("#arrow_left").hide();

	if ( curPart.type == "test" )
		$("#div_test_button").show();
	else
		$("#div_test_button").hide();
}

function testFinish()
{
	document.location.href = "test_finish.html?object_id=<%=curObjectID%>&assessment_id=" + curPart.test_id + "&sid=<%=tools.get_sum_sid(curObjectID)%>&code=" + escape( curPart.code ) + "&attempt=";
	return false;
}
</script>
<script language="JavaScript" type="text/javascript" src="scorm_api.js"></script>

<table width="100%" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td width="200">

		<table width="100%"  border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="32"><div id="arrow_left" style="display:inline"><a href="#" onclick="course_launch_move(-1);" title="<%=tools.get_web_str('vcplb_prev')%>"><img src="pics/arrow_left.gif" border="0"/></a></div></td>
				<td align="center"><a href="view_doc.html?mode=learning_proc&doc_id=<%=curDocID%>&course_id=<%=curCourseID%>&object_id=<%=curObjectID%>" title="<%=tools.get_web_str('vcplb_home')%>"><img src="pics/icon_home_2.gif" border="0"/></a></td>
				<td width="32"><div id="arrow_right" style="display:inline"><a href="#" onclick="course_launch_move(1);" title="<%=tools.get_web_str('vcplb_next')%>"><img src="pics/arrow_right.gif" border="0"/></a></div></td>
			</tr>
		</table>

		<div id="PartList" style="width:200px; height:<%=curCourse.Height()%>px; overflow-y:auto;">
		<table width="100%"  border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1"/></td>
			</tr>
<%
var counter = 0;
var _indent = '&nbsp;&nbsp;&nbsp;&nbsp;';

function put_doc_xml( _code, _indent_str )
{
	var _child_part_array = ArraySelectByKey( curObject.parts, _code, 'parent_part_code' );
	var b = 0;

	for ( _part_learning in _child_part_array )
	{
		_part_course = curCourse.parts.GetOptChildByKey( _part_learning.PrimaryKey );
		if ( _part_course != undefined )
		{
			if ( _part_course.view.conditions.ChildNum != 0 )
				try
				{
					if ( eval( tools.create_filter_javascript( _part_course.view.conditions, null, 'curObject.' ) ) == false )
						throw 'cont';
				}
				catch ( e )
				{
					continue;
				}

			if ( _part_course.launch.conditions.ChildNum != 0 )
				try
				{
					if ( eval( tools.create_filter_javascript( _part_course.launch.conditions, null, 'curObject.' ) ) == false )
						throw 'cont';
				}
				catch ( e )
				{
					continue;
				}
		}

		_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
		_index = _part_learning.code.Value;
%>
			<tr valign="top">
				<td class="<%=_class%>">

				<table width="100%"  border="0" cellspacing="0" cellpadding="0">
					<tr valign="top">
<%
		if ( _indent_str != '' )
		{
%>
						<td class="<%=_class%>" nowrap="nowrap"><%=_indent_str%></td>
<%
		}
%>
						<td class="<%=_class%>" nowrap="nowrap">
<%
		switch ( _part_learning.type )
		{
			case 'lesson':
%>
							<img src="pics/lesson.gif" width="12" height="10" border="0"/>
<%
			break;
			case 'test':
%>
							<img src="pics/test.gif" width="13" height="11" border="0"/>
<%
			break;
			case 'inline':
%>
							<img src="pics/text.gif" width="13" height="11" border="0"/>
<%
			break;
			default:
%>
			 				<img src="pics/folder.gif" width="13" height="11" border="0"/>
<%
		}
%>
						</td>
						<td class="<%=_class%>" width="100%">
							<a href="#" onclick="course_launch(<%=curCourse.Width( _index )%>,<%=curCourse.Height( _index )%>,<%=CodeLiteral( _index )%>);"><%=tools_web.get_cur_lng_name( _part_learning.name )%></a>
						</td>
						<td valign="middle" width="20px"><img id="pimpa<%=_index%>" src="pics/more.gif" width="14" height="14" border="0" align="absmiddle" style="display:inline" class="part_pimpa"/></td>
					</tr>
				</table>

				</td>
			</tr>

<%
		viewPartArray[ viewPartArrayCounter ] = _index;
		viewPartArrayType[ viewPartArrayCounter ] = _part_learning.type.Value;
		viewPartArrayCounter++;

		put_doc_xml( _index, _indent_str + _indent );
	}
}

put_doc_xml( '', '' );
%>
			<tr>
				<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			</tr>
		</table>
		</div>


		</td>
		<td>
			<iframe id="courseWindow" height="<%=curCourse.Height()%>" width="100%" src="course_launch.html?course_id=<%=curCourseID%>&object_id=<%=curObjectID%>&sid=<%=tools.get_sum_sid( curCourseID )%>&part_code=<%=curPartCode%>" frameborder="0" >
			</iframe>
			<div id="div_test_button" style="display:none">
				<center><input type="button" value="<%=tools.get_web_str('vtlpb_end_attempt')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onClick="testFinish()"></center>
			</div>
		</td>
	</tr>
</table>
<script language="javascript">
<%
iCounter = 0;
for ( fldPartElem in curObject.parts )
{
%>
oPart = new Object;
oPart.i = <%=iCounter%>;
oPart.code = <%=CodeLiteral( fldPartElem.code )%>;
oPart.type = "<%=fldPartElem.type%>";
oPart.test_id = "<%=fldPartElem.assessment_id%>";
arrParts[<%=iCounter%>] = oPart;
<%
	iCounter++;
}
%>

getCurPart(<%=CodeLiteral( curPartCode )%>);
paint_img();
</script>