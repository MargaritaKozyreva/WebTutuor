<%
		learningArray = XQuery("active_learnings, learnings");
		allCoursesArray = XQuery("courses");
		
		usedCourseIDArray = Array();
		count = 0;
		for ( _course in allCoursesArray )
		{
			flag_used = true;
			courseDoc = OpenDoc(UrlFromDocID( _course.PrimaryKey )).TopElem;
			try
			{
				if ( courseDoc.custom_elems.GetChildByKey("f_q6ei").value == "true" )
					flag_used = false;
			}
			catch(err)
			{
			}
			if ( flag_used )
			{
				usedCourseIDArray[count] = _course.PrimaryKey;
				count++;
			}
		}
		coursesArray = QueryCatalogByKeys( "courses", "id", usedCourseIDArray );
		
		for( _course in coursesArray )
			_course.max_score = ArrayCount( ArraySelect( learningArray, "course_id == _course.id" ) );

		max_elems = 5;
		if ( ArrayCount( coursesArray ) < max_elems )
			max_elems = ArrayCount( coursesArray );
		
		courses_resultArray = ArraySort( coursesArray, "max_score", "-" );
%>
	
		<table width="100%"  border="0" cellspacing="0" cellpadding="3">
			<tr>
				<td class="tableHeaderWithText"><%=tools.get_web_str('vcr_popular_courses')%></td>
				<td class="tableHeaderWithText" width="50">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2" class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1"/></td>
			</tr>
<%
		counter = 0;
		_elem_counter = 1;
		for ( _course in courses_resultArray )
		{
			_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
			if ( _elem_counter > max_elems )
				break;
%>			
			<tr>
				<td class="<%=_class%>"><a href="view_doc.html?mode=course_info&doc_id=<%=curDocID%>&object_id=<%=_course.id%>"><%=_course.name%></a></td>
				<td align="center" class="<%=_class%>"><%=_course.max_score%></td>
			</tr>
<%
			_elem_counter++;
		}
%>			
			<tr>
				<td colspan="2" class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			</tr>
		</table>