<%
_object_exist = curObjectID != null && curObject.document_persons.ChildByKeyExists( curUserID );
if ( _object_exist || ! curWebCommon.disp_custom_left_panel )
{
%>
<table width="100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
<%
	if ( ! curWebCommon.disp_custom_left_panel && ! selectFirstDocumentFlag )
	{
%>
		<td width="200">
			<%Server.Execute( "view_documents_panel.html" )%>
		</td>
<%
	}

	if ( _object_exist )
	{
		curDocPerson = curObject.document_persons.GetChildByKey( curUserID );
%>
		<td>
		
		<table width="100%" cellspacing="5" cellpadding="0">
<%	
		if ( curDocPerson.can_create )
		{
%>
			<tr>
				<td>
				
				<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
					<tr>
						<td align="CENTER" class="activator">
							<input type="button" value="<%=tools.get_web_str('vdb_create_doc')%>" class="inputButton" onclick="doSubmit('create','<%=curObjectID%>')" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
						</td>
					</tr>
				</table>
				
				</td>
			</tr>
<%
		}
%>
<script src="scripts\tree\ua000000.js"></script>
<script src="scripts\tree\ftiens40.js"></script>
<script language="javascript">

function doSubmit( _action, _doc_id )
{
	switch ( _action )
	{
		case 'view':
		case 'save':
			document.location.href = "view_doc.html?mode=document&action=" + _action + "&object_id=" + _doc_id + "&doc_id=<%=curDocID%>&sid=<%=tools.get_sum_sid( curDocID )%>";
			break;
			
		case 'create':
			document.location.href = "view_doc.html?mode=document_create&action=create&parent_document_id=" + _doc_id + "&doc_id=<%=curDocID%>&sid=<%=tools.get_sum_sid( curDocID )%>";
			break;
			
		case 'delete':
			if ( ! window.confirm( <%=CodeLiteral( tools.get_web_str('vdb_mess_del_doc') )%> ) )
				break;
			
			_flag_hier_up = '0';
			if ( window.confirm( <%=CodeLiteral( tools.get_web_str('vdb_mess_hier') )%> ) )
				_flag_hier_up = '1';
				
			document.location.href = "document_change.html?action=delete&object_id=" + _doc_id + "&hier_up=" + _flag_hier_up + "&doc_id=<%=curDocID%>&sid=<%=tools.get_sum_sid( curDocID )%>";
			break;
		
		default:
			document.location.href = "document_change.html?action=" + _action + "&object_id=" + _doc_id + "&doc_id=<%=curDocID%>&sid=<%=tools.get_sum_sid( curDocID )%>";
			break;
	}
	
	return false;
}

HIGHLIGHT = 0;
USETEXTLINKS = 1;
STARTALLOPEN = 1;
USEFRAMES = 0;
USEICONS = 0;
WRAPTEXT = 1;
PRESERVESTATE = 1;
ICONPATH = "scripts\\tree\\";
</script>
<%
		docsArray = Array();
		if ( curObject.Name == 'document' )
			docsArray[0] = ArrayFind( parentAllDocumentArray, 'document_id==curObjectID' );
		else
			docsArray = ArraySelect( parentAllDocumentArray, 'parent_object_id==curObjectID&&document_id.HasValue' );
		
		for ( _parent_document in docsArray )
		{
%>
<script language="javascript">
foldersTree = gFld("<img src=pics/folder.gif border=0>&nbsp;<%=HtmlEncode( _parent_document.name )%><%=( ( curDocPerson.can_create ? '&nbsp;<a href=\\"javascript: doSubmit(\'create\',\'' + _parent_document.document_id + '\');\\" title=\\"' + tools.get_web_str('c_create') + '\\"><img src=pics/Add_1.gif border=0></a>' : '' ) + ( curDocPerson.can_delete ? '&nbsp;<a href=\\"javascript: doSubmit(\'delete\',\'' + _parent_document.document_id + '\');\\" title=\\"' + tools.get_web_str('c_delete') + '\\"><img src=pics/Delete_3.gif border=0></a>' : '' ) )%>","view_doc.html?mode=document&action=<%=( curDocPerson.can_edit ? 'save' : 'view' )%>&doc_id=<%=curDocID%>&object_id=<%=_parent_document.document_id%>");
<%
			if ( _parent_document.document_id.HasValue )
			{
				docArray = XQuery( "CatalogHierSubset('documents'," + _parent_document.document_id + ")" );
				for ( _doc in docArray )
				{
%>
folder<%=_doc.PrimaryKey%> = insFld(folder<%=( _parent_document.document_id == _doc.parent_document_id ? 'sTree' : _doc.parent_document_id )%>,gFld("<img src=pics/doc.gif border=0>&nbsp;<%=HtmlEncode( _doc.name )%><%=( ( curDocPerson.can_create ? '&nbsp;<a href=\\"javascript: doSubmit(\'create\',\'' + _doc.PrimaryKey + '\');\\" title=\\"' + tools.get_web_str('c_create') + '\\"><img src=pics/Add_1.gif border=0></a>' : '' ) + ( curDocPerson.can_delete ? '&nbsp;<a href=\\"javascript: doSubmit(\'delete\',\'' + _doc.PrimaryKey + '\');\\" title=\\"' + tools.get_web_str('c_delete') + '\\"><img src=pics/Delete_3.gif border=0></a>' : '' ) )%>","view_doc.html?mode=document&action=<%=( curDocPerson.can_edit ? 'save' : 'view' )%>&doc_id=<%=curDocID%>&object_id=<%=_doc.PrimaryKey%>") );
<%
				}
			}
%>
</script>
<%
		}
%>
			<tr valign="top">
				<td>
					<span class="TreeviewSpanArea" style="overflow:auto">
						<script>initializeDocument();</script>
					</span>
				</td>
		
			</tr>
		</table>
		
		</td>
<%
	}
%>
	</tr>
</table>
<%
}
%>