<%
	try
	{
		curEducationMethodID = Int( Request.QueryString.object_id );
		curEducationMethod = OpenDoc( UrlFromDocID( curEducationMethodID ) ).TopElem;
	}
	catch(_fuck_)
	{
		curEducationMethod = null;
		curEducationMethodID = null;
	}

	try
	{
		Session.RETURN_MSG;
	}
	catch(_x_)
	{
		Session.RETURN_MSG = "";
	}

	if (Session.RETURN_MSG != "")
	{
		Response.Write("<br/><center><font size='+1' align='center'><i><b>" + HtmlEncode(Session.RETURN_MSG) + "</b></i></font></center>");
		Session.RETURN_MSG = "";
	}
%>

<script language="javascript">
<!--
//------------------------------------------------------------------------------------------
function buttonMouseOver()
{
	window.event.srcElement.className='inputButtonOver';
}
function buttonMouseOut()
{
	window.event.srcElement.className='inputButton';
}
function checkkey(srcobj, keycode, flag_flat)
{			
	if ((keycode<48 || keycode>57)& keycode!=46) return false;
	if (keycode==46) 
	{
		if( (!flag_flat) || srcobj.value.indexOf('.') >= 0) return false;
	}
	return true;
}
//------------------------------------------------------------------------------------------
function what2submit()
{
	if ($("form#education_method_submitter input#name").val() == "")
	{
		window.alert(<%=CodeLiteral( tools_web.get_web_str('vaeb_mess_empty_title') )%>);
		return false;
	}
	
	return true;
}

-->
</script>

<table width="100%"  border="0" cellspacing="0" cellpadding="3" name="top_report_table">
<tr>
<td>

<form name="education_method_submitter" id="education_method_submitter" action="content_panel_process.html" method="post">
<input type="hidden" name="education_method_id" value="<%=(curEducationMethodID != null ? curEducationMethodID : 0)%>"/>
<input type="hidden" name="mode" value="education_method"/>
<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
<input type="hidden" name="href" value="<%=Request.Url%>"/>

<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder" border="0">
	<tr>
		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools.get_web_str('c_name')%>:</td>
		<td style="font-weight:bolder; font-size:larger"><input type="text" id="name" name="name" value="<%=(curEducationMethod != null ? HtmlEncode(curEducationMethod.name) : "")%>" class="inputEdit" style="width:100%"/></td>
	</tr>
	<tr>
		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools_web.get_web_str('vemeb_org_type')%>:</td>
		<td style="font-weight:bolder; font-size:larger">
			<input type="radio" id="type_org" name="type" value="org" <%=(curEducationMethod == null || curEducationMethod.type == "org"? "checked" : "")%> onpropertychange="$('#type_object_id').val(''); $('#type_object_name').val('');"/><%=tools.get_web_str('c_edu_org')%> &nbsp;&nbsp;<input type="radio" id="type_course" name="type" value="course" <%=(curEducationMethod != null && curEducationMethod.type == "course"? "checked" : "")%> onpropertychange="$('#type_object_id').val(''); $('#type_object_name').val('');"/><%=tools_web.get_web_str('c_course')%><br/>
			<table width="100%">
				<tr valign="middle">
					<td  width="100%">
						<%
							_catCurrentTypeObject = null;
							if (curEducationMethod != null)
							if (curEducationMethod.type == "org" && curEducationMethod.education_org_id.HasValue)
								_catCurrentTypeObject = curEducationMethod.education_org_id.OptForeignElem;
							else if (curEducationMethod.type == "course" && curEducationMethod.course_id.HasValue)
								_catCurrentTypeObject = curEducationMethod.course_id.OptForeignElem;
						%>
						<input type="text" id="type_object_name" name="type_object_name" value="<%=(_catCurrentTypeObject != null ? HtmlEncode(_catCurrentTypeObject.name) : "")%>" class="inputEdit" style="width:100%" readonly/>
						<input type="hidden" name="type_object_id" id="type_object_id" value="<%=(_catCurrentTypeObject != null ? _catCurrentTypeObject.id : "")%>"/>
					</td>
					<td>
						<input type="button" value="..." class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="
								var pars=new Object(); pars.check_access = true;
								var strAttr='status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1';
								xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=' +($('#type_course').get(0).checked ? 'course':'education_org')+ '&typein=0&multi_select=0&rand='+Math.random(), pars, strAttr);
								if (!pars.handle ) return false;
								
								document.getElementById('type_object_id').value = pars.element_id;
								document.getElementById('type_object_name').value = pars.element_name;
							" style="width: 25px"/>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools_web.get_web_str('c_day_duration')%>:</td>
		<td style="font-weight:bolder; font-size:larger">
			<table cellpadding="0" cellspacing="5">
                <tr>
                    <TD><%=tools_web.get_web_str('c_day_duration')%>:</TD>
                    <TD STYLE="font-weight:normal">
						<input type="text" name="duration_days" id="duration_days" style="width: 25px" class="inputEdit" value="<%=(curEducationMethod != null ? curEducationMethod.duration_days : "")%>"  onkeypress="return checkkey(this,window.event.keyCode, false);" onblur="return checkkey(this,window.event.keyCode, false);"/>
                    </TD>
                    <TD><%=tools.get_web_str("c_hour_duration")%>:</TD>
                    <TD STYLE="font-weight:normal">
						<input type="text" name="duration" id="duration" style="width: 25px" class="inputEdit" value="<%=(curEducationMethod != null ? curEducationMethod.duration : "")%>"  onkeypress="return checkkey(this,window.event.keyCode, false);" onblur="return checkkey(this,window.event.keyCode, false);"/>
                    </TD>
               </tr>
            </table>
		</td>
	</tr>
	<tr>
		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools_web.get_web_str('c_person_num')%>:</td>
		<td style="font-weight:bolder; font-size:larger"><input type="text" id="person_num" name="person_num" value="<%=(curEducationMethod != null ? HtmlEncode(curEducationMethod.person_num) : "")%>" class="inputEdit" style="width:50px" onkeypress="return checkkey(this,window.event.keyCode, false);" onblur="return checkkey(this,window.event.keyCode, false);"/></td>
	</tr>
	<tr>
		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools_web.get_web_str('c_cost')%>:</td>
		<td style="font-weight:bolder; font-size:larger">
			<table cellpadding="0" cellspacing="0">
                <tr>
                    <TD><input type="text" id="cost" name="cost" value="<%=(curEducationMethod != null ? curEducationMethod.cost : "")%>" class="inputEdit" style="width:50px" onkeypress="return checkkey(this,window.event.keyCode, false);" onblur="return checkkey(this,window.event.keyCode, false);"/></TD>
					<TD>&nbsp;</TD>
					<TD>
						<select id="currency" name="currency">
<%
	for (elemCurrType in lists.currency_types)
	{
%>
							<option value="<%=elemCurrType.id%>" <%=(curEducationMethod != null && curEducationMethod.currency == elemCurrType.id ? "selected" : "")%>><%=elemCurrType.name%></option>
<%
	}
%>
						</select>
					</TD>
					<TD>
						<select id="cost_type" name="cost_type">
<%
	for (elemCostType in common.cost_types)
	{
%>
							<option value="<%=elemCostType.id%>" <%=(curEducationMethod != null && curEducationMethod.cost_type == elemCostType.id ? "selected" : "")%>><%=elemCostType.name%></option>
<%
	}
%>
						</select>
					</TD>
				</tr>
			</table>
		</td>
	</tr>
</table>

<table width="100%"  border="0" cellspacing="0" cellpadding="3">
	<tr id="line_head">
		<td class="tableHeaderWithText"><%=tools_web.get_web_str('c_lectors')%></td>
		<!--
		<td class="tableHeaderWithText" width="200px"><%=tools.get_web_str('c_type')%></td>
		-->
	</tr>
	<tr>
		<td class="tableHeaderNoText" colspan="1"><img src="pics/1blank.gif" width="1" height="1"/></td>
	</tr>	
	<tbody id="lectorizer"></tbody>
	<tr>
		<td class="tableFooter" colspan="1"><img src="pics/1blank.gif" width="1" height="1"/></td>
	</tr>
</table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
<TR>
	<TD ALIGN="CENTER" class="activator">
		<input type="hidden" name="lectors_count" id="lectors_count" value="0"/>
		<input type="button" value="<%=tools_web.get_web_str('vemeb_sel_lectors')%>" onClick="select_lectors();" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/>
	</TD>
</TR>
</table>
<script language="javascript">
<!--
	var temp_selected_object_ids = "<%=(curEducationMethod != null ? ArrayMerge(curEducationMethod.lectors, "This.lector_id", ";") : "")%>";
	function select_lectors()
	{
		var pars=new Object(); pars.check_access = true;
		var strAttr='status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1';
		
		if (pars.display_object_ids == '') pars.display_object_ids = '0';
		
		pars.selected_object_ids = temp_selected_object_ids;
		pars.can_be_empty = true;
		xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=lector&typein=0&multi_select=1&rand='+Math.random(), pars, strAttr);
		if (!pars.handle ) return false;
				
		$('tbody#lectorizer').empty();
		$("#lectors_count").val("0");
		var item_count = 0;
		temp_selected_object_ids = "";
		for (var _x = item_count; _x < pars.elemArray.length; _x++)
		{
			add_lector(pars.elemArray[_x], pars.elemNamesArray[_x], "");
			temp_selected_object_ids += pars.elemArray[_x]+";"
		}
	}
	
	function add_lector(_id, _name, sType)
	{
		var item_count = parseInt($("#lectors_count").val());
		var _class = item_count % 2 ? 'tableRowEven' : 'tableRowOdd';
		
		$('tbody#lectorizer').append('<tr><td class="' +_class+ '"><input type="hidden" id="lector_id_'+item_count+'" name="lector_id_'+item_count+'" value="'+_id+'"/>' +_name+ '</td></tr>');
		$("#lectors_count").val(item_count+1);
	}
<%
	if (curEducationMethod != null)
	for (fldLectorElem in curEducationMethod.lectors)
	{
		catLector = fldLectorElem.PrimaryKey.OptForeignElem;
		if (catLector != undefined)
			Response.Write("add_lector(\"" + catLector.PrimaryKey + "\", \"" + HtmlEncode(catLector.person_fullname) +"\", \"\");");
	}
%>
-->
</script>



<br/>
<table style="font-weight:bolder; font-size:larger;" width="100%">
	<tr>
		<td><%=tools.get_web_str('c_comment')%></td>
	</tr><tr>
		<td><textarea id="comment" name="comment" style="width:100%"><%=(curEducationMethod != null ? HtmlEncode(curEducationMethod.comment) : "")%></textarea></td>
	</tr>
</table>
	<br/>
		<center><input type="submit" value="<%=tools.get_web_str('c_save')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="return what2submit();"/></center>
</form>
<%
	_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=content_panel&doc_id="+curDocID+"&tab=education_method";
%>
<center><input type="button" value="<%=tools_web.get_web_str('vaaeb_list_back')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="window.location.href='<%=_href%>'"/></center>
<br/>
<%
	Server.Execute("view_knowledge_parts_base.html");
%>
</td>
</tr>
<tr>
	<td colspan="3" class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
</tr>
</table>