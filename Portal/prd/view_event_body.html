<%

_selectedTab = Request.Query.HasProperty("tab") && Request.Query.tab != '' ? Int( Request.Query.tab ) : 0;

_write = ( curUser.access.access_role == 'admin' || curObject.tutors.ChildByKeyExists( curUserID ) );
_is_col = curObject.collaborators.ChildByKeyExists( curUserID );
_is_beginer = ArrayOptFindByKey( curObject.even_preparations, curUserID, 'person_id' ) != undefined;
_requester = ArrayOptFindByKey( curObject.collaborators, curUserID, 'request_person_id' ) != undefined;

_is_lector = ( ArrayOptFind( XQuery( 'for $elem in lectors where $elem/person_id = ' + curUserID + ' return $elem' ), 'curObject.lectors.ChildByKeyExists( PrimaryKey )' ) != undefined );

_view = ( _is_col || _write || _is_beginer || _is_lector );

if ( ! _view && ! curObject.is_public )
{
	Server.Execute( "view_access_panel.html" );
	Cancel();
}

sAvailableTypes = '';
if ( curWebTemplate != null )
{
	sAvailableTypes = curWebTemplate.wvars.ObtainChildByKey( 'available_types' ).value;

	if ( _write && curObject.finish_date.HasValue )
	{
		sFinishDateEditingPeriod = curWebTemplate.wvars.ObtainChildByKey( 'finish_date_editing_period' ).value;
		if ( sFinishDateEditingPeriod != '' && CurDate > DateOffset( curObject.finish_date, 86400 * Int( sFinishDateEditingPeriod ) ) )
			_write = false
	}
}


if ( _is_col )
{
	curCollaborator = curObject.collaborators.GetChildByKey( curUserID );
	curCollaborator.last_exist_date = Date();
	_temp_doc = OpenDoc( UrlFromDocID( curObjectID ) );
	_temp_doc.TopElem.collaborators.GetChildByKey( curUserID ).last_exist_date = Date();
	_temp_doc.Save();

	educationPlanDoc = null;
	if ( curCollaborator.education_plan_id.HasValue )
	{
		try
		{
			educationPlanDoc = OpenDoc( UrlFromDocID( curCollaborator.education_plan_id ) );
		}
		catch ( sde )
		{
		}
		if ( educationPlanDoc == null || educationPlanDoc.TopElem.getEducationPlanAccess( curObjectID, curUserID ) != true )
		{
%>
			<b><a href="view_doc.html?mode=education_plan&doc_id=<%=curDocID%>&object_id=<%=curCollaborator.education_plan_id%>" ><%=tools.get_web_str('veb_message3')%></a></b>
			<br/>
<%
			//Cancel();
		}
	}
}


_lectors_array = ArrayExtract( curObject.lectors, 'PrimaryKey' );
_lectors_array = QueryCatalogByKeys( 'lectors', 'id', _lectors_array );

try
{
	_mode = Request.QueryString.m;
}
catch ( t )
{
	_mode = '0';
}
%>
<form action="event_change.html" name="event_form" method="POST" <%=_write?'enctype="multipart/form-data"':''%>>
	<input type=hidden name="doc_id" value="<%=curDocID%>"/>
	<input type=hidden name="action" id="action_id" value="save"/>
	<input type=hidden name="object_id" value="<%=curObjectID%>"/>
	<input type=hidden name="sid" value="<%=tools.get_sum_sid( curDocID )%>"/>
	<input type=hidden name="selected_object_id" id="selected_object_id" value=""/>
	<input type=hidden name="new_object_id" id="new_object_id" value=""/>
	<input type=hidden name="selected_object_ids" id="selected_object_ids" value=""/>
	<input type=hidden name="add_persons_in_black_list" id="add_persons_in_black_list" value="1"/>
	<input type=hidden name="tab" id="tab" value="<%=_selectedTab%>"/>
<!----------------------------------------------- ACTIONS -------------------------------------------------------------------------->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td>

<table width="100%" border="0" cellspacing="0" cellpadding="5">
<%
		if ( _write )
		{
%>
	<tr>
		<td align="CENTER" class="activator">
			<input type="button" value="<%=tools.get_web_str('veb_to_project')%>" onclick="doSubmit('set_status','project');" <%=( curObject.status_id == 'active' || curObject.status_id == 'project' ? 'disabled="1"' : '' )%> class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" style="width:150px"/>
			<input type="button" value="<%=tools.get_web_str('veb_to_plan')%>" onclick="doSubmit('set_status','plan');" <%=( curObject.status_id == 'active' || curObject.status_id == 'plan' ? 'disabled="1"' : '' )%> class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" style="width:170px">
			<input type="button" value="<%=tools.get_web_str('veb_b1')%>" onclick="doSubmit('set_status','active');" <%=( curObject.status_id == 'active' ? 'disabled="1"' : '' )%> class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" style="width:150px">
			<input type="button" value="<%=tools.get_web_str('veb_b2')%>" onclick="doSubmit('set_status','close');" <%=( curObject.status_id != 'active' ? 'disabled="1"' : '' )%> class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" style="width:170px"/>
			<input type="button" value="<%=tools.get_web_str('veb_to_cancel')%>" onclick="doSubmit('set_status','cancel');" <%=( curObject.status_id == 'active' || curObject.status_id == 'cancel' ? 'disabled="1"' : '' )%> class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" style="width:150px">
		</td>
	</tr>
	<tr>
		<td align="CENTER" class="activator">
			<input type="button" value="<%=tools.get_web_str('veb_activate_test')%>" onclick="doSubmit('activate_test');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<input type="button" value="<%=tools.get_web_str('c_save')%>" onclick="doSubmit('save');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
			&nbsp;&nbsp;&nbsp;&nbsp;
			<input type="button" value="<%=tools.get_web_str('c_delete')%>" onclick="doSubmit('delete');" <%=( curObject.status_id != 'project' ? 'disabled="1"' : '' )%> class="inputButton" style="width:80px " onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
		</td>
	</tr>
<%
		}
%>
	<tr>
		<td align="CENTER" class="activator">
<%
		if ( curObject.type_id=="case" && curObject.is_open_case && ! _is_col && curObject.status_id != 'project' && curObject.status_id != 'close' && curObject.status_id != 'cancel' )
		{
%>
			<input type="button" value="<%=tools.get_web_str('veb_activate_case')%>" onclick="doSubmit('add_collaborator','<%=curUserID%>');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
<%
		}

		if ( curObject.type_id=="case" && _write && !curObject.public_answers )
		{
%>
			<input type="button" value="<%=tools.get_web_str('vceb_publish')%>" onclick="doSubmit('public');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
<%
		}

		if ( _view && curObject.default_response_type_id.HasValue )
		{
%>
			<input type="button" value="<%=tools.get_web_str('c_text_create_response')%>" onclick="document.location.href='view_doc.html?mode=response&doc_id=<%=curDocID%>&response_object_id=<%=curObjectID%>&response_type_id=<%=curObject.default_response_type_id%>';return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
<%
		}
%>
		</td>
	</tr>
<%
		if ( curObject.is_open && ! _is_col && curObject.status_id != 'project' && curObject.status_id != 'close' && curObject.status_id != 'cancel' )
		{
%>
	<tr>
		<td align="CENTER" class="activator">
<%
			if ( curUser.in_request_black_list )
			{
%>
				<b><%=tools.get_web_str('veb_text_in_request_black_list')%></b>
<%
			}
			else if ( curObject.date_request_over.HasValue && curObject.date_request_over < Date() )
			{
%>
				<b><%=tools.get_web_str('veb_request_time_expired')%></b>
<%
			}
			else if ( curObject.date_request_begin.HasValue && curObject.date_request_begin > Date() )
			{
%>
				<b><%=tools.get_web_str('veb_request_time_begin')%></b>
<%
			}
			else if ( curObject.default_request_type_id.HasValue )
			{
%>
			<input type="button" value="<%=tools.get_web_str('c_text_create_request')%>" onclick="document.location.href='view_doc.html?mode=request_create&doc_id=<%=curDocID%>&request_object_id=<%=curObjectID%>&request_type_id=<%=curObject.default_request_type_id%>';return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
<%
			}
			else
			{
%>
			<%=tools.get_web_str('c_text_create_request')%>:&nbsp;
<%
				_request_type_array = XQuery( "for $elem in request_types where $elem/object_type = 'event' return $elem" )
				for ( _request_type in _request_type_array )
				{
%>
			<input type="button" value="<%=tools_web.get_cur_lng_name( _request_type.name )%>" onclick="document.location.href='view_doc.html?mode=request_create&type=event&doc_id=<%=curDocID%>&request_object_id=<%=curObjectID%>&request_type_id=<%=_request_type.PrimaryKey%>';return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
<%
				}
			}
%>
		</td>
	</tr>
<%
		}
%>
</table>
<br/>
</td>
</tr>

</table>

<script src="scripts/calendar/calendar.js"></script>
<script>
function ToggleBookmark(id)
{
	for(i=0; i<4; i++)
	{
		if(i != id)
		{
			document.getElementById("td_" + i).className = 'tab_td';
			document.getElementById("bm_" + i).style.display = 'none';
		}
		else
		{
			document.getElementById("td_" + i).className = 'tab_td_sel';
			document.getElementById("bm_" + i).style.display = '';
		}
	}
	document.getElementById("tab").value = id;
}
</script>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td class="tab_td_empty"><img src="pics/1blank.gif" width="10" height="0"/></td>

		<td class="<%=(_selectedTab == 0 ? "tab_td_sel" : "tab_td")%>" id="td_0" onclick="ToggleBookmark(0)"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="ToggleBookmark(0)"><%=tools.get_web_str('c_event')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>

		<td class="<%=(_selectedTab == 1 ? "tab_td_sel" : "tab_td")%>" id="td_1" onclick="ToggleBookmark(1)"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="ToggleBookmark(1)"><%=tools.get_web_str('c_members')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>

		<td class="<%=(_selectedTab == 2 ? "tab_td_sel" : "tab_td")%>" id="td_2" onclick="ToggleBookmark(2)"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="ToggleBookmark(2)"><%=tools.get_web_str('c_materials')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>

		<td class="<%=(_selectedTab == 3 ? "tab_td_sel" : "tab_td")%>" id="td_3" onclick="ToggleBookmark(3)"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="ToggleBookmark(3)"><%=tools.get_web_str('c_additional')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>

		<td class="tab_td_empty" width="100%">&nbsp;</td>
	</tr>
</table>
<br/>

<table width="100%"  border="0" cellspacing="0" cellpadding="0">
<tr valign="top">
<td>

<%
if ( curObject.status_id == 'active' && _view )
{
%>

	<table width="100%"  border="0" cellspacing="3" cellpadding="0">
<%
if ( curObject.use_video )
{
%>
		<tr>
		<td>

<script>
<!--
var fx = 4;
var fxmax = 12;
var fk = 20;
var wmp_width = 160;
var wmp_height = 120;
var wh = 0.75;

function less_min(){
		fx = 0;
		resizewmp();
}
function less(){
	if (fx > 0){
		fx--;
		resizewmp();
	}
}
function more(){
	if (fx < fxmax){
		fx++;
		resizewmp();
	}
}
function more_max(){
		fx = fxmax;
		resizewmp();
}
function resizewmp(){
	wmpw = fk * fx + wmp_width;
	wmph = wmpw * wh + 70;
	document["WMP"].width = wmpw;
	document["WMP"].height = wmph;

}
//-->
</script>
<table border="0" cellpadding=0 cellspacing=0 width="100%" class="tableBorder">
	<tr><td><%=tools.get_web_str('veb_video_title')%></td></tr>
	<tr>
<td align=center>
	<object name='WMP' id='WMP' width='240' height='250'
		classid='CLSID:22D6F312-B0F6-11D0-94AB-0080C74C7E95'
		codebase='http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=6,4,7,1112'
		standby='Loading Microsoft® Windows® Media Player components...'
		type='application/x-oleobject' style="borderWidth='0.5cm'; borderBottomStyle='groove'">
<param name='Filename' value='<%=curObject.video_url%>' />
<param name='ShowControls' value='TRUE' />
<param name='ShowStatusBar' value='true' />
<param name='Autosize' value='false' />
<param name='Autostart' value='false' />
<param name='ShowPositionControls' value='false' />
<param name='ShowTracker' value='True' />
<embed type='application/x-mplayer2'
			pluginspage = 'http://www.microsoft.com/Windows/MediaPlayer/'
			src='<%=curObject.video_url%>'
			name='WMP'
			width='245'
			height='240'
			autostart='true'
			showcontrols='' showstatusbar='' showdisplay=''> </embed>
</object>
		<!--HEIGHT='250' WIDTH='240'--></td>
</tr>

	<tr>
		<td style="text-align: center; font-family: verdana; font-size: 11">
				<a href="#" onclick="less_min();return false;"><img src="/pics/less_min1.png" alt="<%=tools.get_web_str('veb_video_tip1')%>" title="<%=tools.get_web_str('veb_video_tip1')%>" border=0></a>
				<a href="#" onclick="less();return false;"><img src="/pics/less1.png" alt="<%=tools.get_web_str('veb_video_tip2')%>" title="<%=tools.get_web_str('veb_video_tip2')%>" border=0></a>
				<a href="#" onclick="more();return false;"><img src="/pics/more1.png" alt="<%=tools.get_web_str('veb_video_tip3')%>" title="<%=tools.get_web_str('veb_video_tip3')%>" border=0></a>
				<a href="#" onclick="more_max();return false;"><img src="/pics/more_max1.png" alt="<%=tools.get_web_str('veb_video_tip4')%>" title="<%=tools.get_web_str('veb_video_tip4')%>" border=0></a>
		</td>
	</tr>
</table>

			</td>
			</tr>
<%
}

if ( curObject.use_audio )
{
%>
			<tr>
			<td>
<table border="0" cellpadding=0 cellspacing=0 width="100%" height="100%" class="tableBorder">
	<tr>
<td>
<%=tools.get_web_str('veb_audio_title')%>
<br>
<center>
<input type="button" style="width: 180px;" value="<%=tools.get_web_str('veb_audio_open')%>" onclick="window.location.href='<% Response.Write( curObject.audio_url + ( StrEnds( curObject.audio_url, '/' ) ? '' : '/' ) + 'nickname=' + UrlEncode( curUser.login ) + '?loginname=' + UrlEncode( curObject.audio_login ) + '?password=' + UrlEncode( curObject.audio_password ) + '?channel=' + UrlEncode( curObject.audio_channel_login ) + '?channelpassword=' + UrlEncode( curObject.audio_channel_password ) ) %>'" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
</center>
<br/>
		</td>
	</tr>
</table>
			</td>
			</tr>
<%
}
%>

		</table>


<%
}
%>



</td>
<td>


<div id="bm_0" <%=(_selectedTab != 0 ? 'style="display: none"' : '')%>>
<table border="0" cellpadding="0" cellspacing="3" width="100%" height="100%">

<%
if ( curObject.main_material_url != '' && _view )
{
%>
<script>
function changeSrc()
{
if(!document.getElementById("tSrc")) return false;
if(!document.getElementById("tFrame")) return false;
if(document.getElementById("tSrc").value=="") return false;
var s = document.createElement("a");
s.setAttribute("target","tFrame");
s.setAttribute("href",document.getElementById("tSrc").value);
var t = document.createTextNode("Display material");
s.appendChild(t);
if(document.getElementById("FileFromDisc").firstChild!=null) document.getElementById("FileFromDisc").removeChild(document.getElementById("FileFromDisc").firstChild);
document.getElementById("FileFromDisc").appendChild(s);
document.getElementById("FileFromDisc").setAttribute("ref",document.getElementById("tSrc").value);
document.getElementById("FileFromDisc").onclick = function() {
//        document.getElementById("tFrame").src = this.ref;
window.open("win1",this.ref);
	return false;
}

return true;
}

function changeSrcOld()
{
if(!document.getElementById("tSrc")) return false;
if(!document.getElementById("tFrame")) return false;
if(document.getElementById("tSrc").value=="") return false;
document.getElementById("tFrame").src = document.getElementById("tSrc").value;
return true;
}
function isSpdBrwsr()
{
	var InternetExplorer = navigator.appName.indexOf("Microsoft") != -1;
	return(InternetExplorer ? true : false);
}
</script>
<tr>
<td>

	<table width="100%"  border="0" cellspacing="0" cellpadding="3" class="tableBorder">
		<tr>
			<td align="center">
			<iframe id="tFrame" name="tFrame" src="<%=curObject.main_material_url%>" width="<%=curObject.main_material_width%>" height="<%=curObject.main_material_height%>" scrolling="auto" frameborder="0"  class="">
			</iframe>
			</td>
		</tr>
		<tr>
			<td align="LEFT">
			<%=tools.get_web_str('veb_mat_text1')%>&nbsp;</b><input type="file" id="tSrc" name="tSrc" onchange="changeSrc();" class="inputEdit" size="50">
			<div id="FileFromDisc"></div>
			</td>
		</tr>

	</table>

</td>
</tr>
<%
}
%>


<%
if ( curObject.chat_id.HasValue && _view )
{
%>

<!--   <tr>
<td>

	<br/>
	<br/>
	<a href="#event_chat" onclick="disp_block('event_chat_div','event_chat_img');" id="event_chat"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="event_chat_img" border="0"/>&nbsp;<%=tools.get_web_str('c_chat')%></p></a>
	<div id="event_chat_div" style="display: inline">

	<table width="100%"  border="0" cellspacing="0" cellpadding="0">
		<tr>
			<td ALIGN="LEFT">
				<iframe src="view_chat_body.html?chat_id=<%=curObject.chat_id%>" width="100%" height="310" SCROLLING="AUTO" FRAMEBORDER="0" ></iframe>

				<%
					_chat_cat = curObject.chat_id.OptForeignElem;
				%>
				<a href="view_doc.html?mode=chat&object_id=<%=curObject.chat_id%>&doc_id=<%=curDocID%>"><%=(_chat_cat != undefined ? _chat_cat.name : "*" + tools.get_web_str('c_deleted') + "*")%></a>
			</td>
		</tr>
	</table>

</td>
</tr>-->

<%
}
			if(curObject.type_id=='webinar' && _view && global_settings.disp_vclass)
			{
%>
			<tr>
			<td align="center">
<%
			if(curObject.vclass_host.HasValue)
			{
				if(curObject.status_id=="active")
				{
%>
				<input type="button" value="<%=tools.get_web_str('veb_login_webinar')%>" onclick="openWebinar(); return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" style="width:150px ">
<%
				}
				if(curObject.record_exists)
				{
					if(curObject.show_record )
					{
%>
				&nbsp;<input type="button" value="<%=tools.get_web_str('veb_view_webinar_rec')%>" onclick="openWebinarRecord(); return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" style="width:180px ">
<%
					}
					if(curObject.allow_record_download )
					{
%>
				&nbsp;<input type="button" value="<%=tools.get_web_str('veb_dowload_webinar_rec')%>" onclick="downloadWebinarRecord(); return false;" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';" style="width:180px ">
<%
					}
				}
			}
			else
			{
%>
				<b><%=tools.get_web_str('veb_mess_webinar_url')%></b>
<%
			}
%>
		</td>
	</tr>
<%
}
%>
<%
if ( curObject.forum_id.HasValue && _view )
{
%>
<tr>
<td>

	<br/>
	<br/>
	<a href="#event_forum" onclick="disp_block('event_forum_div','event_forum_img'); return false;" id="event_forum"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="event_forum_img" border="0"/>&nbsp;<%=tools.get_web_str('c_forum')%></p></a>
	<div id="event_forum_div" style="display: inline">

	<table width="100%"  border="0" cellspacing="0" cellpadding="0" class="tableBorder">
		<tr>
			<td align="left">
				<!-- <iframe src="view_forum_body.html?object_id=<%=curObject.forum_id%>&noheader=" width="100%" height="300" scrolling="auto" FRAMEBORDER="0"></iframe> -->
				<%
					_forum_cat = curObject.forum_id.OptForeignElem;
				%>
				<a href="view_doc.html?mode=forums&object_id=<%=curObject.forum_id%>&doc_id=<%=curDocID%>"><%=(_forum_cat != undefined ? _forum_cat.name : "*" + tools.get_web_str('c_deleted') + "*")%></a>
			</td>
		</tr>
	</table>

</td>
</tr>
<%
}
%>
<script language="JAVASCRIPT">
<%
if(curObject.type_id =='webinar')
{

	_start_url = ((curWebDesignUrl != "") ? "../" : "");
%>

function openWebinar()
{
		<%
		if(!_is_lector)
		{
		code=curUserID;
		}
		else
		{
			var _c_lect = ArrayOptFirstElem(XQuery( 'for $elem in lectors where $elem/person_id = ' + curUserID + ' return $elem' ));
			code = _c_lect.PrimaryKey;
		}
		%>
		openWebinarWindow("vclass/webinar.html?room=<%=curObjectID%>&code=<%=code%>");
	}

function openWebinarRecord()
{
		openWebinarWindow("http://<%=curHost%>/vclass/vcplayer.html?cid=<%=curObjectID%>");
	}

function downloadWebinarRecord()
{
		openWebinarWindow("vclass/vcplayer.html?cid=<%=curObjectID%>&download=1");
	}

	function openWebinarWindow(startURL)
	{
	    var z = parseInt(Math.random()*10000,10);
		posX=0;
        posY=0;
		winWidth = screen.width - 20;
		winHeight = screen.height - 100;		
        //win=window.open(startURL,z.toString(),'"resizable=true,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,left='+posX+',top='+posY+',width='+winWidth+',height='+winHeight+'"');
		win=window.open(startURL,z.toString(),'"fullscreen=yes,resizable=yes,toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,left='+posX+',top='+posY+',width='+winWidth+',height='+winHeight+'"' );
        //window.history.back();
        if(win!=null)
                win.focus();
}
<%
}
%>


function doSubmit( _action, _id )
{
	if ( _action != 'delete' )
	{
		try
		{
			_check_flag = check_required();
		}
		catch( err )
		{
			_check_flag = true;
		}
		if ( ! _check_flag )
			return;
	}

	document.getElementById('action_id').value = _action;
	document.getElementById('selected_object_id').value = _id;

	var strAttr="status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1";

	switch ( _action )
	{
<%
	if ( _write )
	{
%>
		case 'delete':
			if ( ! confirm( "<%=tools.get_web_str('veb_message4')%>" ) )
				return;
			break;

		case 'change_place':
			var pars=new Object();
			pars.element_id = '<%=curObject.place_id%>';
			
<%
			if (curObject.education_org_id.HasValue)
			{
				try
				{
					teEduOrg=OpenDoc( UrlFromDocID( curObject.education_org_id ) ).TopElem
					if (ArrayOptFirstElem(teEduOrg.places)!=undefined)
					{
						xquery_qual =' MatchSome( $elem/id, ('+ArrayMerge(ArrayExtract(teEduOrg.places,'place_id'),'This',',')+') ) '
%>
						pars.xquery_qual ='<%=xquery_qual%>'
<%
					}						
				}
				catch(ex)
				{
				}
			}
%>

			xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=place&typein=0&multi_select=0&check_access=1&rand='+Math.random(), pars, strAttr );
			if ( ! pars.handle )
				return null;

			document.getElementById('selected_object_id').value = pars.element_id;
			break;

		case 'change_education_method':
			var pars=new Object();
			pars.element_id = '<%=curObject.education_method_id%>';

			xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=education_method&typein=0&multi_select=0&check_access=1&rand='+Math.random(), pars, strAttr);
			if ( ! pars.handle )
				return null;

			document.getElementById('selected_object_id').value = pars.element_id;
			break;

		case 'change_tutors':
			var pars=new Object();
<%
	_str = '';
	for ( _elem in curObject.tutors )
		_str = _str + _elem.PrimaryKey + ';';
%>
			pars.selected_object_ids = '<%=_str%>';
//alert(111)
			xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&can_be_empty=1&typein=0&multi_select=1&check_access=1&rand='+Math.random(), pars, strAttr);
			if ( ! pars.handle )
				return null;
//alert(222)
			document.getElementById('selected_object_ids').value = pars.selected_object_ids;
			break;

		case 'activate_test':
			var pars=new Object();
			pars.xquery_qual = "$elem/status='publish'";

			xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=assessment&typein=0&multi_select=0&check_access=1&rand='+Math.random(), pars, strAttr);
			if ( ! pars.handle )
				return null;

			document.getElementById('selected_object_id').value = pars.element_id;
			break;

		case 'change_lectors':
			var pars=new Object();
<%
	_str = '';
	for ( _elem in curObject.lectors )
		_str = _str + _elem.PrimaryKey + ';';
%>
			pars.selected_object_ids = '<%=_str%>';

			xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=lector&can_be_empty=1&typein=0&multi_select=1&check_access=1&rand='+Math.random(), pars, strAttr);
			if ( ! pars.handle )
				return null;

			document.getElementById('selected_object_ids').value = pars.selected_object_ids;
			break;

				case 'add_preparation':
					var pars=new Object();
					pars.selected_object_ids = '<%=_str%>';

					xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&typein=0&multi_select=0&check_access=1&rand='+Math.random(), pars, strAttr);
					if ( ! pars.handle )
						return null;

					document.getElementById('selected_object_id').value = pars.element_id;
					break;

		case 'change_collaborators':
			var pars=new Object();
<%
	_str = '';
	for ( _elem in curObject.collaborators )
		_str = _str + _elem.PrimaryKey + ';';
%>
			pars.selected_object_ids = '<%=_str%>';
			pars.can_be_empty = true;
//                        pars.disp_win = true;
//                        pars.overflow_num = 200;

			xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&can_be_empty=1&typein=0&multi_select=1&check_access=1&rand='+ Math.random(), pars, strAttr);
			if ( ! pars.handle )
				return null;

			//document.getElementById("add_persons_in_black_list").value = window.confirm( <%=CodeLiteral( tools.get_web_str('veb_mess_black_list') )%> ) ? '1' : '0'; 
			document.getElementById('selected_object_ids').value = pars.selected_object_ids;
			break;

		case 'set_status':
			switch ( _id )
			{
				case 'active':
					if ( ! window.confirm( "<%=tools.get_web_str('veb_message1')%>" ) )
						return null;
					break;

				case 'close':
					if ( ! window.confirm( "<%=tools.get_web_str('veb_message2')%>" ) )
						return null;
					break;
			}
			break;
		case 'add_file':
			can_submit=false
			try
			{
				if(document.getElementById('add_file_type_file').checked)
				{
					if($("#add_file_url").val()=='')
						return false;
					can_submit=true
				}
				if(document.getElementById('add_file_type_resource').checked)
				{
					if($("#add_file_resource_id").val()=='')
						return false;
					can_submit=true
				}
			}
			catch(ex)
			{	
			}
			if (!can_submit)
			{
				return false;
			}
			break;
<%
	}

	if ( _requester )
	{
		_str = ';';
		for ( _elem in curObject.collaborators )
			_str = _str + _elem.PrimaryKey + ';';
%>
		case 'replace_collaborator':
			var pars=new Object();

			xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&can_be_empty=1&typein=0&multi_select=0&check_access=1&rand='+ Math.random(), pars, strAttr);
			if ( ! pars.handle || pars.element_id == _id )
				return null;

			if ( String("<%=_str%>").indexOf( pars.element_id ) != -1 )
				return null;

			document.getElementById('new_object_id').value = pars.element_id;
			break;
<%
	}
%>
	}

	document.forms['event_form'].submit();
}

function disp_block( _div_id, _img_id )
{
	if ( ! document.getElementById( _div_id ) )
		return false;

	_img = document.getElementById( _img_id );
	_div = document.getElementById( _div_id );
	if ( _div.style.display == 'none' )
	{
		_div.style.display = 'inline';
		if( _img )
			_img.src = 'pics/minus.jpg';
	}
	else
	{
		_div.style.display = 'none';
		if( _img )
			_img.src = 'pics/plus.jpg';
	}
	return true;
}
</script>

	<tr>
	<td>


<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
<tr>
<td width="100%">

<%
	if ( _write )
	{
%>

	<table width="100%" cellspacing="0" cellpadding="4">
		<tr>
			<td><%=tools.get_web_str('c_name')%>:</td>
			<td width="100"><%=tools.get_web_str('c_code')%>:</td>
		</tr>
		<tr>
			<td><input type="TEXT" name="name" id="name_id" value="<%=HtmlEncode( curObject.name )%>" class="inputEdit" style="width:100% "></td>
			<td width="100"><input type="TEXT" name="code" id="code_id" value="<%=HtmlEncode( curObject.code )%>" class="inputEdit" style="width:100"></td>
		</tr>
	</table>
	<table width="100%" cellspacing="8" cellpadding="0">
		<tr>
			<td width="50%"><%=tools.get_web_str('c_type')%>:</td>
			<td><%=tools.get_web_str('c_state')%>:</td>
		</tr>
		<tr>
			<td>
				<select name="type_id" id="type_id" onchange="doSubmit('save');">
<%
		if ( sAvailableTypes != '' )
		{
			arrAvailableTypes = String( sAvailableTypes ).split( ';' );
			for ( sAvailableTypeElem in arrAvailableTypes )
			{
				_type = curLngCommon.event_types.GetOptChildByKey( Trim( sAvailableTypeElem ) );
				if ( _type != undefined )
				{
%>
					<option value="<%=_type.PrimaryKey%>"><%=_type.name%></option>
<%
				}
			}
		}
		else
		{
			for ( _type in curLngCommon.event_types )
			{
%>
					<option value="<%=_type.PrimaryKey%>"><%=_type.name%></option>
<%
			}
		}
%>
				</select>
<script language="JavaScript">
selcur=document.getElementById('type_id');
selcur.selectedIndex==-1;
for (i=0;i<selcur.options.length;i++)
if (selcur.options[i].value=="<%=curObject.type_id%>") {
	selcur.selectedIndex=i;
		break;
}
</script>
			</td>
			<td><b><%=curLngCommon.event_status_types.GetChildByKey( curObject.status_id ).name%></b></td>
		</tr>
		<tr>
			<td colspan="2">&nbsp;</td>
		</tr>
<!---------------------------------------------------------------------------------------------------------------------->
<%
	switch ( curObject.type_id )
	{
		case 'real_time':
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_course')%>:</td>
			<td><%=tools.get_web_str('c_chat')%>:</td>
		</tr>
		<tr>
			<td>
				<select name="course_id">
					<option value=""></option>
<%
			for ( _course in courses )
			{
		if ( tools_web.check_access( OpenDoc( UrlFromDocID ( _course.PrimaryKey ), 'form=x-local://wtv/wtv_form_doc_access.xmd;ignore-top-elem-name=1' ).TopElem, curUserID, curUser, Session ) )
		{
%>
					<option value="<%=_course.id%>"  <%=(_course.id!=curObject.course_id) ? '' : 'selected="selected"'%>><%=_course.code%>&nbsp;<%=tools_web.get_cur_lng_name( _course.name )%></option>
<%
			}
			}
%>
				</select>
<%
			try
			{
				if ( curObject.course_id.HasValue )
				{
					_cur_course = curObject.course_id.ForeignElem;
%>
					<a href="view_doc.html?mode=course_info&doc_id=<%=curDocID%>&object_id=<%=curObject.course_id%>" title="<%=tools.get_web_str('c_tip_course')%>"><%=tools.get_web_str( 'c_go' )%></a>
<%
				}
			}
			catch ( ll )
	{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
}
%>
			</td>
			<td>
				<select name="chat_id">
					<option value=""></option>
<%
			for ( _chat in chats )
			{
%>
				<option value="<%=_chat.id%>" <%=(_chat.id!=curObject.chat_id) ? '' : 'selected="selected"'%>><%=tools_web.get_cur_lng_name( _chat.name )%></option>
<%
			}
%>
				</select>
<%
			try
			{
				if ( curObject.chat_id.HasValue )
				{
					_cur_chat = curObject.chat_id.ForeignElem;
%>
					<a href="view_doc.html?mode=chat&doc_id=<%=curDocID%>&object_id=<%=curObject.chat_id%>" title="<%=tools.get_web_str('c_tip_chat')%>"><%=tools.get_web_str( 'c_go' )%></a>
<%
				}
			}
			catch ( ll )
			{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
}
%>
			</td>
		</tr>
<%
		break;


		case 'compound_program':
		case 'compound_program_elem':
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_compound_prog')%>:</td>
<%
			if ( curObject.type_id == 'compound_program_elem' )
			{
%>
			<td><%=tools.get_web_str('c_compound_prog_part')%>:</td>
<%
			}
%>
		<tr>
		</tr>
			<td width="50%">
<%
			try
			{
				if ( curObject.compound_program_id.HasValue )
				{
					_cur_compound_program = curObject.compound_program_id.ForeignElem;
%>
					<a href="view_doc.html?mode=compound_program&doc_id=<%=curDocID%>&object_id=<%=curObject.compound_program_id%>" title="<%=tools.get_web_str('c_tip_compound_prog')%>"><%=tools_web.get_cur_lng_name( _cur_compound_program.name )%></a>
<%
				}
			}
			catch ( ll )
			{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
			}
%>
			</td>
			<td>
<%
			if ( curObject.type_id == 'compound_program_elem' )
			{
				try
				{
					if ( curObject.program_id.HasValue )
					{
						_cur_program = _cur_compound_program.programs.GetChildByKey( curObject.program_id );
%>
				<b><%=tools_web.get_cur_lng_name( _cur_program.name )%></b>
<%
					}
				}
				catch ( aa )
				{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
				}
			}
%>
			</td>
		</tr>
<%
		break;



		case 'education_method':
		case 'education_method_from_program':
			_disp_education_org = false;
			_cur_education_method = null;
			try
			{
				if ( curObject.education_method_id.HasValue )
				{
					_cur_education_method = curObject.education_method_id.ForeignElem;
					_disp_education_org = ( _cur_education_method.type == 'org' );
				}
			}
			catch ( ff )
			{
			}
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_edu_method')%>:</td>
			<td>
<%
			if ( _disp_education_org )
				Response.Write( tools.get_web_str('c_edu_org') + ":" );
%>
			</td>
		</tr>
		<tr>
			<td>
		<b><a href="view_doc.html?mode=education_method&object_id=<%=curObject.education_method_id%>&doc_id=<%=curDocID%>"><%
				try
				{
					Response.Write( tools_web.get_cur_lng_name( curObject.education_method_id.ForeignElem.name ) );
				}
				catch ( ff )
				{
				}
			%></a></b>
	<input type="hidden" name="education_method_id" id="education_method_id" value="<%=curObject.education_method_id%>" class="inputEdit" style="width:100%">
	&nbsp;<input type="button" value="<%=tools.get_web_str('c_choose')%>" onclick="doSubmit('change_education_method','education_method_id');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
			</td>
			<td>
<%
			if ( _disp_education_org )
			{
				try
				{
					if ( _cur_education_method.education_org_id.HasValue )
					{
						_cur_education_org = _cur_education_method.education_org_id.ForeignElem;
%>
				<b><a href="view_doc.html?mode=education_org&object_id=<%=_cur_education_method.education_org_id%>&doc_id=<%=curDocID%>" title="<%=tools.get_web_str('c_tip_edu_org')%>"><%=tools_web.get_cur_lng_name( _cur_education_org.disp_name )%></a></b>
<%
					}
				}
				catch ( aa )
				{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
				}
			}
%>
			</td>
		</tr>
<%
		break;


		case 'one_time':
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_edu_org')%>:</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td width="50%">
<%
			if ( curObject.education_org_type == 'id' )
			{
				try
				{
					if ( curObject.education_org_id.HasValue )
					{
						_cur_education_org = curObject.education_org_id.ForeignElem;
%>
				<a href="view_doc.html?mode=education_org&doc_id=<%=curDocID%>&object_id=<%=curObject.education_org_id%>" title="<%=tools.get_web_str('c_tip_edu_org')%>"><%=tools_web.get_cur_lng_name( _cur_education_org.disp_name )%></a>
<%
					}
				}
				catch ( aa )
				{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
				}
			}
			else
			{
%>
				<b><%=tools_web.get_cur_lng_name( curObject.education_org_name )%></b>
<%
			}
%>
			</td>
			<td>&nbsp;</td>
		</tr>
<%

		break;

		case 'webinar':

			_disp_education_org = false;
			_cur_education_method = null;
			try
			{
				if ( curObject.education_method_id.HasValue )
				{
					_cur_education_method = curObject.education_method_id.ForeignElem;
					_disp_education_org = ( _cur_education_method.type == 'org' );
				}
			}
			catch ( ff )
			{
			}
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_edu_method')%>:</td>
			<td>
<%
			if ( _disp_education_org )
				Response.Write( tools.get_web_str('c_edu_org') + ":" );
%>
			</td>
		</tr>
		<tr>
			<td>
		<b><a href="view_doc.html?mode=education_method&object_id=<%=curObject.education_method_id%>&doc_id=<%=curDocID%>"><%
				try
				{
					Response.Write( tools_web.get_cur_lng_name( curObject.education_method_id.ForeignElem.name ) );
				}
				catch ( ff )
				{
				}
			%></a></b>
	<input type="hidden" name="education_method_id" id="education_method_id" value="<%=curObject.education_method_id%>" class="inputEdit" style="width:100%">
	&nbsp;<input type="button" value="<%=tools.get_web_str('c_choose')%>" onclick="doSubmit('change_education_method','education_method_id');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
			</td>
			<td>
<%
			if ( _disp_education_org )
			{
				try
				{
					if ( _cur_education_method.education_org_id.HasValue )
					{
						_cur_education_org = _cur_education_method.education_org_id.ForeignElem;
%>
				<b><a href="view_doc.html?mode=education_org&object_id=<%=_cur_education_method.education_org_id%>&doc_id=<%=curDocID%>" title="<%=tools.get_web_str('c_tip_edu_org')%>"><%=tools_web.get_cur_lng_name( _cur_education_org.disp_name )%></a></b>
<%
					}
				}
				catch ( aa )
				{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
				}
			}
%>
			</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td><%=tools.get_web_str('veb_webinar_url')%>: 
				<select name="vclass_host">
<%
			for ( _host in global_settings.settings.vclass_hosts)
			{
				_selected = (curObject.vclass_host != _host.host) ? "" : 'selected="selected"';
%>
					<option value="<%=_host.host%>" <%=_selected%>><%=_host.host%></option>
<%
			}
%>
				</select>
			</td>
			<td>
				Ширина канала для видео: <input type="text" name="bandwidth" id="bandwidth" value="<%=curObject.bandwidth%>" class="inputEdit" style="width:40">
			</td>
		<tr>
		</tr>
<%

		break;
	}
%>
<!---------------------------------------------------------------------------------------------------------------------->
		<tr>
			<td colspan="2"><hr/></td>
		</tr>
<%
				if(curObject.type_id == 'webinar' && curObject.record_exists)
				{
%>
		<tr>
			<td width="50%"><input type="checkbox" name="show_record" <%=( curObject.show_record ? 'checked="checked"' : '' )%>><%=tools.get_web_str('veb_mess_rec_view')%></td>
			<td width="50%"><input type="checkbox" name="allow_record_download" <%=( curObject.allow_record_download ? 'checked="checked"' : '' )%>><%=tools.get_web_str('veb_mess_rec_download')%></td>
		</tr>
<%
				}
%>
		<tr>
			<td width="50%"><input type="checkbox" name="is_public" <%=( curObject.is_public ? 'checked' : '' )%>><%=tools.get_web_str('veb_text1')%></td>
			<td width="50%"><input type="checkbox" name="disp_persons_for_all" <%=( curObject.disp_persons_for_all ? 'checked' : '' )%>><%=tools.get_web_str('veb_disp_persons_for_all')%></td>
		</tr>
		<tr>
			<td width="50%">
					<input type="checkbox" name="is_open" <%=( curObject.is_open ? 'checked' : '' )%>><%=tools.get_web_str('veb_text2')%></td>
			<td width="50%">
				<input type="checkbox" name="allow_guest_login" <%=( curObject.allow_guest_login ? 'checked' : '' )%>>Разрешить вход без предварительной регистрации
				<%
				
				if(curObject.type_id == 'webinar' && curObject.allow_guest_login )
				{
				%>
					<br/><br/>
					<p>Ссылка для гостевого входа:</p>
					<a href="http://<%=Request.UrlHost%>/vclass/webinar_starter.html?room=<%=curObjectID%>&guest=1" target="_blank">http://<%=Request.UrlHost%>/vclass/webinar_starter.html?room=<%=curObjectID%>&guest=1</a>
				<%
				}
				%>
<%
				if(curObject.type_id == 'case')
				{
%>
					<input type="checkbox" name="is_open_case" <%=( curObject.is_open_case ? 'checked' : '' )%>><%=tools.get_web_str('veb_text3')%>

<%
				}
				else
					Response.Write("&nbsp");
%>
			</td>
		</tr>
		<tr>
			<td colspan="2"><hr/></td>
		</tr>
		<tr>
			<td width="50%">
				<table width="100%" cellspacing="4" cellpadding="0" border="0">
					<tr>
						<td width="140"><%=tools.get_web_str('c_start_date')%>:</td>
						<td width="20">&nbsp;</td>
						<td width="140" colspan="2"><%=tools.get_web_str('c_finish_date')%>:</td>
						<td>&nbsp;</td>
					</tr>
					<tr>
						<td width="100">
			<%=tools_web.draw_calendar('start_date',StrDate( curObject.start_date, true,false ),'dd.mm.yyyy HH:MM')%>
			</td>
						<td width="20">&nbsp;</td>
						<td width="140">
			<%=tools_web.draw_calendar('finish_date',StrDate( curObject.finish_date, true,false ),'dd.mm.yyyy HH:MM')%>
			</td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</td>
			<td>
				<table width="100%" cellspacing="4" cellpadding="0">
					<tr>
						<td width="140" colspan="2"><%=tools.get_web_str('veb_duration_plan')%>:</td>
						<td width="20">&nbsp;</td>
						<td width="140" colspan="4"><%=tools.get_web_str('veb_duration_fact')%>:</td>
						<td>&nbsp;</td>
					</tr>
					<tr>
						<td width="80"><%=curObject.duration_plan%>&nbsp;<%=tools.get_web_str('veb_duration_hours')%></td>
						<td width="80"><%=curObject.duration_days_plan%>&nbsp;<%=tools.get_web_str('veb_duration_days')%></td>
						<td width="20">&nbsp;</td>
						<td width="40"><input type="TEXT" name="duration_fact" id="duration_fact_id" value="<%=curObject.duration_fact%>" class="inputEdit" style="width:40"></td>
						<td width="40"><%=tools.get_web_str('veb_duration_hours')%></td>
						<td width="40"><input type="TEXT" name="duration_days_fact" id="duration_days_fact_id" value="<%=curObject.duration_days_fact%>" class="inputEdit" style="width:40"></td>
						<td width="40"><%=tools.get_web_str('veb_duration_days')%></td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td colspan="2"><hr/></td>
		</tr>
		<tr>
			<td width="100%" colspan="2">
				<table width="100%" cellspacing="4" cellpadding="0">
					<tr>
						<td><%=tools.get_web_str('veb_max_person_num')%>:&nbsp;&nbsp;&nbsp;<b><%=curObject.person_num%></b>&nbsp&nbsp;<%=tools.get_web_str('c_of')%>&nbsp;<input type="TEXT" name="max_person_num" id="max_person_num_id" value="<%=curObject.max_person_num%>" class="inputEdit" style="width:60"></td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</td>
		</tr>
<%
		if(curObject.type_id != 'case' && curObject.type_id != 'webinar')
		{
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_org_form')%>:</td>
			<td><%=tools.get_web_str('c_event_form')%>:</td>
		</tr>
		<tr>
			<td width="50%">
				<select name="organizational_form">
					<option value=""></option>
<%
			for ( _org_form in lists.organizational_forms )
			{
				_selected = (curObject.organizational_form != _org_form.id) ? "" : 'selected="selected"';
%>
					<option value="<%=_org_form.id%>" <%=_selected%>><%=_org_form.name%></option>
<%
			}
%>
				</select>
			</td>
			<td>
				<select name="event_form">
					<option value=""></option>
<%
	if (ArrayCount(curObject.event_forms)==0||(curObject.type_id != 'education_method'&&curObject.type_id != 'education_method_from_program'&&curObject.type_id != 'compound_program_elem'))
	{
			for ( _event_form in lists.event_forms )
			{
				_selected = (curObject.event_form != _event_form.id) ? "" : 'selected="selected"';
%>
					<option value="<%=_event_form.id%>" <%=_selected%>><%=_event_form.name%></option>
<%
			}
	}
	else
	{
			for ( _event_form in curObject.event_forms )
			{
				_selected = (curObject.event_form != _event_form.form_id) ? "" : 'selected="selected"';
				try
				{
%>
					<option value="<%=_event_form.form_id%>" <%=_selected%>><%=_event_form.form_id.ForeignElem.name%></option>
<%
				}
				catch(ex)
				{
				}
			}
	}
%>
				</select>
			</td>
		</tr>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_action_place')%>:</td>
			<td><%=tools.get_web_str('c_place')%>:</td>
		</tr>
		<tr>
		<td width="50%"><input type="TEXT" name="place" value="<%=curObject.place%>" class="inputEdit" style="width:100%"></td>
			<td><b><a href="view_doc.html?mode=place&doc_id=<%=curDocID%>&object_id=<%=curObject.place_id%>" target="_blank"><%
				try
				{
					Response.Write( tools_web.get_cur_lng_name( curObject.place_id.ForeignElem.name ) );
				}
				catch ( ff )
				{
				}
			%></a></b>
	<input type="hidden" name="place_id" value="<%=curObject.place_id%>" class="inputEdit" style="width:100%">
	&nbsp;<input type="button" value="<%=tools.get_web_str('c_choose')%>" onclick="doSubmit('change_place','place_id');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
	</td>
		</tr>
<%
		}
%>
		<tr>
			<td colspan="2"><hr/></td>
		</tr>
		<tr>
			<td width="50%">
				<table width="100%" cellspacing="0" cellpadding="0">
					<tr>
						<td width="50%"><%=tools.get_web_str('veb_date_request_begin')%>:</td>
						<td width="20">&nbsp;</td>
						<td width="50%"><%=tools.get_web_str('veb_date_request_over')%>:</td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</td>
			<td width="50%"><%=tools.get_web_str('veb_date_request_rejection_over')%>:</td>
		</tr>
		<tr>
			<td width="50%">
				<table width="100%" cellspacing="0" cellpadding="0">
					<tr>
						<td width="50%">
			<%=tools_web.draw_calendar('date_request_begin',StrDate( curObject.date_request_begin, true,false ),'dd.mm.yyyy HH:MM')%>
			</td>
						<td width="20">&nbsp;</td>
						<td width="50%">
			<%=tools_web.draw_calendar('date_request_over',StrDate( curObject.date_request_over, true,false ),'dd.mm.yyyy HH:MM')%>
			</td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</td>
			<td width="50%">
		<%=tools_web.draw_calendar('date_request_rejection_over',StrDate( curObject.date_request_rejection_over, true,false ),'dd.mm.yyyy HH:MM')%>
	</td>
		</tr>
	<tr>
	<td width="50%"><%=tools.get_web_str('veb_default_request_type')%>:</td>
	<td width="50%">
	</td>
	</tr>
	<tr>
	<td width="50%">
	<select name="default_request_type_id" id="default_request_type_id">
<%
				_request_type_array = XQuery( "for $elem in request_types where $elem/object_type = 'event' return $elem" )
				for ( _request_type in _request_type_array )
				{
		_selected = (_request_type.PrimaryKey==curObject.default_request_type_id) ?'selected="selected"' : "" ;
%>
					<option value="<%=_request_type.PrimaryKey%>" <%=_selected%>><%=_request_type.name%></value>
<%
		}
%>
	</select>
	</td>
	<td width="50%">
	<input type="checkbox" name="use_object_workflow" id="use_object_workflow" value="use_object_workflow" <%= (curObject.use_object_workflow)?'checked="checked"' : ''%>>
	<%=tools.get_web_str('veb_use_object_workflow')%></input>
	</td>
	</tr>
		<tr>
			<td colspan="2"><hr/></td>
		</tr>
	<tr>
	<td width="50%"><%=tools.get_web_str('veb_response_default_type')%>:</td>
	<td width="50%">
	</td>
	</tr>
	<tr>
	<td width="50%">
	<select name="default_response_type_id" id="default_response_type_id">
<%
				_response_type_array = XQuery( "for $elem in response_types where $elem/object_type = 'event' return $elem" )
				for ( _response_type in _response_type_array )
				{
		_selected = (_response_type.PrimaryKey==curObject.default_response_type_id) ?'selected="selected"' : "" ;
%>
					<option value="<%=_response_type.PrimaryKey%>" <%=_selected%>><%=_response_type.name%></value>
<%
		}
%>
	</select>
	</td>
	<td width="50%">
	<input type="checkbox" name="mandatory_fill_response" id="mandatory_fill_response" value="mandatory_fill_response" <%= (curObject.mandatory_fill_response)?'checked="checked"' : ''%>>
	<%=tools.get_web_str('veb_mandatory_fill_response')%></input>
	</td>
	</tr>
	<tr>
	<td width="50%"><%=tools.get_web_str('veb_default_result_type')%>:</td>
	<td width="50%">
	</td>
	</tr>
	<tr>
	<td width="50%">
	<select name="default_event_result_type_id" id="default_request_type_id">
<%
				for ( _result_type in event_result_types )
				{
		_selected = (_result_type.PrimaryKey==curObject.default_event_result_type_id) ?'selected="selected"' : "" ;
%>
					<option value="<%=_result_type.PrimaryKey%>" <%=_selected%>><%=_result_type.name%></value>
<%
		}
%>
	</select>
	</td>
	<td width="50%">&nbsp;
	</td>
	</tr>

	</table>

<%
	}
	else  //////////////////////////////////////////////////  NOT EDIT  ////////////////////////////////////////////////////////////////////
	{
%>
	<table width="100%" cellspacing="0" cellpadding="4">
		<tr>
			<td><%=tools.get_web_str('c_name')%>:</td>
			<td width="100"><%=tools.get_web_str('c_code')%>:</td>
		</tr>
		<tr>
			<td><b><%=tools_web.get_cur_lng_name( curObject.name )%></b></td>
			<td width="100"><b><%=curObject.code%></b></td>
		</tr>
	</table>
	<table width="100%" cellspacing="4" cellpadding="0">
		<tr>
			<td width="50%"><%=tools.get_web_str('c_type')%>:</td>
			<td><%=tools.get_web_str('c_state')%>:</td>
		</tr>
		<tr>
			<td><b><%=curLngCommon.event_types.GetChildByKey( curObject.type_id ).name%><b></td>
			<td><b><%=curLngCommon.event_status_types.GetChildByKey( curObject.status_id ).name%></b></td>
		</tr>
		<tr>
			<td colspan="2">&nbsp;</td>
		</tr>
<!---------------------------------------------------------------------------------------------------------------------->
<%
	switch ( curObject.type_id )
	{
		case 'real_time':
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_course')%>:</td>
			<td><%=tools.get_web_str('c_chat')%>:</td>
		</tr>
		<tr>
			<td>
<%
			try
			{
				if ( curObject.course_id.HasValue )
				{
					_cur_course = curObject.course_id.ForeignElem;
%>
					<a href="view_doc.html?mode=course_info&doc_id=<%=curDocID%>&object_id=<%=curObject.course_id%>" title="<%=tools.get_web_str('c_tip_course')%>"><%=tools_web.get_cur_lng_name( _cur_course.name )%></a>
<%
				}
			}
			catch ( ll )
			{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
			}
%>
			</td>
			<td>
<%
			try
			{
				if ( curObject.chat_id.HasValue )
				{
					_cur_chat = curObject.chat_id.ForeignElem;
%>
					<a href="view_doc.html?mode=chat&doc_id=<%=curDocID%>&object_id=<%=curObject.chat_id%>" title="<%=tools.get_web_str('c_tip_chat')%>"><%=tools_web.get_cur_lng_name( _cur_chat.name )%></a>
<%
				}
			}
			catch ( ll )
			{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
			}
%>
			</td>
		</tr>
<%
		break;


		case 'compound_program':
		case 'compound_program_elem':
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_compound_prog')%>:</td>
<%
			if ( curObject.type_id == 'compound_program_elem' )
			{
%>
			<td><%=tools.get_web_str('c_compound_prog_part')%>:</td>
<%
			}
%>
		<tr>
		</tr>
			<td width="50%">
<%
			try
			{
				if ( curObject.compound_program_id.HasValue )
				{
					_cur_compound_program = curObject.compound_program_id.ForeignElem;
%>
					<a href="view_doc.html?mode=compound_program&doc_id=<%=curDocID%>&object_id=<%=curObject.compound_program_id%>" title="<%=tools.get_web_str('c_tip_compound_prog')%>"><%=tools_web.get_cur_lng_name( _cur_compound_program.name )%></a>
<%
				}
			}
			catch ( ll )
			{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
			}
%>
			</td>
			<td>
<%
			if ( curObject.type_id == 'compound_program_elem' )
			{
				try
				{
					if ( curObject.program_id.HasValue )
					{
						_cur_program = _cur_compound_program.programs.GetChildByKey( curObject.program_id );
%>
				<b><%=tools_web.get_cur_lng_name( _cur_program.name )%></b>
<%
					}
				}
				catch ( aa )
				{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
				}
			}
%>
			</td>
		</tr>
<%
		break;



		case 'education_method':
		case 'education_method_from_program':
			_disp_education_org = false;
			_cur_education_method = null;
			try
			{
				if ( curObject.education_method_id.HasValue )
				{
					_cur_education_method = curObject.education_method_id.ForeignElem;
					_disp_education_org = ( _cur_education_method.type == 'org' );
				}
			}
			catch ( ff )
			{
			}
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_edu_method')%>:</td>
			<td>
<%
			if ( _disp_education_org )
				Response.Write( tools.get_web_str('c_edu_org') + ":" );
%>
			</td>
		</tr>
		<tr>
			<td>
<%
			try
			{
				if ( curObject.education_method_id.HasValue )
				{
					_cur_education_method = curObject.education_method_id.ForeignElem;
%>
				<b><a href="view_doc.html?mode=education_method&doc_id=<%=curDocID%>&object_id=<%=curObject.education_method_id%>" title="<%=tools.get_web_str('c_tip_edu_method')%>"><%=tools_web.get_cur_lng_name( _cur_education_method.name )%></a></b>
<%
				}
			}
			catch ( ll )
			{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
			}
%>
			</td>
			<td>
<%
			if ( _disp_education_org )
			{
				try
				{
					if ( _cur_education_method.education_org_id.HasValue )
					{
						_cur_education_org = _cur_education_method.education_org_id.ForeignElem;
%>
				<b><a href="view_doc.html?mode=education_org&object_id=<%=_cur_education_method.education_org_id%>&doc_id=<%=curDocID%>" title="<%=tools.get_web_str('c_tip_edu_org')%>"><%=tools_web.get_cur_lng_name( _cur_education_org.disp_name )%></a></b>
<%
					}
				}
				catch ( aa )
				{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
				}
			}
%>
			</td>
		</tr>
<%
		break;


		case 'one_time':
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_edu_org')%>:</td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td width="50%">
<%
			if ( curObject.education_org_type == 'id' )
			{
				try
				{
					if ( curObject.education_org_id.HasValue )
					{
						_cur_education_org = curObject.education_org_id.ForeignElem;
%>
				<a href="view_doc.html?mode=education_org&doc_id=<%=curDocID%>&object_id=<%=curObject.education_org_id%>" title="<%=tools.get_web_str('c_tip_edu_org')%>"><%=tools_web.get_cur_lng_name( _cur_education_org.disp_name )%></a>
<%
					}
				}
				catch ( aa )
				{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
				}
			}
			else
			{
%>
				<b><%=tools_web.get_cur_lng_name( curObject.education_org_name )%></b>
<%
			}
%>
			</td>
			<td>&nbsp;</td>
		</tr>
<%

		break;
		case 'webinar':
		
			_disp_education_org = false;
			_cur_education_method = null;
			try
			{
				if ( curObject.education_method_id.HasValue )
				{
					_cur_education_method = curObject.education_method_id.ForeignElem;
					_disp_education_org = ( _cur_education_method.type == 'org' );
				}
			}
			catch ( ff )
			{
			}
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_edu_method')%>:</td>
			<td>
<%
			if ( _disp_education_org )
				Response.Write( tools.get_web_str('c_edu_org') + ":" );
%>
			</td>
		</tr>
		<tr>
			<td>
<%
			try
			{
				if ( curObject.education_method_id.HasValue )
				{
					_cur_education_method = curObject.education_method_id.ForeignElem;
%>
				<b><a href="view_doc.html?mode=education_method&doc_id=<%=curDocID%>&object_id=<%=curObject.education_method_id%>" title="<%=tools.get_web_str('c_tip_edu_method')%>"><%=tools_web.get_cur_lng_name( _cur_education_method.name )%></a></b>
<%
				}
			}
			catch ( ll )
			{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
			}
%>
			</td>
			<td>
<%
			if ( _disp_education_org )
			{
				try
				{
					if ( _cur_education_method.education_org_id.HasValue )
					{
						_cur_education_org = _cur_education_method.education_org_id.ForeignElem;
%>
				<b><a href="view_doc.html?mode=education_org&object_id=<%=_cur_education_method.education_org_id%>&doc_id=<%=curDocID%>" title="<%=tools.get_web_str('c_tip_edu_org')%>"><%=tools_web.get_cur_lng_name( _cur_education_org.disp_name )%></a></b>
<%
					}
				}
				catch ( aa )
				{
%>
				<font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
				}
			}
%>
			</td>
		</tr>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_edu_org')%>:</td>
			<td>&nbsp;</td>
		</tr>
<%

		break;
	}
%>
<!---------------------------------------------------------------------------------------------------------------------->
		<tr>
			<td colspan="2"><hr/></td>
		</tr>
		<tr>
			<td width="50%">
			<%
			if(curObject.start_date.HasValue || curObject.finish_date.HasValue)
			{
			%>
				<table width="100%" cellspacing="4" cellpadding="0">
					<tr>
					<%
					if(curObject.start_date.HasValue)
					{
					%>
						<td width="140"><%=tools.get_web_str('c_start_date')%>:</td>
						<td width="20">&nbsp;</td>
						<%
						}
				if(curObject.finish_date.HasValue)
				{
						%>
						<td width="140"><%=tools.get_web_str('c_finish_date')%>:</td>
						<td>&nbsp;</td>
						<%
						}
						%>
					</tr>
					<tr>
					<%
					if(curObject.start_date.HasValue)
					{
					%>
						<td width="140"><b><%=StrDate( curObject.start_date, true, false )%></b></td>
						<td width="20">&nbsp;</td>
						<%
						}
				if(curObject.finish_date.HasValue)
				{
						%>
						<td width="140"><b><%=StrDate( curObject.finish_date, true, false )%></b></td>
						<td>&nbsp;</td>
						<%
						}
						%>
					</tr>
				</table>
				<%
				}
				%>
			</td>
			<td>
					<%
		if(curObject.duration_plan.HasValue || curObject.duration_days_plan.HasValue || curObject.duration_fact.HasValue || curObject.duration_days_fact.HasValue)
		{
					%>
				<table width="100%" cellspacing="4" cellpadding="0">
					<tr>
						<%
			if(curObject.duration_plan.HasValue || curObject.duration_days_plan.HasValue)
			{
						%>
						<td width="140"><%=tools.get_web_str('veb_duration_plan')%>:</td>
						<td width="20">&nbsp;</td>
						<%
						}
			if(curObject.duration_fact.HasValue || curObject.duration_days_fact.HasValue)
			{
						%>
						<td width="140"><%=tools.get_web_str('veb_duration_fact')%>:</td>
						<td>&nbsp;</td>
						<%
						}
						%>
					</tr>
					<tr>
						<%
			if(curObject.duration_plan.HasValue || curObject.duration_days_plan.HasValue)
			{
						%>
						<td width="140">
						<%
							if(curObject.duration_plan.HasValue)
							{
						%>
						<b><%=curObject.duration_plan%></b>&nbsp;<%=tools.get_web_str('veb_duration_hours')%>&nbsp;&nbsp;&nbsp;
						<%
							}
							if(curObject.duration_days_plan.HasValue)
							{
						%>
							<b><%=curObject.duration_days_plan%></b>&nbsp;<%=tools.get_web_str('veb_duration_days')%>
						<%
							}
						%>
						</td>
						<td width="20">&nbsp;</td>
						<%
						}
			if(curObject.duration_fact.HasValue || curObject.duration_days_fact.HasValue)
			{
						%>
						<td width="140">
						<%
			if(curObject.duration_fact.HasValue)
			{
						%>
						<b><%=curObject.duration_fact%></b>&nbsp;<%=tools.get_web_str('veb_duration_hours')%>&nbsp;&nbsp;&nbsp;
						<%
							}
			if(curObject.duration_days_fact.HasValue)
			{
						%>
						<b><%=curObject.duration_days_fact%></b>&nbsp;<%=tools.get_web_str('veb_duration_days')%></td>
						<td>&nbsp;</td>
						<%
							}
						}
						%>
					</tr>
				</table>
						<%
						}
						else
						{
							Response.Write("&nbsp;");
						}
						%>
			</td>
		</tr>
		<tr>
			<td colspan="2"><hr/></td>
		</tr>
		<tr>
			<td width="50%" colspan="2">
				<table width="100%" cellspacing="4" cellpadding="0">
					<tr>
						<td><%=tools.get_web_str('veb_max_person_num')%>:&nbsp;&nbsp;&nbsp;<b><%=curObject.person_num%></b>&nbsp&nbsp;<%=(curObject.max_person_num.HasValue) ? tools.get_web_str('c_of') + "&nbsp;<b>" + curObject.max_person_num : ""%></b></td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</td>
		</tr>
<%
		if(curObject.type_id != 'case')
		{
%>
		<tr>
			<td width="50%"><%=tools.get_web_str('c_action_place')%>:</td>
			<td width="50%"><%=tools.get_web_str('c_place')%>:</td>
		</tr>
		<tr>
			<td width="50%"><b><%=curObject.place%></b></td>
			<td width="50%"><b><a href="view_doc.html?mode=place&doc_id=<%=curDocID%>&object_id=<%=curObject.place_id%>" target="_blank"><%
				try
				{
					Response.Write( tools_web.get_cur_lng_name( curObject.place_id.ForeignElem.name ) );
				}
				catch ( ff )
				{
				}
			%></a></b></td>
		</tr>
<%
		}
%>
		<tr>
			<td width="50%">
				<table width="100%" cellspacing="0" cellpadding="0">
					<tr>
						<td width="50%"><%=tools.get_web_str('veb_date_request_begin')%>:</td>
						<td width="20">&nbsp;</td>
						<td width="50%"><%=tools.get_web_str('veb_date_request_over')%>:</td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</td>
			<td width="50%"><%=tools.get_web_str('veb_date_request_rejection_over')%>:</td>
		</tr>
		<tr>
			<td width="50%">
				<table width="100%" cellspacing="0" cellpadding="0">
					<tr>
						<td width="50%"><b><%=StrDate( curObject.date_request_begin, true, false )%></b></td>
						<td width="20">&nbsp;</td>
						<td width="50%"><b><%=StrDate( curObject.date_request_over, true, false )%><b></td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</td>
			<td width="140"><b><%=StrDate( curObject.date_request_rejection_over, true, false )%><b></td>
		</tr>
<%
		if ( _view )
		{
%>
		<tr>
			<td colspan="2">&nbsp;</td>
		</tr>
		<tr>
			<td><%=tools.get_web_str('veb_tutors')%>:</td>
			<td><%=tools.get_web_str('vllec_title')%>:</td>
		</tr>
		<tr>
			<td><b>
<%
	_str="";
			for ( _tutor in curObject.tutors )
			_str += '<a href="view_doc.html?mode=collaborator&object_id=' + _tutor.PrimaryKey + '&doc_id=' + curDocID + '">' + _tutor.person_fullname + '</a>, ';
			Response.Write(_str.substr(0,StrLen(_str) - 2));
%>
			</b></td>
			<td><b>
<%
	_str="";
			for ( _lector in _lectors_array )
			_str += '<a href="view_doc.html?mode=lector&object_id=' + _lector.PrimaryKey + '&doc_id=' + curDocID + '">' + _lector.person_fullname + '</a>, ';
//                              _str += _lector.person_fullname + ", ";
			if(StrLen(_str) > 0)
			Response.Write(_str.substr(0,StrLen(_str) - 2));
%>
			</b></td>
		</tr>
<%
		}
%>
	</table>

<%
	}
%>


</td>
</tr>
</table>

</td>
</tr>



<!-------------------------------------------------- Desc -------------------------------------------------------------------------->
<tr>
	<td>
		<br/>
		<a href="#desc" onclick="disp_block('desc_div','desc_img');" id="best"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="desc_img" border="0"/>&nbsp;<%=tools.get_web_str('c_desc')%>:</p></a>
		<div id="desc_div" style="display: inline">
<%
	if ( ! _write )
	{
		Server.Execute( "view_desc.html" );
	}
	else
	{
		Server.Execute( "view_tinymce.html" );
%>
			<textarea id="elm1" name="desc" width="100%" style="width: 100%; height: 200px;" richtext="true">
			<%=tools_web.get_web_desc( curObject.desc, UrlFromDocID( curObjectID ), "event.desc" )%>
			</textarea>
<%
	}
%>
		</div>
	</td>
</tr>
<!-------------------------------------------------- Best of Case -------------------------------------------------------------------------->
<%
if ( curObject.public_answers && curObject.type_id=="case")
{
	event_result_array = XQuery("for $elem in event_results where $elem/event_id=" + curObjectID + " and $elem/is_open=true() order by $elem/person_fullname return $elem");
%>
	<tr>
		<td>
		<br>
		<br>
		<a href="#best" onclick="disp_block('best_div','best_img');" id="best"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="best_img" border="0"/>&nbsp;<%=tools.get_web_str('vceb_best_decision')%></p></a>			

		<div id="best_div" style="display: inline">
			<table width="100%" cellspacing="0" cellpadding="4">
				<tr>
					<td class="tableHeaderWithText"><%=tools.get_web_str('c_fio')%></td>
					<td class="tableHeaderWithText"><%=tools.get_web_str('c_answer')%></td>
				</tr>
				<tr>
					<td class="tableHeaderNoText" colspan="2"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
<%
	counter = 0;

	for ( _event_result in event_result_array )
	{
		_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
		try
		{
			event_resultDoc = OpenDoc( UrlFromDocID( _event_result.PrimaryKey ) ).TopElem;
		}
		catch(err)
		{
			continue;
		}
%>
				<tr>
					<td width="20%" class="<%=_class%>">
						<%=event_resultDoc.person_fullname%>
					</td>
					<td width="80%" class="<%=_class%>">
						<%=event_resultDoc.collaborator_comment%>
					</td>
				</tr>
<%
	}
%>
			<tr>
				<td class="tableHeaderNoText" colspan="2"><img src="pics/1blank.gif" width="1" height="1" /></td>
			</tr>
		</table>
		</div>
	</td>
	</tr>
<%
	if ( _write )
	{
%>
	<tr>
		<td align="CENTER" class="activator">
				<input type="button" value="<%=tools.get_web_str('c_cancel')%>" onclick="doSubmit('cancel_public');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
		</td>
	</tr>
<%
	}
}
%>
</table>
	</div>


<div id="bm_1" <%=(_selectedTab != 1 ? 'style="display: none"' : '')%>>
<table width="100%" border="0" cellspacing="0" cellpadding="0">

<!------------------------------------------------- COLLABORATORS ----------------------------------------------------------->
<%
	if ( _write || _is_col || _requester || curObject.disp_persons_for_all )
	{
		_view_replace_person = ( _requester && ( ( curObject.date_request_over.HasValue && curObject.date_request_over > Date() ) || ! curObject.date_request_over.HasValue ) );
%>
<tr>
<td>

	<br/>
	<br/>
	<a href="#event_persons" onclick="disp_block('event_persons_div','event_persons_img');" id="event_persons"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="event_persons_img" border="0"/>&nbsp;<%=tools.get_web_str('veb_persons')%></p></a>
	<div id="event_persons_div" style="display: inline">

	<table width="100%"  border="0" cellspacing="0" cellpadding="3">
		<tr>
			<td class="tableHeaderWithText"><%=tools.get_web_str('c_fio')%></td>
			<td class="tableHeaderWithText"><%=tools.get_web_str('c_position')%></td>
			<td class="tableHeaderWithText"><%=tools.get_web_str('c_subd')%></td>
			<td class="tableHeaderWithText" width="80"><%=tools.get_web_str('veb_exist_now')%></td>
<%
		if ( _write || _is_col )
		{
%>
			<td class="tableHeaderWithText" width="80"><%=tools.get_web_str('veb_exist_confirm')%></td>
<%
		if ( _write )
		{
%>
			<td class="tableHeaderWithText"><%=tools.get_web_str('veb_response_added')%></td>
			<td class="tableHeaderWithText" width="80"><%=tools.get_web_str('veb_exist')%></td>
<%
		}
		}
%>
			<td class="tableHeaderWithText" width="20">&nbsp;</td>
<%
		if ( _view_replace_person )
		{
%>
			<td class="tableHeaderWithText" width="20">&nbsp;</td>
<%
		}
%>
		</tr>
		<tr>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		if ( _write || _is_col )
		{
%>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		if ( _write )
		{
%>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		}
		}
%>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		if ( _view_replace_person )
		{
%>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		}
%>
		</tr>

<%
		counter = 0;
		for ( _person in curObject.collaborators )
		{
			_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
%>

			<tr valign="MIDDLE">
				<td class="<%=_class%>">
<%
			if ( _write || _person.collaborator_id == curUserID )
			{
%>
					<a href="javascript: doSubmit('event_result','<%=_person.PrimaryKey%>');" title="<%=tools.get_web_str('c_tip_result')%>"><%=_person.person_fullname%></a>
<%
			}
			else
			{
				Response.Write( _person.person_fullname );
			}
%>
				</td>
				<td class="<%=_class%>"><%=tools_web.get_cur_lng_name( _person.person_position_name )%></td>
				<td class="<%=_class%>"><%=tools_web.get_cur_lng_name( _person.person_subdivision_name ) + " (" + tools_web.get_cur_lng_name( _person.person_org_name ) + ") "%></td>

				<td class="<%=_class%>" align="CENTER">
<%
				_cur_last_exist_date = curObject.collaborators.GetChildByKey( _person.collaborator_id ).last_exist_date;

				if ( _cur_last_exist_date != null && ( DateToRawSeconds( Date() ) - DateToRawSeconds( _cur_last_exist_date ) ) < 1800 )
				{
%>
				<img src="pics/vwicn082.gif" width="13" height="11" hspace="5">
<%
				}
				else
				{
%>
					&nbsp;
<%
}
%>
				</td>
<%
				if ( _write || _person.collaborator_id == curUserID )
				{
					_cur_result = ArrayOptFirstElem( XQuery( "for $elem in event_results where $elem/person_id = " + _person.PrimaryKey + " and $elem/event_id = " + curObjectID + " return $elem" ) );

					if ( _cur_result != undefined )
					{
%>
				<td class="<%=_class%>" align="CENTER">
					<a href="javascript: doSubmit('change_confirm','<%=_cur_result.PrimaryKey%>');" title="<%=tools.get_web_str('veb_tip_exist_confirm')%>">
<%
						if ( _cur_result.is_confirm )
						{
%>
						<img src="pics/vwicn082.gif" width="13" height="11" hspace="5" border="0">
<%
						}
						else
						{
%>
						<img src="pics/no.gif" width="13" height="11" hspace="5" border="0">
<%
						}
%>
					</a>
				</td>
<%
						if ( _write )
						{
%>
				<td class="<%=_class%>" align="CENTER">
<%
	_res = XQuery( "for $elem in responses where $elem/object_id = " + curObjectID + " and $elem/person_id = " + _person.collaborator_id + " return $elem" );
							if ( ArrayCount(_res) > 0)
							{
%>
						<img src="pics/vwicn082.gif" width="13" height="11" hspace="5" border="0">
<%
							}
							else
							{
%>
						<img src="pics/no.gif" width="13" height="11" hspace="5" border="0">
<%
							}
%>
				</td>
				<td class="<%=_class%>" align="CENTER">
					<a href="javascript: doSubmit('change_assist','<%=_cur_result.PrimaryKey%>');" title="<%=tools.get_web_str('veb_exist_change')%>">
<%
						if ( _cur_result.is_assist )
						{
%>
						<img src="pics/vwicn082.gif" width="13" height="11" hspace="5" border="0">
<%
						}
						else
						{
%>
						<img src="pics/no.gif" width="13" height="11" hspace="5" border="0">
<%
						}
%>
					</a>
				</td>
<%
					}
					}
					else
					{
%>
				<td class="<%=_class%>" align="CENTER">&nbsp;</td>
				<td class="<%=_class%>" align="CENTER">&nbsp;</td>
				<td class="<%=_class%>" align="CENTER">&nbsp;</td>
<%
					}
				}
		else if ( _is_col )
		{
%>
				<td class="<%=_class%>" align="CENTER">&nbsp;</td>
<%
				}

%>
				<td class="<%=_class%>" align="CENTER"><a href="view_doc.html?mode=collaborator&object_id=<%=_person.PrimaryKey%>&doc_id=<%=curDocID%>" title="<%=tools.get_web_str('c_tip_coll')%>"><img src="pics/person.gif" border="0"></a></td>
<%
		if ( _view_replace_person )
		{
%>
				<td class="<%=_class%>" align="CENTER">
<%
			if ( _person.request_person_id == curUserID )
			{
%>
					<a href="#" onclick="doSubmit('replace_collaborator','<%=_person.PrimaryKey%>');" title="<%=tools.get_web_str('veb_replace_coll')%>"><img src="pics/refresh.ico" border="0"/></a>
					&nbsp;
					<a href="#" onclick="if (window.confirm('<%=tools.get_web_str('veb_delete_coll_confirm_part1')%> <%=_person.person_fullname%> <%=tools.get_web_str('veb_delete_coll_confirm_part2')%> ')) doSubmit('delete_collaborator','<%=_person.PrimaryKey%>');" title="<%=tools.get_web_str('veb_delete_coll')%>"><img src="pics/Delete_3.gif" border="0"/></a>
<%
			}
			else
			{
				Response.Write( '\&nbsp;' );
			}
%>
				</td>
<%
		}
%>
			</tr>
<%
			}
%>
		<tr>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		if ( _write || _is_col )
		{
%>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		if ( _write )
		{
%>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
			}
		}
%>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		if ( _view_replace_person )
		{
%>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
		}
%>
		</tr>
	</table>
<%
	if ( _write )
	{
%>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
		<td align="CENTER" class="activator">
			<input type="button" value="<%=tools.get_web_str('veb_b7')%>" onclick="doSubmit('change_collaborators');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
		</td>
	</table>
<%
	}
%>
<br/>
<%
	if ( _write )
	{
%>
	<%=tools.get_web_str("veb_unnamed_person_num")%>:&nbsp;&nbsp;&nbsp;
		<input type="TEXT" name="unnamed_person_num" id="unnamed_person_num_id" value="<%=curObject.unnamed_person_num%>" class="inputEdit" style="width:60">
<%
	}
	else if(curObject.unnamed_person_num.HasValue)
	{
%>

	<%=tools.get_web_str("veb_unnamed_person_num")%>:&nbsp;&nbsp;&nbsp;
	<b><%=curObject.unnamed_person_num%><b>
<%
	}

	if ( curObject.tutors.ChildByKeyExists( curUserID ) || _is_lector )
	{

%>
		<br/>
		<%=tools.get_web_str("veb_group_formed")%>:&nbsp;&nbsp;&nbsp;
		<input type="CHECKBOX" name="group_formed" onclick="
			if ( this.checked )
			{
				var person_num = document.getElementById('unnamed_person_num_id');
				var max_person_num = document.getElementById('max_person_num_id');
				var min_person_num = document.getElementById('min_person_num_id');

				person_num = person_num ? parseInt(person_num.value) : 0;
				person_num = <%=ArrayCount( curObject.collaborators )%> + ( person_num == NaN ? 0 : person_num );
				max_person_num = max_person_num ? parseInt(max_person_num.value) : '';
				max_person_num = max_person_num == NaN ? '' : max_person_num;
				min_person_num = min_person_num ? parseInt(min_person_num.value) : '';
				min_person_num = min_person_num == NaN ? '' : min_person_num;

				if ( ( ( max_person_num == '' || person_num &lt;= max_person_num ) &amp;&amp; ( min_person_num == '' || person_num &gt;= min_person_num ) )
					||
					confirm(<%=CodeLiteral(XmlAttrEncode(tools.get_web_str('veb_grf_restrict')))%>) )
				{
					alert(<%=CodeLiteral(XmlAttrEncode(tools.get_web_str('veb_group_formed_notification')))%>);
				}
				else
				{
					this.checked = false;
				}
			}
		" <%=( curObject.group_formed ? 'checked' : '' )%> />

<%
	}
%>
	</div>

</td>
</tr>

<%
	}
%>



<!------------------------------------------------- TUTORS ----------------------------------------------------------->
<%
	if ( _write )
	{
%>
<tr>
<td>

	<br/>
	<br/>
	<a href="#event_tutors" onclick="disp_block('event_tutors_div','event_tutors_img');" id="event_tutors"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="event_tutors_img" border="0"/>&nbsp;<%=tools.get_web_str('veb_tutors')%></p></a>
	<div id="event_tutors_div" style="display: inline">

	<table width="100%"  border="0" cellspacing="0" cellpadding="3">
		<tr>
			<td class="tableHeaderWithText"><%=tools.get_web_str('c_fio')%></td>
			<td class="tableHeaderWithText"><%=tools.get_web_str('c_position')%></td>
			<td class="tableHeaderWithText"><%=tools.get_web_str('c_subd')%></td>
			<td class="tableHeaderWithText" width="20">&nbsp;</td>
		</tr>
		<tr>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
		</tr>

<%
		counter = 0;
		for ( _person in curObject.tutors )
		{
			_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
%>
			<tr valign="MIDDLE">
				<td class="<%=_class%>"><a href="view_doc.html?mode=collaborator&object_id=<%=_person.PrimaryKey%>&doc_id=<%=curDocID%>" title="<%=tools.get_web_str('c_tip_coll')%>"><%=_person.person_fullname%></a></td>
				<td class="<%=_class%>"><%=tools_web.get_cur_lng_name( _person.person_position_name )%></td>
				<td class="<%=_class%>"><%=tools_web.get_cur_lng_name( _person.person_subdivision_name )%></td>
				<td class="<%=_class%>" align="CENTER"><a href="view_doc.html?mode=collaborator&object_id=<%=_person.PrimaryKey%>&doc_id=<%=curDocID%>" title="<%=tools.get_web_str('c_tip_coll')%>"><img src="pics/person.gif" border="0"></a></td>
			</tr>
<%
		}
%>
		<tr>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
		</tr>
	</table>

	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
		<td align="CENTER" class="activator">
			<input type="button" value="<%=tools.get_web_str('veb_b7')%>" onclick="doSubmit('change_tutors');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
		</td>
	</table>

	</div>

</td>
</tr>
<%
	}
%>


<!---------------------------------------------- LECTORS ----------------------------------------------------------------->
<tr>
<td>

	<br/>
	<br/>
	<a href="#event_lectors" onclick="disp_block('event_lectors_div','event_lectors_img');" id="event_lectors"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="event_lectors_img" border="0"/>&nbsp;<%=tools.get_web_str('vllec_title')%></p></a>
	<div id="event_lectors_div" style="display: inline">
	<table width="100%" class="tableBasic" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td class="tableHeaderTextLeft"><img src="pics/1blank.gif" width="1" height="1"/></td>
		<td class="tableHeaderText" colspan="3" width="100%">
			<table width="100%" border="0" cellspacing="0" cellpadding="0">
				<tr>
					<td width="100%"><p class="tableHeaderTextInner"></p></td>
				</tr>
			</table>
		</td>
		<td class="tableHeaderTextRight"><img src="pics/1blank.gif" width="1" height="1"/></td>
	</tr>
	<tr>
		<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
		<td class="tableHeaderWithText" width="60%"><%=tools.get_web_str('c_fio')%></td>
		<td class="tableHeaderWithText" width="60"><%=tools.get_web_str('c_type')%></td>
		<td class="tableHeaderWithText" width="60"><%=tools.get_web_str('c_hour_duration')%></td>
		<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
	</tr>
	<tr>
		<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
		<td class="tableHeaderNoText" colspan="3"><img src="pics/1blank.gif" width="1" height="1" /></td>
		<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
	</tr>
<%
		counter = 0;
		for ( _lector in _lectors_array )
		{
			_class = counter % 2 ? 'tableRowEven' : 'tableRowOdd';
			_classl = counter % 2 ? 'tableRowEvenLeft' : 'tableRowOddLeft';
			_classr = counter % 2 ? 'tableRowEvenRight' : 'tableRowOddRight';
			counter++
%>
		<tr>
			<td class="<%=_classl%>"></td>
			<td class="<%=_class%>"><a href="view_doc.html?mode=lector&object_id=<%=_lector.id%>&doc_id=<%=curDocID%>"><%=_lector.person_fullname%></a></td>
			<td class="<%=_class%>"><%=( _lector.type == "invitee" ? tools.get_web_str('c_lector_invitee') : tools.get_web_str('c_lector_coll') )%></td>
<%
			_lector_hours = curObject.lectors.GetChildByKey( _lector.id ).hours;
			if ( _write )
			{
%>
			<td class="<%=_class%>"><input type="text" name="hours_<%=_lector.id%>" class="inputEdit" style="width:30px " value="<%=_lector_hours%>"></td>
<%
			}
			else
			{
%>
			<td class="<%=_class%>"><%=_lector_hours%>&nbsp;</td>
<%
			}
%>
			<td class="<%=_classr%>"></td>
		</tr>
		<%
		}
		%>
	<tr>
		<td class="tableFooterLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
		<td class="tableFooter" colspan="3"><img src="pics/1blank.gif" width="1" height="1" /></td>
		<td class="tableFooterRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
	</tr>
</table>

<%
	if ( _write )
	{
%>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
		<td align="CENTER" class="activator">
			<input type="button" value="<%=tools.get_web_str('veb_b7')%>" onclick="doSubmit('change_lectors');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
		</td>
	</table>
<%
	}
%>
	</div>

</td>
</tr>

<!-- ============================================ PREPARATIONS ===================================================== -->
<%
	if ( _write || _is_beginer )
	{
%>

<tr>
<td>

	<br/>
	<br/>
	<a href="#even_preparations" onclick="disp_block('even_preparations_div','even_preparations_img');" id="even_preparations"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="even_preparations_img" border="0"/>&nbsp;<%=tools.get_web_str('veb_preparation')%></p></a>
	<div id="even_preparations_div" style="display: inline">

	<table width="100%"  border="0" cellspacing="0" cellpadding="3">
			<tr>
				<td class="tableHeaderWithText"><%=tools.get_web_str('c_fio')%></td>
				<td class="tableHeaderWithText" width="100"><%=tools.get_web_str('c_plan_date')%></td>
				<td class="tableHeaderWithText" width="100"><%=tools.get_web_str('c_fact_date')%></td>
				<td class="tableHeaderWithText" width="100"><%=tools.get_web_str('c_status')%></td>
				<td class="tableHeaderWithText"><%=tools.get_web_str('c_desc')%></td>
				<td class="tableHeaderWithText"><%=tools.get_web_str('veb_preparation_comment')%></td>
				<td class="tableHeaderWithText" width="20">&nbsp;</td>
			</tr>
			<tr>
				<td class="tableHeaderNoText" colspan="7"><img src="pics/1blank.gif" width="1" height="1" /></td>
			</tr>
<%
			counter = 0;
			for ( _even_preparation in curObject.even_preparations )
			{
				_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
%>
			<tr valign="MIDDLE">
				<td class="<%=_class%>">
<%
				if ( _write || curUserID == _even_preparation.person_id )
				{
%>
					<a href="javascript: doSubmit('event_preparation','<%=_even_preparation.PrimaryKey%>');" title="<%=tools.get_web_str('veb_tip_preparation')%>"><%=_even_preparation.person_fullname%></a>
<%
				}
				else
				{
					Response.Write( _even_preparation.person_fullname );
				}
%>
				</td>
				<td class="<%=_class%>" align="CENTER"><%=StrDate( _even_preparation.plan_date, true, false )%></td>
				<td class="<%=_class%>" align="CENTER"><%=StrDate( _even_preparation.fact_date, true, false )%></td>
				<td class="<%=_class%>" align="CENTER"><%=curLngCommon.event_status_types.GetChildByKey( _even_preparation.status_id ).name%></td>
				<td class="<%=_class%>" align="CENTER"><%=_even_preparation.comment%></td>
				<td class="<%=_class%>" align="CENTER"><%=_even_preparation.comment_person%></td>
				<td class="<%=_class%>" align="CENTER"><a href="view_doc.html?mode=collaborator&object_id=<%=_even_preparation.person_id%>&doc_id=<%=curDocID%>" title="<%=tools.get_web_str('c_tip_coll')%>"><img src="pics/person.gif" border="0"></a></td>
			</tr>
<%
			}
%>
			<tr>
				<td class="tableFooter" colspan="7"><img src="pics/1blank.gif" width="1" height="1" /></td>
			</tr>
	</table>
<%
			if ( _write )
			{
%>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
			<td align="CENTER" class="activator">
				<input type="button" value="<%=tools.get_web_str('veb_add')%>" onclick="doSubmit('add_preparation');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
			</td>
		</table>
<%
			}
%>
	</div>
</td>
</tr>
<%
	}
%>

</table>
</div>

<!---------------------------------------------- MATERIALS ----------------------------------------------------------------->
<div id="bm_2" <%=(_selectedTab != 2 ? 'style="display: none"' : '')%>>
<table width="100%" border="0" cellspacing="0" cellpadding="0">

<!---------------------------------------------- FILES ----------------------------------------------------------------->
<tr>
<td>

<br/>
<%
/*_write = ( curUser.access.access_role == 'admin' || curObject.tutors.ChildByKeyExists( curUserID ) );
_is_col = curObject.collaborators.ChildByKeyExists( curUserID );
_is_beginer = ArrayOptFindByKey( curObject.even_preparations, curUserID, 'person_id' ) != undefined;*/

_files=ArraySelect(curObject.files,'visibility == "all"')
if (_is_col)
{
	_files=ArrayUnion(_files,ArraySelect(curObject.files,'visibility == "participants"'))
}
if (_write)
{
	_files=ArrayUnion(_files,ArraySelect(curObject.files,'visibility == "responsible"'))
}
Server.Execute( "view_files.html" )
%>

</td>
	</tr>
<%
	if ( _write )
		{
%>
	<tr>
<td>
<br/>
	<table width="100%" cellspacing="0" cellpadding="0"  class="tableBorder" border="0">
		<tr>
			<td align="left">
<%
				UseAjaxUpload=false;
				Server.Execute('view_file_add.html');
%>
			</td>
		</tr>
		<tr>
			<td align="left">
			<nobr>&nbsp;Видимость:&nbsp;<select id="add_file_visibility" name="add_file_visibility" class="inputEdit">
			<%
			for ( _visibility_type in curLngCommon.event_file_visibility_types )
			{
			%>
				<option value="<%=_visibility_type.PrimaryKey%>"><%=_visibility_type.name%></option>
			<%
			}
			%>
			</select></nobr>
		</td>
		</tr>
		<tr>
			<td align="center"><input type="button" id="add_file_post" value="<%=tools_web.get_web_str('vdb_upload')%>" onclick="doSubmit('add_file');" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
		</tr>
	</table>
</td>
	</tr>
	<tr>
<td>

	<br/>
	<br/>
	<a href="#material_info" onclick="disp_block('material_info_div','material_info_img');" id="material_info"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/plus.jpg" id="material_info_img" border="0"/>&nbsp;<%=tools.get_web_str('c_materials')%></p></a>
	<div id="material_info_div" style="display: none">

	<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_mat_url')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="main_material_url" class="inputEdit" style="width:400px " value="<%=HtmlEncode( curObject.main_material_url )%>"></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_mat_w')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="main_material_width" class="inputEdit" value="<%=curObject.main_material_width%>"></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_mat_h')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="main_material_height" class="inputEdit" value="<%=curObject.main_material_height%>"></td>
	</tr>
<%
		if ( curObject.type_id == 'real_time' )
		{
%>
		<tr>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td style=" font-weight:normal"><input type="checkbox" name="use_video" <%=( curObject.use_video ? 'checked' : '' )%>><%=tools.get_web_str('veb_video_disp')%></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_video_url')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="video_url" class="inputEdit" style="width:400px " value="<%=HtmlEncode( curObject.video_url )%>"></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_login')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="video_login" class="inputEdit" value="<%=HtmlEncode( curObject.video_login )%>"></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_pass')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="video_password" class="inputEdit" value="<%=HtmlEncode( curObject.video_password )%>"></td>
		</tr>
		<tr>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td style=" font-weight:normal"><input type="checkbox" name="use_audio" <%=( curObject.use_audio ? 'checked' : '' )%>><%=tools.get_web_str('veb_audio_disp')%></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_audio_url')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="audio_url" class="inputEdit" style="width:400px " value="<%=HtmlEncode( curObject.audio_url )%>"></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_audio_name')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="audio_channel_login" class="inputEdit" value="<%=HtmlEncode( curObject.audio_channel_login )%>"></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_audio_pass')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="audio_channel_password" class="inputEdit" value="<%=HtmlEncode( curObject.audio_channel_password )%>"></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_login')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="audio_login" class="inputEdit" value="<%=HtmlEncode( curObject.audio_login )%>"></td>
		</tr>
		<tr>
			<td align="RIGHT"><%=tools.get_web_str('veb_pass')%>:</td>
			<td style=" font-weight:normal"><input type="text" name="audio_password" class="inputEdit" value="<%=HtmlEncode( curObject.audio_password )%>"></td>
		</tr>
<%
			}
%>
<!--                <TR>
			<TD colspan="2">&nbsp;</TD>
		</TR>
		<TR>
			<TD colspan="2" WIDTH="250" ALIGN="RIGHT"><%=tools.get_web_str('c_desc')%>:</TD>
			<TD STYLE=" font-weight:normal"><TEXTAREA ROWS="2" COLS="50" name="desc" id="desc" CLASS="inputTextarea" STYLE="width: 600px; height: 100px;"><%=curObject.desc%></TEXTAREA></TD>
		</TR>-->
	</table>

	</div>

</td>
</tr>
<%
			}
%>
</table>
</div>
<div id="bm_3"  <%=(_selectedTab != 3 ? 'style="display: none"' : '')%>>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<%
	if ( _write || ArrayCount( curObject.custom_elems ) != 0 )
			{
%>
<!------------------------------------------------ Custom elems ----------------------------------------------------------------->
<tr>
<td>

	<br/>
	<br/>
	<a href="#event_additional" onclick="disp_block('event_additional_div','event_additional_img');" id="event_additional"><p class="headerText" style="margin-top:10px; margin-bottom:10px;"><img src="pics/minus.jpg" id="event_additional_img" border="0"/>&nbsp;<%=tools.get_web_str('c_additional')%></p></a>
	<div id="event_additional_div" style="display: inline">

<%
		readOnly = true;
		Server.Execute( "view_custom_templates.html" );
%>

	</div>

</td>
	</tr>
<%
		}
%>
</table>
</div>


		</td>
	</tr>
</table>
</form>