<%
	curPreparationID = Request.QueryString.event_preparation_id;
	curPreparation = curObject.even_preparations.GetChildByKey( curPreparationID );

	_write = ( curUser.access.access_role == 'admin' || curObject.tutors.ChildByKeyExists( curUserID ) );
	_is_beginer = ( curUserID == curPreparation.person_id );
%>
<script src="scripts\calendar\calendar.js"></script>
<script language="javascript">
function doDelete()
{
	document.forms["preparation_form"].elements["action"].value = 'delete';
	document.forms["preparation_form"].submit();
}
</script>
<form action="event_preparation_change.html" name="preparation_form" method="POST">
	<input type="hidden" name="doc_id" value="<%=curDocID%>">
	<input type="hidden" name="sid" value="<%=tools.get_sum_sid( curDocID )%>">
	<input type="hidden" name="object_id" value="<%=curObjectID%>">
	<input type="hidden" name="event_preparation_id" value="<%=curPreparationID%>">
	<input type="hidden" name="action" value="">
	
<table width="100%" cellspacing="0" cellpadding="4">		
	<tr>
		<td width="200"><b><%=tools.get_web_str('c_coll')%>:</b></td>
		<td><%=curPreparation.person_fullname%></td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('c_event')%>:</b></td>
		<td><%=tools_web.get_cur_lng_name( curObject.name )%></td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('c_plan_date')%>:</b></td>
		<td>
<%
	sDate = StrDate( curPreparation.plan_date, true, false );
	Response.Write( ( _write ? tools_web.draw_calendar('plan_date',sDate,'dd.mm.yyyy') : sDate ) );
%>
		</td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('c_fact_date')%>:</b></td>
		<td>
<%
	sDate = StrDate( curPreparation.fact_date, true, false );
	Response.Write( ( _write ? tools_web.draw_calendar('fact_date',sDate,'dd.mm.yyyy') : sDate ) );
%>
		</td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('c_status')%>:</b></td>
		<td><select NAME="status_id">
<%
		for ( _status in curLngCommon.event_status_types )
		{
%>
			<OPTION VALUE="<%=_status.PrimaryKey%>"><%=_status.name%></OPTION>
<%
		}
%>
		</select>
<SCRIPT language="JavaScript">
selcur=document.forms['preparation_form'].elements['status_id'];
selcur.selectedIndex=-1;
for (i=0;i<selcur.options.length;i++)
    if (selcur.options[i].value=="<%=curPreparation.status_id%>") {
        selcur.selectedIndex=i;
	}
</SCRIPT>
		</td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('c_desc')%>:</b></td>
		<td><textarea name="comment" class="inputTextarea" style="width: 500px; height: 100px;" <%=( _write ? '' : 'readonly' )%>><%=curPreparation.comment%></textarea></td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('veb_preparation_comment')%>:</b></td>
		<td><textarea name="comment_person" class="inputTextarea" style="width: 500px; height: 100px;" <%=( _is_beginer ? '' : 'readonly' )%>><%=curPreparation.comment_person%></textarea></td>
	</tr>
</table>

	
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
	<td align="CENTER" class="activator">
		<input type="submit" value="<%=tools.get_web_str('c_save')%>" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
<%
	if ( _write )
	{
%>
		&nbsp;&nbsp;&nbsp;
		<input type="button" value="<%=tools.get_web_str('c_delete')%>" onclick="doDelete();" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
<%
	}
%>
	</td>
</table>	

</form>