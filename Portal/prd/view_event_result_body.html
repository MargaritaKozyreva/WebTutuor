<%
	curEvent = OpenDoc( UrlFromDocID( curObject.event_id ) ).TopElem;

	_write = ( curUser.access.access_role == 'admin' || curEvent.tutors.ChildByKeyExists( curUserID ) );
	_is_col = ( curUserID == curObject.person_id );
%>

<script>
<!--
function doSubmit() 
{
	try
	{
		val = document.getElementById( 'score' ).value;
		if ( val != '' )
			parseInt( val );
			
		document.event_form.submit();
	}
	catch ( e )
	{
		alert( "<%=tools.get_web_str('veresb_error1')%>" );
	}	
}
//-->
</script>

<form action="event_result_change.html" name="event_form" method="POST">
	<input type=hidden name="doc_id" value="<%=curDocID%>">
	<input type=hidden name="sid" value="<%=tools.get_sum_sid( curDocID )%>">
	<input type=hidden name="object_id" value="<%=curObjectID%>">
	
<table width="100%" cellspacing="0" cellpadding="4">		
	<tr>
		<td width="200"><b><%=tools.get_web_str('c_coll')%>:</b></td>
		<td><a href="view_doc.html?mode=person&doc_id=<%=curDocID%>&object_id=<%=curObject.person_id%>"><%=curObject.person_fullname%></a></td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('c_event')%>:</b></td>
		<td><a href="view_doc.html?mode=event&doc_id=<%=curDocID%>&object_id=<%=curObject.event_id%>"><%=tools_web.get_cur_lng_name( curEvent.name )%></a></td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('veresb_exist')%>:</b></td>		
		<td>
<%
	if ( _write )
	{
%>
			<input type="checkbox" name="is_assist" <%=( curObject.is_assist ? 'checked' : '' )%>>
<%
	}
	else if ( curObject.is_assist )
	{
%>
			<img src="pics/vwicn082.gif" width="13" height="11" hspace="5">
			<input type="hidden" name="is_assist">			
<%
	}
%>
		</td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('veb_exist_confirm')%>:</b></td>		
		<td>
<%
	if ( _write )
	{
%>
			<input type="checkbox" name="is_confirm" <%=( curObject.is_confirm ? 'checked' : '' )%>>
<%
	}
	else if ( curObject.is_confirm )
	{
%>
			<img src="pics/vwicn082.gif" width="13" height="11" hspace="5">
			<input type="hidden" name="is_confirm">			
<%
	}
%>
		&nbsp;</td>
	</tr>
	<tr>
		<td width="200"><b><%=tools.get_web_str('veb_text4')%>:</b></td>
		<td>
<%
	if ( _write )
	{
%>
			<input type="checkbox" name="is_open" <%=( curObject.is_open ? 'checked' : '' )%>>
<%
	}
	else if ( curObject.is_open )
	{
%>
			<img src="pics/vwicn082.gif" width="13" height="11" hspace="5">
			<input type="hidden" name="is_open">			
<%
	}
%>
		&nbsp;</td>
	</tr>	
	<tr>
		<td width="200"><b><%=tools.get_web_str('veresb_score')%>:</b></td>
		<td><input type="text" id="score" name="score" class="inputEdit" value="<%=curObject.score%>" <%=( _write ? '' : 'readonly' )%>></td>
	<tr>
		<td width="200"><b><%=tools.get_web_str('veresb_t_comment')%>:</b></td>
		<td><textarea name="tutor_comment" id="tutor_comment" class="inputTextarea" style="width: 500px; height: 100px;" <%=( _write ? '' : 'readonly' )%>><%=curObject.tutor_comment%></textarea></td>
	</tr>
	<tr>
		<td width="200"><b><%=curEvent.type_id == "case" ? tools.get_web_str('veresb_case_answer') : tools.get_web_str('veresb_p_comment') %>:</b></td>
		<td><textarea name="collaborator_comment" id="collaborator_comment" class="inputTextarea" style="width: 500px; height: 100px;" <%=( _is_col ? '' : 'readonly' )%>><%=curObject.collaborator_comment%></textarea></td>
	</tr>
<%
		readOnly = true;
		dispTable = false;
		leftStyle = 'text-align:left; width:200px; font-weight:bold';
		Server.Execute( "view_custom_templates.html" );
%>
</table>

	
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
	<td align="CENTER" class="activator">
		<input type="button" value="<%=tools.get_web_str('c_save')%>" onclick="doSubmit();" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
	</td>
</table>
<br/>


<%
	curView = new Object;
	curView.SetProperty( 'catalog_name', 'active_test_learning' );
	curView.SetProperty( 'disp_link', '' + _is_col );
	curView.SetProperty( 'xquery_qual', '$elem/event_id = ' + curObject.event_id + ' and $elem/person_id = ' + curObject.person_id );
	curView.SetProperty( 'link_mode', 'test_learning_proc' );
	curView.SetProperty( 'link_prop', '="&assessment_id=" + ListElem.assessment_id' );
	curView.SetProperty( 'link_field_index', 2 );
	curView.SetProperty( 'sort_index', 3 );
	curView.SetProperty( 'sort_direct', '-' );

	Server.Execute( "view_catalog_list.html" );
%>

</form>