<script src="scripts\tree\ua000000.js"></script>
<script src="scripts\tree\ftiens40.js"></script>
<script language="javascript">
<!--
USETEXTLINKS = 1;
STARTALLOPEN = 0;
USEFRAMES = 0;
USEICONS = 0;
WRAPTEXT = 1;
PRESERVESTATE = 1;
ICONPATH = "scripts/tree/";

foldersTree = gFld("<b><%=tools_web.get_web_str('c_classifiers')%></b>", '');
<%
xarrExpertQuestions = XQuery("for $elem in expert_questions where $elem/is_disclosed = true() and $elem/knowledge_parts != null() return $elem");

arrOfIntIDs = Array();
for (catQuestionElem in xarrExpertQuestions)
	arrOfIntIDs = ArrayUnion(arrOfIntIDs, String(catQuestionElem.knowledge_parts).split(";"));
	
arrOfIntIDs = ArraySelectDistinct(arrOfIntIDs, "This");
for (var _i =0; _i < ArrayCount(arrOfIntIDs); _i++)
if (arrOfIntIDs[_i] != "")
	arrOfIntIDs[_i] = Int(arrOfIntIDs[_i]);

sPartsList = "";
_sHref = "view_doc.html?mode=" + curMode + "&doc_id=" + curDocID + "&object_id=";

xarrMyKnowledgesPack = QueryCatalogByKeys("knowledge_parts", "id", arrOfIntIDs);

/*
aClassifierPack = Array();
aKnowledgePack = Array();
function getList(iKnowledgeIDParam)
{
	var _arrObjz = Array();
	
	for (commonKnowledgePartsObject in common.knowledge_parts_objects)
	{
		_arrObjz = ArrayUnion(_arrObjz,  XQuery ( 'for $obj in ' + commonKnowledgePartsObject.PrimaryKey + 's where contains($obj/knowledge_parts, \'' + iKnowledgeIDParam + '\') return $obj' ) );
	}
	 return _arrObjz;
}
function placeknowledgeBranch(catKnowledgeParam, sParentNodeParent, catKnowledgeClassifierParam)
{
	var branchName;
	if (ArrayOptFind(xarrMyKnowledgesPack, "PrimaryKey == " + catKnowledgeParam.PrimaryKey) != undefined)
	{
		if (ArrayOptFind(aClassifierPack, "This == " + catKnowledgeClassifierParam.id) == undefined)
		{
			aClassifierPack[ArrayCount(aClassifierPack)] = catKnowledgeClassifierParam.id;
			branchName = HtmlEncode(catKnowledgeClassifier.name);
			Response.Write("var C" + catKnowledgeClassifierParam.id + ' = insFld( foldersTree, gFld("'+branchName+'", "view_doc.html?mode=knowledge_classifier&doc_id='+curDocID+'&object_id=' + catKnowledgeClassifier.id + '"));');
		}
		
		sPartsList += catKnowledgeParam.id + ";"
		branchName = HtmlEncode(catKnowledgeParam.name);
		if (curObjectID == catKnowledgeParam.id)
			branchName = "<b>" + branchName + "</b>";
		Response.Write("var P" + catKnowledgeParam.id +" = insFld( " + (sParentNodeParent != null ?  sParentNodeParent : (catKnowledgeClassifierParam != null ? "C"+catKnowledgeClassifierParam.id: "foldersTree")) + ' , gFld("'+branchName+'", "' + _sHref + catKnowledgeParam.id+ '")); \n');
		sParentNodeParent = "P"+catKnowledgeParam.id;
		aKnowledgePack[ArrayCount(aKnowledgePack)] = catKnowledgeParam;
	}
	var carrDescKnowledges = XQuery("for $elem in knowledge_parts where $elem/parent_object_id = " + catKnowledgeParam.id + " return $elem");
		for (catDescKnowledge in carrDescKnowledges) placeknowledgeBranch(catDescKnowledge, sParentNodeParent, catKnowledgeClassifierParam);
	
}
function __and(_aSpecie1Param, _aSpecie2Param)
{
	_aSpecie1Param = ArraySort(_aSpecie1Param, "PrimaryKey", "+");_aSpecie2Param = ArraySort(_aSpecie2Param, "PrimaryKey", "+");
	var _aHybrid = Array();var _ac1 = ArrayCount(_aSpecie1Param);var _ac2 = ArrayCount(_aSpecie2Param);var _i=0; var _j=0; var _k=0;

	while (_i < _ac1 &&_j < _ac2)
	{
		if (_aSpecie1Param[_i].PrimaryKey == _aSpecie2Param[_j].PrimaryKey)
		{
			_aHybrid[_k] = _aSpecie1Param[_i];_i++;_j++;_k++;
		}
		else if (_aSpecie1Param[_i].PrimaryKey > _aSpecie2Param[_j].PrimaryKey) _j++;else _i++;
	}
	
	return _aHybrid;
}
for (catKnowledgeClassifier in knowledge_classifiers)
{
	xarrKnowledgePack = XQuery("for $elem in knowledge_parts where $elem/knowledge_classifier_id = " + catKnowledgeClassifier.id + " and $elem/parent_object_id = null() return $elem");
	for (catKnowledge in xarrKnowledgePack) placeknowledgeBranch(catKnowledge, null, catKnowledgeClassifier);
}
*/

xarrKnowledgeClassifiers = QueryCatalogByKeys("knowledge_classifiers", "id", ArrayExtract(ArraySelectDistinct(xarrMyKnowledgesPack,"knowledge_classifier_id"), "knowledge_classifier_id"));
var branchNam;
xarrKnowledgeClassifiers = ArraySort(xarrKnowledgeClassifiers, "name", "+");
xarrMyKnowledgesPack = ArraySort(xarrMyKnowledgesPack, "name", "+");
for (catKnowledgeClassifierElem in xarrKnowledgeClassifiers)
{
	branchNam = HtmlEncode(catKnowledgeClassifierElem.name);
	Response.Write("var C" + catKnowledgeClassifierElem.id + ' = insFld( foldersTree, gFld("'+branchNam+'", "view_doc.html?mode=knowledge_classifier&doc_id='+curDocID+'&object_id=' + catKnowledgeClassifierElem.id + '"));');
	
	for (catKnowledgeElem in ArraySelect(xarrMyKnowledgesPack, "knowledge_classifier_id == " + catKnowledgeClassifierElem.id))
	{
		branchNam = HtmlEncode(catKnowledgeElem.name);
		if (curObjectID == catKnowledgeElem.id)
			branchNam = "<b>" + branchNam + "</b>";
		Response.Write("var P" + catKnowledgeElem.id +' = insFld(' + ("C" + catKnowledgeClassifierElem.id) + ', gFld("'+branchNam+'", "' + _sHref + catKnowledgeElem.id+ '")); \n');
	}
}


%>
-->
</script>
<table width="100%" border="0">
<tr>
	<td width="300px" valign="top">
		<span class="TreeviewSpanArea" style="overflow:auto; width:100%">
			<script>initializeDocument();</script>
		</span>
	</td>
	<td valign="top">
<%
	if (curObjectID != null && curObject.Name == "knowledge_part")
	{
		arrOfCatSelected = ArraySelect(xarrExpertQuestions, "StrContains(knowledge_parts, "+CodeLiteral(curObjectID)+")");
		for (catQuestion in arrOfCatSelected)
		{
			teQuestion = OpenDoc(UrlFromDocID(catQuestion.id)).TopElem;
			catExpert = teQuestion.expert_id.OptForeignElem;
%>
			<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
			<tr>
				<td width="100" align="left"><%=tools.get_web_str('c_question')%>:</td>
			</tr>
			<tr>
				<td style="font-weight:normal"><%=teQuestion.question%></td>
			</tr>
			</table>
			<table>
				<tr>
					<td style="font-weight:bold"><%=tools_web.get_web_str('veqb_expert_answer') + " " + (catExpert != undefined ? catExpert.person_fullname : "-")%>:</td>
				</tr>
				<tr>
					<td><%=teQuestion.answer%></td>
				</tr>
			</table>
			<br/><br/>
<%
		}
	}
%>
	</td>
</tr>
</table>