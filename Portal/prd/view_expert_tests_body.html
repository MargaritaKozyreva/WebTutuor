<%
xarrTests = XQuery( "for $elem in assessment_collaborators where $elem/person_id = " + curUserID + " and $elem/type = 'expert' return $elem" );

xarrTestLearnings = Array();
if ( ArrayCount( xarrTests ) != 0 )
{
	sCond = '';
	bEmpty = false;
	if ( curDoc.wvars.ObtainChildByKey( 'show_only_subordinate' ).value == '1' )
	{
		xarrPersons = tools.get_all_sub_persons_by_func_manager_id( curUserID );
		if ( ArrayCount( xarrPersons ) == 0 )
			bEmpty = true;
		else
			sCond = ' and MatchSome( $elem/person_id, (' + ArrayMerge( xarrPersons, 'id', ',' ) + ') )';
	}

	if ( ! bEmpty )
		for ( catTest in xarrTests )
			xarrTestLearnings = ArrayUnion( xarrTestLearnings, XQuery( "for $elem in active_test_learnings where $elem/assessment_id = " + catTest.assessment_id + sCond + " and $elem/state_id = 2 return $elem" ) );
}
	
curView = new Object;
curView.SetProperty( 'catalog_name', 'active_test_learning' );
curView.SetProperty( 'disp_link', 'true' );
curView.SetProperty( 'link_mode', 'expert_test' );
curView.SetProperty( 'array', xarrTestLearnings );
Server.Execute( "view_catalog_list.html" );
%>