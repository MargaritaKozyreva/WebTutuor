<%

try
{
	UseAjaxUpload
}
catch(ex)
{
	UseAjaxUpload=true;
}
%>

<%
if (UseAjaxUpload)
{
%>
<script type="text/javascript" src="scripts/ajaxfileupload.js" ></script>
<script language="javascript">
function ajaxFileUpload()
{
	if($("#add_file_url").val()=='')
		return false;

	$("#loading")
	.ajaxStart(function(){
		$("#add_file_post").hide();
		$(this).show();
	})
	.ajaxComplete(function(){
		$(this).hide();
		$("#add_file_post").show();
	});
	$.ajaxFileUpload
	(
		{
			url:'resource_create.html?ajax=1&doc_id=<%=curDocID%>&sid=<%=tools.get_sum_sid( curDocID )%>&add_file_field=add_file_url&add_file_status='+$("#add_file_status").val()+'&update_repositorium_id='+$('#update_repositorium_id').val(), 
			secureuri:false,
			fileElementId:'add_file_url',
			dataType: 'json',
			success: function (data, status)
			{
				if(typeof(data.error) != 'undefined')
				{
					if(data.error != '')
					{
						alert(data.error);
					}else
					{
						alert(data.msg);
					}
				}
				if (typeof(postFileUploadFunc) == "function")
					postFileUploadFunc();
			},
			error: function (data, status, e)
			{
				alert(e);
			}
		}
	)
	return false;
} 
</script>
<%
}
%>
<nobr><input type="radio" name="add_file_type" id="add_file_type_resource" value="resource"/>&nbsp;<%=tools.get_web_str('vdb_select_file')%>:&nbsp;<input type="text" name="add_file_name" id="add_file_name" class="inputEdit" value="" readonly="readonly"/>&nbsp;<input type="button" value="<%=tools.get_web_str('c_choose')%>..." class="inputButton" onclick="
		var pars=new Object();
		pars.xquery_qual = '$elem/person_id=null() or $elem/person_id=<%=curUserID%>';
		xShowModalDialog('dlg_select.html?catalog_name=resource&doc_id=<%=curDocID%>&typein=0&rand='+ Math.random(), pars);
		if ( ! pars.handle ) 
			return null;

		document.getElementById('add_file_type_resource').checked = true;
		document.getElementById('add_file_resource_id').value = pars.element_id;
		document.getElementById('add_file_name').value = pars.element_name;
		document.getElementById('add_file_url').value = '';
" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/></nobr><br/>
<nobr><input type="radio" name="add_file_type" id="add_file_type_file" value="file"/>&nbsp;<%=tools.get_web_str('vdb_post_file')%>:&nbsp;<input type="file" name="add_file_url" id="add_file_url" value="" class="inputEdit" onchange="
		document.getElementById('add_file_type_file').checked = true;
		document.getElementById('add_file_resource_id').value = '';
		document.getElementById('add_file_name').value = '';
		sSuf = this.value.slice( this.value.lastIndexOf('.') );
		arrPicSufs = new Array('.jpg','.jpeg','.jpe','.gif','.png','.bmp','.tif','.tiff','.ico');
		for(suf in arrPicSufs)
			if(arrPicSufs[suf]==sSuf)
			{
				$('select[name=add_file_status] option[value=img]').attr('selected', 'yes');
				break;
			}
"/>&nbsp;&nbsp;&nbsp;&nbsp;<%=tools.get_web_str('vdb_file_type')%>:&nbsp;<select id="add_file_status" name="add_file_status" class="inputEdit">
<%
for ( _resource_type in curLngCommon.resource_types )
{
%>
	<option value="<%=_resource_type.PrimaryKey%>"><%=_resource_type.name%></option>
<%
}
%>
</select>&nbsp;&nbsp;&nbsp;&nbsp;
<%
if (UseAjaxUpload)
{
%>
<input type="button" id="add_file_post" value="<%=tools_web.get_web_str('vdb_upload')%>" onclick="ajaxFileUpload()" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
<img src="pics/progress.gif" id="loading" style="display:none"/></nobr>
<%
}
%>
<input type="hidden" name="add_file_resource_id" id="add_file_resource_id" value=""/>
<input type="hidden" name="update_repositorium_id" id="update_repositorium_id" value=""/>