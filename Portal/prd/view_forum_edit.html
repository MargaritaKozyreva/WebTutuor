<%
	Server.Execute( 'include/user_init.html' );
	// убедимся что эту страничку пользователь может просматривать
	if ( curUser.access.access_role != 'admin' ) 
	{
		Server.Execute( "view_access_panel.html" );
		Cancel();
	}
	forumID = '';
	
	if ( Request.QueryString.HasProperty( 'edit_forum_id' ) )
	{ // пришел запрос на редактирование форума
		if (Request.QueryString.edit_forum_id != '') 
		{
			forumID = Int( Request.QueryString.edit_forum_id );
			forumObject = OpenDoc( UrlFromDocID( forumID ) ).TopElem;
			if ( forumObject.closed.HasValue && forumObject.closed == true ) 
			{
				Server.Execute( "view_access_panel.html" );
				Cancel();
			}
		}
%>
<script type=text/JavaScript>
//<!--
function check_content( target )
{	
	var max_title_len = 1000;
	
	var _text = document.getElementById( "__forum__name_text_id__" ).value;
	
	if ( _text == '' )
		alert( "<%=tools_web.get_web_str('vfb_message1')%>" );
	else if ( _text.length > max_title_len )
		alert( String("<%=tools_web.get_web_str('vfb_message2')%>").replace( /{param1}/g, _title.length - max_title_len ) );
	else
	{
		var _form = document.getElementById( "message" );
		_form.name.value = _text;
		_form.submit();
	}
}
<%
	_str = '';
	if (forumID != '') 
	{
		for ( _elem in forumObject.moderators )
			_str = _str + _elem.moderator_id + ';';
	}
%>

var selected_object_ids = '<%=_str%>';

function doSelect()
{	
		var pars=new Object();
		var strAttr="status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1";
		pars.selected_object_ids = selected_object_ids;
		pars.can_be_empty = true;

		xShowModalDialog( 'dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&typein=0&multi_select=1&rand='+ Math.random(), pars, strAttr );
		if ( ! pars.handle ) 
			return null;
			
		document.forms['message'].selected_object_ids.value = pars.selected_object_ids;
		selected_object_ids = pars.selected_object_ids;
}

//-->
</script>

<form id="message" name="message" action="view_doc.html?doc_id=<%=curDocID%>" method="post" >
	<input type=hidden name="doc_id" id="doc_id_id" value="<%=curDocID%>"/>
	<input type=hidden name="saved_forum_id" id="saved_forum_id" value="<%=forumID%>"/>
	<input type=hidden name="sid" id="sid_id" value="<%=tools.get_sum_sid( curDocID )%>"/>
	<input type=hidden name="selected_object_ids" value=""/>
	
	<input type=hidden name="name" value=""/>
</form>



<a name="ans"/>
<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody>
	<tr>
		<td class="CL_forum_answer_form_table">
		
		<h4 align=center><%=( forumID == '' )? tools_web.get_web_str( 'vfb_forum_title' ) : tools_web.get_web_str( 'vfb_edit_forum' )%></h4>
		<table cellspacing=1 cellpadding=0 width="100%" border=0>
		<tbody>
			<tr>
				<td class=CL_forum_form_row align=right width="30%"><b><%=tools_web.get_web_str('vfb_forum')%>:</b></td>
				<td class=CL_forum_form_row><input type="text" name="text" id="__forum__name_text_id__" class="inputEdit" style="width: 300px" onkeypress="if ( window.event.keyCode == 13 ) return false;"></td>
			</tr>
			<tr>
				<td class=CL_forum_form_row align=right width="30%"><b><%=tools_web.get_web_str('vfb_moderators')%>:</b></td>
				<td class=CL_forum_form_row>
					<form action="view_forum_save_moderators.html" name="event_form" method="post">
						<input type=hidden name="doc_id" value="<%=curDocID%>"/>
						<input type=hidden name="object_id" value="<%=curObjectID%>"/>
						<input type=hidden name="forum_id" value="<%=forumID%>"/>
						<input type=hidden name="sid" value="<%=tools.get_sum_sid( curDocID )%>"/>
						<input type=hidden name="selected_object_ids" value=""/>
						<input type="button" value="<%=tools_web.get_web_str( 'veb_b7' )%>" onClick="doSelect()" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">
					</form>

				</td>
			</tr>
			<tr>
				<td class=CL_forum_form_row>&nbsp;</td>
				<td class=CL_forum_form_row><input type="button" name="go" value="<%=tools_web.get_web_str('vfb_submit_add_forum')%>" onclick="check_content(this);" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"></td>
			</tr>
		</tbody>
		</table>
		
		</td>
	</tr>
</tbody>
</table>

<script type=text/JavaScript>
<%
	if ( forumID != '' )
	{
%>
		function setTextValue( _text ) 
		{
			tags = document.getElementsByTagName( "input" );
			for ( var i=0; i<tags.length; i++ ) 
			{
				curname = tags[i].getAttribute( "id" );
				if ( curname=="__forum__name_text_id__" ) 
				{
					tags[i].value = _text;
				}
			}
			return false;
		}

		setTextValue( '<%=forumObject.name%>' );

<%
	}
%>
</script>
<%
	}
%>
