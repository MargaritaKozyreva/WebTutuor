<%
	try
	{
		curForumID = Int( Request.QueryString.object_id );
		curForum = OpenDoc( UrlFromDocID( curForumID ) ).TopElem;
		//if ( tools.check_access(curForum, curUserID) == false ) throw "ne lez!";
	}
	catch(_fuck_)
	{
		curForum = null;
		curForumID = null;
	}

	try
	{
		Session.RETURN_MSG;
	}
	catch(_x_)
	{
		Session.RETURN_MSG = "";
	}

	if (Session.RETURN_MSG != "")
	{
		Response.Write("<br/><center><font size='+1' align='center'><i><b>" + HtmlEncode(Session.RETURN_MSG) + "</b></i></font></center>");
		Session.RETURN_MSG = "";
	}
%>

<script language="javascript">
<!--
//------------------------------------------------------------------------------------------
function buttonMouseOver()
{
	window.event.srcElement.className='inputButtonOver';
}
function buttonMouseOut()
{
	window.event.srcElement.className='inputButton';
}
function checkkey(srcobj, keycode, flag_flat)
{			
	if ((keycode<48 || keycode>57)& keycode!=46) return false;
	if (keycode==46) 
	{
		if( (!flag_flat) || srcobj.value.indexOf('.') >= 0) return false;
	}
	return true;
}
//------------------------------------------------------------------------------------------
function what2submit()
{
	var tobj=document.all.recycler;
	if (document.forms["forum_submitter"].elements["name"].value == "")
	{
		window.alert(<%=CodeLiteral( tools_web.get_web_str('vaeb_mess_empty_title') )%>);
		return false;
	}
	
	return true;
}
-->
</script>

<table width="100%"  border="0" cellspacing="0" cellpadding="3" name="top_report_table">
<tr>
<td>

<form name="forum_submitter" id="forum_submitter" action="content_panel_process.html" method="post">
<input type="hidden" name="forum_id" value="<%=(curForumID != null ? curForumID : 0)%>"/>
<input type="hidden" name="mode" value="forum"/>
<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
<input type="hidden" name="href" value="<%=Request.Url%>"/>

<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder" border="0">
	<tr>
		<td style="font-weight:bolder; font-size:larger;" width="90px"><%=tools_web.get_web_str("c_name")%>:</td>
		<td style="font-weight:bolder; font-size:larger"><input type="text" id="name" name="name" value="<%=(curForum != null ? HtmlEncode(curForum.name) : "")%>" class="inputEdit" style="width:100%"/></td>
	</tr>
</table>
<br/>
<table style="font-weight:bolder; font-size:larger;">
	<tr>
		<td width="150"><%=tools_web.get_web_str('vfeb_view_type')%>:</td>
		<td width="600">
			<select name="default_view_type" id="default_view_type" style="width: 90%">
				<%
					for (_lng in curLngCommon.forum_view_types) Response.Write("<option "+((curForum != null && curForum.default_view_type == _lng.PrimaryKey)||(curForum == null && _lng.PrimaryKey == "longtree") ? "selected": "")+" value='"+_lng.PrimaryKey+"'>" +_lng.name+"</option>");
				%>
			</select>
		</td>
	</tr>
	<tr>
		<td width="150"><%=tools_web.get_web_str('c_course')%>:</td>
		<td width="600">
			<table width="100%" cellpadding="0" cellspacing="0">
				<tr valign="middle">
					<td  width="100%">
						<%
							if (curForum != null)
								catForumCourse = curForum.course_id.OptForeignElem;
							else
								catForumCourse = undefined;
						%>
						<input type="text" id="course_disp_name" name="course_disp_name" value="<%=(catForumCourse != undefined ? HtmlEncode(catForumCourse.name) : "")%>" class="inputEdit" style="width:100%" readonly/>
						<input type="hidden" name="course_id" id="course_id" value="<%=(catForumCourse != undefined ? catForumCourse.id : "")%>"/>
					</td>
					<td width="5">&nbsp;</td>
					<td>
						<input type="button" value="..." class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="
								var pars=new Object(); pars.check_access = true;
								var strAttr='status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1';
								xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=course&typein=0&multi_select=0&rand='+Math.random(), pars, strAttr);
								if (!pars.handle ) return false;
								
								document.getElementById('course_id').value = pars.element_id;
								document.getElementById('course_disp_name').value = pars.element_name;
							" style="width: 25px"/>
					</td>
					<td>
						<input type="button" value="x" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="
								document.getElementById('course_id').value = '';
								document.getElementById('course_disp_name').value = '';
							" style="width: 25px"/>
					</td>
				</tr>
			</table>
		</td>
	</tr>
</table>
<table>
	<tr>
		<td><input type="checkbox" name="permit_subscription" id="permit_subscription" <%=(curForum != null && curForum.permit_subscription ? "checked": "")%> value="1"/><%=tools_web.get_web_str("vdb_can_submition")%></td>
		<td><input type="checkbox" name="allow_create_closed_theme" id="allow_create_closed_theme" <%=(curForum != null && curForum.allow_create_closed_theme ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vfeb_can_create_close')%></td>
	</tr>
	<tr>
		<td><input type="checkbox" name="allow_anonymous_message" id="allow_anonymous_message" <%=(curForum != null && curForum.allow_anonymous_message ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vfeb_can_send_anonum')%></td>
		<td><input type="checkbox" name="allow_user_delete" id="allow_user_delete" <%=(curForum != null && curForum.allow_user_delete ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vfeb_can_del_mess')%></td>
	</tr>
	<tr>
		<td><input type="checkbox" name="disp_user_status" id="disp_user_status" <%=(curForum != null && curForum.disp_user_status ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vfeb_show_state')%></td>
		<td><input type="checkbox" name="disp_foto" id="disp_foto" <%=(curForum != null && curForum.disp_foto ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vfeb_show_avatar')%></td>
	</tr>
	<tr>
		<td><input type="checkbox" name="disp_user_avatar" id="disp_user_avatar" <%=(curForum == null || curForum.disp_user_avatar ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vfeb_avatar_photo')%></td>
		<td><input type="checkbox" name="allow_create_pinned_theme" id="allow_create_pinned_theme" <%=(curForum == null || curForum.allow_create_pinned_theme ? "checked": "")%> value="1"/><%=tools_web.get_web_str('vfeb_can_fix')%></td>
	</tr>
</table>
<br/>

<table width="100%"  border="0" cellspacing="0" cellpadding="3">
	<tr>
		<td class="tableHeaderWithText"><%=tools_web.get_web_str('vfb_moderators')%></td>
	</tr>
	<tr>
		<td class="tableHeaderNoText" colspan="1"><img src="pics/1blank.gif" width="1" height="1"/></td>
	</tr>	
	<tbody id="moderatorium"></tbody>
	<tr>
		<td class="tableFooter" colspan="1"><img src="pics/1blank.gif" width="1" height="1"/></td>
	</tr>
</table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
<TR>
	<TD ALIGN="CENTER" class="activator">
		<input type="hidden" name="moders_count" id="moders_count" value="0"/>
		<input type="button" value="<%=tools_web.get_web_str('vfeb_sel_moderators')%>" onClick="select_moders();" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/>
	</TD>
</TR>
</table>
<script language="javascript">
<!--
	var temp_selected_object_ids = "<%=(curForum != null ? ArrayMerge(curForum.moderators, "This.moderator_id", ";") : "")%>";
	function select_moders()
	{
		var pars=new Object(); pars.check_access = true;
		var strAttr='status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1';
		
		if (pars.display_object_ids == '') pars.display_object_ids = '0';
		
		pars.selected_object_ids = temp_selected_object_ids;
		pars.can_be_empty = true;
		xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&typein=1&multi_select=1&rand='+Math.random(), pars, strAttr);
		if (!pars.handle ) return false;
				
		$('tbody#moderatorium').empty();
		var item_count = 0;
		temp_selected_object_ids = "";
		for (var _x = item_count; _x < pars.elemArray.length; _x++)
		{
			add_moderator(pars.elemArray[_x], pars.elemNamesArray[_x], "");
			temp_selected_object_ids += pars.elemArray[_x]+";"
		}
	}
	
	function add_moderator(_id, _name, sType)
	{
		var item_count = parseInt($("#moders_count").val());
		var _class = item_count % 2 ? 'tableRowEven' : 'tableRowOdd';
		
		$('tbody#moderatorium').append('<tr><td class="' +_class+ '"><input type="hidden" id="moderator_id_'+item_count+'" name="moderator_id_'+item_count+'" value="'+_id+'"/>' +_name+ '</td></tr>');
		$("#moders_count").val(item_count+1);
	}
<%
	if (curForum != null)
	for (fldModerElem in curForum.moderators)
	{
		catModer = fldModerElem.PrimaryKey.OptForeignElem;
		if (catModer != undefined)
			Response.Write("add_moderator(\"" + catModer.PrimaryKey + "\", \"" + HtmlEncode(catModer.fullname) +"\", \"\");");
	}
%>
-->
</script>


<table style="font-weight:bolder; font-size:larger;" width="100%">
	<tr>
		<td><%=tools.get_web_str('c_comment')%></td>
	</tr><tr>
		<td><textarea id="comment" name="comment" style="width:90%"><%=(curForum != null ? HtmlEncode(curForum.comment) : "")%></textarea></td>
	</tr>
</table>
	<br/>
		<center><input type="submit" value="<%=tools.get_web_str('c_save')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="return what2submit();"/></center>
</form>
<%
	_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=content_panel&doc_id="+curDocID+"&tab=forum";
%>
<center><input type="button" value="<%=tools_web.get_web_str('vaaeb_list_back')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="window.location.href='<%=_href%>'"/>
<%
	if (curForum != null)
	{
		_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=forums&doc_id="+curDocID+"&object_id=" + curForumID;
%>
	<input type="button" value="<%=tools_web.get_web_str('vfeb_go_forum')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="window.location.href='<%=_href%>'"/>
<%
	}
%>
</center>
<br/>
<%
	Server.Execute("view_knowledge_parts_base.html");
%>
</td>
</tr>
<tr>
	<td colspan="3" class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
</tr>
</table>
