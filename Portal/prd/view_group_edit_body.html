<%	try	{		curGroupID = Int( Request.QueryString.object_id );		curGroup = OpenDoc( UrlFromDocID( curGroupID ) ).TopElem;	}	catch(_fuck_)	{		curGroup = null;		curGroupID = null;	}	try	{		Session.RETURN_MSG;	}	catch(_x_)	{		Session.RETURN_MSG = "";	}	if (Session.RETURN_MSG != "")	{		Response.Write("<br/><center><font size='+1' align='center'><i><b>" + HtmlEncode(Session.RETURN_MSG) + "</b></i></font></center>");		Session.RETURN_MSG = "";	}%><script language="javascript"><!--//------------------------------------------------------------------------------------------function buttonMouseOver(){	window.event.srcElement.className='inputButtonOver';}function buttonMouseOut(){	window.event.srcElement.className='inputButton';}function checkkey(srcobj, keycode, flag_flat){				if ((keycode<48 || keycode>57)& keycode!=46) return false;	if (keycode==46) 	{		if( (!flag_flat) || srcobj.value.indexOf('.') >= 0) return false;	}	return true;}//------------------------------------------------------------------------------------------function what2submit(){	var tobj = $("form#group_submitter tbody#recycler").get(0);	var item_count = parseInt(document.getElementById("authors_count").value);		var o = document.forms["group_submitter"].elements["name"].value;	if (o == "")	{		window.alert(<%=CodeLiteral( tools_web.get_web_str('vaeb_mess_empty_title') )%>);		return false;	}		return true;}//------------------------------------------------------------------------------------------function addCollaborator(cur_id, cur_name){	var tobj = $("form#group_submitter tbody#collrecycler").get(0);	var _x = parseInt($("#collaborators_count").val());	var trow=document.createElement("TR");	trow.setAttribute("id","author_" + cur_id);	trow.setAttribute("value",cur_id);	trow.valign="middle";	$(tobj).append(trow);	var _classL = trow.rowIndex % 2 ? 'tableRowEvenLeft' : 'tableRowOddLeft';	var _class = trow.rowIndex % 2 ? 'tableRowEven' : 'tableRowOdd';	var _classR = trow.rowIndex % 2 ? 'tableRowEvenRight' : 'tableRowOddRight';		$(trow).append("<td class='"+_classL+"'></td>");		var tcol1=document.createElement("TD");	tcol1.className = _class;	$(trow).append(tcol1);<%	_href = "view_doc.html?mode=collaborator&doc_id="+curDocID+"&object_id=";%>	tcol1.innerHTML = "<a href='<%=_href%>" +cur_id+ "'>" + cur_name + "</a>";		var tinput_qt=document.createElement('INPUT');	tinput_qt.type='hidden'; 	tinput_qt.id='collaborator_id_' + _x;	tinput_qt.name='collaborator_id_' + _x;	tinput_qt.value = cur_id;	$(tcol1).append(tinput_qt);		$(trow).append("<td class='"+_classR+"'></td>");	$("#collaborators_count").val(_x++);}//-----------------------------------function change_collaborators(){	var tobj = $("form#group_submitter tbody#collrecycler").get(0);	var item_count = parseInt(document.getElementById("collaborators_count").value);		var pars=new Object();	var _x = 0;	pars.selected_object_ids = "";	while (_x < item_count)	{		if (document.getElementById("collaborator_id_" + _x) != undefined)			pars.selected_object_ids += (pars.selected_object_ids != "" ? ";" : "") + document.getElementById("collaborator_id_" + _x).value;		_x++;	}				var strAttr="status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1";	xShowModalDialog("dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&typein=1&check_access=1&multi_select=1&rand="+Math.random(), pars, strAttr);		if (!pars.handle) return false;		$(tobj).empty()	item_count = 0;	$("#collaborators_count").val("0");	for (_x = item_count; _x < pars.elemArray.length; _x++)	{		var cur_id = pars.elemArray[_x];		var cur_name = pars.elemNamesArray[_x];				addCollaborator(cur_id, cur_name)	}}function toggle_section(_word){	$("form#group_submitter div[id^='cdiv_']").each(function(){ if (this.id == "cdiv_" + _word) $(this).show("fast"); else $(this).hide("fast"); });	$("form#group_submitter td[id^='ctd_']").each(function(){if (this.id == "ctd_" + _word)	{$(this).addClass("tab_td_sel"); $(this).removeClass("tab_td");} else {$(this).removeClass("tab_td_sel"); $(this).addClass("tab_td");} });		return false;}--></script><table width="100%"  border="0" cellspacing="0" cellpadding="3" name="top_report_table"><tr><td><form name="group_submitter" id="group_submitter" action="content_panel_process.html" method="post"><input type="hidden" name="group_id" value="<%=(curGroupID != null ? curGroupID : 0)%>"/><input type="hidden" name="mode" value="group"/><input type="hidden" name="doc_id" value="<%=curDocID%>"/><input type="hidden" name="href" value="<%=Request.Url%>"/><table width="100%" border="0" cellspacing="0" cellpadding="0">	<tr>		<td class="tab_td_empty"><img src="pics/1blank.gif" width="10" height="0"/></td>		<td class="tab_td" id="ctd_common" onclick="return toggle_section('common');"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="return toggle_section('common');"><%=tools_web.get_web_str('c_common_settings')%></a></td>		<td class="tab_td_empty" width="10px">&nbsp;</td>		<td class="tab_td" id="ctd_collaborators" onclick="return toggle_section('collaborators');"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick=" return toggle_section('collaborators');"><%=tools_web.get_web_str('c_collaborators')%></a></td>		<td class="tab_td_empty" width="10px">&nbsp;</td>		<td class="tab_td_empty" width="100%">&nbsp;</td>	</tr></table><br/><div id="cdiv_common" style="display: none"><table width="100%" cellspacing="0" cellpadding="4" class="tableBorder" border="0">	<tr>		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools.get_web_str('c_name')%>:</td>		<td style="font-weight:bolder; font-size:larger"><input type="text" id="name" name="name" value="<%=(curGroup != null ? HtmlEncode(curGroup.name) : "")%>" class="inputEdit" style="width:100%"/></td>	</tr></table><br/><input type="checkbox" name="is_dynamic" id="is_dynamic" value="1" onclick="$('form#group_submitter div#dynamic_table').toggle('fast');" <%=(curGroup != null && curGroup.is_dynamic ? "checked" : "")%>/>&nbsp;<%=tools_web.get_web_str('c_dinamic_group')%><div id="dynamic_table" style="display: <%=(curGroup != null && curGroup.is_dynamic ? "inline" : "none")%>">	<table width="100%">		<tr>			<td><%=tools_web.get_web_str('vgeb_sel_condit')%></td>			<td><input type="button" value="<%=tools_web.get_web_str('dcs_add_conditions')%>" onClick="___manageConditions();" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/></td>		</tr>	</table>		<table width="100%"  border="0" cellspacing="0" cellpadding="3">		<tr>			<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="1" height="1"/></td>			<td class="tableHeaderNoText" width="20px"><img src="pics/1blank.gif" width="1" height="1"/></td>			<td class="tableHeaderNoText" width="20px"><img src="pics/1blank.gif" width="1" height="1"/></td>			<td class="tableHeaderNoText" width="100%"><img src="pics/1blank.gif" width="1" height="1"/></td>			<td class="tableHeaderNoText" width="20px"><img src="pics/1blank.gif" width="1" height="1"/></td>			<td class="tableHeaderNoRight"><img src="pics/1blank.gif" width="1" height="1"/></td>		</tr>		<tbody id="body_of_good_condition">		</tbody>		<tr>			<td class="tableFooterLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooterRight"><img src="pics/1blank.gif" width="1" height="1" /></td>		</tr>	</table>	<input type="hidden" id="dynamic_conditions_count" name="dynamic_conditions_count" value="0"/></div><script language="javascript">	<!--		function ___manageConditions()		{			var pars=new Object();			pars.conditions = new Array();			var iUpperCount = parseInt($("div#dynamic_table input#dynamic_conditions_count").val());			//var aFieldArray = Array("field","title","type","option_type","is_custom_field","and_or","bracket");			for (var i=0; i < iUpperCount; i++)			{				pars.conditions[i].field = $("div#dynamic_table input#dynamic_condition_" + "field" + "_" + i).val();				pars.conditions[i].title = $("div#dynamic_table input#dynamic_condition_" + "title" + "_" + i).val();				pars.conditions[i].type = $("div#dynamic_table input#dynamic_condition_" + "type" + "_" + i).val();				pars.conditions[i].option_type = $("div#dynamic_table input#dynamic_condition_" + "option_type" + "_" + i).val();				pars.conditions[i].is_custom_field = $("div#dynamic_table input#dynamic_condition_" + "is_custom_field" + "_" + i).val();				pars.conditions[i].and_or = $("div#dynamic_table input#dynamic_condition_" + "and_or" + "_" + i).val();				pars.conditions[i].bracket = $("div#dynamic_table input#dynamic_condition_" + "bracket" + "_" + i).val();			}						var strAttr='status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1';			xShowModalDialog('dlg_condition_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&rand='+Math.random(), pars, strAttr);			if (!pars.handle) return false;		}				function __addCondition(_sField, _sTitle, _sValue,_sType, _sOptionType, _bIsCustomField, _sAndOr, _sBracket)		{			var tb = $("div#dynamic_table tbody#body_of_good_condition").get(0);			var trow=document.createElement("TR");			trow.valign="middle";			$(tb).append(trow);			_sClass = $(tb).children("tr").index(trow) % 2 ? 'tableRowEven' : 'tableRowOdd';			var _sClassL = _sClass + "Left";			var _sClassR = _sClass + "Right";			var iCount = parseInt($("div#dynamic_table input#dynamic_conditions_count").val());						$(tb).append("<td class='"+_sClassL+"'></td>");			var tcol=document.createElement("TD");			tcol.className = _class;			if (iCount > 0)				if (_sBracket == "or") tcol.innerHTML = "OR"; else tcol.innerHTML = "AND";							var tinput=document.createElement('INPUT'); tinput.type='hidden';			tinput.setAttribute("name",'dynamic_condition_'+ 'field' + '_' + iCount);			tinput.value = _sField;			$(tobj).append(tinput);						tinput=document.createElement('INPUT'); tinput.type='hidden'; 			tinput.setAttribute("name",'dynamic_condition_'+ 'title' + '_' + iCount);			tinput.setAttribute("id", tinput.getAttribute("name"));			tinput.value = _sTitle;			$(tobj).append(tinput);						tinput=document.createElement('INPUT'); tinput.type='hidden'; 			tinput.setAttribute("name",'dynamic_condition_'+ 'value' + '_' + iCount);			tinput.setAttribute("id", tinput.getAttribute("name"));			tinput.value = _sValue;			$(tobj).append(tinput);						tinput=document.createElement('INPUT'); tinput.type='hidden'; 			tinput.setAttribute("name",'dynamic_condition_'+ 'type' + '_' + iCount);			tinput.setAttribute("id", tinput.getAttribute("name"));			tinput.value = _sType;			$(tobj).append(tinput);						tinput=document.createElement('INPUT'); tinput.type='hidden'; 			tinput.setAttribute("name",'dynamic_condition_'+ 'option_type' + '_' + iCount);			tinput.setAttribute("id", tinput.getAttribute("name"));			tinput.value = _sOptionType;			$(tobj).append(tinput);						tinput=document.createElement('INPUT'); tinput.type='hidden'; 			tinput.setAttribute("name",'dynamic_condition_'+ 'is_custom_field' + '_' + iCount);			tinput.setAttribute("id", tinput.getAttribute("name"));			tinput.value = _bIsCustomField;			$(tobj).append(tinput);						tinput=document.createElement('INPUT'); tinput.type='hidden'; 			tinput.setAttribute("name",'dynamic_condition_'+ 'and_or' + '_' + iCount);			tinput.setAttribute("id", tinput.getAttribute("name"));			tinput.value = _sAndOr;			$(tobj).append(tinput);						tinput=document.createElement('INPUT'); tinput.type='hidden'; 			tinput.setAttribute("name",'dynamic_condition_'+ 'bracket' + '_' + iCount);			tinput.setAttribute("id", tinput.getAttribute("name"));			tinput.value = _sBracket;			$(tobj).append(tinput);						$(trow).append(tcol);						tcol=document.createElement("TD");			tcol.className = _class;			if (_sBracket == "(") tcol.innerHTML = _sBracket			$(trow).append(tcol);						tcol=document.createElement("TD");			tcol.className = _class;			tcol.innerHTML = _sTitle + "[" + _sField + "] ";			switch (_sOptionType)			{<%				for (fldOptionType in curLngCommon.all_option_types)				{%>				case "<%=fldOptionType.id%>": tcol.innerHTML += "<%=fldOptionType.name%>"; break;<%				}%>				default: tcol.innerHTML += "???";			}			tcol.innerHTML += " " + _sValue;			$(trow).append(tcol);						tcol=document.createElement("TD");			tcol.className = _class;			if (_sBracket == ")") tcol.innerHTML = _sBracket			$(trow).append(tcol);						$(tb).append("<td class='"+_sClassR+"'></td>");			$("div#dynamic_table input#dynamic_conditions_count").val(iCount++);		}<%		if (curGroup != null)		for (_fldConditionElem in curGroup.conditions)		{%>			__addCondition("<%=_fldConditionElem.field%>", "<%=HtmlEncode(_fldConditionElem.title)%>", "<%=HtmlEncode(_fldConditionElem.value)%>","<%=_fldConditionElem.type%>", "<%=_fldConditionElem.option_type%>", <%=_fldConditionElem.is_custom_field%>, "<%=_fldConditionElem.and_or%>", "<%=_fldConditionElem.bracket%>");<%		}%>	--></script><br/><table style="font-weight:bolder; font-size:larger;" width="100%">	<tr>		<td><%=tools.get_web_str('c_comment')%></td>	</tr><tr>		<td><textarea id="comment" name="comment" style="width:100%"><%=(curGroup != null ? curGroup.comment : "")%></textarea></td>	</tr></table></div><div id="cdiv_collaborators" style="display: none">	<table width="100%"  border="0" cellspacing="0" cellpadding="3">		<tr>			<td class="tableHeaderWithTextLeft"></td>			<td class="tableHeaderWithText" width="100%"><%=tools_web.get_web_str('c_collaborators')%></td>			<td class="tableHeaderWithTextRight"></td>		</tr>		<tr>			<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="1" height="1" /></td>		</tr>		<tbody id="collrecycler"></tbody>		<tr>			<td class="tableFooterLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>			<td class="tableFooterRight"><img src="pics/1blank.gif" width="1" height="1" /></td>		</tr>	</table>	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">		<TR><TD ALIGN="CENTER" class="activator">			<input type="button" value="<%=tools.get_web_str("veb_b7")%>" onClick="change_collaborators();" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/>		</TD></TR>	</table></div><%	if (curGroup != null && ArrayOptFirstElem(curGroup.collaborators) != undefined)	{%>		<script language='javascript'>			var tobj1 = document.getElementById("recycler");<%		_x = 0;		for (_catCollaborator in curGroup.collaborators)		{			Response.Write('addCollaborator("' + _catCollaborator.PrimaryKey + '", "' +HtmlEncode(_catCollaborator.person_fullname)+ '");\n');			_x++;		}%>		</script><%	}%><br/><input type="hidden" name="collaborators_count" id="collaborators_count" value="<%=(curGroup != null ? ArrayCount(curGroup.collaborators): 0)%>"/><script language="javascript"><!--toggle_section("common");--></script><br/><center><input type="submit" value="<%=tools.get_web_str('c_save')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="return what2submit();"/></center></form><%	_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=content_panel&doc_id="+curDocID+"&tab=group";%><center>	<input type="button" value="<%=tools_web.get_web_str('vaaeb_list_back')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="window.location.href='<%=_href%>'"/></center><br/></td></tr><tr>	<td colspan="3" class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td></tr></table>