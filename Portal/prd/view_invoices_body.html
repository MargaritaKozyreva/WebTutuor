<%
	try
	{
		_filter = Request.Form.filter_id;
	}
	catch ( e )
	{
		_filter = 'date descending';
	}
%>

<BR>
<FORM ACTION="view_doc.html?mode=invoices" NAME="refresh_form" METHOD="POST">
<INPUT TYPE="HIDDEN" NAME="doc_id" VALUE="<%=curDocID%>">		

<TABLE width="100%" cellspacing="0" cellpadding="4" CLASS="tableBorder">
	<TR>		
		<TD WIDTH="170" ALIGN="RIGHT"><b><%=tools.get_web_str('c_sort')%>:</b></TD>
		<TD ALIGN="LEFT">
		<select name="filter_id" onChange="document.refresh_form.submit()">
			<option value="date descending"><%=tools.get_web_str('c_date')%></option>
			<option value="code"><%=tools.get_web_str('c_code')%></option>
			<option value="is_paid"><%=tools.get_web_str('vib_pay')%></option>
			<option value="org_id"><%=tools.get_web_str('c_org')%></option>	
         </select>
		 
<SCRIPT language="JavaScript">
<!--
selcur=document.forms['refresh_form'].filter_id;
for (i=0;i<selcur.options.length;i++) {
    if (selcur.options[i].value=="<%=_filter%>") {
        selcur.selectedIndex=i;
    }
	
if (selcur.selectedIndex==-1) {selcur.selectedIndex=0;}
}
//-->
</SCRIPT>
		</TD>
	</TR>
</TABLE>
</form>	

<%
	_invoices_array = Array();
	if ( curUser.access.access_role == 'admin' || curUser.access.access_role == 'organizer' )
	{
		_invoices_array = invoices;
	}
	else
	{
		if ( curUser.org_id != null )
		{
			_invoices_array = XQuery( 'for $invoice in invoices where $invoice/org_id = ' + curUser.org_id + ' order by $invoice/' + _filter + ' return $invoice' );
		}
		else
		{
%>
	<center><font COLOR="#FF0033"><%=tools.get_web_str('vib_error1')%></font></center>
<%		
		}
	}
%>

<table width="100%"  border="0" cellspacing="0" cellpadding="3">
	<tr>
		<td class="tableHeaderWithText" WIDTH="50">¹</td>
		<td class="tableHeaderWithText" WIDTH="150"><%=tools.get_web_str('c_date')%></td>
		<td class="tableHeaderWithText"><%=tools.get_web_str('c_org')%></td>
		<td class="tableHeaderWithText" WIDTH="60"><%=tools.get_web_str('c_sum')%></td>
		<td class="tableHeaderWithText" WIDTH="60"><%=tools.get_web_str('vib_pay')%></td>
		<!--<td class="tableHeaderWithText" WIDTH="60"><%=tools.get_web_str('vib_print')%></td>-->
	</tr>
	<tr>
		<td class="tableHeaderNoText" colspan="5"><img src="pics/1blank.gif" width="1" height="1" /></td>
	</tr>	
			
<%				
	counter = 0;
	for ( _invoice in _invoices_array )
	{
		_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
%>
		
	<TR>
		<TD class="<%=_class%>" WIDTH="50"><%=_invoice.code%></TD>
		<TD class="<%=_class%>" WIDTH="150"><%=_invoice.date%></TD>
		<TD class="<%=_class%>">
<%
		try
		{
			Response.Write( tools_web.get_cur_lng_name( _invoice.org_id.ForeignElem.name ) );
		}
		catch ( e )
		{
%>
			<font COLOR="#FF0033"><%=tools.get_web_str('c_deleted')%></font>
<%
		}
%>
		</TD>
		<TD class="<%=_class%>" ALIGN="RIGHT" WIDTH="60"><%=StrReal( _invoice.amount, 2, true )%></TD>
		<TD class="<%=_class%>" ALIGN="CENTER" WIDTH="60">
<%
		if ( _invoice.is_paid )
		{
%>
			<IMG SRC="pics/vwicn082.gif" WIDTH="13" HEIGHT="11" HSPACE="5">
<%
		}
%>
		</TD>
		<!--<TD class="<%=_class%>" ALIGN="CENTER" WIDTH="60"><a HREF="invoice_print.html?doc_id=<%=curDocID%>&inv_id=<%=_invoice.id%>&sid=<%=tools.get_sum_sid( curDocID )%>" TARGET="_BLANK" TITLE="<%=tools.get_web_str('vib_open_inv')%>"><IMG SRC="pics/print.gif" WIDTH="16" HEIGHT="14" HSPACE="5" BORDER="0"></a></TD>-->
	</TR>
<%
	}
%>
	<tr>
		<td class="tableFooter" colspan="5"><img src="pics/1blank.gif" width="1" height="1" /></td>
	</tr>
</table>
<BR/>