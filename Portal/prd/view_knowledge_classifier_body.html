<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr> 
	<td width="200px" valign="top">
<%
	curKnowledgeClassifierID = curObjectID;
	curKnowledgeClassifier = curObject;
	Server.Execute("view_knowledge_tree_body.html");
%>
	</td>
	<td valign="top">
	<%
		if (curObjectID == null)
		{
	%>
			<center><h2><%=tools_web.get_web_str("c_deleted")%></h2></center>
	<%
		}
		else
		{
	%>
		<center><h2><%=curObject.name%></h2></center><br/>
		<div><%=tools_web.get_web_desc( curObject.desc, UrlFromDocID( curObjectID ), "knowledge_classifier.desc" )%></div>
		
		

<%
	if (Request.Form.HasProperty("qid") && Request.Form.GetProperty("qid") != "")
		qid = Request.Form.qid;
	else
		qid = undefined;
		
	_knowledge_parts = XQuery("for $kp in knowledge_parts where $kp/knowledge_classifier_id = " + curObjectID + (qid != undefined ? " and doc-contains( $kp/id, '" + DefaultDb + "', '" + qid + "' )" : "") + " order by $kp/name return $kp");
	
	if (ArrayCount(_knowledge_parts) > 0 || qid != undefined)
	{
%>


<table width="100%"  border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td class="tableHeaderTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
		<td class="tableHeaderText"><p class="tableHeaderTextInner"><%=tools_web.get_web_str("vkpb_knowledge_parts_title")%></p></td>
		<td class="tableHeaderText" valign="middle" align="right">
			<FORM ACTION="view_doc.html?mode=knowledge_classifier&object_id=<%=curObjectID%>" NAME="query_form" METHOD="POST">
				<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
				<%=tools_web.get_web_str("vkpb_search")%>:&nbsp; <input type="text" name="qid" style="width: 300px" class="inputEdit" value="<%=(qid!= undefined ? qid : "")%>"/><input type="submit" value="&gt;&gt;" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/>
			</FORM>
		</td>
		<td class="tableHeaderTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
	</tr>
	<tr>
		<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
		<td class="tableHeaderWithText" colspan="2"><a href="#" style="text-decoration:none" onclick="if ($('#tbody_knowledge_parts_block').is(':hidden')) {$('#img_block_hider').attr('src','pics/minus.jpg'); $('#tbody_knowledge_parts_block').show();} else {$('#img_block_hider').attr('src','pics/plus.jpg'); $('#tbody_knowledge_parts_block').hide();}"><img id="img_block_hider" src="pics/plus.jpg" border="0"/>&nbsp;&nbsp;<%=tools_web.get_web_str("vkpb_part")%></a></td>
		<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
	</tr>
	<tr>
		<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
		<td class="tableHeaderNoText" width="100%" colspan="2"><img src="pics/1blank.gif" width="0" height="0" /></td>
		<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
	</tr>
	<tbody id="tbody_knowledge_parts_block" style="display: none">
<%				
	counter = 0;
	for ( _knowledge_part in _knowledge_parts)
	{
		
		if ( global_settings.settings.check_access_on_lists )
			try
			{
				if ( tools_web.check_access(OpenDoc(UrlFromDocID(_knowledge_part.PrimaryKey ), "form=x-local://wtv/wtv_form_doc_access.xmd;ignore-top-elem-name=1").TopElem, curUserID, curUser, Session) == false)
					continue;
			}
			catch(_opa_)
			{
				continue;
			}
		_class = counter++ % 2 ? "tableRowEven" : "tableRowOdd";
		_classl = counter++ % 2 ? "tableRowEvenLeft" : "tableRowOddLeft";
		_classr = counter++ % 2 ? "tableRowEvenRight" : "tableRowOddRight";
%>
		<tr>
			<td class="<%=_classl%>"></td>					
			<td class="<%=_class%>" colspan="2">
				<a href="view_doc.html?mode=knowledge_part&object_id=<%=_knowledge_part.PrimaryKey%>&doc_id=<%=curDocID%>"><%=tools_web.get_cur_lng_name(_knowledge_part.name, curLng.short_id)%></a>
			</td>
			<td class="<%=_classr%>"></td>
		</tr>
<%
	}
%>
	</tbody>
	<tr>
		<td class="tableFooterLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
		<td class="tableFooter" colspan="2"><img src="pics/1blank.gif" width="0" height="0" /></td>
		<td class="tableFooterRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
	</tr>
</table>
<%
	}
%>
		
	<%
		}
	%>
	</td>
</tr>
</table>		