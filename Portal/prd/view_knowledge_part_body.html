<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
	<td width="200px" valign="top">
<%Server.Execute("view_knowledge_tree_body.html");%>
	</td>
	<td valign="top">

<%
	if (curObject == null)
	{
		Response.Write(tools_web.get_web_str("c_deleted"));
	}
	else
	{
		i_m_expert = false;
		_classifier_name = curObject.knowledge_classifier_id.OptForeignElem;
		if (_classifier_name != undefined)
			_classifier_name = tools_web.get_cur_lng_name(_classifier_name.name, curLng.short_id);
%>
		<center><h2><%=tools_web.get_cur_lng_name(curObject.name, curLng.short_id)%></h2></center>
		<p class="tableHeaderTextInner">
		<%
			if (_classifier_name != undefined)
			{
		%>
			<%=tools_web.get_web_str("vkpb_classifier")%>:&nbsp;&nbsp;<font color="black"><a href="view_doc.html?mode=knowledge_classifier&object_id=<%=curObject.knowledge_classifier_id%>&doc_id=<%=curDocID%>"><%=_classifier_name%></a></font>
		<%
			}
			else
				Response.Write(tools_web.get_web_str("vkpb_not_classified"));
		%>
		</p>
<%
		for (_expert in curObject.experts)
		{
			_exp_cat = _expert.PrimaryKey.OptForeignElem;
			if (_exp_cat != undefined)
			{
				i_m_expert = (_exp_cat.person_id == curUserID);
				break;
			}
		}
		
		curOperationalDoc = curObject;
		curOperationalID = curObjectID;
		Server.Execute("view_text_area.html");
		
		if (ArrayOptFirstElem(curObject.tags) != undefined)
		{
			Response.Write( "<b>" + tools_web.get_web_str("vkpb_tag_name") + ":</b>&nbsp;" + ArrayMerge(curObject.tags, "(This.PrimaryKey.OptForeignElem != undefined ? '<a href=\"view_doc.html?mode=knowledge_cloud&tag_id=' + This.PrimaryKey + '&doc_id=' + curDocID + '\">' + tools_web.get_cur_lng_name(This.PrimaryKey.OptForeignElem.name, curLng.short_id) + '</a>' : '')", "&nbsp;&nbsp;") );
		}
		
		
		function getList()
		{
			_arr = Array();
			
			for (_knowledge_parts_object in curLngCommon.knowledge_parts_objects)
			{
				_arr = ArrayUnion(_arr ,  XQuery ( "for $obj in " + _knowledge_parts_object.PrimaryKey + "s where contains($obj/knowledge_parts, '" + curObjectID + "') return $obj" ) );
				
			}
			 return _arr;
		}
		
		_current_docs = getList();
		if (ArrayCount(_current_docs) > 0)
		{
%>
	<table width="100%" border="0" cellspacing="0" cellpadding="0">
		<tr>
			<td class="tableHeaderTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderText" colspan="<%=(i_m_expert ? 3 : 2)%>"><p class="tableHeaderTextInner"><%=tools_web.get_web_str("vkpb_object_links")%></p></td>
			<td class="tableHeaderTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
		<tr>
			<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderWithText"><%=tools_web.get_web_str("c_name")%></td>
			<td class="tableHeaderWithText" width="30%"><%=tools_web.get_web_str("c_type")%></td>
			<%
				if (i_m_expert)
				{
			%>
				<td class="tableHeaderWithText" width="50px">*</td>
			<%
				}
			%>
			<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
		<tr>
			<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<%
				if (i_m_expert)
				{
			%>
				<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<%
				}
			%>
			<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
<%
		counter = 0;

		for(__ in _current_docs)
		{
			_kpsection = OpenDoc(UrlFromDocID(__.id), "form=x-local://wtv/wtv_knowledge_parts_section.xmd;ignore-top-elem-name=1").TopElem;
			_cur_entry = _kpsection.knowledge_parts.GetChildByKey(curObjectID);
			
			if (_cur_entry.require_acknowledgement && !i_m_expert)
				continue;
			
			_exchange_type = curLngCommon.exchange_object_types.GetOptChildByKey(__.Name);
			if (_exchange_type != undefined)
			{
				_name = tools_web.get_cur_lng_name(__.EvalPath(_exchange_type.disp_name), curLng.short_id);
				_object_type = _exchange_type.name;
				_object_type_name = _exchange_type.title;
				
				_common_part_lib = curLngCommon.knowledge_parts_objects.GetOptChildByKey(_object_type);
				if (_common_part_lib != undefined)
				{
					_is_functional = _common_part_lib.is_functional;
				}
				else
				{
					_is_functional = false;
				}
				bNewWindow = false;
				switch(_object_type)
				{
					case "forum":
						_web_template = "view_doc.html?mode=forums&object_id=" + __.PrimaryKey + "&doc_id=" + curDocID;
						break;
					case "document":
						_web_template = "view_doc.html?doc_id=" + __.PrimaryKey ;
						break;
					case "competence_profile":
						_web_template = "view_doc.html?mode=competence_profile&object_id=" + __.PrimaryKey + "&doc_id=" + curDocID;
						break;
					case "article":
						bNewWindow = true;
						_web_template = "webhelp/webhelp.html?&doc_id=" + curDocID + "&object_id="+__.book_id;
						break;
					case "book":
						bNewWindow = true;
					default:
						_web_template = ( _exchange_type.web_template.HasValue ? _exchange_type.web_template + ( StrContains( _exchange_type.web_template, '?' ) ? '&' : '?' ) + 'doc_id=' + curDocID + '&object_id=' + __.PrimaryKey : '' );
				}
				
				if (_is_functional && _web_template != "")
					_ref_str = '<a href="' + _web_template + '"'+ (bNewWindow ? ' target="_blank"':'')+'>' + _name + '</a>';
				else
					_ref_str = _name;
				
			}
			else
			{
				_name = '???';
				_object_type.object_type = '';
				_object_type_name.object_type_name = '???';
				_web_template="";
				_ref_str = "???";
			}
			
			_class = counter++ % 2 ? "tableRowEven" : "tableRowOdd";
			_classl = counter++ % 2 ? "tableRowEvenLeft" : "tableRowOddLeft";
			_classr = counter++ % 2 ? "tableRowEvenRight" : "tableRowOddRight";
		
%>
		<tr>
			<td class="<%=_classl%>"></td>
			<td class="<%=_class%>"><%=_ref_str%></td>
			<td class="<%=_class%>"><%=_object_type_name%></td>
			<%
				if (i_m_expert)
				{
					
			%>
				<td class="<%=_class%>">
			<%
				if (_cur_entry.require_acknowledgement)
				{
			%>
					<FORM ACTION="knowledge_acknowledgement.html" NAME="f_<%=__.PrimaryKey%>" METHOD="POST" style="margin: 0">
						<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
						<input type="hidden" name="object_id" value="<%=__.PrimaryKey%>"/>
						<input type="hidden" name="mode" value="<%=curMode%>"/>
						<input type="hidden" name="knowledge_part_id" value="<%=curObjectID%>"/>
						<table border="0" cellpadding="0" cellspacing="0">
						<tr>
						<td width="150px"><%=tools_web.get_web_str("veb_require_acknowledgement")%>&nbsp;</td><td><input type="submit" onClick="if (!confirm('<%=HtmlEncode(tools_web.get_web_str("veb_are_you_sure_confirm_part"))%>')) return false;" value="<%=HtmlEncode(tools_web.get_web_str("vherb_submit"))%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/></td>
						</tr>
						</table>
					</FORM>
			<%
				}
			%>
				</td>
			<%
				}
			%>
			<td class="<%=_classr%>"></td>
		</tr>
<%	
		}
%>
	</table>
	<BR/>
<%
	}
		
		curFilesDoc = curObject;
		Server.Execute( "view_files.html" );
		Response.Write("<br/>");
			
	if (ArrayCount(curObject.experts) > 0)
	{
%>
	
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
		<tr>
			<td class="tableHeaderTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderText" colspan="2"><p class="tableHeaderTextInner"><%=tools_web.get_web_str("vkpb_experts")%></p></td>
			<td class="tableHeaderTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
		<tr>
			<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderWithText" width="40%"><%=tools_web.get_web_str("c_fio")%></td>
			<td class="tableHeaderWithText" width="60%"><%=tools_web.get_web_str("vkpb_comment")%></td>
			<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
		<tr>
			<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="0" height="0" /></td>
			<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="0" height="0" /></td>
		</tr>
<%
		counter = 0;
		for (_expert in curObject.experts)
		{
			_class = counter++ % 2 ? "tableRowEven" : "tableRowOdd";
			_classl = counter++ % 2 ? "tableRowEvenLeft" : "tableRowOddLeft";
			_classr = counter++ % 2 ? "tableRowEvenRight" : "tableRowOddRight";
			_exp_cat = _expert.PrimaryKey.OptForeignElem;
			
			if (_exp_cat != undefined)
				i_m_expert = (_exp_cat.person_id == curUserID);
			
%>
		<tr>
			<td class="<%=_classl%>"></td>
			<td class="<%=_class%>"><%=(_exp_cat != undefined ? "<a href='view_doc.html?mode=expert&object_id=" + _expert.PrimaryKey + "&doc_id=" + curDocID + "'>" + _exp_cat.person_fullname + "</a>" : tools_web.get_web_str("c_deleted") )%></td>
			<td class="<%=_class%>"><%=_expert.desc%></td>
			<td class="<%=_classr%>"></td>
		</tr>
<%			
		
		}
%>
		</table>
		<p><a href="view_doc.html?mode=expert_questions&doc_id=<%=curDocID%>&object_id=<%=curObjectID%>"><%=tools_web.get_web_str("veb_go_questions")%> &raquo;&raquo;</a></p>
<%
	}
	
	}
%>
	<br/>

	</td>
</tr>
</table>		