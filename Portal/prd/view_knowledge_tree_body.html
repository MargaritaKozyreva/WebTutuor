<%
try {curKnowledgeClassifierID = Int(curKnowledgeClassifierID)} catch(_X_) {curKnowledgeClassifierID = undefined;}
its_ok = false;
if (curMode == "knowledge_part" && curObject != undefined && curObject != null)
{
	if (curObject.knowledge_classifier_id.HasValue)
		_classifier = curObject.knowledge_classifier_id.OptForeignElem;
	else
		_classifier = undefined;
		
		
	if (_classifier == undefined && curObject.parent_object_id.HasValue)
	{
		_upper_part = curObject.parent_object_id.OptForeignElem;
		while(_upper_part != undefined && _upper_part.parent_object_id.HasValue)
		{
			_upper_part = _upper_part.parent_object_id.OptForeignElem;
		}
	
		if (_upper_part != undefined && _upper_part.knowledge_classifier_id.HasValue )
			_classifier = _upper_part.knowledge_classifier_id.OptForeignElem;
	
	}
	
	if (_classifier != undefined)
		_classifier_id = _classifier.PrimaryKey;
	else
		_classifier_id = undefined;
	
	its_ok = true;
}
else if (curMode == "knowledge_classifier" && curKnowledgeClassifierID != undefined )
{
	_classifier = curKnowledgeClassifier;
	_classifier_id = curKnowledgeClassifierID;
	its_ok = true;
}

if (its_ok)
{
%>
<script src="scripts\tree\ua000000.js"></script>
<script src="scripts\tree\ftiens40.js"></script>
<script language="javascript">

USETEXTLINKS = 1;
STARTALLOPEN = 0;
USEFRAMES = 0;
USEICONS = 0;
WRAPTEXT = 1;
PRESERVESTATE = 1;
ICONPATH = "scripts/tree/";

foldersTree = gFld("<b><%=(_classifier != undefined ? "<a href='view_doc.html?mode=knowledge_classifier&object_id=" + _classifier_id + "&doc_id=" + curDocID + "'>" + tools_web.get_cur_lng_name(_classifier.name, curLng.short_id) + "</a>" : tools_web.get_web_str("c_deleted"))%></b>", '');
<%
	if (_classifier != undefined)
	{
		/*
		function build_part(_part, _parent_part)
		{
			//curPartsArray = ArrayExtract( partsArray, 'id' );
			//curPArr = QueryCatalogByKeys( 'knowledge_parts', 'parent_object_id', curPartsArray );
			if (_part == undefined)
			{
				curPartsArray = ArraySelect(partsArray , "parent_object_id.HasValue == false");
			}
			else
			{
				_href="view_doc.html?mode=knowledge_part&object_id=" + _part.PrimaryKey + "&doc_id=" + curDocID;
				var sKnowledgeName = HtmlEncode(_part.name);
				if (curObjectID == _part.id)
					sKnowledgeName = "<b>" + sKnowledgeName + "</b>";
				Response.Write('var P' + _part.id +' = insFld( ' + (_parent_part == undefined ? 'foldersTree' : 'P' + _parent_part.id ) + ' , gFld("'+sKnowledgeName+'", "' + _href + '")); \n');
				curPartsArray = ArraySelect(partsArray , "parent_object_id == _part.id");
			}
		
			for (_new_part in curPartsArray)
			{
				build_part(_new_part, _part);
			}
		}
	
		partsArray = XQuery("for $knowledge_part in knowledge_parts where $knowledge_part/knowledge_classifier_id = " + _classifier_id + " order by $knowledge_part/name return $knowledge_part");

		build_part(undefined, undefined);
		*/
		
		partsArray = XQuery("for $knowledge_part in knowledge_parts where $knowledge_part/knowledge_classifier_id = " + _classifier_id + " order by $knowledge_part/Hier(),$knowledge_part/name return $knowledge_part");
		for (_part in partsArray)
		{
			skName = HtmlEncode(tools_web.get_cur_lng_name(_part.name, curLng.short_id));
			if (curObjectID == _part.id)
				skName = "<b>" + skName + "</b>";
			_href="view_doc.html?mode=knowledge_part&object_id=" + _part.PrimaryKey + "&doc_id=" + curDocID;
			Response.Write('try{ var P' + _part.id +' = insFld( ' + (!_part.parent_object_id.HasValue ? 'foldersTree' : 'P' + _part.parent_object_id ) + ' , gFld("'+skName+'", "' + _href + '"));} catch(_err_){var P' + _part.id +' = insFld( foldersTree , gFld("'+skName+'", "' + _href + '"));} \n');
		}

	}
%>
</script>

<span class="TreeviewSpanArea" style="overflow:auto; width:100%">
	<script>initializeDocument();</script>
</span>

<%
}
else
{
	Response.Write("&nbsp;");
}
%>