<%
	
	catDocType = ArrayOptFirstElem(XQuery("for $elem in doc_types where $elem/object_name = '" + contentItem.id + "' and $elem/is_crave_for_reboot = false() return $elem"));
	if (catDocType == undefined) Cancel();
	_cardDoc = tools_web.get_my_person_object_link_card(catDocType.object_name,curUserID);
	
	if (_cardDoc != undefined)
	{
		_item_allowed_pack = ArrayExtract(_cardDoc.objects, "PrimaryKey");
		if (_cardDoc.all_can_edit)
			_editable_list = "'*'";
		else
			_editable_list = CodeLiteral(ArrayMerge(ArraySelectByKey(_cardDoc.objects, true, "can_edit"), "This.PrimaryKey", ";"));
			
		if (_cardDoc.all_can_delete)
			_deletable_list = "'*'";
		else
			_deletable_list = CodeLiteral(ArrayMerge(ArraySelectByKey(_cardDoc.objects, true, "can_delete"), "This.PrimaryKey", ";"));
	}
	else
	{
		_item_allowed_pack = Array();
		_editable_list = "''";
		_deletable_list = "''";
	}
	
	_itemArray = QueryCatalogByKeys(catDocType.object_name + "s", "id", _item_allowed_pack);
	
	curView = new Object;
	curView.SetProperty("id", "doc_list");
	curView.SetProperty("catalog_name", catDocType.object_name);
	curView.SetProperty("disp_link", "true");
	curView.SetProperty("disp_check_box", "false");
	curView.SetProperty("title", catDocType.name);
	
	curView.SetProperty("disp_link", "("+_editable_list+"=='*' || StrContains("+_editable_list+",ListElem.PrimaryKey) ? true: false)");
	curView.SetProperty("disp_check_box", "true");
	curView.SetProperty("disp_check_box_visibility", "("+_deletable_list+"=='*' || StrContains("+_deletable_list+",ListElem.PrimaryKey) ? true: false)");
	
	curView.SetProperty("array", _itemArray);
	curView.SetProperty("link_mode", "doc_type_document_edit");
	curView.SetProperty("link_prop", "&doc_type_id="+catDocType.id);
	Server.Execute( "view_catalog_list.html" );
	
	_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=doc_type_document_edit&doc_id="+curDocID + "&doc_type_id="+catDocType.id;
%>
<p>
<%
	if (_cardDoc != undefined && _cardDoc.all_can_create)
	{
%>
	<input type="button" value="<%=StrReplace(tools_web.get_web_str('vmdtd_create'), "{PARAM1}", catDocType.name)%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="window.location.href='<%=_href%>'"/>
<%
	}
	if (_deletable_list != "''")
	{
%>
	<input type="button" value="<%=tools.get_web_str('c_delete')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="
		var _str = '';
		var _dead_list = document.getElementsByName('select_check_box_doc_list');
		var x =0;
		for (var i =0; i<_dead_list.length;i++)
		if (_dead_list[i].checked)
		{
			_str += (_str != '' ? ';': '') + _dead_list[i].id;
			x++;
		}
		document.forms['doc_killa'].elements['dead_object_ids'].value = _str;
		if (_str != '' && confirm(String('<%=tools_web.get_web_str('vmaa_mess_del_tests')%>').replace('{PARAM1}',x) ))
			document.forms['doc_killa'].submit();
	"/>
	
	<form name="doc_killa" id="doc_killa" action="content_panel_process.html" method="post">
		<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
		<input type="hidden" name="href" value="<%=Request.Url%>"/>
		<input type="hidden" name="mode" value="delete_elements"/>
		<input type="hidden" name="catalog_name" value="<%=catDocType.object_name%>"/>
		<input type="hidden" name="dead_object_ids" value=""/>
	</form>
<%
	}
%>
</p>