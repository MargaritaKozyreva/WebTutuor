<%
	_cardDoc = tools_web.get_my_person_object_link_card("education_org",curUserID);
	
	if (_cardDoc != undefined)
	{
		_item_allowed_pack = ArrayExtract(_cardDoc.objects, "PrimaryKey");
		if (_cardDoc.all_can_edit)
			_editable_list = "'*'";
		else
			_editable_list = CodeLiteral(ArrayMerge(ArraySelectByKey(_cardDoc.objects, true, "can_edit"), "This.PrimaryKey", ";"));
			
		if (_cardDoc.all_can_delete)
			_deletable_list = "'*'";
		else
			_deletable_list = CodeLiteral(ArrayMerge(ArraySelectByKey(_cardDoc.objects, true, "can_delete"), "This.PrimaryKey", ";"));
	}
	else
	{
		_item_allowed_pack = Array();
		_editable_list = "''";
		_deletable_list = "''";
	}
	_itemArray = QueryCatalogByKeys("education_orgs", "id", _item_allowed_pack);
	
	curView = new Object;
	curView.SetProperty("id", "education_org_list");
	curView.SetProperty("catalog_name", "education_org");
	curView.SetProperty("disp_link", "true");
	curView.SetProperty("disp_check_box", "false");
	curView.SetProperty("title", tools_web.get_web_str('c_edu_orgs') );
	curView.SetProperty("list_columns", Array('name','email'));
	curView.SetProperty("list_headers", Array(tools.get_web_str('c_name'),'E-mail'));
	curView.SetProperty("disp_link", "("+_editable_list+"=='*' || StrContains("+_editable_list+",ListElem.PrimaryKey) ? true: false)");
	curView.SetProperty("disp_check_box", "true");
	curView.SetProperty("disp_check_box_visibility", "("+_deletable_list+"=='*' || StrContains("+_deletable_list+",ListElem.PrimaryKey) ? true: false)");
	curView.SetProperty("link_field_index", "2");
	curView.SetProperty("array", _itemArray);
	curView.SetProperty("link_mode", "education_org_edit");
	Server.Execute("view_catalog_list.html");
	
	_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=education_org_edit&doc_id="+curDocID;
%>
<p>
<%
	if (_cardDoc != undefined && _cardDoc.all_can_create)
	{
%>
	<input type="button" value="<%=tools_web.get_web_str('vmeo_create_edu_org')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="window.location.href='<%=_href%>'"/>
<%
	}
	if (_deletable_list != "''")
	{
%>
	<input type="button" value="<%=tools.get_web_str('c_delete')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="
		var _str = '';
		var _dead_list = $('input[name=\'select_check_box_education_org_list\']:checkbox:checked');
		var x =0;
		for (var i =0; i<_dead_list.length;i++)
		{
			_str += (_str != '' ? ';': '') + _dead_list[i].id;
			x++;
		}
		$('form#education_org_killa input#dead_object_ids').val(_str);
		
		if (_str != '' && confirm(String('<%=tools_web.get_web_str('vmeo_mess_del_edu_orgs')%>').replace('{PARAM1}',x) ))
			$('form#education_org_killa').submit();
	"/>
	
	<form name="education_org_killa" id="education_org_killa" action="content_panel_process.html" method="post">
		<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
		<input type="hidden" name="href" value="<%=Request.Url%>"/>
		<input type="hidden" name="mode" value="delete_elements"/>
		<input type="hidden" name="catalog_name" value="education_org"/>
		<input type="hidden" name="dead_object_ids" id="dead_object_ids" value=""/>
	</form>
<%
	}
%>
</p>