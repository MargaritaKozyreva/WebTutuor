<%
	_doc_code = tools.get_web_str('c_doc_news');
    _doc_code = ( _doc_code == '' ? 'news' : _doc_code );
    _doc_array = XQuery( "for $elem in documents where $elem/code = '"  +_doc_code + "' return $elem" );
    _cond_str = ( ArrayOptFirstElem( _doc_array ) != undefined ? '$elem/parent_document_id = ' + ArrayFirstElem( _doc_array ).PrimaryKey.Value + ' and ' : '' );
    
	_news_array = XQuery( "for $elem in documents where " + _cond_str + "$elem/is_news = true() order by $elem/create_date descending return $elem" );

	_len = Int( curWebCommon.count_news_panel_unit )
	if ( ArrayOptFirstElem( _news_array ) != undefined )
	{
%>	
<table class="panelNewsTable" width="100%" border="0" cellspacing="0" cellpadding="3">
	<tr>
		<td><div class="NewsheaderText"><%=tools.get_web_str('vnp_news')%></div></td>
	</tr>
	<tr>
		<td class="horDividerNews"><img src="pics/1blank.gif" width="0" height="0" /></td>
	</tr>
<%
		_counter = 0;
		for ( _news in _news_array )
		{
			if ( _counter >= _len )
				break;
		
			_url = tools_web.put_query_string( _news.id , _news.template );
%>						
	<tr>
		<td class="newsColumnDigest"><span class="newsColumnDate"><%=StrDate( _news.create_date, false )%></span><br/>
			<a class="news" href="<%=_url%>"><%=_news.name%></a></td>
	</tr>
	<tr>
		<td class="horDividerNews"><img src="pics/1blank.gif" width="0" height="0" /></td>
	</tr>
<%
			_counter++;
		}
		
		if ( ArrayOptFirstElem( _doc_array ) != undefined )
		{
%>
	<tr>
		<td align="right" class="newsColumnDigest"><a href="<%=( 'view_doc.html?mode=news&doc_id=' + ArrayFirstElem( _doc_array ).PrimaryKey.Value )%>"><%=tools.get_web_str('vnp_all_news')%></a><img src="pics/more.gif" width="14" height="14" align="absmiddle" /></td>
	</tr>
<%				
		}
%>	
</table>
<%
	}
%>	