<%
for ( _poll in _list_polls )	
{				
	_result_array = XQuery( 'for $elem in poll_results where $elem/poll_id = ' + _poll + ' and $elem/poll_procedure_id = null() return $elem' );
	_child_num = ArrayCount( _result_array );

	if ( _child_num == 0 )
		continue;
	
	pollDoc = OpenDoc( UrlFromDocID( _poll ) ).TopElem;
	if ( ! pollDoc.is_main )
		continue;
		
%>
		<p><b><%=tools_web.get_cur_lng_name( pollDoc.name )%></b></p>
<%
	for( _cur_question in pollDoc.questions )
	{
		if( _cur_question.type != "choice" && _cur_question.type != "select" && _cur_question.type != "combo" )
			continue;
			
		_num = 0;	
		_entry_array = Array();
		for ( _entry in _cur_question.entries )
		{
			_cur_count = ArrayCount( ArraySelect( _result_array, "ArrayOptFind(String(main_value).split(';'),'This==\\'" + _entry.id + "\\'')!=undefined" ) );
			_entry_array[ _entry.ChildIndex ] = _cur_count;
			_num += _cur_count;
		}

%>

<table width="100%"  border="0" cellspacing="0" cellpadding="3">
<tr> 
		<td width="100%" colspan="3"><b><%=(ArrayCount(pollDoc.questions) > 1)?(_cur_question.title + ( pollDoc.is_multiple_select ? ' (' + curLngCommon.poll_types.GetChildByKey( _cur_question.type ).name + ')' : '' )) : ""%></b></td>
</tr>
<tr>
	<td class="tableHeaderNoText" WIDTH="60%"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableHeaderNoText" WIDTH="10%"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableHeaderNoText" WIDTH="10%"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableHeaderNoText" WIDTH="20%"><img src="pics/1blank.gif" width="1" height="1" /></td>					
</tr>
<%
		for ( _entry in _cur_question.entries )
		{
%>
<tr>
	<td width="60%"><IMG src="pics/arrow.gif" width="4" height="8" hspace="5">&nbsp;<%=tools_web.get_cur_lng_name( _entry.value )%></td>
	<td width="10%">
<%
			if ( _num == 0 )
			{
				_var = '0%';
				_count = 0;
			}
			else
			{
				_count = _entry_array[ _entry.ChildIndex ];								
				_var = StrReal( _count * 100.0 / _num, 1 ) + '%';
			}
		
			Response.Write( _count );
%>
	</td>
	<td width="10%"><%=_var%></td>
	<td class="description" width="20%"><img src="pics/color<%=( ( _entry.ChildIndex % 6 ) + 1 )%>.gif" border=0 width=<%=_var%> height="10"></td>
</tr>
<%
		}
%>
<tr>
	<td class="tableFooter" WIDTH="60%"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableFooter" WIDTH="10%"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableFooter" WIDTH="10%"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableFooter" WIDTH="20%"><img src="pics/1blank.gif" width="1" height="1" /></td>
</tr>

<tr>
	<td ALIGN="RIGHT"><b><%=tools.get_web_str('vprb_text1')%>:</b></td>
	<td COLSPAN="3" ALIGN="LEFT"><b><%=_child_num%></b></td>
</tr>
</table>
<br>
<%
	}
}
%>