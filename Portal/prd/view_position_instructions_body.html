<%
	cur_user=OpenDoc(UrlFromDocID( curUserID )).TopElem;
%>
<center>
	<table width="100%" border="0" height="100%">
		<tr> <td> <b><%=tools.get_web_str('c_position')%>: </b>
		<% 
			has_position=false;
			has_position_common=false;
			if (cur_user.position_id.HasValue) 
			{ 
				try
				{
					cur_user_position=OpenDoc(UrlFromDocID( cur_user.position_id )).TopElem;
					Response.Write(cur_user_position.name); 
					has_position=true;
				}
				catch(err)	
				{
					Response.Write( CodeLiteral( tools.get_web_str('c_deleted') ) );
				}
			}	
		%>
		</td> </tr>
		<tr> <td> <b><%=tools.get_web_str('c_position_common')%>: </b>	
		<%
				if (has_position && cur_user_position.position_common_id.HasValue)
				{
					try
					{
						cur_user_position_common=OpenDoc(UrlFromDocID( cur_user_position.position_common_id )).TopElem;
						Response.Write(cur_user_position_common.name);
						has_position_common=true;
					}
					catch(err)
					{
						Response.Write( CodeLiteral( tools.get_web_str('c_deleted') ) );
					}
				}
		%>
		</td> </tr>
	</table>
</center>

</br>
<table width="100%"  border="0" cellspacing="0" cellpadding="3">
	<tr>
		<td class="tableHeaderWithText" width="30%"><%=tools.get_web_str('c_section_instruction')%></td>
		<td class="tableHeaderWithText"><%=tools.get_web_str('c_content')%></td>
	</tr>
	<tr>
		<td class="tableHeaderNoText" colspan="2"> <img src="pics/1blank.gif" width="1" height="1" /></td>
	</tr>
	
	<%
	if (has_position_common)
	{
		position_common_instructionArray = XQuery('for $pi in position_common_instructions where  $pi/position_common_id='+cur_user_position.position_common_id+' order by $pi/section_instruction_name return $pi');
		counter = 0;

		function node_section( _s_id, _indent )
		{
			var _cur_section_array = XQuery( "for $elem in section_instructions where $elem/parent_object_id = " + ( _s_id == null ? 'null()' : _s_id ) + " order by $elem/name return $elem" );

			for ( _cur_sect in _cur_section_array )
			{
				_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
				%>
				<TR valign="top">					
					<TD class="<%=_class%>"><%=_indent + _cur_sect.name%></TD>
					<TD class="<%=_class%>">
					<%
						for ( _pi in  position_common_instructionArray)
						{
							if ( _cur_sect.id == _pi.section_instruction_id )
							{
								instructionDoc = OpenDoc( UrlFromDocID( _pi.PrimaryKey ) ).TopElem;
								Response.Write( instructionDoc.desc );
								break;
							}
						}
					%>
					</TD>
				</TR>	
				<%
				node_section( _cur_sect.id, _indent + '&nbsp;&nbsp;&nbsp;&nbsp;' );
			}
		}
		
		node_section(null, '');
	}
	%>
	<tr>
		<td class="tableFooter" colspan="2"> <img src="pics/1blank.gif" width="1" height="1" /></td>				
	</tr>
</table>	