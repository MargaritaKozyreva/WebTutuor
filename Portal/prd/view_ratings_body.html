<BR>

<%
	//if ( !(Request.QueryString.HasProperty("rating_id") && Request.QueryString.GetProperty("rating_id") != "" ))
	if (curRatingID == null)
	{
%>


		<table width="100%"  border="0" cellspacing="0" cellpadding="3">
					<tr>
						<td class="tableHeaderWithText"><%=tools.get_web_str("ass_ratings")%></td>
					</tr>
					<tr>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>				
					</tr>
			
			<%
				counter = 0;
				
				_my_ratings = XQuery('for $r in ratings where $r/expert_person_id = ' + curUserID + ' return $r ');
				
				for (_r in _my_ratings)
				{
					
					_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
			%>
					
				<TR VALIGN="MIDDLE">					
					<TD class="<%=_class%>"><a HREF="view_doc.html?mode=ratings&doc_id=<%=curDocID%>&object_id=<%=_r.id%>"><%=_r.name%></a></TD>
				</TR>
			<%	
				}
			%>
					<tr>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
					</tr>
		</table>
				<BR/>
<%
	}
	else
	{
			if (Request.QueryString.HasProperty("is_post") && Request.QueryString.GetProperty("is_post") == "1")
				_is_post = true;
			else
				_is_post = false;
%>
			<table width="100%" cellspacing="0" cellpadding="0" class="tableBorder">
			<tr>
				<td width="140" align="RIGHT"><b><%=tools.get_web_str("c_object_type")%>:</b>&nbsp;</td>
				<td style="font-weight:normal"><%=(curRating.object_type.HasValue ? curRating.object_type.ForeignElem.title : '*' + tools.get_web_str("vrb_not_specified") + '*')%></td>
			</tr>
			<tr>
				<td width="140" align="RIGHT"><b><%=tools.get_web_str("c_date")%>:</b>&nbsp;</td>
				<td style="font-weight:normal"><%=StrDate(curRating.date, false)%></td>
			</tr>
			<tr>
				<td width="140" align="RIGHT"><b><%=tools.get_web_str("ass_estimating_person")%>:</b>&nbsp;</td>
				<td style="font-weight:normal"><%=(curRating.expert_person_id.sd.fullname)%></td>
			</tr>
			<tr>
				<td width="140" align="RIGHT"><b><%=tools.get_web_str("c_status")%>:</b>&nbsp;</td>
				<td style="font-weight:normal"><%=(curRating.status ? tools.get_web_str("c_is_completed") : tools.get_web_str("c_active"))%></td>
			</tr>
					
			</table>
	<script language="javascript">
		<!--
		
		function moveUsMaybeUp(_idx, _where)
		{
			// _where == true - up, _where == false - down
			var _src_id = document.getElementById("object_id_" + _idx);
			var _src_name = document.getElementById("object_name_" + _idx);
			
			if (_where)
				var multiplier = -1;
			else
				var multiplier = 1;
			
			var _dest_id = document.getElementById("object_id_" + (_idx + multiplier));
			var _dest_name = document.getElementById("object_name_" + (_idx + multiplier));
			
			if (_dest_id != undefined && _dest_name != undefined && _src_id != undefined && _src_name != undefined)
			{
				var _save_id = _dest_id.value;
				var _save_name = _dest_name.value;
				
				_dest_id.value = _src_id.value;
				_dest_name.value = _src_name.value;
				
				_src_id.value = _save_id;
				_src_name.value = _save_name;
			}
			
		}
		-->
	</script>
			
			<form action='rating_save.html' name='f_switch' id='f_switch' method=POST>
			<input type="hidden" name="doc_id" value="<%=curDocID%>">
			<input type="hidden" name="object_id" value="<%=curRatingID%>">
			<input type="hidden" name="status_field" id="status_field_id" value="<%=(curRating.status ? 1 : 0)%>">
			
			<table width="100%"  border="0" cellspacing="0" cellpadding="3">
			
				<tr id="line_head">
					<td class="tableHeaderWithText" width="10px">#</td>
					<td class="tableHeaderWithText">&nbsp;</td>
				<%
					_top_count = ArrayCount(curRating.objects) - 1;
					if (_top_count > 0 && curRating.status == false)
					{
						_colspanner = 4;
				%>
					<td class="tableHeaderWithText" width="20px">&nbsp;</td>
					<td class="tableHeaderWithText" width="20px">&nbsp;</td>
				<%
					}
					else
						_colspanner = 2;
				%>
				</tr>
				<tr>
					<td class="tableHeaderNoText" colspan="<%=_colspanner%>"><img src="pics/1blank.gif" width="1" height="1"/></td>
				</tr>					
				<tbody id="recycler">
			<%
				counter = 0;
											
				for (_o in curRating.objects)
				{
					
					_class = counter++ % 2 ? 'tableRowOdd' : 'tableRowEven';
			%>
					<tr valign="middle">	
						<td class="<%=_class%>"><input id="object_index_<%=_o.ChildIndex%>" name="object_index_<%=_o.ChildIndex%>" type="text" value="<%=(_o.ChildIndex + 1)%>" class="inputEdit" style="width: 100%" readonly="readonly"/></td>
						<td class="<%=_class%>">
							<input type="hidden" id="object_id_<%=_o.ChildIndex%>" name="object_id_<%=_o.ChildIndex%>" value="<%=(_o.object_id)%>" />
							<input type="text" id="object_name_<%=_o.ChildIndex%>" name="object_name_<%=_o.ChildIndex%>" value="<%=(_o.object_name)%>" class="inputEdit" readonly="readonly" style="width: 100%"/>
						</td>
				<%
					if (_o.ChildIndex > 0 && curRating.status == false)
					{
				%>
						<td class="<%=_class%>" align="center" colspan="<%=(_o.ChildIndex == _top_count ? 2 : 1)%>">
							<input type="button" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" style="width:20px" value="^" onclick="moveUsMaybeUp(<%=_o.ChildIndex%>, true)"/>
						</td>
				<%
					}
					if (_o.ChildIndex < _top_count && curRating.status == false)
					{
				%>
						<td class="<%=_class%>" align="center" colspan="<%=(_o.ChildIndex == 0 ? 2 : 1)%>">
							<input type="button" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" style="width:20px" value="v" onclick="moveUsMaybeUp(<%=_o.ChildIndex%>, false)"/>
						</td>
				<%
					}
				%>
					</tr>
			<%
				}
			%>
							
				</tbody>
				<tr>
					<td colspan="<%=_colspanner%>" class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
			</table>
			<%
				if (curRating.status == false )
				{
					if (_is_post == false)
					{
			%>
						<p><center><input type="submit" onClick='return true' value="<%=tools.get_web_str("c_save")%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"></center></p>
			<%
					}
					else
					{
			%>
						<p><center><input type="submit" onClick='document.getElementById("status_field_id").value = 1; return true' value="<%=tools.get_web_str("ass_finish_estimation")%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"></center></p>
			<%
					}
				}
			%>
			
			
			</form>
			
			
			
			
			
<%
		if (_is_post)
			Response.Write("<script>window.alert('" + tools.get_web_str("c_form_save") + "');</script>")
	}
%>