<%
	try
	{
		curRepositoriumID = Int( Request.QueryString.object_id );
		curRepositorium = OpenDoc( UrlFromDocID( curRepositoriumID ) ).TopElem;
	}
	catch(_fuck_)
	{
		curRepositorium = null;
		curRepositoriumID = null;
	}

	try
	{
		Session.RETURN_MSG;
	}
	catch(_x_)
	{
		Session.RETURN_MSG = "";
	}

	if (Session.RETURN_MSG != "")
	{
		Response.Write("<br/><center><font size='+1' align='center'><i><b>" + HtmlEncode(Session.RETURN_MSG) + "</b></i></font></center>");
		Session.RETURN_MSG = "";
	}
%>
<script src="scripts/calendar/calendar.js"></script>
<script language="javascript">
<!--
//------------------------------------------------------------------------------------------
function buttonMouseOver()
{
	window.event.srcElement.className='inputButtonOver';
}
function buttonMouseOut()
{
	window.event.srcElement.className='inputButton';
}
function checkkey(srcobj, keycode, flag_flat)
{			
	if ((keycode<48 || keycode>57)& keycode!=46) return false;
	if (keycode==46) 
	{
		if( (!flag_flat) || srcobj.value.indexOf('.') >= 0) return false;
	}
	return true;
}
function what2submit()
{
	if($('form#repositorium_submitter input#name').val() == "")
	{
		window.alert(<%=CodeLiteral( tools_web.get_web_str("vaaeb_mess_no_name") )%>);
		return false;
	}
	return true;
}
function select_auditorys()
{
	var oPars=new Object(); oPars.check_access = true;
	var strAttr='status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1';
	
	oPars.selected_object_ids = "";
	$("form#repositorium_submitter tbody#auditorizer > tr").each(function(){oPars.selected_object_ids+=this.getAttribute("key_id") +";";});
	oPars.can_be_empty = true;
	xShowModalDialog('dlg_select.html?doc_id=<%=curDocID%>&catalog_name=collaborator&typein=1&multi_select=1&rand='+Math.random(), oPars, strAttr);
	if (!oPars.handle ) return false;
	
	$('form#repositorium_submitter tbody#auditorizer').empty();
	for (var _x = 0; _x < oPars.elemArray.length; _x++)
	{
		add_auditorys(oPars.elemArray[_x], oPars.elemNamesArray[_x]);
	}
	
}
function add_auditorys(_id, _name)
{
	var item_count = parseInt($("form#repositorium_submitter input#auditory_count").val());
	var _class = item_count % 2 ? "tableRowEven" : "tableRowOdd";
	_name = '<a href="view_doc.html?mode=collaborator&object_id='+_id+'&doc_id=<%=curDocID%>">'+_name+'</a>';
	
	$("form#repositorium_submitter tbody#auditorizer").append('<tr key_id="'+_id+'"><td class="' +_class+ '"><input type="hidden" id="auditory_id_'+item_count+'" name="auditory_id_'+item_count+'" value="'+_id+'"/>' +_name+ '</td></tr>');
	$("form#repositorium_submitter input#auditory_count").val(item_count+1);
}
//------------------------------------------------------------------------------------------
function toggle_section(_word)
{
	$("div[id^='cdiv_']").each(function(){ if (this.id == "cdiv_" + _word) $(this).show(); else $(this).hide(); });
	$("td[id^='ctd_']").each(function(){if (this.id == "ctd_" + _word){$(this).addClass("tab_td_sel"); $(this).removeClass("tab_td"); $("input#hrefhiddeninput").val("<%=tools_web.get_query_string(true, "tab")%>tab=" + _word);} else {$(this).removeClass("tab_td_sel"); $(this).addClass("tab_td");} });
	return false;
}
$(document).ready(function()
{
<%
		if (curRepositorium != null)
		for (_fldAuthorElem in curRepositorium.authors)
		{
			Response.Write('add_auditorys("'+_fldAuthorElem.PrimaryKey+'", "'+HtmlEncode(_fldAuthorElem.person_fullname)+'");');
		}
%>
	toggle_section("<%=Request.QueryString.GetOptProperty("tab",0)%>");
});
-->
</script>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td class="tab_td_empty"><img src="pics/1blank.gif" width="10" height="0"/></td>
		<td class="tab_td" id="ctd_0" onclick="return toggle_section('0');"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick="return toggle_section('0');"><%=tools_web.get_web_str("c_common_settings")%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>
<%
	if (curRepositorium != null)
	{
%>
		<td class="tab_td" id="ctd_1" onclick="return toggle_section('1');"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick=" return toggle_section('1');"><%=tools.get_web_str('c_resourses')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>
<%
	}
%>
		<td class="tab_td_empty" width="100%">&nbsp;</td>
	</tr>
</table>
<br/>
<form name="repositorium_submitter" id="repositorium_submitter" action="content_panel_process.html" method="post">
<div width="100%" id="cdiv_0" style="display: none">
<table width="100%"  border="0" cellspacing="0" cellpadding="3" name="top_report_table">
<tr>
<td>
<input type="hidden" name="repositorium_id" value="<%=(curRepositoriumID != null ? curRepositoriumID : 0)%>"/>
<input type="hidden" name="mode" value="repositorium"/>
<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
<input type="hidden" id="hrefhiddeninput" name="href" value="<%=Request.Url%>"/>

<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder" border="0">
	<tr>
		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools.get_web_str('c_code')%>:</td>
		<td style="font-weight:bolder; font-size:larger"><input type="text" id="code" name="code" value="<%=(curRepositorium != null ? HtmlEncode(curRepositorium.code) : "")%>" class="inputEdit" style="width:50px"/></td>
	</tr>
	<tr>
		<td style="font-weight:bolder; font-size:larger;" width="100px"><%=tools_web.get_web_str('c_name')%>:</td>
		<td style="font-weight:bolder; font-size:larger"><input type="text" id="name" name="name" value="<%=(curRepositorium != null ? HtmlEncode(curRepositorium.name) : "")%>" class="inputEdit" style="width:100%"/></td>
	</tr>
</table>
<div width="100%" id="div_auditory">
	<table width="100%"  border="0" cellspacing="0" cellpadding="3">
		<tr>
			<td class="tableHeaderWithText"><%=tools_web.get_web_str('vbbo_authors')%></td>
		</tr>
		<tr>
			<td class="tableHeaderNoText" colspan="1"><img src="pics/1blank.gif" width="1" height="1"/></td>
		</tr>	
		<tbody id="auditorizer"></tbody>
		<tr>
			<td class="tableFooter" colspan="1"><img src="pics/1blank.gif" width="1" height="1"/></td>
		</tr>
	</table>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
	<TR>
		<TD ALIGN="CENTER" class="activator">
			<input type="hidden" name="auditory_count" id="auditory_count" value="0"/>
			<input type="button" value="<%=tools.get_web_str('c_choose')%>..." onClick="select_auditorys();" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/>
		</TD>
	</TR>
	</table>
</div>
<br/>
<table style="font-weight:bolder; font-size:larger;" width="100%">
	<tr>
		<td><%=tools.get_web_str("c_comment")%></td>
	</tr><tr>
		<td><textarea id="comment" name="comment" style="width:100%"><%=(curRepositorium != null ? curRepositorium.comment : "")%></textarea></td>
	</tr>
</table>
<br/>
<br/>
</td>
</tr>
</table>
</div>
<div width="100%" id="cdiv_1" style="display: none">
<%
	if (curRepositoriumID != null)
	{
		bMASTER_MODE = true;
		Server.Execute("view_repositorium_body.html");
	}
	_href = tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=content_panel&doc_id="+curDocID+"&tab=repositorium";
%>
</div>
<center><input type="submit" value="<%=tools.get_web_str("c_save")%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onclick="return what2submit();"/></center>
</form>
<table style="width:100%">
<tr>
	<td width="50%" align="left">
		<a href="<%=_href%>">&laquo;&laquo;&nbsp;<%=tools_web.get_web_str("vaaeb_list_back")%></a>
	</td>
</tr>
</table>