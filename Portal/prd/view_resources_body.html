<script type="text/javascript" src="scripts/ajaxfileupload.js" ></script>
<script language="javascript">
function ajaxFileUpload()
{
	if($("#add_file_url").val()=='')
		return false;

	$("#loading")
	.ajaxStart(function(){
		$("#add_file_post").hide();
		$(this).show();
	})
	.ajaxComplete(function(){
		$(this).hide();
		$("#add_file_post").show();
	});
	$.ajaxFileUpload
	(
		{
			url:'resource_create.html?ajax=1&doc_id=<%=curDocID%>&sid=<%=tools.get_sum_sid( curDocID )%>&add_file_field=add_file_url&add_file_status='+$("#add_file_status").val()+'&add_file_desc='+escape($("#add_file_desc").val()), 
			secureuri:false,
			fileElementId:'add_file_url',
			dataType: 'json',
			success: function (data, status)
			{
				if(typeof(data.error) != 'undefined')
				{
					if(data.error != '')
					{
						alert(data.error);
					}else
					{
						alert(data.msg);
					}
				}
				window.location.reload( true );
			},
			error: function (data, status, e)
			{
				alert(e);
			}
		}
	)
	return false;
} 
</script>

<br/>
<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
	<tr>		
		<td width="200" align="right"><%=tools.get_web_str('c_file')%>:</td>
		<td><nobr><input type="file" name="add_file_url" id="add_file_url" value="" class="inputEdit" onchange="
				sSuf = this.value.slice( this.value.lastIndexOf('.') );
				arrPicSufs = new Array('.jpg','.jpeg','.jpe','.gif','.png','.bmp','.tif','.tiff','.ico');
				for(suf in arrPicSufs)
					if(arrPicSufs[suf]==sSuf)
					{
						$('select[name=add_file_status] option[value=img]').attr('selected', 'yes');
						break;
					}
		"/>&nbsp;&nbsp;&nbsp;&nbsp;<%=tools.get_web_str('vdb_file_type')%>:&nbsp;<select id="add_file_status" name="add_file_status" class="inputEdit">
<%
	for ( _resource_type in curLngCommon.resource_types )
	{
%>
						<option value="<%=_resource_type.PrimaryKey%>"><%=_resource_type.name%></option>
<%
	}
%>
					</select></nobr>
		</td>
	</tr>
	<tr>		
		<td width="200" align="right"><%=tools.get_web_str('c_desc')%>:</td>
		<td>
			<input type="text" id="add_file_desc" name="add_file_desc" value="" style="width:100%" class="inputEdit"/>
		</td>
	</tr>
	<tr>		
		<td width="200" align="right">&nbsp;</td>
		<td>
			<input type="button" id="add_file_post" value="<%=tools_web.get_web_str('vdb_upload')%>" onclick="ajaxFileUpload()" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/>
			<img src="pics/progress.gif" id="loading" style="display:none"/>
		</td>
	</tr>
</table>
</form>	

<%
xquery_qual = '$elem/person_id = ' + curUserID;
try
{
	if ( curUrlQuery.show_public_resources == '1' || curUrlQuery.show_public_resources == 'true' || curUrlQuery.show_public_resources == true || curUrlQuery.show_public_resources == 1 || curUrlQuery.show_public_resources == undefined )
		xquery_qual += ' or $elem/person_id = null()';
}
catch ( err )
{
	xquery_qual += ' or $elem/person_id = null()';
}

curView = new Object;
curView.SetProperty( 'id', '1' );
curView.SetProperty( 'catalog_name', 'resource' );
curView.SetProperty( 'disp_link', 'true' );
curView.SetProperty( 'link_field_index', 1 );
curView.SetProperty( 'sort_index', 1 );
curView.SetProperty( 'xquery_qual', xquery_qual );

Server.Execute( 'view_catalog_list.html' );
%>
<br/>