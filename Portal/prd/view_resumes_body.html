<%
	try
	{
		RedirectUrl=_url;
	}
	catch(ex)
	{
		RedirectUrl="view_doc.html?mode=resume&doc_id=" + curDocID
	}
	
	try
	{
		strBackUrl
	}
	catch(ex)
	{
		strBackUrl=(UrlPath(Request.Url) +"?"+ UrlParam(Request.Url))
	}
	
	try
	{
		isTutor;
	}
	catch ( e )
	{
		isTutor = false;
	}
	
	try
	{
		PersonID;
	}
	catch ( e )
	{
		PersonID = null;
	}
	
	try
	{
		CanAddDelResumes
	}
	catch ( e )
	{
		CanAddDelResumes=true;
	}
	try
	{
		tableID
	}
	catch ( e )
	{
		tableID='resume_table';
	}
	
	try
	{
		FormToSubmit
	}
	catch ( e )
	{
		FormToSubmit='delete_resume_form';
	}
	
	ShowDefForm=true;
	if (FormToSubmit!='delete_resume_form')
	{
		ShowDefForm=false
	}
%>
<script language="javascript">
	
	function NewResume()
	{
		document.location.href = "<%=RedirectUrl%>";
	}

	function get_selected_ids_<%=tableID%>()
	{
		var _str = "";
		try
		{
		var personArray = document.getElementsByName("select_check_box_<%=tableID%>");
		for ( var i=0; i<personArray.length; i++ )
			if ( personArray[i].checked )
				_str += personArray[i].id + ";";
		}
		catch(ex)
		{
		}
		return _str;
	}
	
	function filling_selected_object_ids<%=tableID%>()
	{
		if( ! document.getElementById("selected_resume_ids") )
			return 0;
	
		var _str = get_selected_ids_<%=tableID%>();
	
		document.getElementById("selected_resume_ids").value = _str;
		return String( _str ).split(';').length - 1;
	}
	
	function DeleteResume()
	{
		if ( filling_selected_object_ids<%=tableID%>() == 0 )
		{
			return false;
		}
		if (!window.confirm('<%=tools_web.get_web_str('vrb_mess_del')%>'))
		{
			return false
		}

		document.forms['<%=FormToSubmit%>'].command.value = "delete_resumes";
		document.forms['<%=FormToSubmit%>'].submit();		
	}

</script>
<BR>
<%
	if (CanAddDelResumes)
	{
%>
		<div align="right">
			<input type="button" value="<%=tools_web.get_web_str('vrb_create')%>" onClick="NewResume()" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"> 
		</div>
<br/>
<%
	}
%>
		<table width="100%"  border="0" cellspacing="0" cellpadding="3" id="<%=tableID%>">
					<tr>
						<td class="tableHeaderWithText">&nbsp;</td>
						<td class="tableHeaderWithText" width="20%"><%=tools.get_web_str('c_name')%></td>
						<td class="tableHeaderWithText"><%=tools_web.get_web_str('vrb_professional_field')%></td>
						<td class="tableHeaderWithText"><%=tools.get_web_str('c_create_date')%></td>
						<td class="tableHeaderWithText"><%=tools_web.get_web_str('vrb_date_last_edit')%></td>
						<td class="tableHeaderWithText">&nbsp;</td>
					</tr>
					<tr>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>				
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>	
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>	
					</tr>
<%

			if (ShowDefForm)
			{
%>							
	
		<form action="resume_delete.html" name="delete_resume_form" id="delete_resume_form" method="POST">	
			<input type="hidden" name="doc_id" value="<%=curDocID%>">
			<input type="hidden" name="command" id="command" value=""/>
			<input type="hidden" name="selected_resume_ids" id="selected_resume_ids" value=""/>
<%
			}
%>
			<input type="hidden" name="href" value="<%=strBackUrl%>"/>
			<%
				counter = 0;
				if (!isTutor)
				{
					resumeArray = XQuery( 'for $elem in resumes where $elem/person_id='+curUserID+'and $elem/creator_person_id='+curUserID+' return $elem' );
				}
				else
				{
					_where_str=' where $elem/tutor_id='+curUserID;
					if (PersonID!=null)
					{
						_where_str=_where_str+' and $elem/person_id='+PersonID;
					}
					arrDepPersons=XQuery( 'for $elem in career_reserve_tutors '+_where_str+' return $elem' );
					resumeArray=QueryCatalogByKeys( 'resumes', 'person_id', ArrayExtract(ArraySelectDistinct(arrDepPersons,'person_id'),'person_id') );
				}
				CheckboxCounter=0;
				for ( _resume in  resumeArray)
				{
								
					_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
				%>
						
					<TR VALIGN="MIDDLE">
<%
						_show_checkbox=(CanAddDelResumes&&!_resume.forbid_portal_delete)?true:false
						if (_show_checkbox)
						{
							CheckboxCounter++
%>										
							<TD class="<%=_class%>" width="10px"><input type="checkbox" id="<%=_resume.PrimaryKey%>" name="select_check_box_<%=tableID%>"/></TD>
<%
						}
						else
						{
%>										
							<TD class="<%=_class%>" width="10px">&nbsp;</TD>
<%
						}
						
%>							
				
						<TD class="<%=_class%>"><%=_resume.name%></TD>
						<TD class="<%=_class%>"><%=_resume.profession_area%></TD>
						<TD class="<%=_class%>" align="center"><%=_resume.creation_date%></TD>
						<TD class="<%=_class%>" align="center"><%=_resume.modification_date%></TD>
						<TD class="<%=_class%>" width="10%"><a HREF="<%=RedirectUrl%>&resume_id=<%=_resume.id%>"><%=tools_web.get_web_str('c_edit')%></a></TD>
					</TR>
				<%
			
				}
			%>
				
					<tr>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>						
					</tr>
		</table>
			<BR/>
			<%
			if ( ArrayCount(resumeArray) != 0 && CheckboxCounter>0)
			{  

				if (CanAddDelResumes)
				{

			%>
				<div align="right">
					<input type="button" onClick="DeleteResume()" value="<%=tools_web.get_web_str('vrb_del_sel')%>" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';">
				</div>
			<% 
				}
			}

			if (ShowDefForm)
			{
%>							
		</form>
<%
			}
%>		
		
		<BR/>