<%
result_array = Array();
if ( curUserID != undefined )
	result_array = XQuery("for $elem in selected_vacancys where $elem/person_id=" + curUserID + " return $elem")
	
if ( Request.Form.HasProperty("sort_field") && Request.Form.GetProperty("sort_field") != "")
	result_array = ArraySort( result_array, Request.Form.GetProperty("sort_field"), Request.Form.HasProperty("sort_type") ? Request.Form.GetProperty("sort_type") : "+" );

	
if ( Request.Form.HasProperty("selected_vacancy_id") && Request.Form.GetProperty("selected_vacancy_id") != "")
{
	try
	{
		DeleteDoc( UrlFromDocID( Int( Request.Form.GetProperty("selected_vacancy_id") ) ) )
	}
	catch(err)
	{
		alert("!$%$^@!$@%^" + err)
	}
}
%>

<script language="javascript">	
	function sort_result(_field_name)
	{
		document.getElementById("sort_field").value = _field_name;
		_old_value = document.getElementById("sort_type").value;
		document.getElementById("sort_type").value = ( _old_value == "+" ? "-" : "+" );
		document.all["form_sort"].submit();
	}
	
	function question( _form_name )
	{
		if ( confirm('<%=tools.get_web_str('vsvb_alert_delete')%>') )
		{
			//alert("Удаляем...")
			document.all[_form_name].submit();
		}
	}
	
</script>


<form ACTION="<%=Request.Url%>" name="form_sort" method="post">
	<input type=hidden name="sort_field" id="sort_field" value="<%=Request.Form.HasProperty('sort_field') ? Request.Form.GetProperty('sort_field') : 'name'%>">
	<input type=hidden name="sort_type" id="sort_type" value="<%=Request.Form.HasProperty('sort_type') ? Request.Form.GetProperty('sort_type') : '+'%>">

</form>

<table width="100%"  border="0" cellspacing="0" cellpadding="3">
					<tr>
						<td class="tableHeaderWithText">&nbsp;</td>
						
						<td class="tableHeaderWithText"><a href="<%=Request.Url%>#" onclick="sort_result( 'vacancy_name' )"><%=tools.get_web_str('c_vacancy')%></a></td>
						<td class="tableHeaderWithText" width="20%"><a href="<%=Request.Url%>#" onclick="sort_result( 'creation_date' )"><%=tools.get_web_str('vdb_aim_date')%></a></td>
						
						<td class="tableHeaderWithText" width="10%">&nbsp;</td>						
						<td class="tableHeaderWithText" width="2%">&nbsp;</td>
					</tr>
					<tr>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>				
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>	
					</tr>
					
	<%
		counter = 0;
		for ( _result in result_array  )
		{
			_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
			
	%>
				<TR VALIGN="MIDDLE">					
						<TD  class="<%=_class%>">&nbsp;</TD>
						
						<TD  class="<%=_class%>"><a HREF="view_doc.html?mode=vacancy_estaff&object_id=<%=_result.vacancy_id%>&doc_id=<%=curDocID%>"><%=_result.vacancy_name%> </a></TD>
						<TD  class="<%=_class%>"><%=_result.creation_date%></TD>
						<TD  class="<%=_class%>" valign=center>
						<form action="<%Request.Url%>" name="delete_response_<%=_result.id%>" method="post"> 
						  <a href="#" onclick="question('delete_response_<%=_result.id%>')"><img border="0" src="pics/Delete_2.gif"></a>
                          <input type="hidden" name="selected_vacancy_id" value="<%=_result.id%>"/> 
                        </form> 
						
						
						</TD>
						<TD  class="<%=_class%>"></TD>
					</TR>
	
	<%
		}
	%>					
					
					<tr>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>						
					</tr>
		</table>