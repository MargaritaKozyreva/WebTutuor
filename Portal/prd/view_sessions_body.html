<%
try
{
	_time = Int( Request.Query.time );
}
catch ( ff )
{
	_time = 3;
}

_sort = Request.Query.HasProperty( 'sort' ) ? Request.Query.sort : 'cur_date';

_dalta_date = DateOffset( CurDate, 0 - ( 60 * _time ) );
curSessionArray = ArraySelectDistinct( ArraySort( ArraySelect( Request.AllSessions, "HasProperty( 'cur_user_id' ) && HasProperty( 'cur_user_fullname' ) && HasProperty( 'cur_date' ) && Date( cur_date ) > _dalta_date" ), _sort, '+' ), 'cur_user_id' );

%>
<FORM ACTION="view_doc.html?mode=sessions" NAME="refresh_form" METHOD="POST">
<INPUT TYPE="HIDDEN" NAME="doc_id" VALUE="<%=curDocID%>">		

<TABLE width="100%" cellspacing="0" cellpadding="4" CLASS="tableBorder">
<TR>		
	<TD WIDTH="170" ALIGN="RIGHT"><b><%=tools.get_web_str('c_time')%>:</b></TD>
	<TD ALIGN="LEFT"><input type="text" name="time" width="10" value="<%=_time%>"/> min</TD>
</TR>
<TR>		
	<TD WIDTH="170" ALIGN="RIGHT"><b><%=tools.get_web_str('c_sort')%>:</b></TD>
	<TD ALIGN="LEFT">
	<select name="sort" onChange="document.refresh_form.submit()">
		<option value="cur_user_fullname"><%=tools.get_web_str('c_fio')%></option>
		<option value="cur_date"><%=tools.get_web_str('c_time')%></option>
	 </select>
<SCRIPT language="JavaScript">
<!--
selcur=document.forms['refresh_form'].sort;
for (i=0;i<selcur.options.length;i++) {
    if (selcur.options[i].value=="<%=_sort%>") {
        selcur.selectedIndex=i;
    }
	
if (selcur.selectedIndex==-1) {selcur.selectedIndex=0;}
}
//-->
</SCRIPT>
	</TD>
</TR>
</TABLE>

<br/>

<table width="100%"  border="0" cellspacing="0" cellpadding="3">
<tr>
	<td class="tableHeaderWithText"><%=tools.get_web_str('c_fio')%></td>
	<td class="tableHeaderWithText" WIDTH="120"><%=tools.get_web_str('c_time')%></td>
</tr>
<tr>
	<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
</tr>	
<%
			
counter = 0;
for ( _sesion in curSessionArray )
{	
	_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
%>
<TR>
	<TD class="<%=_class%>"><%=( _sesion.HasProperty( 'cur_user_fullname' ) ? _sesion.cur_user_fullname : '' )%></TD>
	<TD class="<%=_class%>"><%=( _sesion.HasProperty( 'cur_date' ) ? _sesion.cur_date : '' )%></TD>
</TR>
<%
}
%>
<tr>
	<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
</tr>
</table>
<BR/>

<TABLE width="100%" cellspacing="0" cellpadding="5" CLASS="activator">
      <TR VALIGN="MIDDLE">
		<TD ALIGN="CENTER"><input type="submit" value="<%=tools.get_web_str('c_refresh')%>" class="inputButton" onmouseover="this.className='inputButtonOver';" onmouseout="this.className='inputButton';"/></TD>
	</TR>
</TABLE>
</form>
<br>