<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
<tr>
	<td style="font-weight:bold; font-size:larger; text-align:right; width:50%"><%=tools.get_web_str("c_name")%>:</td>
	<td style="font-size:larger; font-weight:lighter; width:50%"><%=curObject.name%></td>	
</tr>
<tr>
	<td style="font-weight:bold; font-size:larger;text-align:right; width:50%"><%=tools.get_web_str("c_boss")%>:</td>
	<td style="font-size:larger; font-weight:lighter; width:50%"><%=ArrayMerge( QueryCatalogByKeys( "collaborators", "id", tools.get_sub_boss_by_sub_id( curObjectID ) ), 'fullname', ",<br/>" )%></td>	
</tr>
<%
	catParentSub = ArrayOptFirstElem(XQuery("for $elem in subdivisions where $elem/id = "+curObject.parent_object_id.XQueryLiteral + " return $elem"));
	if (catParentSub != undefined)
	{
%>
<tr>
	<td style="font-weight:bold; font-size:larger; text-align:right; width:50%"><%=tools_web.get_web_str('uf_s_depart')%>:</td>
	<td style="font-size:larger; font-weight:lighter; width:50%"><a href="view_doc.html?mode=subdivision&doc_id=<%=curDocID%>&object_id=<%=catParentSub.id%>"><%=catParentSub.name%></a></td>	
</tr>
<%
	}
	catParentOrg = curObject.org_id.OptForeignElem;
	if (catParentOrg != undefined)
	{
%>
<tr>
	<td style="font-weight:bold; font-size:larger; text-align:right; width:50%"><%=tools.get_web_str('c_org')%>:</td>
	<td style="font-size:larger; font-weight:lighter; width:50%"><a href="view_doc.html?mode=org&doc_id=<%=curDocID%>&object_id=<%=catParentOrg.id%>"><%=catParentOrg.name%></a></td>	
</tr>
<%
	}
%>
</table>
<br/>
<%Server.Execute( "view_desc.html" );%>
<br />
<script src="scripts\tree\ua000000.js"></script>
<script src="scripts\tree\ftiens40.js"></script>
<script language="javascript">
USETEXTLINKS = 1;
STARTALLOPEN = 0;
USEFRAMES = 0;
USEICONS = 0;
WRAPTEXT = 1;
PRESERVESTATE = 1;
ICONPATH = "scripts/tree/";

foldersTree = gFld("<b><%=tools.get_web_str('vsb_docs')%></b>");
<%

function _print_doc(_cur_doc_id, _depth)
{
	_new_docs = XQuery("for $elem in documents where $elem/parent_document_id = " + _cur_doc_id + " return $elem");
		
	for (_new_doc in _new_docs)
	{
		_href = "view_doc.html?doc_id=" + _new_doc.id;
		Response.Write('var sub' + _new_doc.id +' = insFld( sub' +_cur_doc_id+ ' , gFld("'+HtmlEncode(_new_doc.name)+'", "' + _href + '")); \n');
		if (_depth <= 5)
			_print_doc(_new_doc.id, (_depth + 1));
	}
}


_my_docs = XQuery("for $elem in documents where $elem/parent_object_id = " + curObjectID + " return $elem");

for (_doc in _my_docs)
{
	_href = "view_doc.html?doc_id=" + _doc.id;
	Response.Write('var sub' + _doc.id +' = insFld( foldersTree, gFld("'+HtmlEncode(_doc.name)+'", "' + _href + '")); \n');
	_print_doc(_doc.id, 0);
}
%>
</script>

<span class="TreeviewSpanArea">
	<script>initializeDocument();</script>
</span>
<br />
<%
if(curObject.show_detailed ||  curObject.show_children)	
{
	if(ArrayOptFirstElem(curObject.func_managers) != undefined)
    {
%>
<h3><%=tools.get_web_str('c_managers')%></h3>
    <table width="100%"  border="0" cellspacing="0" cellpadding="3">
        <tr>
            <td class="tableHeaderWithText"><%=tools.get_web_str('c_fio')%></td>
            <td class="tableHeaderWithText"><%=tools.get_web_str('c_position')%></td>
            <td class="tableHeaderWithText"><%=tools.get_web_str('c_manager_type')%></td>
        </tr>
        <tr>
            <td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
            <td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
            <td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
        </tr>
    <%
        counter = 0;
        for ( _person in curObject.func_managers )
        {
            _class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
    %>
        <tr valign="MIDDLE">
    <%
            try
            {
    %>
            <td class="<%=_class%>"><a href="view_doc.html?mode=collaborator&doc_id=<%=curDocID%>&object_id=<%=_person.PrimaryKey%>"><%=_person.person_fullname%></a></td>
            <td class="<%=_class%>"><%=_person.person_position_name%></td>
            <td class="<%=_class%>"><%=_person.boss_type_id.HasValue ? _person.boss_type_id.ForeignElem.name: "-"%></td>
    <%    
            }
            catch ( bv )
            {
    %>
            <td class="<%=_class%>" colspan="3"><font color="#FF0033"><%=tools.get_web_str('c_deleted')%></font></td>
    <%
            }
    %>
        </tr>
    <%
        }
    %>
        <tr>
            <td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
            <td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
            <td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
        </tr>
    </table>
<%
	}
%>    
<h3><%=tools.get_web_str('c_collaborators')%></h3>
<%
    function DrawTable(_sub_id, name)
    {
        sub = OpenDoc( UrlFromDocID( _sub_id ) ).TopElem;
        if(sub.show_detailed)
        {
            curView = new Object;
            array = XQuery("for $elem in collaborators where $elem/position_parent_id = " + _sub_id + "  and $elem/is_dismiss = false() return $elem");
            //curView.SetProperty( 'id', '1' );
            curView.SetProperty( 'title', '<a href="view_doc.html?mode=subdivision&doc_id=' + curDocID + '&object_id=' + _sub_id+ '">' + name + '</a>');
            curView.SetProperty( 'catalog_name', 'collaborator' );
            curView.SetProperty( 'disp_sort', 'false' );
            curView.SetProperty( 'disp_link', 'true' );
            curView.SetProperty( 'disp_search', 'false' );
            curView.SetProperty( 'disp_filter', 'false' );
            curView.SetProperty( 'link_field_index', 0 );
            curView.SetProperty( 'sort_index', 0 );
            curView.SetProperty( 'sort_direct', '-' );
            curView.SetProperty( 'link_mode', 'collaborator' );
            curView.SetProperty( 'array', array );
            curView.SetProperty( 'list_columns', Array('fullname','position_name') );
            curView.SetProperty( 'list_headers', Array(tools.get_web_str('c_fio'),tools.get_web_str('c_position')) );
            Server.Execute( 'view_catalog_list.html' );
            Response.Write("<br/>");                    
        }
        else
        	Response.Write('<h3><a href="view_doc.html?mode=subdivision&doc_id=' + curDocID + '&object_id=' + _sub_id+ '">' + name + '</a></h3>');
                
        if(sub.show_children)
        {
            subdivisionsArray = XQuery("for $elem in subdivisions where $elem/parent_object_id = " + _sub_id + "  return $elem");
            for(_sub in subdivisionsArray )
            {
                DrawTable(_sub.PrimaryKey, _sub.name);            
            }
        }
    }
    DrawTable(curObjectID, '');   
}    
%>