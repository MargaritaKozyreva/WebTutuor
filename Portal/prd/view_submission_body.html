<%
collaboratorDoc = OpenDoc( UrlFromDocID( curObject.person_id ) ).TopElem;
_staff = ( global_settings.settings.fill_path_subs ? ArrayMerge( collaboratorDoc.path_subs, 'name', ' -> ' ) : collaboratorDoc.position_parent_name );

isSender = curObject.person_id == curUserID;
if ( ! isSender || curObject.status_id != 'active' || curObject.status_id != 'plan' )
	readOnly = true;

curSubmissionTypeID = curObject.submission_type_id;
curSubmissionType = OpenDoc( UrlFromDocID( curSubmissionTypeID ) ).TopElem;
isRecipient = curSubmissionType.recipients.ChildByKeyExists( curUserID );

if ( curSubmissionType.use_form && isSender )
{
	formDoc = OpenNewDoc( 'x-local://wtv/wtv_form_submission_form_data.xmd' ).TopElem;
	
	if ( curSubmissionType.eval_prev_form.HasValue )
		eval( curSubmissionType.eval_prev_form );
}
%>
	
<SCRIPT LANGUAGE="JAVASCRIPT">
function doSubmit( _status )
{
	try
	{
		CollectIFrameFields();
	}
	catch ( err )
	{
	}
	
    document.forms['submission_form'].action.value = _status;   
	document.forms['submission_form'].submit();
}
</SCRIPT>

<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
	<tr>		
		<td width="140" align="RIGHT"><%=tools.get_web_str('c_coll')%>:</b></td>
		<td align="LEFT" style="font-weight:normal"><%=curObject.person_fullname%></td>
	</td>
	<tr>		
		<td width="140" align="RIGHT"><%=tools.get_web_str('c_position')%>:</b></td>
		<td align="LEFT" style="font-weight:normal"><%=curObject.person_position_name%></td>
	</td>
	<tr>		
		<td width="140" align="RIGHT"><%=tools.get_web_str('c_subd')%>:</b></td>
		<td align="LEFT" style="font-weight:normal"><%=_staff%></td>
	</td>
	<tr>		
		<td width="140" align="RIGHT"><%=tools.get_web_str('c_org')%>:</b></td>
		<td align="LEFT" style="font-weight:normal"><%=curObject.person_org_name%></td>
	</td>
	<tr>
		<td colspan="2">&nbsp;</td>
	</td>
	<tr>		
		<td width="140" align="RIGHT"><%=tools.get_web_str('c_status')%>:</b></td>
		<td align="LEFT" style="font-weight:normal"><%=curLngCommon.submission_states.GetChildByKey( curObject.status_id ).name%></td>
	</td>
</table>

<FORM ACTION="submission_change.html" NAME="submission_form" METHOD="POST" enctype="multipart/form-data">
	<input type="hidden" name="doc_id" value="<%=curDocID%>"/>
	<input type="hidden" name="object_id" value="<%=curObjectID%>"/>
	<input type="hidden" name="sid" value="<%=tools.get_sum_sid( curDocID )%>"/>
	<input type="hidden" id="form_data_xml" name="form_data_xml" value=""/>
	<input type="hidden" name="action" value="active"/>

<%
	if ( curSubmissionType.use_form && isSender )
	{
		Server.Execute( "view_submission_form.html" );
	}
	else
	{
		Server.Execute( "view_custom_templates.html" );
	}
%>

<br/>
<%
	if ( curObject.status_id != 'plan' && curObject.status_id != 'active' )
    {
%>
	<table>
    	<TR>
			<TD WIDTH="140" ALIGN="RIGHT"><%=tools.get_web_str('c_comment')%>:</TD>
<% 
		if ( isRecipient && curObject.status_id == 'approve' )
		{
%>
             <TD STYLE=" font-weight:normal"><TEXTAREA ROWS="2" COLS="50" name="decline_desc" id="decline_desc" CLASS="inputTextarea" STYLE="width: 600px; height: 100px;"><%=curObject.decline_desc%></TEXTAREA></TD>
<%
		}
		else
		{
%>				
            <TD STYLE=" font-weight:normal"><%=curObject.decline_desc%></TD>
<%
		}
%>
		</TR>
	</table>
<%
    }
%>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
		<TD ALIGN="CENTER" class="activator">
<%
 	if ( isSender )
	{
%>
		<input type="button" value="<%=tools.get_web_str('c_save')%>" onclick="doSubmit('active')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">
		<input type="button" value="<%=tools.get_web_str('vsb_approve')%>" onclick="doSubmit('approve')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">
<%
	}
	
    if ( isRecipient )
    {
%>
		<input type="button" value="<%=tools.get_web_str('c_reject')%>"  onclick="doSubmit('declined')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">    
		<input type="button" value="<%=tools.get_web_str('c_confirm')%>"  onclick="doSubmit('confirmed')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">
<%
    }
%>
		</TD>
	</table>
</FORM>