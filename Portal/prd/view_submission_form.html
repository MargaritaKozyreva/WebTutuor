
<script type="text/javascript" src="scripts/browser.js"></script>
<script type="text/javascript">

var oStateXML = CreateDOMDocument();
var oResXML = CreateDOMDocument();
var oIFrame;
var iCheckTimer = 0;
var bLoaded = false;

function LoadIFrame(sURL)
{
	if(sURL==null) return false;
	if(sURL=="") return false;
	oIFrame = document.getElementById("wsIFrame");
//	oIFrame = document.frames["wsIFrame"];
	if(oIFrame==null) return false;
	oIFrame.src = sURL;
//	oIFrame.onreadystatechange = CheckLoading;
//	iCheckTimer = setTimeout("CheckLoading()",50);
	return false;
}

function LoadStateXML() {
	if(oIFrame==null) {
		iCheckTimer = setTimeout("LoadStateXML()", 100);
		return false;
	}
	if(bLoaded) return false;
	bLoaded = true;
	var aXML = document.getElementsByTagName("XML");
	if(aXML.length==0) return false;
	for(var i=0;i<aXML.length;i++)
	{
		if(aXML[i].getAttribute("id")=="state")
		{
			if(g_isMSIE)
			{
				oStateXML.loadXML(trim(aXML[i].innerHTML));
			}
			else
			{
				var parser = new DOMParser();
				oStateXML = parser.parseFromString(trim(aXML[i].innerHTML),"text/xml");
			}
			SetIFrameFields();
			return true;
		}
	}
	return false;
}

function CheckLoading()
{
	switch(oIFrame.readyState)
	{
		case "complete":
			LoadStateXML();
			return false;
		default:
			return false;
	}
}

function SetIFrameFields()
{
	var oIFDoc = g_isMSIE ? oIFrame.contentWindow.document : oIFrame.contentDocument;
	var aInputs = oIFDoc.getElementsByTagName("input");
	if(aInputs.length==0) return false;
	var aFields = oStateXML.selectNodes("//data/fields/field");
	if(aFields.length==0) return false;
	var sId = "";
	var oField, oValue, oDisabled;
	for(var i=0;i<aInputs.length;i++)
	{
		sId = aInputs[i].getAttribute("id");
		if(sId==null || sId=="") sId = aInputs[i].getAttribute("name");
		oField = oStateXML.selectSingleNode("//data/fields/field[id/text()='"+sId+"']");
		if(oField==null) continue;
		oValue = oField.selectSingleNode("value");
		if(oValue&&oValue.text!=null) aInputs[i].value = oValue.text;
		oDisabled = oField.selectSingleNode("disabled");
		if(oDisabled&&oDisabled.text!=null) aInputs[i].disabled = (oDisabled.text=="1");
	}
	return false;
}

function CollectIFrameFields()
{
	var oIFDoc = g_isMSIE ? oIFrame.contentWindow.document : oIFrame.contentDocument;
	var aInputs = oIFDoc.getElementsByTagName("input");
	if(aInputs.length==0) return false;
	var aFields = oStateXML.selectNodes("//data/fields/field[disabled/text()='0']");
	if(aFields.length==0) return false;
	if(g_isMSIE)
	{
		oResXML.loadXML("<data><fields></fields></data>");
	}
	else
	{
		var parser = new DOMParser();
		oResXML = parser.parseFromString("<data><fields></fields></data>","text/xml");
	}
	var oRoot = oResXML.selectSingleNode("data/fields");
	var sId = "";
	var sValue = "";
	var oInput, oId, oType, oField;
	var reSpace = /\s/g;
	for(var i=0;i<aFields.length;i++)
	{
		oId = aFields[i].selectSingleNode("id");
		if(oId==null) continue;
		sId = oId.text;
		if(sId=="") continue;
		oInput = oIFDoc.getElementById(sId);
		if(oInput==null) continue;
		oField = AppendNode(oResXML, oRoot, "field");
		AppendNode(oResXML, oField, "id", sId);
		sValue = oInput.value;
		oType = aFields[i].selectSingleNode("type");
		if(oType!=null)
		{
			if(oType.text=="integer" || oType.text=="real")
			{
				sValue = sValue.replace(reSpace, "");
			}
		}
		AppendNode(oResXML, oField, "value", sValue);
	}
	var sXML = oResXML.xml;
	var oHiddenField = document.getElementById("form_data_xml");
	if(oHiddenField==null) return false;
	oHiddenField.value = sXML;
	return false;	
}

</script>



<div style="display:none;">
<XML id="state">
<%=formDoc.Xml%>
</XML>
</div>

<iframe id="wsIFrame" name="wsIFrame" width="100%" height="600" frameborder="1"></iframe>
<br/>


<script language="javascript">
LoadIFrame('submission_get_form.html?object_id=<%=curSubmissionTypeID%>&doc_id=<%=curDocID%>&sid=<%=tools.get_sum_sid( curDocID )%>');
</script>
