<%
curFilter = ( Request.Query.HasProperty( 'filter_id' ) ? Request.Query.filter_id : 'all' );			
curQueryString = tools_web.get_query_string( true, 'filter_id' );

curView = new Object;
curView.SetProperty( 'id', '1' );
curView.SetProperty( 'catalog_name', 'submission' );
curView.SetProperty( 'disp_link', 'true' );
curView.SetProperty( 'link_field_index', 0 );
curView.SetProperty( 'sort_index', 0 );
curView.SetProperty( 'sort_direct', '-' );

curArray = XQuery( "for $elem in submissions where $elem/person_id = " + curUserID  + ( curFilter == 'all' ? '' : " and $elem/status_id = '" + curFilter + "'" ) + " return $elem" );

_submission_type_array = ArraySelectDistinct( XQuery( "for $elem in submission_recipients where $elem/collaborator_id = " + curUserID + " return $elem" ), 'submission_type_id' );
_submission_array = QueryCatalogByKeys( 'submissions', 'submission_type_id', ArrayExtract( _submission_type_array, 'submission_type_id' ) );
if ( curFilter != 'all' )
	_submission_array = ArraySelectByKey( _submission_array, curFilter, 'status_id' );

curArray = ArrayUnion( curArray, _submission_array );

curView.SetProperty( 'array', curArray );
curView.SetProperty( 'title', tools.get_web_str('c_submissions') );
%>

<br/>

<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
	<tr>		
		<td width="200" align="RIGHT"><b><%=tools.get_web_str('c_status')%>:</b></td>
		<td align="LEFT">
		<select name="filter_id" id="filter_id" onchange="document.location.href='<%=curQueryString%>filter_id='+this.value">
			<option value="all" selected="selected"><%=tools.get_web_str('c_all')%></option>
<%
	for ( _status in curLngCommon.submission_states )
	{
%>
            <option value="<%=_status.PrimaryKey%>"><%=_status.name%></option>
<%
	}
%>	
         </select>
		 
<script language="JavaScript">
selcur=document.getElementById('filter_id');
for (i=0;i<selcur.options.length;i++) {
    if (selcur.options[i].value=="<%=curFilter%>") {
        selcur.selectedIndex=i;
		break;
    }
}
</script>
		</td>
	</tr>
</table>
<br/>

<%Server.Execute( 'view_catalog_list.html' )%>
<br/>