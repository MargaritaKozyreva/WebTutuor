<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
	var win;
	var aTimer;
	var courseWindow = window;
	
	function refr()
	{
		clearTimeout( aTimer );
		
		if( win && win.closed )
		{
/*		
			_href = String( document.location.href );
			
			if ( _href.indexOf( 'start=' ) == -1 )
				document.location.reload();
			else
				document.location.href = _href.slice( 0, _href.indexOf( 'start=' ) - 1 );
*/
			document.location.href = 'view_doc.html?mode=learning_proc&doc_id=<%=curDocID%>&object_id=<%=curObjectID%>&course_id=<%=curObject.course_id%>';
			return;
		}
		
		aTimer = setTimeout( 'refr()', 5000 );
	}
	
	function test_launch( _width, _height )
	{
		if( screen.availWidth < _width || screen.availHeight < _height )
			alert("<%=tools.get_web_str('vcplb_message1')%>");
			
		win = window.open( 'course_launch.html?course_id=<%=curObject.course_id%>&object_id=<%=curObjectID%>&sid=<%=tools.get_sum_sid( curObject.course_id )%>&part_code=<%=curPart.code%>', 'win<%=curObjectID%>', 'toolbar=no,location=no,status=no,menubar=no,resizable=yes,directories=no,scrollbars=no,width=' + _width + ',height=' + _height );
		win.moveTo( 0, 0 );
			
		aTimer = setTimeout( 'refr()', 10000 );
	}
//-->
</SCRIPT>	




<TABLE width="100%" cellspacing="4" cellpadding="0">
<%
	if ( curPart.attempts_num > curPart.test_learnings.ChildNum )
	{
%>
	<TR>
		<TD>
		
		<TABLE width="100%" cellspacing="0" cellpadding="4" CLASS="tableBorder">			
			<TR>
				<TD WIDTH="200" ALIGN="RIGHT"><b><%=tools.get_web_str('c_act_date')%>:</b>&nbsp;</TD>
				<TD STYLE="font-weight:normal"><%=StrDate( curPart.start_usage_date, true, false )%></TD>
			</TR>
			<TR>
				<TD WIDTH="200" ALIGN="RIGHT"><b><%=tools.get_web_str('vtlpb_last_use')%>:</b>&nbsp;</TD>
				<TD STYLE="font-weight:normal"><%=StrDate( curPart.last_usage_date, true, false )%></TD>
			</TR>
			<TR>
				<TD WIDTH="200" ALIGN="RIGHT"><b><%=tools.get_web_str('c_pass_score')%>:</b>&nbsp;</TD>
				<TD STYLE="font-weight:normal"><%=curAssessment.passing_score%></TD>
			</TR>
			<TR>
			<TR>
				<TD WIDTH="200" ALIGN="RIGHT"><b><%=tools.get_web_str('c_score')%>:</b>&nbsp;</TD>
				<TD STYLE="font-weight:normal"><%=curPart.cur_score%>&nbsp;<%=( curAssessment.passing_score == 0 || curAssessment.passing_score == null ? '' : '(' + ( ( 100 * curPart.cur_score ) / curAssessment.passing_score ) + '%)' )%></TD>
			</TR>
			<TR>
			<TR>
				<TD WIDTH="200" ALIGN="RIGHT"><b><%=tools.get_web_str('c_attempt_num')%>:</b>&nbsp;</TD>
				<TD STYLE="font-weight:normal"><%=( curPart.test_learnings.ChildNum + 1 )%>&nbsp;/&nbsp;<%=curPart.attempts_num%></TD>
			</TR>
			<TR>
				<TD WIDTH="200" ALIGN="RIGHT"><b><%=tools.get_web_str('c_state')%>:</b>&nbsp;</TD>
				<TD STYLE="font-weight:normal"><%=curLngCommon.learning_states.GetChildByKey( curPart.cur_state_id ).name%></TD>
			</TR>
		</TABLE>
	
		</TD>
	</TR>	
	<TR>
		<TD>
		
		<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" class="activator">
			<TR>
				<TD align="center" width=33% class="activator">
<%
		_win_width = curAssessment.win_width//750;
		_win_height = curAssessment.win_height//530;	
%>
			<input type="button" value="<%=(curPart.cur_state_id == 0 ? tools.get_web_str('vtlpb_start') : tools.get_web_str('vtlpb_next') )%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onClick="test_launch( '<%=_win_width%>', '<%=_win_height%>' );">
<%
		if ( curPart.attempts_num > 1 )
		{
%>
			<input type="button" value="<%=tools.get_web_str('vtlpb_end_attempt')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';" onClick="document.location.href='test_finish.html?object_id=<%=curObjectID%>&assessment_id=<%=curAssessmentID%>&sid=<%=tools.get_sum_sid(curObjectID)%>&code=<%=curPart.code%>&attempt='">
<%
		}
%>
				</TD>
			 </TR>
		</TABLE>
		
		</TD>
	</TR>
	
<%
	}

	if ( curPart.attempts_num > 1 || curPart.test_learnings.ChildNum > 0 )
	{
%>	
	<TR>
		<TD>
		
		<p class="headerText" style="margin-top:10px; margin-bottom:10px;"><%=tools.get_web_str('vlpb_last_attemps')%></p>
		<table width="100%"  border="0" cellspacing="0" cellpadding="3">
			<tr>
				<td class="tableHeaderWithText"><%=tools.get_web_str('c_date')%></td>
				<td class="tableHeaderWithText" WIDTH="120"><%=tools.get_web_str('c_score')%></td>
				<td class="tableHeaderWithText" WIDTH="120"><%=tools.get_web_str('c_state')%></td>
			</tr>
			<tr>
				<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
				<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
				<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
			</tr>	
<%
		counter = 0;
		for ( _test_learning in curPart.test_learnings )
		{
			_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
%>
			<TR VALIGN="top">					
				<TD class="<%=_class%>"><a HREF="view_doc.html?mode=test_learning_stat&doc_id=<%=curDocID%>&object_id=<%=_test_learning.PrimaryKey%>&assessment_id=<%=curAssessmentID%>&sid=<%=tools.get_sum_sid(_test_learning.PrimaryKey)%>" title="<%=tools.get_web_str('c_tip_edu_method')%>"><%=( StrDate( _test_learning.start_usage_date, true, false ) + ' - ' + StrDate( _test_learning.last_usage_date, true, false ) )%></a></TD>
				<TD class="<%=_class%>"><center><%=StrReal( _test_learning.score, 1 )%>&nbsp;<%=( curPart.max_score == 0 || curPart.max_score == null ? '' : '(' + StrReal( ( 100 * _test_learning.score ) / curPart.max_score, 1 ) + '%)' )%></center></TD>
				<TD class="<%=_class%>"><center><%=( _test_learning.state_id.HasValue ? curLngCommon.learning_states.GetChildByKey( _test_learning.state_id ).name : '' )%></center></TD>
			</TR>
<%	
		}
%>
			<tr>
				<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
				<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
				<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
			</tr>
		</table>
						
		</TD>
	</TR>
<%
	}
%>

</TABLE>