<%
	if ( curUser.in_request_black_list )
	{
%>
<center><b><%=tools.get_web_str('veb_text_in_request_black_list')%></b></center>
<%
		Cancel();
	}
	
		
	template_req_type='request_education_method';
	try
	{
		if (Trim(curDoc.wvars.ObtainChildByKey('req_type_code').value)!="")
		{
			template_req_type=Trim(curDoc.wvars.ObtainChildByKey('req_type_code').value)
		}
	}
	catch(ex)
	{
	}
	
	repeat_template_search=false;
	try
	{
		temp_template=ArrayFirstElem(XQuery("for $elem in request_types where $elem/code='"+template_req_type+"' return $elem"))
		if (Trim(temp_template.object_type)!='education_method')
		{
			Response.Write("<font color='red' stle='font-weight: boldest'>" + tools_web.get_web_str('vtmb_err_not_use') + "</font><br/>");
			repeat_template_search=true;
		}
		else
		{
			template_req_type_id=temp_template.id;
		}
		
	}
	catch(ex)
	{
		Response.Write("<font color='red' stle='font-weight: boldest'>" + tools_web.get_web_str('vtmb_err_not_is') + "</font><br/>");
		repeat_template_search=true;
	}
	
	if (repeat_template_search)
	{
		template_req_type='request_education_method';
		try
		{
			template_req_type_id=ArrayFirstElem(XQuery("for $elem in request_types where $elem/code='"+template_req_type+"' return $elem")).id
		}
		catch(ex)
		{
			Response.Write("<font color='red' stle='font-weight: boldest'>" + tools_web.get_web_str('vtmb_err_not_find') + "</font><br/>");
			Cancel();
		}
	}
	
	
	
	try
	{
		if (Trim(curDoc.wvars.ObtainChildByKey('show_other').value)=="1")
		{
			show_other=true;
		}
		else
		{
			show_other=false;
		}
	}
	catch(ex)
	{
		//Response.Write(ex+'<br/>')
		show_other=false;
	}
	
	try
	{
		if (Trim(curDoc.wvars.ObtainChildByKey('use_def_workflow').value)=="1")
		{
			use_def_workflow=true;
		}
		else
		{
			use_def_workflow=false;
		}
	}
	catch(ex)
	{
		//Response.Write(ex+'<br/>')
		use_def_workflow=false;
	}
	
	
	
	try
	{
		other_name=String(curDoc.wvars.ObtainChildByKey('other_name').value)
	}
	catch(ex)
	{
		other_name='other'
	}
	
	if (other_name=='')
	{
		other_name='other'
	}
	
	try
	{
		flagCheckAccess=(Int(check_edu_prog_and_method_access)>0?true:false)
	}
	catch(ex)
	{
		flagCheckAccess=false;
	}



	_hide_dismissed = (Request.Query.HasProperty("hide_dismissed") && Request.Query.GetProperty("hide_dismissed") == "1");
	
	selected_budget_period='';
	budget_period_name='';
	if (Request.QueryString.HasProperty("selected_budget_period"))
	{
		selected_budget_period=Request.QueryString.GetProperty("selected_budget_period")
		try
		{
			budget_period_name=ArrayFirstElem(XQuery("for $elem in budget_periods where $elem/id="+Int(selected_budget_period)+" return $elem")).name;

		}
		catch(ex)
		{
			alert(ex)
		}
	}
	
	
	if (selected_budget_period=='')
	{
		try
		{
			def_budget_period=String(curDoc.wvars.ObtainChildByKey('def_budget_period_code').value)
		}
		catch(ex)
		{
			def_budget_period=''
		}
		
		if (Trim(def_budget_period)!='')
		{
			try
			{
				
				def_bp=ArrayFirstElem(XQuery("for $elem in budget_periods where $elem/code='"+Trim(def_budget_period)+"' return $elem"))
				selected_budget_period=def_bp.id;
				budget_period_name=def_bp.name;
	
			}
			catch(ex)
			{
				//alert(ex)
			}
		}
	}
	
	arrEducationPrograms=Array()
	arrMethods=Array();
	//&education_program_methods_ids=5368660029372655750@@5363074711399641737;5363074711399641740|5413649868913062452@@5363074711399641744
	tempArrEducationPrograms=Array();
	sel_program="&selected_budget_period="+selected_budget_period;
	if (Request.QueryString.HasProperty("education_program_methods_ids"))
	{
		_temp=Request.QueryString.GetProperty("education_program_methods_ids")
		sel_program=sel_program+"&education_program_methods_ids="+_temp;
		tempArrEdPr=_temp.split("|")
		counter=0;
		for (iEduProg  in tempArrEdPr)
		{
			try
			{
				NewElem= new Object;
				
				EdAndMethArr=iEduProg.split("@@")
				NewElem.program_id=Int(EdAndMethArr[0])
				NewElem.methods=EdAndMethArr[1]
				tempArrEducationPrograms[counter]=NewElem;
				counter++;

			}
			catch(ex)
			{
			}
		}
	}
	counter=0;
	for( iEduProg in education_programs)
	{
		if (flagCheckAccess)
		{
			try
			{
				teEduProg = OpenDoc( UrlFromDocID( iEduProg.id ) ).TopElem;
			}
			catch(err)
			{
				continue;
			}
			if ( !tools_web.check_access( teEduProg, curUserID, curUser, Session ) )
			{
				continue;
			}
			
			arrProgMethods=XQuery('for $elem in education_program_education_methods where $elem/education_program_id='+iEduProg.id+' return $elem');
			
			temp_counter=0;
			for (iProgMethodElem in arrProgMethods)
			{
				try
				{
					teEduMethod = OpenDoc( UrlFromDocID( iProgMethodElem.education_method_id ) ).TopElem;
				}
				catch(err)
				{
					continue;
				}
				if ( !tools_web.check_access( teEduMethod, curUserID, curUser, Session ) )
				{
					continue;
				}
				temp_counter++
			}
			
			if (temp_counter==0)
			{
				continue;
			}

		}
		NewProgram=new Object
		NewProgram.id=iEduProg.id;
		NewProgram.name=iEduProg.name;
		NewProgram.real_method=true;
		NewProgram.arrMethods=Array()
		curProgram=ArrayOptFind(tempArrEducationPrograms,'program_id=='+NewProgram.id)
		if (curProgram!=undefined)
		{
			try
			{
				tempArr=curProgram.methods.split(";")
				NewTempArr=Array()
				temp_counter=0;
				for (Elem in tempArr)
				{
					try
					{
						if (flagCheckAccess)
						{
							try
							{
								teEduMethod = OpenDoc( UrlFromDocID( Int(Elem) ) ).TopElem;
							}
							catch(err)
							{
								continue;
							}
							if ( !tools_web.check_access( teEduMethod, curUserID, curUser, Session ) )
							{
								continue;
							}
						}
						NewTempArr[temp_counter]=Int(Elem)
						temp_counter++;
					}
					catch(ex)
					{
	
					}
				}
				curEduMethodsArr=QueryCatalogByKeys( 'education_methods', 'id', NewTempArr );
				NewProgram.arrMethods=curEduMethodsArr;
				arrMethods=ArrayUnion(arrMethods,curEduMethodsArr);
			}
			catch(ex)
			{
			}
		}
		arrEducationPrograms[counter]=NewProgram
		counter++
	}
 	arrEducationPrograms=ArraySort(arrEducationPrograms,'name', '+' );

	arrOtherMethods=Array()
	if (show_other)
	{
		if (Request.QueryString.HasProperty("other_education_program_methods_ids"))
		{
			_temp=Request.QueryString.GetProperty("other_education_program_methods_ids")
			//alert(_temp)
			sel_program=sel_program+"&other_education_program_methods_ids="+UrlEncode(_temp);
			tempArrOther=_temp.split("|")
			tempArrOther=ArraySelectDistinct(tempArrOther,"StrLowerCase(This)")
		}
		else
		{
			tempArrOther=ArraySelectDistinct(ArrayExtract(XQuery('for $elem in requests where $elem/type=\'education_method\' and $elem/request_type_id='+template_req_type_id+' and $elem/status_id=\'active\' and $elem/object_id=null() return $elem'),'object_name'),"StrLowerCase(This)")
			//all_methods=ArrayMerge(arrTempEducationMethods,'HtmlEncode(This)',';')
		}
		counter=0;
		for (iOtherElem in tempArrOther)
		{
			if (iOtherElem!='')
			{
				try
				{
					NewElem= new Object;
					NewElem.id='other'+counter
					NewElem.name=iOtherElem
					arrOtherMethods[counter]=NewElem;
					counter++;
				}
				catch(ex)
				{
				}
			}
		}
		arrMethods=ArrayUnion(arrMethods,arrOtherMethods);
		
	}


	//curMethods=education_programs;
	
curPersonsArray=Array();
arrPersonMethodRequest=Array();
repeat_search=false;
if ((Request.Query.HasProperty("new_req") && Request.Query.GetProperty("new_req") == "1"))
{
	repeat_search=true;
	Session.person_method_request=Array();
}
else
{
	try
	{
		arrPersonMethodRequest=Session.person_method_request;
	}
	catch(_netu_)
	{
		repeat_search=true;
		Session.person_method_request=Array();
	}
}

if (show_other)
{
	repeat_search=true;
}
if (repeat_search)
{
	if (selected_budget_period!='')
	{
		counter=0;
		arrMethods=ArraySelectDistinct(arrMethods,'id')
		for (iMethodElem in arrMethods)
		{
			//Response.Write(iMethodElem.id+'<br/>');
			try
			{
				_id=Int(iMethodElem.id)
				//Response.Write("for $elem in requests where $elem/type='education_method' and $elem/request_type_id="+template_req_type_id+" and $elem/status_id='active' and $elem/budget_period_id="+Int(selected_budget_period)+" and $elem/object_id="+_id+" return $elem"+'<br/>');
				arrRequests=XQuery("for $elem in requests where $elem/type='education_method' and $elem/request_type_id="+template_req_type_id+" and $elem/status_id='active' and $elem/budget_period_id="+Int(selected_budget_period)+" and $elem/object_id="+_id+" return $elem")
			}
			catch(ex)
			{
				//Response.Write('for $elem in requests where $elem/type=\'education_method\' and $elem/object_id=null() and $elem/object_name='+XQueryLiteral(iMethodElem.name)+' return $elem'+'<br/>');
				arrRequests=XQuery('for $elem in requests where $elem/type=\'education_method\' and $elem/status_id=\'active\' and $elem/request_type_id='+template_req_type_id+' and $elem/object_id=null() and $elem/object_name='+XQueryLiteral(iMethodElem.name)+' return $elem')
			}
			
			for (iRequestElem in arrRequests)
			{
				if (iRequestElem.is_group)
				{
					try
					{
						requestData= XQuery( 'for $elem in request_collaborators where $elem/request_id='+iRequestElem.id+' return $elem')
						for (iPersonElem in requestData)
						{
							NewUserReq=new Object;
							NewUserReq.person_id=iPersonElem.person_id;
							NewUserReq.person_fullname=iPersonElem.person_fullname;
							NewUserReq.method_id=iMethodElem.id
							NewUserReq.method_name=iMethodElem.name
							NewUserReq.req_id=iRequestElem.id;
							NewUserReq.bHasUsers=false;
							
							arrPersonMethodRequest[counter]=NewUserReq
							counter++;
						}
/*
						teRequest=OpenDoc(UrlFromDocID(iRequestElem.id)).TopElem;
						for (iPersonElem in teRequest.persons)
						{
							NewUserReq=new Object;
							NewUserReq.person_id=iPersonElem.person_id;
							NewUserReq.person_fullname=iPersonElem.person_fullname;
							NewUserReq.method_id=iMethodElem.id
							NewUserReq.method_name=iMethodElem.name
							NewUserReq.req_id=iRequestElem.id;
							
							arrPersonMethodRequest[counter]=NewUserReq
							counter++;
						}
*/
					}
					catch(ex)
					{
					}
				}
				else
				{
					NewUserReq=new Object;
					NewUserReq.person_id=iRequestElem.person_id;
					NewUserReq.person_fullname=iRequestElem.person_fullname;
					NewUserReq.method_id=iMethodElem.id
					NewUserReq.method_name=iMethodElem.name;
					NewUserReq.req_id=iRequestElem.id;
					NewUserReq.bHasUsers=false;
					
					arrPersonMethodRequest[counter]=NewUserReq
					counter++;
				}
			}
		}
		
	}
	Session.person_method_request=arrPersonMethodRequest;
}
//Response.Write(sel_program+'<br/>')

//Response.Write(sel_program+'<br/>')
/*for (elem in arrPersonMethodRequest)
{
	Response.Write(elem.method_name+' ' +elem.person_fullname+ '<br/>')
}*/
%>
<script language="javascript">
//<!--
	function ToggleBookmark(id)
	{
		
		if (document.getElementById('budget_period_id').value =='')
		{
			alert(<%=CodeLiteral( tools_web.get_web_str('vtmb_err_budget_per') )%>);
			return false;
		}
		
		if (id==1)
		{
			if (eval(document.getElementById("changed").value))
			{
				if (confirm(<%=CodeLiteral( tools_web.get_web_str('tmd_confirm_mess') )%>)==true)
				{
					document.getElementById("tab").value = id;
					doSubmit('save');
					return false;
				}
			}
		}
		
		for(i=0; i<2; i++)
		{
			if(i != id)
			{
				document.getElementById("td_" + i).className = 'tab_td';
				document.getElementById("bm_" + i).style.display = 'none';
			}
			else
			{
				document.getElementById("td_" + i).className = 'tab_td_sel';
				document.getElementById("bm_" + i).style.display = '';
			}
		}
		
		document.getElementById("tab").value = id;
		if (id==1)
		{
			RecountRequests();
<%
			for ( ListElem in arrMethods )
			{
%>
/*				if ( document.getElementById('changed_<%=ListElem.id%>').value == '' )
				{	
					document.getElementById('tr_req_<%=ListElem.id%>').style.display = 'none';
				}
				else
				{
					document.getElementById('tr_req_<%=ListElem.id%>').style.display = '';
				}*/
<%
			}
%>

		}
		//var _href = "view_doc.html?mode=<%=curMode%>&doc_id=<%=curDocID%><%=(_hide_dismissed?"&hide_dismissed=1":"")%>"+"<%=sel_program%>";
		//var _href ="<%=HtmlEncode(tools_web.get_query_string(true, "tab"))%>&tab=" + _id ;
		//window.location.href = _href;
	}
//-->
</script>
	
<style>
	.tab_td {
		border-right: #aaaaaa 1px solid; border-top: #aaaaaa 1px solid; border-left: #aaaaaa 1px solid; border-bottom: #aaaaaa 1px solid; text-align: center; background-color: #EEEEEE;
	}
	.tab_td_sel {
		border-right: #aaaaaa 1px solid; border-top: #aaaaaa 1px solid; border-left: #aaaaaa 1px solid; border-bottom: #aaaaaa 0px solid; text-align: center; font-weight:bold; height:24px;
	}
	.tab_td_empty {
		border-bottom: #aaaaaa 1px solid;
	}
</style>

<%
if (Request.Query.HasProperty("tab"))
	_selectedTab = Int(Request.Query.GetProperty("tab"));
else
	_selectedTab = 0;
%>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td class="tab_td_empty"><img src="pics/1blank.gif" width="10" height="0"/></td>
		
		<td class="<%=(_selectedTab == 0 ? "tab_td_sel" : "tab_td")%>" id="td_0" onclick="ToggleBookmark(0)"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick=""><%=tools.get_web_str('c_collaborators')%></a></td>
		<td class="tab_td_empty" width="10px">&nbsp;</td>

		<td class="<%=(_selectedTab == 1 ? "tab_td_sel" : "tab_td")%>" id="td_1" onclick="ToggleBookmark(1)"><img src="pics/1blank.gif" width="140" height="0"/><br/><a style="text-decoration:none" href="#" onclick=""><%=tools.get_web_str('c_requests')%></a></td>
		
		<td class="tab_td_empty" width="10px">&nbsp;</td>
		
		<td class="tab_td_empty" width="10px">&nbsp;</td>
		
		<td class="tab_td_empty" width="100%">&nbsp;</td>
	</tr>
</table>

<FORM ACTION="tna_matrix_save.html" NAME="action_process" METHOD="POST" enctype="multipart/form-data">
<input type='hidden'  id='template_req_type_id' name='template_req_type_id' value='<%=template_req_type_id%>'/>
<input type='hidden'  id='use_def_workflow' name='use_def_workflow' value='<%=use_def_workflow%>'/>
<input type='hidden'  id='repeat_search' name='repeat_search' value='<%=repeat_search%>'/>
<input type='hidden'  id='budget_period_id' name='budget_period_id' value='<%=selected_budget_period%>'/>
<input type="hidden" name="selected_object_ids" id="selected_object_ids" value=""/>
<input type="hidden" name="element_ids" id="element_ids"/>
<input type="hidden" name="element_value" id="element_value"/>
<input type="hidden" name="href" id="href" value="<%=(UrlPath(Request.Url) +"?"+ UrlParam(Request.Url))%>"/>
<input type="hidden" name="redirect" value="<%=curMode%>"/>
<input type="hidden" name="mode" value="<%=curMode%>"/>
<input type="hidden" name="action_id" id="action_id" value=""/>
<input type="hidden" name="changed" id="changed" value="false"/>
<input type="hidden" name="sid" value="<%=tools.get_sum_sid( curDocID )%>">
<input type=hidden name="tab" id="tab" value="0"/>
	
<div id="bm_0" <%=(_selectedTab != 0 ? 'style="display: none"' : '')%>>
<script src="scripts\tree\ua000000.js"></script>
<script src="scripts\tree\ftiens40.js"></script>
<script language="javascript">



function daddy_plusplus(_object)
{
	while (_object.parentObj)
	{
		_object.total_sum = parseInt(_object.total_sum) + 1;
		_object = _object.parentObj;
	}
}
function paint_sum(_object)
{	
	if(_object.total_sum)
		_object.desc = _object.desc + "&nbsp;<b>[" + _object.total_sum + "]</b>";
	
	if(_object.children)
	for (var _i = 0; _i < _object.children.length; _i++)
	{
		paint_sum(_object.children[_i]);
	}	
}


USETEXTLINKS = 1;
STARTALLOPEN = 0;
USEFRAMES = 0;
USEICONS = 0;
WRAPTEXT = 1;
PRESERVESTATE = 1;
ICONPATH = "scripts/tree/";

<%
need_clear_users=true
if ((Request.Query.HasProperty("need_clear_users") && Request.Query.GetProperty("need_clear_users") == "1"))
{
	need_clear_users=false
}
if ((Request.Query.HasProperty("flush") && Request.Query.GetProperty("flush") == "1"))
{
	Session.req_tree_cache = undefined;
	if (need_clear_users)
	{
		Session.req_users = Array();
	}
}
else
{
	try
	{
		Session.req_tree_cache;
		Session.req_users;
	}
	catch(_netu_)
	{
		Session.req_tree_cache = undefined;
		Session.req_users = Array();
	}
}

_default_org = null;


if (Session.req_tree_cache == undefined)
{
//Response.Write(curMode+'<br/>')
_href = "view_doc.html?mode=" + curMode + "&doc_id=" + curDocID + "&all=1" + (_hide_dismissed?"&hide_dismissed=1":"")+sel_program;
//_href = '<a href="#" onclick="doSubmit(\'_action\')"></a>'
//Response.Write(_href+'<br/>')
_STREAM = "foldersTree = gFld('<b>" + tools.get_web_str("vmpb_all_subordinates") + "</b>', '" + _href + "');\n";

var subs_var = "";
var orgs_var = "";

function add_org(_org, _html)
{
	if (StrContains(orgs_var, _org.id) == false)
	{
		_href = "view_doc.html?mode=" + curMode + "&doc_id=" + curDocID + "&org_id=" + _org.id +  (_hide_dismissed?"&hide_dismissed=1":"")+sel_program;
		
		_STREAM = _STREAM + ('var org' + _org.id +' = insFld(foldersTree, gFld("<img src=\'pics/org.ico\' border=0/>&nbsp;'+HtmlEncode(_org.disp_name) + _html +'", "' + _href + '")); \n');
		_STREAM = _STREAM + ('org' + _org.id + '.total_sum = 0;\n');
		orgs_var = orgs_var + _org.id;
		if (_default_org == null) _default_org = _org.id;
	}
}

function add_sub(_sub, _html, iDepth)
{
	if (StrContains(subs_var, _sub.id) == false)
	{
		_parent_object = _sub.parent_object_id.OptForeignElem;
		if (_parent_object != undefined && iDepth < 10)
		{
			add_sub(_sub.parent_object_id.ForeignElem, "", iDepth+1);
			_parent = 'sub' + _sub.parent_object_id;
		}
		else if (_sub.org_id.HasValue && _sub.org_id.OptForeignElem != undefined)
		{
			add_org(_sub.org_id.ForeignElem, "");
			_parent = 'org' + _sub.org_id;
		}
		else
		{
			_parent = 'foldersTree';
		}
		
		_href = "view_doc.html?mode=" + curMode + "&doc_id=" + curDocID + "&subdivision_id=" +_sub.PrimaryKey  + (_hide_dismissed?"&hide_dismissed=1":"")+sel_program;
		
		_STREAM = _STREAM + ('var sub' + _sub.id +' = insFld( ' + _parent + ', gFld("<img src=\'pics/subdivision.ico\' border=0/>&nbsp;'+HtmlEncode(_sub.name)+ _html +'", "' + _href + '")); \n');
		
		_STREAM = _STREAM + ('sub' + _sub.id + '.total_sum = 0;\n');
		
		subs_var = subs_var + _sub.id + ",";
	}
}


function add_position(_position, _html)
{
	_parent_object = _position.parent_object_id.OptForeignElem;
	if (_parent_object != undefined)
	{
		add_sub(_parent_object, "", 0);
		_parent = 'sub' + _position.parent_object_id;
	}
	else if (_position.org_id.HasValue && _position.org_id.OptForeignElem != undefined)
	{
		add_org(_position.org_id.ForeignElem, "");
		_parent = 'org' + _position.org_id;
	}	
	else
	{
		_parent = 'foldersTree';
	}
	
	//_STREAM = _STREAM + ("insDoc( " + _parent + ", gLnk('S', '<b>" + _position.basic_collaborator_fullname + _html + "</b>' , '" + tools_web.get_url_protocol( Request.Url ) + Request.UrlHost + UrlPath( Request.Url ) + "?mode=" + curMode + "&doc_id=" + curDocID + "&person_id=" + _position.basic_collaborator_id + "&tab=" + _selectedTab + (_hide_dismissed?"&hide_dismissed=1":"")+"'));\n");
	_STREAM = _STREAM + ("daddy_plusplus(" + _parent+ ");\n");	
}


if (need_clear_users)
{
	_elems_full = Array();
	
	if (curUser.access.access_role != "admin" && curUser.access.access_role != "hr")
	{
		_elems_full = tools.get_sub_persons_by_func_manager_id(curUserID);
	}
	else
	{
		_elems_full = collaborators;
	}
}
else
{
	_elems_full = Session.req_users
}


for (_collab in _elems_full)
{
	if (_hide_dismissed && _collab.is_dismiss) continue;
	_posarr = _collab.position_id.OptForeignElem;
	if (_posarr != undefined)
	{
		add_position(_posarr, "");
	}
}

curGroupArray = XQuery("for $elem in func_managers where $elem/person_id = " + curUserID + " and $elem/catalog = 'group' return $elem");

for (_group_entry in curGroupArray)
{
	try
	{
		groupDoc = OpenDoc(UrlFromDocID(_group_entry.object_id)).TopElem;
	}
	catch(_blya_)
	{
		continue;
	}
		
	_href = "view_doc.html?mode=" + curMode + "&doc_id=" + curDocID + "&group_id=" + _group_entry.object_id +  (_hide_dismissed?"&hide_dismissed=1":"")+sel_program;
	_STREAM = _STREAM + ("var group" + _group_entry.object_id + " = insDoc( foldersTree, gLnk('S', '<img src=\"pics/group.ico\" border=0/>&nbsp;" + groupDoc.name + "' , '" + _href + "'));\n");
	_STREAM = _STREAM + "group" + _group_entry.object_id + ".total_sum = " + ArrayCount(groupDoc.collaborators) + ";\n";
}

Session.req_tree_cache = _STREAM;
if (need_clear_users)
{
	Session.req_users = _elems_full;
}
}


Response.Write(Session.req_tree_cache);
%>
paint_sum(foldersTree);

</script>


<table border="0" width="100%" style="height:100%">
<tr>
	<td id="treeArea" width="300px" valign="top">
		<table border="0" width="100%">
			<tr>
				<td colspan="2" align="left">
					<%=tools.get_web_str('c_budget_period')%>:
				</td>
			</tr>
			<tr>
				<td width="90%">
				<input type="text" id="budget_period_name" style="width:100%" class="inputEdit" readonly value="<%=budget_period_name%>"/></td>
				<td>
				<input align="right" type="button" width="100%" value="&nbsp;...&nbsp;" onClick="doSelect('budget_period','budget_period_id','','0')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">
				</td>
			</tr>
		</table>
		<span class="TreeviewSpanArea" style="overflow:auto; width:300px">
			<script>initializeDocument();</script>
		</span>
		<p>
		<script language="javascript">
		//<!--
		function hide_on_click(_PARAM)
		{	
			var _href = "<%=HtmlEncode(tools_web.get_query_string(true, "hide_dismissed;flush"))%>flush=1" +_PARAM ; 
			window.location.href = _href;
		}
		//-->
		</script>
		<input type="checkbox" name="hide_dismissed" value="1" <%=(_hide_dismissed?"checked":"")%> onclick="hide_on_click((this.checked ? '&hide_dismissed=1': ''))"/><%=tools.get_web_str('c_no_disp_dismiss')%>
		</p>
	</td>
	<td valign="top">
	<%
		try
		{
			_god_message = Session.r_msg;
		}
		catch(_god_message_err_)
		{
			_god_message = undefined;
		}
		
		Session.r_msg = undefined;
		
		if (_god_message != undefined)
		{
	%>
		<center style="font-weight: bold"><%=_god_message%></center>
	<%
		}
	%>
	
	
<%
	_spat_id = Array();
	
	if ( Request.QueryString.HasProperty("subdivision_id") )
	{
		positionArray = XQuery( "CatalogHierSubset('subs'," + Request.QueryString.subdivision_id + ")" );
		positionArray = ArraySelect( positionArray, 'basic_collaborator_id.HasValue' );
		curPersonsArray = ArrayExtract( positionArray, 'basic_collaborator_id' );
		curPersonsArray = QueryCatalogByKeys( 'collaborators', 'id', curPersonsArray );
		_structure = OpenDoc(UrlFromDocID(Int(Request.QueryString.GetProperty("subdivision_id")))).TopElem;
		_structure_name = "<img src='pics/subdivision.ico' border='0'/>&nbsp;" + tools.get_web_str("c_subd") + ": " + _structure.name;
		_bz = 0;
		_spat_id[0] = Int(Request.QueryString.GetProperty("subdivision_id"));
		
		_parent_document_object = ArrayOptFirstElem(XQuery("for $sub in subdivisions where $sub/id = "+XQueryLiteral(_structure.parent_object_id)+ " return $sub"));
		while (_parent_document_object != undefined)
		{
			_spat_id[(_bz++)] = _parent_document_object.PrimaryKey;
			_parent_document_object = ArrayOptFirstElem(XQuery("for $sub in subdivisions where $sub/id = "+XQueryLiteral(_parent_document_object.parent_object_id)+ " return $sub"));
		}
		
		if (_structure.org_id)
			_spat_id[(_bz++)] = _structure.org_id;
	}
	else if (Request.QueryString.HasProperty("org_id"))
	{
		curPersonsArray = XQuery("for $elem in collaborators where $elem/org_id = " + Request.QueryString.GetProperty("org_id") + " return $elem");
		_structure_name = "<img src='pics/org.ico' border='0'/>&nbsp;" + tools.get_web_str("c_org") + ": " + OpenDoc(UrlFromDocID(Int(Request.QueryString.GetProperty("org_id")))).TopElem.disp_name;
		_spat_id[0] = Int(Request.QueryString.GetProperty("org_id"));
	}
	else if (Request.QueryString.HasProperty("do") && _default_org!= null && Request.QueryString.GetProperty("do") == "1")
	{
		curPersonsArray = XQuery("for $elem in collaborators where $elem/org_id = " + _default_org + " return $elem");
		_structure_name = "<img src='pics/org.ico' border='0'/>&nbsp;" + tools.get_web_str("c_org") + ": " + OpenDoc(UrlFromDocID(_default_org)).TopElem.name;
		_spat_id[0] = _default_org;
	}
	else if ( Request.QueryString.HasProperty("group_id") )
	{
		groupDoc = OpenDoc(UrlFromDocID(Int(Request.QueryString.GetProperty("group_id")))).TopElem;
		curPersonsArray = ArrayExtract( groupDoc.collaborators, 'collaborator_id' );
		curPersonsArray = QueryCatalogByKeys( 'collaborators', 'id', curPersonsArray );
		_structure_name = "<img src='pics/group.ico' border='0'/>&nbsp;" + tools.get_web_str("c_group") + ": " + groupDoc.name;
		_spat_id[0] = Int(Request.QueryString.GetProperty("group_id"));
	}
	else if ( Request.QueryString.HasProperty("all") && Request.QueryString.GetProperty("all") == "1" )
	{
		curPersonsArray = Session.req_users;
		_structure_name = tools.get_web_str("vmpb_all_subordinates");
	}
	else
	{
		_structure_name = "-";
		curPersonsArray = Array();
	}
	
	_i_m_in = (ArrayOptFind(curPersonsArray, "id == curUserID") != undefined);
		
	
	//////////////////////////////////
	function and(_specie1, _specie2)
	{
		_specie1 = ArraySort(_specie1, 'PrimaryKey', '+');
		_specie2 = ArraySort(_specie2, 'PrimaryKey', '+');
		
		_hybrid = Array();
		
		_ac1 = ArrayCount(_specie1);
		_ac2 = ArrayCount(_specie2);
		_i=0;
		_j=0;
		_k=0;
	
		while (_i < _ac1 && _j < _ac2)
		{
			if (_specie1[_i].PrimaryKey == _specie2[_j].PrimaryKey)
			{
				_hybrid[_k] = _specie1[_i];
				_i++;
				_j++;
				_k++;
			}
			else if (_specie1[_i].PrimaryKey > _specie2[_j].PrimaryKey)
				_j++;
			else
				_i++;
		}
		
		return _hybrid;
	
	}
	/////////////////////////////////////
	//--
	function add_custom_fields(_field,ID,_class,cur_value)
	{
			_value=cur_value;
			_field_name=_field.name+'_'+ID;
%>
		<td class="<%=_class%>" width="50%" align="center" valign="middle" id="td_<%=_field_name%>">
		<%
			switch ( _field.type )
					{
						case 'heading':
							break;
						
						case 'bool':
			%>

										<%=( _value == 'true' ? '<img src="pics/vwicn082.gif"/>' : '' )%>
			<%		
							break;
							
						case 'file':

							if(_value!='')
                            {
			%>
							<a href="download_file.html?file_id=<%=_value%>&sid=<%=tools.get_sum_sid( _value )%>"><%=OpenDoc( UrlFromDocID( Int(_value))).TopElem.name%></a>
   
							<%
							}
							break;
							
						case 'foreign_elem':
							_value_str = '';
							if ( _value != '' )
							{
								try
								{
									_disp_name = curLngCommon.exchange_object_types.GetChildByKey( _field.catalog ).disp_name;
									_value_str = HtmlEncode( eval( 'OpenDoc( UrlFromDocID( ' + _value + ' ) ).TopElem.' + _disp_name ) );
								}
								catch ( err )
								{
									_value_str = HtmlEncode( tools.get_web_str('c_deleted') );
								}
							}
											
			%>
									<%=_value_str%>												
			<%		
							break;
		
							default:		
			%>						
										<%=HtmlEncode( _value )%>				
							
			<%
					
				}
	%>
		</td>
	<%							
	}
	//--
/*	if (ArrayOptFirstElem(curPersonsArray) != undefined)
	{*/
		curPersonsArray = and(curPersonsArray, Session.req_users)
		if (_hide_dismissed)
			curPersonsArray = ArraySelectByKey(curPersonsArray, false,"is_dismiss");
		
		
			
		curView = new Object;
		curView.SetProperty( 'id', 'c_list' );
		curView.SetProperty( 'catalog_name', 'collaborator' );
		curView.SetProperty( 'disp_link', 'true' );
		curView.SetProperty( 'disp_check_box', 'false' );
		curView.SetProperty( 'title', _structure_name );
		curView.SetProperty( 'array', curPersonsArray );
		curView.SetProperty( 'first_add_Array', arrEducationPrograms );
		curView.SetProperty( 'second_add_Array', arrOtherMethods );
		curView.SetProperty( 'list_columns', Array('fullname','position_name','position_parent_name') );
/*		curView.SetProperty( 'col_headers', Array('one','two') );
		curView.SetProperty( 'col_cells', Array('1','2') );*/
		//--catalog_list--
		catalogBase = curLngCommon.exchange_object_types.GetOptChildByKey( curView.catalog_name );
		if ( catalogBase == undefined )
				catalogBase = curLngCommon.linking_views.GetChildByKey( curView.catalog_name );
		
		tableID =                         curView.HasProperty( 'id' ) ? curView.id : '';
		viewBase =                         view_types.GetChildByKey( curView.HasProperty( 'view_type' ) ? curView.view_type : curView.catalog_name );
		xqueryQual =                 curView.HasProperty( 'xquery_qual' ) ? curView.xquery_qual : '';
		dispLink =                         curView.HasProperty( 'disp_link' ) ? curView.disp_link + '' : 'false';
		title =                         curView.HasProperty( 'title' ) ? curView.title : ( catalogBase.web_title.HasValue ? catalogBase.web_title : catalogBase.title );
		linkFieldIndex =         curView.HasProperty( 'link_field_index' ) ? Int( curView.link_field_index ) : 0;
		linkMode =                         curView.HasProperty( 'link_mode' ) ? curView.link_mode : curView.catalog_name;
		linkProp =                         curView.HasProperty( 'link_prop' ) ? Trim( curView.link_prop ) : '';
		linkPropFlag =                 StrBegins( linkProp, '=' );
		linkProp =                         linkPropFlag ? linkProp.slice( 1 ) : linkProp;
		linkObjectField =         curView.HasProperty( 'link_object_field' ) ? curView.link_object_field : 'PrimaryKey';
		openDocFlag =                 curView.HasProperty( 'open_doc' ) ? curView.open_doc == 'true' : false;
		
		dispSort =                         curView.HasProperty( 'disp_sort' ) ? curView.disp_sort == 'true' : true;
		sortIndex =                 Request.QueryString.HasProperty( 'sort' + tableID ) ? Int( Request.QueryString.GetProperty( 'sort' + tableID ) ) : ( curView.HasProperty( 'sort_index' ) ? Int( curView.sort_index ) : linkFieldIndex );
		sortDirect =                 Request.QueryString.HasProperty( 'direct' + tableID ) ? ( Request.QueryString.GetProperty( 'direct' + tableID ) == '0' ? '-' : '+' ) : ( curView.HasProperty( 'sort_direct' ) ? curView.sort_direct : '+' );
		
		dispSearch =                 curView.HasProperty( 'disp_search' ) ? curView.disp_search == 'true' : true;
		dispFilter =                 curView.HasProperty( 'disp_filter' ) ? curView.disp_filter == 'true' : true;
		
		checkAccess =                 curView.HasProperty( 'check_access' ) ? curView.check_access == 'true' : global_settings.settings.check_access_on_lists;
		
		colHeaders =                 curView.HasProperty( 'col_headers' ) ? curView.col_headers : Array();
		colCells =                         curView.HasProperty( 'col_cells' ) ? curView.col_cells : Array();
		
		listColumns =                 curView.HasProperty( 'list_columns' ) ? curView.list_columns : null;
		listHeaders =                 curView.HasProperty( 'list_headers' ) ? curView.list_headers : null;
		listHeadersNum =         listHeaders == null ? 0 : ArrayCount( listHeaders );
		
		//////////////////////////////////////////
		
		curQueryString = dispSort ? tools_web.get_query_string( true, 'flush;selected_budget_period;education_program_methods_ids;other_education_program_methods_ids'+';sort' + tableID + ';direct' + tableID + ';sel' + tableID + ';search' + tableID + ';filter' + tableID ) : '';
		
		curSearchText = Request.QueryString.HasProperty( 'search' + tableID ) ? UrlDecode( Request.QueryString.GetProperty( 'search' + tableID ) ) : '';
		curFilterID = Request.QueryString.HasProperty( 'filter' + tableID ) ? Request.QueryString.GetProperty( 'filter' + tableID ) : '';
		curFilter = curFilterID != '' ? ArrayOptFind( lists.view_conditions_schemes, "catalog=='" + curView.catalog_name + "'&&disp_web&&PrimaryKey=='" + curFilterID + "'" ) : undefined;
		curSortColumn = viewBase.columns.Child( sortIndex );
		if ( curView.HasProperty( 'array' ) )
		{
				curFilterCond = curSearchText != "" ? "StrContains(Xml," + CodeLiteral( curSearchText ) + ")" : "";
				curFilterCond = curFilter != undefined ? tools.create_filter_javascript( curFilter.conditions, curFilterCond, "" ) : curFilterCond;
				curArray = curFilterCond != "" ? ArraySelect( curView.array, curFilterCond ) : curView.array;
				curArray = ArraySort( curArray, curSortColumn.order_code, sortDirect );
		}
		else
		{
				curFilterCond = curFilter != undefined ? tools.create_filter_xquery( curFilter.conditions ) : '';
				curArray = XQuery( tools.create_xquery( curView.catalog_name, xqueryQual, curFilterCond, curSearchText, curSortColumn.order, sortDirect ) );
		}
		
		
		if ( curView.HasProperty( 'first_add_Array' ) )
		{
				curFirstArray = curView.first_add_Array
				//columnAddNum=ArrayCount( curFirstArray )
		}
		else
		{
				curFirstArray =Array()
				columnAddNum=0;
		}
		
		if ( curView.HasProperty( 'second_add_Array' ) )
		{
				curSecondArray = curView.second_add_Array
				//columnAddNum=ArrayCount( curFirstArray )
		}
		else
		{
				curSecondArray =Array()
				//columnAddNum=0;
		}
		
		if ( listColumns == null )
		{
				columnNum = ArrayCount( viewBase.columns );
				columnArray = viewBase.columns;
		}
		else
		{
				columnNum = 0;
				columnArray = Array();
				for ( _column_name in listColumns )
				{
						columnArray[ columnNum ] = viewBase.columns.GetChildByKey( _column_name, 'order_code' );
						columnNum++;
				}
		}
		
		columnNum += ArrayCount( colHeaders )
		TotalcolumnNum=columnNum;
		OtherMethodcolumnNum=0;
		//Response.Write(columnNum+'<br/>')
		
		%>
		<script language="javascript">
		//<!--
		function editRequestFields(method_id)
		{

				field_names=get_field_names();
				field_types=get_field_types();
				arrNames=field_names.split(';')
				arrTypes=field_types.split(';')
				var parobj=new Object();
				parobj.showAll=1;
				parobj.is_kpi=true;
				parobj.arrFields=Array()
				counter=0;

				for (i=0;i<arrNames.length;i++)
				{
					name=arrNames[i]
					if (name!='')
					{
						//alert(name)
						type=arrTypes[i]
						NewElem=Array();
						parobj.arrFields[counter]=NewElem
						parobj.arrFields[counter][0]=name
						parobj.arrFields[counter][1]=''
						parobj.arrFields[counter][2]=type;
						parobj.arrFields[counter][3]='';
						counter++
					}
				}
			

				var strAttr="status:no;dialogWidth:780px;dialogHeight:555px;help:no;modal=yes";
				xShowModalDialog("dlg_edit_request.html?doc_id=<%=curDocID%>&template_req_type_id=<%=template_req_type_id%>&req_id="+method_id, parobj, strAttr);
				
			
				if(parobj.handle) 
				{
					try
					{
						arrFields=parobj.arrFields
					}
					catch(ex)
					{
						arrFields=Array()
					}
					
					
					counter=parobj.arrFields.length 
/*					for (i=0;i<counter;i++)
					{
						alert(parobj.arrFields[i][0]+' '+ parobj.arrFields[i][1]+' '+ parobj.arrFields[i][2]+' '+ parobj.arrFields[i][3])
					}*/
					arr_length=arrFields.length
					for (i=0;i<arr_length;i++)
					{
						id=arrFields[i][0]+'_'+method_id
						value=arrFields[i][1]
						type=arrFields[i][2]
						disp_value=arrFields[i][3]
						try
						{
							switch ( type )
							{
								case 'bool':
									if (eval(value))
									{
										document.getElementById('td_'+id).innerHTML='<img src="pics/vwicn082.gif"/>'
									}
									else
									{
										document.getElementById('td_'+id).innerHTML=''
									}
									break;
								case 'foreign_elem':
									document.getElementById('td_'+id).innerHTML=disp_value
									break;	
								default:
									document.getElementById('td_'+id).innerHTML=value
							}
						}
						catch(ex)
						{
							//alert(ex)
						}
					}
					showPic(method_id)
					
					
				}
		}	
		
		function showPic(method_id)
		{
			if (check_required(method_id,false))
			{
				try
				{
					document.getElementById('td_fill_req'+method_id).innerHTML='<img src="pics/vwicn082.gif"/>'
				}
				catch(ex)
				{
				}
			}
			else
			{
				try
				{
					document.getElementById('td_fill_req'+method_id).innerHTML='&nbsp;'
				}
				catch(ex)
				{
				}
			}
		}
		
		function doSelect(catalog,sel,check_str,multi_select)
		{	
		
				selected_object_ids =document.getElementById(sel).value
				var pars=new Object();
				var strAttr="status:no;dialogWidth:780px;dialogHeight:550px;help:no;resizable:1";
				pars.selected_object_ids = selected_object_ids;
				pars.can_be_empty = true;
				pars.show_all = true;
				
				if (catalog=='education_method')
				{
					<% 
					if (flagCheckAccess)
					{
					%>
						pars.check_access = true;
					<%
					}
					%>
				}
				
				
				if (check_str!='')
				{
					check_str='&xquery_qual='+escape(check_str)
				}

				xShowModalDialog( 'dlg_select.html?doc_id=<%=curDocID%>&catalog_name='+catalog+'&typein=0'+check_str+'&multi_select='+multi_select, pars, strAttr );
		
				if ( ! pars.handle ) 
					return null;
				selected_object_ids = pars.selected_object_ids;
				
				try
				{
					document.getElementById(sel).value =pars.selected_object_ids;
				}
				catch(ex)
				{
					//alert(ex)
				}	
				//document.location.href = String("<%=curQueryString%>").replace("education_program_methods_ids","") + get_selected_mehods_ids() +"&sel<%=tableID%>=" + get_selected_ids() +get_selected_mehods_ids()+ "&search<%=tableID%>=<%=UrlEncode( curSearchText )%>" + "#CLA_<%=tableID%>";
				document.location.href = "<%=curQueryString%>"+ "&flush=1&new_req=1&need_clear_users=1"+get_selected_mehods_ids()+ get_selected_other_mehods_ids()+"&sel<%=tableID%>=" + get_selected_ids() + "&search<%=tableID%>=<%=UrlEncode( curSearchText )%>" + "#CLA_<%=tableID%>";
				//doSubmit('proc');
		
		}
		
		function doAdd()
		{	
				var pars=new Object();
				try
				{
					heigth=Math.round(screen.availHeight*0.1)
					width=Math.round(screen.availWidth*0.2)
				}
				catch(ex)
				{
					heigth=30;
					width=50;
				}
				var strAttr="status:no;dialogWidth:"+width+"px;dialogHeight:"+heigth+"px;help:no;resizable:1";
				pars.selected_object_ids = '';
				pars.can_be_empty = false;
				pars.show_all = true;
				

				xShowModalDialog( 'dlg_add_new_method_name.html?doc_id=<%=curDocID%>', pars, strAttr );
		
				if ( ! pars.handle ) 
					return null;
				selected_object_ids = pars.selected_object_ids;
				
				try
				{
					other_counter=parseInt(document.getElementById("other_counter").value);
					var tobj=document.all['secretArea']; 
					hidin=document.createElement('INPUT'); 
					hidin.type='hidden'; 
					hidin.setAttribute("id",'other'+other_counter);
					while ( (selected_object_ids.lastIndexOf("'") !=-1))
					  {
					  selected_object_ids=selected_object_ids.replace("'", '"');
					  }
					hidin.value=selected_object_ids.replace("'", '"');
					
					hidinins = tobj.insertAdjacentElement('beforeEnd',hidin);
					other_counter++
					document.getElementById("other_counter").value=other_counter;
				}
				catch(ex)
				{
					//alert(ex)
				}
				//document.location.href = String("<%=curQueryString%>").replace("education_program_methods_ids","") + get_selected_mehods_ids() +"&sel<%=tableID%>=" + get_selected_ids() +get_selected_mehods_ids()+ "&search<%=tableID%>=<%=UrlEncode( curSearchText )%>" + "#CLA_<%=tableID%>";
				document.location.href = "<%=curQueryString%>"+ "&flush=1&new_req=1&need_clear_users=1"+get_selected_mehods_ids()+ get_selected_other_mehods_ids(undefined)+"&sel<%=tableID%>=" + get_selected_ids() + "&search<%=tableID%>=<%=UrlEncode( curSearchText )%>" + "#CLA_<%=tableID%>";
				//doSubmit('proc');
		
		}
		
		function doSubmit(_action)
		{
			if (eval(document.getElementById("changed").value))
			{
				if (_action=='save')
				{
					if (document.getElementById('budget_period_id').value =='')
					{
						alert(<%=CodeLiteral( tools_web.get_web_str('vtmb_err_budget_per') )%>);
						return false;
					}
					if (confirm(<%=CodeLiteral( tools_web.get_web_str('vtmb_mes_save') )%>)==false)
					{
						return false;
					}
					
					
				}
				document.getElementById('action_id').value = _action;
				document.forms['action_process'].submit();
			}
			else
			{
				alert(<%=CodeLiteral( tools_web.get_web_str('vtmb_err_req_list') )%>);
				return false;
			}
		}
		
		function RecountRequests()
		{	
			try
			{
				Num=parseInt(document.getElementById('elem_counter').value)
			}
			catch(ex)
			{
				Num=0;
			}
			
<%
			for( iMethodElem in arrMethods)
			{
%>
				sel_counter=0
				for (i=1;i<=Num;i++)
				{
					try
					{	
					
						elem=document.getElementById("elem_counter"+i+"_<%=iMethodElem.id%>")
						if (eval(elem.checked)!=eval(elem.originally_checked))
						{
							if (eval(elem.checked))
							{
								sel_counter++;
							}
						}

					}
					catch(ex)
					{
					}	
				}	
				try
				{	
					document.getElementById("personCount_<%=iMethodElem.id%>").innerHTML=sel_counter;

				}
				catch(ex)
				{
				}				
<%
			}
%>					

		}
		
		
		
		
		function get_selected_ids()
		{
				var _str = "";
				var personArray = document.getElementsByName("select_check_box_<%=tableID%>");
				for ( var i=0; i<personArray.length; i++ )
						if ( personArray[i].checked )
								_str += personArray[i].id + ";";
		
				return _str;
		}
		
		function get_selected_mehods_ids()
		{
				var _str = '';
				try
				{
					_str = _str+ "&selected_budget_period="+document.getElementById("budget_period_id").value;
				}
				catch(ex)
				{
					//alert(ex)
				}	
				_str = _str+"&education_program_methods_ids="; 
			<%
				//for( iEduProg in education_programs)
				for( iEduProg in curFirstArray)
				{
			%>
					try
					{	
						
						_str = _str+"<%=iEduProg.id%>@@"+document.getElementById("education_program_<%=iEduProg.id%>_methods_ids").value+"|"
					}
					catch(ex)
					{
						//alert(ex)
					}
			<%
				}
			%>
			
		//alert(_str)
				return _str;
		}
		
		function get_selected_other_mehods_ids(_param)
		{
			try
			{
				var _str = '';

				_str = _str+"&other_education_program_methods_ids=";
				other_counter=parseInt(document.getElementById("other_counter").value);
				if (_param==undefined )
				{
					_param='0';
				}
				for( kk=0;kk<other_counter;kk++)
				{
					try
					{	
					
						name='other'+kk;
/*						alert(name)*/
						//alert(document.getElementById(name).value)
						if (String(name)!=String(_param))
						{
							_str = _str+document.getElementById(name).value+"|"
						}
					}
					catch(ex)
					{
						//alert(ex)
					}
				}
				
/*				if (_param2!=undefined )
				{
					_str = _str+_param2+"|";
				}*/
				//alert(_str)
				repStr="$|&|+|,|/|:|;|=|?|@|#|*"
				repArr=repStr.split("|")
				for (elem in repArr)
				{
					_str =_str.replace(elem, encodeURIComponent(elem))
				}
/*				_str =_str.replace("$", "%24")
				_str =_str.replace("&", "%26")
				_str =_str.replace("+", "%2B")
				_str =_str.replace(",", "%2C")
				_str =_str.replace("/", "%2F")
				_str =_str.replace(":", "%3A")
				_str =_str.replace(";", "%3B")
				_str =_str.replace("=", "%3D")
				_str =_str.replace("?", "%3F")
				_str =_str.replace("@", "%40")
				_str =_str.replace("#", "%23")
				_str =_str.replace("*", "%23")*/
				//alert(_str)
				return _str;
		//alert(_str)
				//return encodeURI(_str);
			}
			catch(ex)
			{
				//alert(ex)
			}
		}
		
		function doDelete(_param)
		{
			document.location.href = "<%=curQueryString%>"+ "&flush=1&new_req=1&need_clear_users=1"+get_selected_mehods_ids()+get_selected_other_mehods_ids(_param) +"&sel<%=tableID%>=" + get_selected_ids() + "&search<%=tableID%>=<%=UrlEncode( curSearchText )%>" + "#CLA_<%=tableID%>";
		}
		
		function do_sort( _href )
		{
				document.location.href = "<%=curQueryString%>" + _href + "&sel<%=tableID%>=" + get_selected_ids()+ get_selected_mehods_ids()+get_selected_other_mehods_ids()+ "&search<%=tableID%>=<%=UrlEncode( curSearchText )%>" + "#CLA_<%=tableID%>";
				return false;
		}
		function do_search()
		{
				var _text = (document.getElementById("search_text_<%=tableID%>") != null) ? document.getElementById("search_text_<%=tableID%>").value : "";
				var _filter_id = (document.getElementById("filter_<%=tableID%>") != null) ? document.getElementById("filter_<%=tableID%>").value : "";
				document.location.href = "<%=curQueryString%>filter<%=tableID%>=" + _filter_id + "&search<%=tableID%>=" + escape( _text ) + "&sel<%=tableID%>=" + get_selected_ids() +get_selected_mehods_ids()+get_selected_other_mehods_ids()+ "&sort<%=tableID%>=<%=sortIndex%>&direct<%=tableID%>=<%=( sortDirect == '+' ? '1' : '0' )%>#CLA_<%=tableID%>";
				return false;
		}

		function submitenter(myfield,e)
		{
				var keycode;
				if (window.event) keycode = window.event.keyCode;
				else if (e) keycode = e.which;
				else return true;
		
				if (keycode == 13)
				{
				   do_search();
				   return false;
				}
				else
				   return true;
		}
		function set_change(MethodId)
		{
			//alert(MethodId+','+checked)
/*			alert(MethodId+', checked='+checked+', originally_checked='+originally_checked)
			document.getElementById("changed").value=true;
			if (eval(checked))
			{
				document.getElementById("changed_"+MethodId).value='1';
			}*/
			
			try
			{
				Num=parseInt(document.getElementById('elem_counter').value)
			}
			catch(ex)
			{
				Num=0;
			}
			
			method_changed=false;
			for (i=1;i<=Num;i++)
			{
				try
				{
					elem=document.getElementById("elem_counter"+i+"_"+MethodId)
					if (eval(elem.checked)!=eval(elem.originally_checked))
					{
						method_changed=true;
						break;
					}	
				}
				catch(ex)
				{
				}
				
			}
			
			if (method_changed)
			{
				document.getElementById("changed_"+MethodId).value='1';
			}
			else
			{
				document.getElementById("changed_"+MethodId).value='';
			}
			
			
			all_changed=false;
			try
			{
	<%
				for( iMethodElem in arrMethods)
				{
	%>
					if (document.getElementById("changed_<%=iMethodElem.id%>").value=='1')
					{
						all_changed=true;
					}
	<%
				}
	%>					
			}
			catch(ex)
			{
	
			}
			document.getElementById("changed").value=all_changed;
			
		}
		function toggle_check_selection(_check,MethodElemId)
		{
			try
			{
				Num=parseInt(document.getElementById('elem_counter').value)
			}
			catch(ex)
			{
				Num=0;
			}
			
			for (i=1;i<=Num;i++)
			{
				try
				{
					document.getElementById("elem_counter"+i+"_"+MethodElemId).checked=	_check	
					
				}
				catch(ex)
				{
				}
				
			}
			set_change(MethodElemId)
			//set_change();
		}
		//-->
		</script>
<%
	if (ArrayOptFirstElem(curPersonsArray) != undefined)
	{
%>
		<a href="CLA_<%=tableID%>" id="CLA_<%=tableID%>"></a>
		<table id="CLT_<%=tableID%>" width="100%" class="tableBasic" border="0" cellspacing="0" cellpadding="0">
				<tr>
						<td class="tableHeaderTextLeft"><img src="pics/1blank.gif" width="1" height="1"/></td>
						<td class="tableHeaderText" colspan="<%=columnNum%>" width="100%">
								<table width="100%" border="0" cellspacing="0" cellpadding="0">
										<tr>
												<td width="100%" colspan="2"><p class="tableHeaderTextInner"><%=title%></p></td>
										</tr>
										<tr>
		<%
				if ( dispFilter )
				{
		%>
												<td><select name="filter_<%=tableID%>" id="filter_<%=tableID%>" onchange="do_search()"  class="inputEdit">
														<option value="">- <%=tools.get_web_str('c_filter')%> -</option>
		<%
						for ( _filter in ArraySelect( lists.view_conditions_schemes, "catalog=='" + curView.catalog_name + "'&&disp_web" ) )
						{
		%>
														<option value="<%=_filter.PrimaryKey%>"><%=_filter.name%></option>
		<%
						}
		%>
												</select>&nbsp;&nbsp;&nbsp;&nbsp;</td>
		<SCRIPT language="JavaScript">
		selcur=document.getElementById("filter_<%=tableID%>");
		selcur.selectedIndex==-1;
		for(var i=0;i<selcur.options.length;i++)
			if(selcur.options[i].value=="<%=curFilterID%>")
				{
				selcur.selectedIndex=i;
						break;
			}
		</SCRIPT>
		<%
				}
		
				if ( dispSearch )
				{
		%>
												<td><input type="text" id="search_text_<%=tableID%>" width="16" value="<%=curSearchText%>" class="inputEdit" onKeyPress="return submitenter(this,event)"/><img src="pics/icon_search_1.gif" onclick="do_search()"/></td>
		<%
				}
		%>
										</tr>
								</table>
						</td>			
<%
											for (iFirstArrElem in curFirstArray)
											{
												//Response.Write(iFirstArrElem.name+'<br/>')
												WhereStr=''
												if (iFirstArrElem.real_method)
												{
													arrEducationMethods=ArrayExtract(XQuery('for $elem in education_program_education_methods where $elem/education_program_id ='+iFirstArrElem.id+' return $elem'),'education_method_id')
													for ( iElem in arrEducationMethods )
													{
														WhereStr=WhereStr+(WhereStr==''?'':' or')+' $elem/id='+iElem;
												
													}
													if (WhereStr=='')
													{
														WhereStr='$elem/id=0';
													}
													_selected_methods='';
													try
													{
														_selected_methods=ArrayMerge(ArrayExtract(iFirstArrElem.arrMethods,'id'),'This',';')
													}
													catch(ex)
													{
													}
												}
												else
												{
													_selected_methods='';
													try
													{
														_selected_methods=ArrayMerge(ArrayExtract(iFirstArrElem.arrMethods,'id'),'This',';')
													}
													catch(ex)
													{
													}
												}

												EducationMethodcolumnNum=ArrayCount(iFirstArrElem.arrMethods)
												EducationMethodcolumnNum=(EducationMethodcolumnNum==0?EducationMethodcolumnNum+1:EducationMethodcolumnNum);
												TotalcolumnNum=TotalcolumnNum+EducationMethodcolumnNum
%>
						<td class="tableHeaderText" colspan="<%=EducationMethodcolumnNum%>" width="100%" valign="bottom">
								<table width="100%" border="0" cellspacing="1" cellpadding="0">
										<tr>
	<td valign="bottom" width="80%">
	<input type='hidden'  id='education_program_<%=iFirstArrElem.id%>_methods_ids' name='education_program_<%=iFirstArrElem.id%>_methods_ids' value='<%=_selected_methods%>'/>
	<input type="text" id="education_program_<%=iFirstArrElem.id%>" style="width:100%" class="inputEdit" readonly value="<%=iFirstArrElem.name%>"/></td>
	<td valign="bottom">
	<input align="right" type="button" width="100%" value="&nbsp;...&nbsp;" onClick="doSelect('education_method','education_program_<%=iFirstArrElem.id%>_methods_ids','<%=WhereStr%>','1')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"></td>
										</tr>
								</table>
						</td>											
<%
											}


											if (show_other)
											{
												OtherMethodcolumnNum=ArrayCount(curSecondArray)
												OtherMethodcolumnNum=(OtherMethodcolumnNum==0?OtherMethodcolumnNum+1:OtherMethodcolumnNum);
												TotalcolumnNum=TotalcolumnNum+OtherMethodcolumnNum
%>
						<td class="tableHeaderText" colspan="<%=OtherMethodcolumnNum%>" width="100%" valign="bottom">
								<table width="100%" border="0" cellspacing="1" cellpadding="0">
										<tr>
	<td valign="bottom" width="80%">
	<input type="text" id="education_program_other" style="width:100%" class="inputEdit" readonly value="<%=other_name%>"/></td>
	<td valign="bottom">
<input align="right" type="button" width="100%" value="&nbsp;&nbsp;+&nbsp;&nbsp;" onClick="doAdd()" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';">
	</td>
										</tr>
								</table>
						</td>											
<%
											}
%>
						<td class="tableHeaderTextRight"><img src="pics/1blank.gif" width="1" height="1"/></td>
				</tr>
				<tr>
						<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
		<%
		
				columnIndex = 0;
				for ( _column in columnArray )
				{
		%>
						<td  rowspan="2" class="tableHeaderWithText" width__="<%=StrReplace( _column.width, 'zr', '0' )%>">
		<%
						_column_title = ( listHeaders != null && columnIndex < listHeadersNum ? listHeaders[ columnIndex ] : ( _column.web_const.HasValue ? tools.get_web_str( _column.web_const ) : eval( _column.title ) ) );
		
						if ( dispSort )
						{
								_add = 'sort' + tableID + '=' + _column.ChildIndex + '&direct' + tableID + ( _column.ChildIndex == sortIndex && sortDirect == '+' ? '=0' : '=1' );
		%>
								<a href="#" onclick="do_sort('<%=_add%>')"><%=_column_title%></a>
		<%
								if ( _column.ChildIndex == sortIndex )
										Response.Write( sortDirect == '+' ? '&nbsp;&#9650;' : '&nbsp;&#9660;' );
						}
						else
						{
								Response.Write( _column_title );
						}
		%>
						</td>
		<%
						columnIndex++;
				}
		
				for ( _column in colHeaders )
				{
		%>
						<td rowspan="2" class="tableHeaderWithText"><%=_column%></td>
		<%
				}
				cb_counter=0;
				for (iFirstArrElem in curFirstArray)
				{
					if (ArrayOptFirstElem(iFirstArrElem.arrMethods)!=undefined)
					{
						for(iMethodElem in iFirstArrElem.arrMethods)
						{
%>
							<td class="tableHeaderWithText">
							<input type='hidden'  id='changed_<%=iMethodElem.id%>' name='changed_<%=iMethodElem.id%>' value=""/>
							<%=iMethodElem.name%><br/></td>
<%	
							cb_counter++;							
						}	
					}
					else
					{
%>
						<td class="tableHeaderWithText">&nbsp;</td>
<%		
					}
				}

			if (show_other)
			{
				if (ArrayOptFirstElem(curSecondArray)!=undefined)
				{
					for(iMethodElem in curSecondArray)
					{
						_value=HtmlEncode(iMethodElem.name)
	%>
						<td class="tableHeaderWithText">
						<input type='hidden'  id='<%=iMethodElem.id%>' name='<%=iMethodElem.id%>' value="<%=_value%>"/>
						<input type='hidden'  id='changed_<%=iMethodElem.id%>' name='changed_<%=iMethodElem.id%>' value=""/>
								<%=iMethodElem.name%>&nbsp;<input align="right" type="button" width="80%" value="&nbsp;X&nbsp;" onClick="doDelete('<%=iMethodElem.id%>')" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"><br/></td>
	<%	
						cb_counter++;							
					}
				}
				else
				{
%>
					<td class="tableHeaderWithText">&nbsp;</td>
<%		
				}
			}	
%>
						<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
				<tr>
					<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%					cb_counter=0;
				for (iFirstArrElem in curFirstArray)
				{
					if (ArrayOptFirstElem(iFirstArrElem.arrMethods)!=undefined)
					{
						for(iMethodElem in iFirstArrElem.arrMethods)
						{
%>
							<td class="tableHeaderWithText" style="border-top-style:none">
<input type="checkbox" id='check_box_<%=cb_counter%>' name='check_box_<%=cb_counter%>' onclick="toggle_check_selection(document.getElementById('check_box_<%=cb_counter%>').checked,'<%=iMethodElem.id%>')"></td>
<%	
							cb_counter++;							
						}	
					}
					else
					{
%>
						<td class="tableHeaderWithText" style="border-top-style:none">&nbsp;</td>
<%		
					}
				}

			if (show_other)
			{
				if (ArrayOptFirstElem(curSecondArray)!=undefined)
				{
					for(iMethodElem in curSecondArray)
					{
	%>
						<td class="tableHeaderWithText" style="border-top-style:none">
<input type="checkbox" id='check_box_<%=cb_counter%>' name='check_box_<%=cb_counter%>' onclick="toggle_check_selection(document.getElementById('check_box_<%=cb_counter%>').checked,'<%=iMethodElem.id%>')"></td>
	<%	
						cb_counter++;							
					}
				}
				else
				{
%>
					<td class="tableHeaderWithText" style="border-top-style:none">&nbsp;</td>
<%		
				}
			}	
%>
						<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
				<tr>
						<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText" colspan="<%=TotalcolumnNum%>"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
		<%
				counter = 0;
				for ( ListElem in curArray )
				{
						_cur_link_field = eval( 'ListElem.' + linkObjectField );
						_row_bk_color = viewBase.row_bk_color.HasValue ? StrHexColor( eval( viewBase.row_bk_color ) ) : '';
						_row_bk_color = _row_bk_color != '' ? 'style="background-color:#' + _row_bk_color + '"' : '';
		
						ListElemDoc = openDocFlag ? OpenDoc( UrlFromDocID ( _cur_link_field ) ).TopElem : null;
		
						if ( checkAccess )
								try
								{
										if ( tools_web.check_access( ( ListElemDoc == null ? OpenDoc( UrlFromDocID ( _cur_link_field ), 'form=x-local://wtv/wtv_form_doc_access.xmd;ignore-top-elem-name=1' ).TopElem : ListElemDoc ), curUserID, curUser, Session ) == false )
												continue;
								}
								catch(_opa_)
								{
		//alert(_opa_)
										continue;
								}
		
						_class = counter % 2 ? 'tableRowEven' : 'tableRowOdd';
						_classl = counter % 2 ? 'tableRowEvenLeft' : 'tableRowOddLeft';
						_classr = counter % 2 ? 'tableRowEvenRight' : 'tableRowOddRight';
						counter++
		%>
				<tr>
						<td class="<%=_classl%>"></td>
		<%
		
						for ( _column in columnArray )
						{
								try
								{
										_column_name = tools_web.get_cur_lng_name( _column.web_name.HasValue ? eval( _column.web_name ) : eval( _column.name ) );
		
										if ( eval( dispLink ) && _column.ChildIndex == linkFieldIndex )
										{
												if ( linkPropFlag )
														try
														{
																linkProp = eval( linkProp );
														}
														catch(_tufta_)
														{
																linkProp = '';
														}
		
												_template = "view_doc.html?mode=" + linkMode + "&object_id=" + _cur_link_field + "&doc_id=" + curDocID + linkProp;
		%>
						<td class="<%=_class%>" <%=_row_bk_color%>><a href="<%=_template%>"><%=_column_name%>&nbsp;</a></td>
		<%
										}
										else
										{
		%>
						<td class="<%=_class%>" <%=_row_bk_color%>><%=_column_name%></td>
		<%
										}
								}
								catch ( err )
								{
		%>
						<td class="<%=_class%>"><font color="#FF0000"><%=err%></font></td>
		<%
								}
						}
		
						for ( _column in colCells )
						{
		%>
						<td class="<%=_class%>" <%=_row_bk_color%>><%=eval( _column )%></td>
		<%
						}
						for (iFirstArrElem in curFirstArray)
						{
							if (ArrayOptFirstElem(iFirstArrElem.arrMethods)!=undefined)
							{
								for(iMethodElem in iFirstArrElem.arrMethods)
								{
									checked=''
									originally_checked='originally_checked="false"'
									curRequest=ArrayOptFind(arrPersonMethodRequest,"method_id=="+iMethodElem.id+"&&person_id=="+ListElem.id)
									if (curRequest!=undefined)
									{
										checked='checked="checked"'
										originally_checked='originally_checked="true"'
										curRequest.bHasUsers=true;
									}
		%>
									<td class="<%=_class%>" align="center" <%=_row_bk_color%>><input type="checkbox"  title="<%=ListElem.fullname%>" onchange="set_change('<%=iMethodElem.id%>')" <%=checked%> <%=originally_checked%> id="elem_counter<%=counter%>_<%=iMethodElem.id%>" name="elem_counter<%=counter%>_<%=iMethodElem.id%>"/><input type='hidden'  id='elem_<%=counter%>_person_id' name='elem_<%=counter%>_person_id' value='<%=ListElem.id%>'/></td>
		<%								
								}	
							}
							else
							{
		%>
								<td class="<%=_class%>" <%=_row_bk_color%>>&nbsp;</td>
		<%		
							}
						}
		if (show_other)
		{
				if (ArrayOptFirstElem(curSecondArray)!=undefined)
				{
							for(iMethodElem in curSecondArray)
							{
								checked=''
								originally_checked='originally_checked="false"'
								curRequest=ArrayOptFind(arrPersonMethodRequest,"method_id=='"+iMethodElem.id+"'&&person_id=="+ListElem.id)
								if (curRequest!=undefined)
								{
									checked='checked="checked"'
									originally_checked='originally_checked="true"'
									curRequest.bHasUsers=true;
								}
	%>
								<td class="<%=_class%>" align="center" <%=_row_bk_color%>><input type="checkbox" onchange="set_change('<%=iMethodElem.id%>')" <%=checked%> <%=originally_checked%> id="elem_counter<%=counter%>_<%=iMethodElem.id%>" name="elem_counter<%=counter%>_<%=iMethodElem.id%>"/><input type='hidden'  id='elem_<%=counter%>_person_id' name='elem_<%=counter%>_person_id' value='<%=ListElem.id%>'/></td>
	<%								
							}
				}
				else
				{
%>
					<td class="<%=_class%>" <%=_row_bk_color%>>&nbsp;</td>
<%		
				}								
		}
%>
						<td class="<%=_classr%>"></td>
				</tr>
		<%
				}
		%>
				<tr>
						<td class="tableFooterLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter" colspan="<%=TotalcolumnNum%>"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooterRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>		
		</table>
		<br/>
<div name="secretArea" id="secretArea">		
		<input type='hidden'  id='elem_counter' name='elem_counter' value='<%=counter%>'/>	
		<input type="hidden" id="other_counter" name='other_counter' value="<%=OtherMethodcolumnNum%>"/>
</div>	
<%	
		
		//--end catalog_list--
	}
%>
	</td>
</tr>
</table>
	<center>
		<input type="button" id="b_save" onclick="doSubmit('save')" value="<%=tools.get_web_str('c_save')%>" class="inputButton" onMouseOver="this.className='inputButtonOver';" onMouseOut="this.className='inputButton';"/>
	</center>
<%

%>
	</form>		
</div>
<div id="bm_1" <%=(_selectedTab != 1 ? 'style="display: none"' : '')%>>

<%
	arrHeaders=Array()
	arrHeaders[0]=tools.get_web_str('c_code')
	arrHeaders[1]=tools.get_web_str('c_create_date');
	arrHeaders[2]=tools.get_web_str('c_name');
	arrHeaders[3]=tools.get_web_str('c_object');
	arrHeaders[4]=tools_web.get_web_str('vtmb_coll_num');
	arrHeaders[5]=tools.get_web_str('c_coll')

	ColHeaders=ArrayCount(arrHeaders)

	fieldArray=Array()
	try
	{
		curReqObject=OpenNewDoc( 'x-local://wtv/wtv_request.xmd' ).TopElem;
		curReqObject.request_type_id=template_req_type_id
		_cur_template = tools.get_custom_template( curReqObject.Name, null, curReqObject );
		if ( _cur_template !=  null )
		{
			TempFieldArray = ArraySelect( _cur_template.fields, 'disp_web' );
			//fieldArray=ArrayUnion(ArraySelect( TempFieldArray, 'type!="file"'),ArraySelect( TempFieldArray, 'type=="file"'))
			fieldArray=TempFieldArray
		}
	}
	catch(ex)
	{
	}
	_str_required = '';	
		
	_first_flag = true;
	_fields_str=''
	_fields_type_str=''
	_field_required_count=0;
	for ( _field in ArraySelect( fieldArray, 'disp_web' ) )
	{
	
		_str = '';
		if ( _field.is_required )
		{
			_str = '*';
			if ( _field.type != 'heading' && _field.type != 'bool' )
			{
				_str_required = _str_required + ( _first_flag ? '' : ',' ) + '' + _field.name + '';
				_first_flag = false;
				_field_required_count++;
			}
		}
		_fields_str=_fields_str+_field.name+';'
		_fields_type_str=_fields_type_str+_field.type+';'
		arrHeaders[ColHeaders]=tools_web.get_cur_lng_name( _field.title )+_str
		ColHeaders++;
	}

	arrRequestShow=QueryCatalogByKeys('requests','id',ArrayExtract(ArraySelect(arrPersonMethodRequest,'bHasUsers==true'),'req_id'))							
%>
<script language="javascript">
//<!--

function get_field_names ()
{
	return '<%=_fields_str%>'
}
function get_field_types ()
{
	return '<%=_fields_type_str%>'
}
function get_required_string ()
{
	return '<%=_str_required%>'
}
function check_required(param,show_alert)
{
	//alert(param)
	//alert(<%=_str_required%>)
	str_required=get_required_string()
	var reqArray = str_required.split(',')
	for ( var i=0; i<reqArray.length; i++ )
		try
		{
			if ( document.getElementById('td_'+reqArray[i]+'_'+param).innerHTML == '' )
			{
				if (show_alert)
				{
					alert("<%=tools.get_web_str('uc_error2')%>");
				}
				return false;
			}
		}
		catch ( ff )
		{
		
		}
		
	return true;
}

//-->
</script>
<table width="100%" class="tableBasic" border="0" cellspacing="0" cellpadding="0">
				<tr>
						<td class="tableHeaderWithTextLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
<%
	for (iHeaderElem in arrHeaders)
	{
%>
						<td  class="tableHeaderWithText" ><%=iHeaderElem%></td>
<%
	}
%>
						<td class="tableHeaderWithTextRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
				<tr>
						<td class="tableHeaderNoTextLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText" colspan="<%=ColHeaders+1%>"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoTextRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
				<tr>
<%
				counter = 0;
				for ( ListElem in arrRequestShow )
				{		
						_class = counter % 2 ? 'tableRowEven' : 'tableRowOdd';
						_classl = counter % 2 ? 'tableRowEvenLeft' : 'tableRowOddLeft';
						_classr = counter % 2 ? 'tableRowEvenRight' : 'tableRowOddRight';
						counter++
						
						_object_type = (ListElem.type.HasValue ? curLngCommon.exchange_object_types.GetOptChildByKey( ListElem.type ) : undefined );
						
		%>
				<tr id="tr_req_<%=ListElem.id%>">
						<td class="<%=_classl%>">&nbsp;</td>
						<td id="td_fill_req<%=ListElem.id%>" class="<%=_class%>">&nbsp;</td>
						<td class="<%=_class%>" title="<%=tools_web.get_web_str('tmb_edit_request')%>"><a href="javascript: editRequestFields('<%=ListElem.id%>');"><%=ListElem.code%>&nbsp;</a></td>
						<td class="<%=_class%>" title="<%=tools_web.get_web_str('tmb_edit_request')%>" align="left"><a href="javascript: editRequestFields('<%=ListElem.id%>');"><%=StrDate( ListElem.create_date, true, false )%></a></td>
						<td class="<%=_class%>" align="center">
<%
		if ( _object_type != undefined )
		{
		
			if ( _object_type.web_template.HasValue && ListElem.object_id.HasValue)
			{
%>
				<a href="<%=_object_type.web_template%>&doc_id=<%=curDocID%>&object_id=<%=ListElem.object_id%>"><%=tools_web.get_cur_lng_name( ListElem.object_name )%></a>
<%
			}
			else
			{
				Response.Write( tools_web.get_cur_lng_name( ListElem.object_name ) );
			}
		}
		else
		{
			Response.Write( '\&nbsp;' );
		}
%>
						</td>
						<td class="<%=_class%>" align="center"><%=( _object_type != undefined ? _object_type.title : '&nbsp;' )%></td>
						<td class="<%=_class%>" id='personCount_<%=ListElem.id%>' name='personCount_<%=ListElem.id%>' align="center"><%=ListElem.person_num%></td>
						<td class="<%=_class%>" align="center"><a href="view_doc.html?mode=collaborator&doc_id=<%=curDocID%>&object_id=<%=ListElem.person_id%>"><%=ListElem.person_fullname%></a></td>
						
<%
						try
						{
							teRequest=OpenDoc(UrlFromDocID(ListElem.id)).TopElem;
						}
						catch(ex)
						{
						}
						_cur_field_required_count=0
						for ( _field in ArraySelect( fieldArray, 'disp_web' ) )
						{
							
							try
							{
								_value = teRequest.custom_elems.GetChildByKey( _field.name ).value;
							}
							catch ( dd )
							{
								_value = '';
							}
							
							if(_field.is_required)
							{
								if ( _field.type != 'heading' && _field.type != 'bool' )
								{
									if (Trim(_value)!='')
									{
										_cur_field_required_count++;
									}
								}
								
							}
							add_custom_fields(_field,ListElem.id,_class,_value)
						}
						if(_cur_field_required_count==_field_required_count)
						{
%>
						<td class="<%=_classl%>"></td>
<script language="javascript">
//<!--
						document.getElementById('td_fill_req<%=ListElem.id%>').innerHTML='<img src="pics/vwicn082.gif"/>'
//-->
</script>	
<%
						}
%>			
				</tr>
<%
										
				}
%>				
				<tr>
						<td class="tableFooterLeft"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter" colspan="<%=ColHeaders+1%>"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooterRight"><img src="pics/1blank.gif" width="1" height="1" /></td>
				</tr>
</table>
<center>	
	<%=tools.get_web_str('c_text_required_filds')%>
</center>
</div>


<%
	
%>
	