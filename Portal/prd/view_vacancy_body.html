<%
	_url = ( StrBegins( global_settings.settings.recruitment.estaff_server_url, 'http://' ) || StrBegins( global_settings.settings.recruitment.estaff_server_url, 'https://' ) ? '' : tools_web.get_url_protocol( Request.Url ) ) + global_settings.settings.recruitment.estaff_server_url;
	resp = HttpRequest( UrlAppendPath( _url, '/active_position.xml?eid=' + Request.QueryString.eid ), 'get' );
	respDoc = OpenDocFromStr( resp.Body, "form=x-local://wtv/estaff/active_position.xmd" ).TopElem;
	
	strSubDivName=''
	if (respDoc.subdivision_data.disp_name.HasValue||respDoc.subdivision_data.name.HasValue)
	{
		strSubDivName=respDoc.subdivision_data.disp_name.HasValue?respDoc.subdivision_data.disp_name:respDoc.subdivision_data.name
	}
	else
	{
		if (respDoc.eid.HasValue)
		{
			fldRequest=ArrayOptFirstElem(XQuery('for $elem in requests where $elem/id='+respDoc.eid+' return $elem'))
			
			if (fldRequest!=undefined)
			{
				try
				{
					teRequest=OpenDoc( UrlFromDocID ( fldRequest.id )).TopElem;
					strSubDivName=teRequest.person_subdivision_name
				}
				catch(ex)
				{
				}
			}
		}
	}
%>
<table width="100%" cellspacing="0" cellpadding="4" class="tableBorder">
	<tr>		
		<td width="170" align="RIGHT"><%=tools.get_web_str('c_name')%>:</td>
		<td align="LEFT" style="font-weight:normal;"><%=respDoc.name%></td>
	</tr>
	<tr>
		<td width="170" align="RIGHT"><%=tools.get_web_str('c_customer')%>:</td>
		<td align="LEFT" style="font-weight:normal;"><%=respDoc.person_data.fullname%></td>
	</tr>
	<tr>
		<td width="170" align="RIGHT"><%=tools.get_web_str('c_subd')%>:</td>
		<td align="LEFT" style="font-weight:normal;"><%=tools_web.get_cur_lng_name( strSubDivName )%></td>
	</tr>

</table>
<br>
<br>



<div class="headerText" style="margin-top:10px;margin-bottom:5px;margin-left:5px;"><%=tools.get_web_str('c_candidates')%></div>

<table width="100%"  border="0" cellspacing="0" cellpadding="3">
  <tr>
    <td class="tableHeaderWithText"><%=tools.get_web_str('c_fio')%></td>
    <td class="tableHeaderWithText" width="100px"><%=tools.get_web_str('c_start_date')%></td>
	<td class="tableHeaderWithText" width="100px"><%=tools.get_web_str('c_finish_date')%></td>
	<td class="tableHeaderWithText" width="180px"><%=tools.get_web_str('c_state')%></td>
  </tr>
  <tr>
    <td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
    <td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
  </tr>
<%				
	counter = 0;
	for ( _person in respDoc.work_candidates )
	{
		_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
%>
  <tr valign="MIDDLE">
    <td class="<%=_class%>"><a href="view_doc.html?mode=candidate&doc_id=<%=curDocID%>&eid=<%=_person.candidate_eid%>" title="<%=tools.get_web_str('c_tip_candidate')%>"><%=_person.fullname%></a></td>
    <td class="<%=_class%>" align="CENTER"><%=StrDate( _person.state_date, false )%></td>
	<td class="<%=_class%>" align="CENTER"><%=StrDate( _person.state_end_date, false )%></td>
	<td class="<%=_class%>" align="CENTER"><%=_person.state_desc%></td>
  </tr>
<%
	}
%>  
  <tr>
    <td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
    <td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
	<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
  </tr>
</table>
<br/>
