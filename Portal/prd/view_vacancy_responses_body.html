<%
Server.Execute( "include/access_init.html" );
result_array = Array();
if ( curUserID != undefined )
	result_array = XQuery( "for $elem in vacancy_responses where $elem/person_id=" + curUserID + " return $elem" );
	
if ( Request.Form.HasProperty("sort_field") && Request.Form.GetProperty("sort_field") != "")
	result_array = ArraySort( result_array, Request.Form.GetProperty("sort_field"), Request.Form.HasProperty("sort_type") ? Request.Form.GetProperty("sort_type") : "+" );
	
if ( Request.Form.HasProperty("vacancy_response_id") && Request.Form.GetProperty("vacancy_response_id") != "")
{
	try
	{
		DeleteDoc( UrlFromDocID( Int( Request.Form.GetProperty("vacancy_response_id") ) ) )
	}
	catch(err)
	{}
}
%>

<script language="javascript">	
	function sort_result(_field_name)
	{
		document.getElementById("sort_field").value = _field_name;
		_old_value = document.getElementById("sort_type").value;
		document.getElementById("sort_type").value = ( _old_value == "+" ? "-" : "+" );
		document.all["form_sort"].submit();
	}
	
	function question( _form_name )
	{
		if ( confirm('Вы уверены, что хотите удалить отклик?') )
		{
			document.all[_form_name].submit();
		}
	}
	
</script>


<form ACTION="<%=Request.Url%>" name="form_sort" method="post">
	<input type=hidden name="sort_field" id="sort_field" value="<%=Request.Form.HasProperty('sort_field') ? Request.Form.GetProperty('sort_field') : 'name'%>">
	<input type=hidden name="sort_type" id="sort_type" value="<%=Request.Form.HasProperty('sort_type') ? Request.Form.GetProperty('sort_type') : '+'%>">

</form>

<table width="100%"  border="0" cellspacing="0" cellpadding="3">
					<tr>
						<td class="tableHeaderWithText">&nbsp;</td>
						<td class="tableHeaderWithText" width="20%"><a href="<%=Request.Url%>#" onclick="sort_result( 'creation_date' )">Дата</a></td>
						<td class="tableHeaderWithText"><a href="<%=Request.Url%>#" onclick="sort_result( 'vacancy_name' )">Вакансия</a></td>

						<td class="tableHeaderWithText"><a href="<%=Request.Url%>#" onclick="sort_result( 'status' )">Состояние</a></td>
						<td class="tableHeaderWithText"><a href="<%=Request.Url%>#" onclick="sort_result( 'resume_id' )">Резюме</a></td>
						<td class="tableHeaderWithText">&nbsp;</td>						
						<td class="tableHeaderWithText">&nbsp;</td>
					</tr>
					<tr>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>				
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>	
						<td class="tableHeaderNoText"><img src="pics/1blank.gif" width="1" height="1" /></td>	
					</tr>
					
	<%
		counter = 0;
		for ( _result in result_array  )
		{
			//_class = counter++ % 2 ? 'tableRowEven' : 'tableRowOdd';
			_class = "";
			if ( _result.status == "accepted" )
				_class = ' bgcolor="#CCFFCC"';
			if ( _result.status == "rejected" )
				_class = ' bgcolor="#FFCCFF"';
			try
			{
				vacancyDoc = OpenDoc(UrlFromDocID( _result.vacancy_id )).TopElem;
				if ( vacancyDoc.is_closed )
					_class = ' bgcolor="#CCCCCC"';
			}
			catch(err)
			{
				//continue;
				vacancyDoc = null;
			}
	%>
				<TR VALIGN="MIDDLE">					
						<TD <%=_class%>>&nbsp;</TD>
						<TD <%=_class%>><a href="view_doc.html?mode=vacancy_response&object_id=<%=_result.id%>&doc_id=<%=curDocID%>"><%=_result.creation_date%></a></TD>
						<TD <%=_class%>><a HREF="view_doc.html?mode=vacancy&object_id=<%=_result.vacancy_id%>&doc_id=<%=curDocID%>"><%=_result.vacancy_name%> </a><%=( vacancyDoc != null && vacancyDoc.is_closed ? " -> в архиве" : "" )%></TD>
						<TD <%=_class%>><%=_result.status.HasValue ? _result.status.OptForeignElem.name : ""%></TD>
						<TD <%=_class%>>
						<%
							if ( _result.resume_id.HasValue )
								try
								{
									resumeDoc = OpenDoc( UrlFromDocID( _result.resume_id )  ).TopElem;
									Response.Write( "<a href='view_doc.html?resume&object_id=" + _result.resume_id + "&doc_id=" + curDocID + "'>" + resumeDoc.name + "</a>")
								}
								catch(err)
								{
									alert(err)
								}
						%></TD>
						<TD <%=_class%> valign=center>
						<form action="<%Request.Url%>" name="delete_response_<%=_result.id%>" method="post"> 
						  <a href="#" onclick="question('delete_response_<%=_result.id%>')"><img border="0" src="pics/Delete_2.gif"></a>
                          <input type="hidden" name="vacancy_response_id" value="<%=_result.id%>"/> 
                        </form> 
						
						
						</TD>
						<TD <%=_class%>></TD>
					</TR>
	
	<%
		}
	%>					
					
					<tr>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>
						<td class="tableFooter"><img src="pics/1blank.gif" width="1" height="1" /></td>						
					</tr>
		</table>