<%
Server.Execute( "../include/user_init.html" );
function GetChildArticles(bid, aid)
{
	Articles = XQuery("for $obj in articles where $obj/book_id = " + bid + 
    					" and $obj/parent_object_id = " + ( aid != 0 ? aid : "null()" ) + " order by $obj/weight,$obj/name return $obj");
                        
   	curObj = ( aid == 0 ? bid : aid );
	js_str += "parent.addContent('" + curObj + "');\n";
 
	for (_article in Articles)
    {
		Response.Write( "articleTree" + _article.id + " = insFld( " + ( aid == 0 ? ("bookTree" + bid) : ("articleTree" + aid) ) + ", gFld('<img src=\"img/article.gif\" border=0>&nbsp;" + HtmlEncode(_article.name) + "', 'JavaScript:if(window.frames[0].do_display) window.frames[0].do_display(\"" + _article.id + "\",null, \"" +(curDocID)+ "\"); else if (parent.do_display) do_display(\"" + _article.id + "\",null, \"" +(curDocID)+ "\");') );\n" );
    	GetChildArticles(bid, _article.id);
    }
}
try
{
	curDocID = Int(Request.Query.doc_id);
}
catch(_X_)
{
	curDocID = null;
}
curObjectID = 0;
if ( Request.QueryString.HasProperty("oid") )
{
	try
    {
		curObjectID = Int(Request.QueryString.GetProperty("oid"));
	}
    catch(err)
    {
		alert(tools.get_web_str('rp_err_not_resourse'));
    }
}
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<title>TOC</title>
<link href="../style.css" rel="stylesheet" type="text/css"/>
</head>
<body class="libraryLeftPanel">

<script src="../scripts/tree/ua000000.js"></script>
<script src="../scripts/tree/ftiens40.js"></script>
<script language="javascript">

USETEXTLINKS = 1;
STARTALLOPEN = 0;
USEFRAMES = 0;
USEICONS = 0;
WRAPTEXT = 1;
PRESERVESTATE = 1;
ICONPATH = "..\\scripts\\tree\\";

foldersTree = gFld( '<img src="img/folder.gif" border=0>&nbsp;<b><%=tools.get_web_str("c_library")%></b>', 'JavaScript:parent.do_display("0",null,"<%=curDocID%>");' );
<%
js_str = "parent.clearContent();\n";
RootBooks = XQuery("for $obj in books" + ( curObjectID != 0 ? " where $obj/id = " + curObjectID : "") + " order by $obj/name return $obj");
for (_book in RootBooks)
if (tools_web.check_access(OpenDoc(UrlFromDocID(_book.PrimaryKey), "form=x-local://wtv/wtv_form_doc_access.xmd;ignore-top-elem-name=1").TopElem, curUserID, curUser, Session))
{
	Response.Write( "bookTree" + _book.id + " = insFld( foldersTree, gFld('<img src=\"img/folder.gif\" border=0>&nbsp;<b>" + HtmlEncode(_book.name) + "</b>', 'JavaScript:if(window.frames[0].do_display) window.frames[0].do_display(\"" + _book.id + "\",null, \"" +(curDocID)+ "\"); else if (parent.do_display) do_display(\"" + _book.id + "\",null, \"" +(curDocID)+ "\");') );\n" );

	GetChildArticles(_book.id, 0);
}
%>
</script>

<span class="TreeviewSpanArea" style="overflow:auto">
	<script>initializeDocument();</script>
</span>
<script language="javascript">
<%=js_str%>
parent.do_display("<%=curObjectID%>",null,"<%=curDocID%>");
</script>
</body>
</html>